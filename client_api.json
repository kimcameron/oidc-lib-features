{"issuer":"client_api","oidc_lib_version":"^2.7.5","code":{"applications.json":"ew0KICAiYXBwX2xhdW5jaGVyIjogew0KICAgICJjb21wYW55X25hbWUiOiJBcHBsaWNhdGlvbiBMYXVuY2hlciIsDQogICAgImlucHV0X2lzc3VlciI6IjwtLUlTU1VFUl9IT1NULS0-L29oaXAiLA0KICAgICJpbnB1dF9jcmVkZW50aWFsX3R5cGUiOiI8LS1TTUFSVF9DUkVERU5USUFMX0hPU1QtLT4vc21hcnQtY3JlZGVudGlhbC9PbnRhcmlvLUhlYWx0aC1JbnN1cmFuY2UtUGxhbiIsDQogICAgImlucHV0X2NyZWRlbnRpYWxfbmFtZSI6IkRpZ2l0YWwgT0hJUCBDYXJkIiwNCiAgICAiaW5wdXRfY3JlZGVudGlhbF9yZWFzb24iOiJSZXF1aXJlZCB0byBhY2Nlc3MgT250YXJpbyBIZWFsdGggQXBwbGljYXRpb25zIiwNCiAgICAiZGVmYXVsdF93YWxsZXQiOiI8LS1XQUxMRVQtLT4vd2FsbGV0L3dhbGxldC5odG1sIiwNCiAgICAib3V0cHV0X2lzc3VlciI6IjwtLUlTU1VFUl9IT1NULS0-L29oaXBfc21hcnRoZWFsdGhjYXJkIiwNCiAgICAiYXBwbGljYXRpb25fdXJsIjogIjwtLUFQUF9MQVVOQ0hFUi0tPi9hcHBfbGF1bmNoZXIiLA0KICAgICJ2YWxpZF90YXJnZXRfbGlua191cmlzIjogWw0KICAgICAgICAiPC0tQVBQX0xBVU5DSEVSLS0-L2FwcF9sYXVuY2hlciINCiAgICBdDQogIH0sDQogICJvaGlwIjogew0KICAgICJjb21wYW55X25hbWUiOiAiRGlnaXRhbCBPSElQIENhcmQiLA0KICAgICJvdXRwdXRfY3JlZGVudGlhbF90eXBlIjogIjwtLVNNQVJUX0NSRURFTlRJQUxfSE9TVC0tPi9zbWFydC1jcmVkZW50aWFsL09udGFyaW8tSGVhbHRoLUluc3VyYW5jZS1QbGFuIiwNCiAgICAib3V0cHV0X2NyZWRlbnRpYWxfcmVhc29uIjogIkFjY2VzcyBPbnRhcmlvIEhlYWx0aCBBcHBsaWNhdGlvbnMiLA0KICAgICJ2YWxpZF90YXJnZXRfbGlua191cmlzIjogWw0KICAgICAgICAiPC0tSVNTVUVSX0hPU1QtLT4vY3JlZGVudGlhbC9hdXRoX3VzZXJhZ2VudF9yZXNwb25zZSINCiAgICBdDQogIH0sDQogICJvaGlwX2NvdmlkIjogew0KICAgICJjb21wYW55X25hbWUiOiAiT250YXJpbyBDT1ZJRCBUZXN0IExhYnMiLA0KICAgICJpbnB1dF9jcmVkZW50aWFsX3R5cGUiOiAiPC0tU01BUlRfQ1JFREVOVElBTF9IT1NULS0-L3NtYXJ0LWNyZWRlbnRpYWwvT250YXJpby1IZWFsdGgtSW5zdXJhbmNlLVBsYW4iLA0KICAgICJpbnB1dF9jcmVkZW50aWFsX3JlYXNvbiI6ICJPYnRhaW4gYSBDb3ZpZCBUZXN0IENhcmQiLA0KICAgICJ2YWxpZF90YXJnZXRfbGlua191cmlzIjogWw0KICAgICAgICAiPC0tQ0xJRU5UX0FQSS0tPi9vaGlwX2NvdmlkL2NpVUlSZXN1bHQiDQogICAgXQ0KICB9LA0KICAib2hpcF9zbWFydGhlYWx0aGNhcmQiOiB7DQogICAgImNvbXBhbnlfbmFtZSI6ICJPbnRhcmlvIENPVklEIFN0YXR1cyIsDQogICAgImRpc2FibGUtaW5wdXRfY3JlZGVudGlhbF90eXBlIjogIjwtLVNNQVJUX0NSRURFTlRJQUxfSE9TVC0tPi9zbWFydC1jcmVkZW50aWFsL09udGFyaW8tSGVhbHRoLUluc3VyYW5jZS1QbGFuIiwNCiAgICAiaW5wdXRfY3JlZGVudGlhbF9yZWFzb24iOiAiT2J0YWluIGFuIE9udGFyaW8gQ09WSUQgU21hcnQgSGVhbHRoY2FyZCIsDQogICAgInZhbGlkX3RhcmdldF9saW5rX3VyaXMiOiBbDQogICAgICAgICI8LS1DTElFTlRfQVBJLS0-L29oaXBfc21hcnRoZWFsdGhjYXJkL2NpVUlSZXN1bHQiDQogICAgXQ0KICB9LA0KICAiZ2F0ZXdheSI6IHsNCiAgICAiY29tcGFueV9uYW1lIjogIk9udGFyaW8gSGVhbHRoIE5ldHdvcmsgR2F0ZXdheSIsDQogICAgImNvbXBhbnlfbG9nbyI6ICIvd2ViL2ltZy91aG4uanBnIiwNCiAgICAiaW5wdXRfY3JlZGVudGlhbF90eXBlIjogIjwtLVNNQVJUX0NSRURFTlRJQUxfSE9TVC0tPi9zbWFydC1jcmVkZW50aWFsL09udGFyaW8tSGVhbHRoLUluc3VyYW5jZS1QbGFuIiwNCiAgICAiaW5wdXRfY3JlZGVudGlhbF9yZWFzb24iOiAiUmVxdWlyZWQgdG8gZW50ZXIgT250YXJpbyBIZWFsdGggTmV0d29yayBHYXRld2F5IiwNCiAgICAiYXBwbGljYXRpb25fdXJsIjogIjwtLUdBVEVXQVktLT4vZ2F0ZXdheSIsDQogICAgInZhbGlkX3RhcmdldF9saW5rX3VyaXMiOiBbDQogICAgICAgICI8LS1HQVRFV0FZLS0-L2dhdGV3YXkvYXV0aF91c2VyYWdlbnRfcmVzcG9uc2UiDQogICAgXSwNCiAgICAicmVzcG9uc2VfdHlwZSI6ICJpZF90b2tlbiINCiAgfSwgIA0KICAidWhuIjogew0KICAgICJjb21wYW55X25hbWUiOiAiVW5pdmVyc2l0eSBIZWFsdGggTmV0d29yayIsDQogICAgImNvbXBhbnlfbG9nbyI6ICJ1bmRlZmluZWQvd2ViL2ltZy91aG4ucG5nIiwNCiAgICAiaW5zdHJ1Y3Rpb25zIjogIlNjYW4gd2l0aCB5b3VyIE9udGFyaW8gSGVhbHRoIFdhbGxldCIsDQogICAgImlucHV0X2NyZWRlbnRpYWxfdHlwZSI6ICI8LS1TTUFSVF9DUkVERU5USUFMX0hPU1QtLT4vc21hcnQtY3JlZGVudGlhbC9PbnRhcmlvLUhlYWx0aC1JbnN1cmFuY2UtUGxhbiIsDQogICAgImlucHV0X2NyZWRlbnRpYWxfcmVhc29uIjogIlJlcXVpcmVkIHRvIGVudGVyIGEgVUhOIGhvcGl0YWwgZm9yIGV2ZXJ5b25lJ3MgcHJvdGVjdGlvbiBhbmQgdG8gc3R1ZHkgdHJhbnNtaXNzaW9uIHBhdHRlcm5zIiwNCiAgICAiYXBwbGljYXRpb25fdXJsIjogIjwtLVVITi0tPi91aG4iLA0KICAgICJ2YWxpZF90YXJnZXRfbGlua191cmlzIjogWw0KICAgICAgICAiPC0tVUhOLS0-L3Vobi9sYW5kaW5nX3BhZ2UiDQogICAgXQ0KICB9LA0KICAiYWlyY2FuYWRhIjogew0KICAgICJjb21wYW55X25hbWUiOiAiQWlyIENhbmFkYSIsDQogICAgImNvbXBhbnlfbG9nbyI6ICIvd2ViL2ltZy9sb2dvLnBuZyIsDQogICAgImluc3RydWN0aW9ucyI6ICJTY2FuIHdpdGggeW91ciBPbnRhcmlvIEhlYWx0aCBXYWxsZXQgdG8gRW50ZXIgQ09WSUQtU2FmZSBDYWJpbiIsDQogICAgImlucHV0X2NyZWRlbnRpYWxfdHlwZSI6ICI8LS1TTUFSVF9DUkVERU5USUFMX0hPU1QtLT4vc21hcnQtY3JlZGVudGlhbC9PSC1TbWFydEhlYWx0aENhcmQtUHJvb2YiLA0KICAgICJpbnB1dF9jcmVkZW50aWFsX3JlYXNvbiI6ICJSZXF1aXJlZCB0byBlbnRlciBhIENPVklELVNhZmUgQ2FiaW4iLA0KICAgICJhcHBsaWNhdGlvbl91cmwiOiAiPC0tREVOVElTVC0tPi9haXJjYW5hZGEiLA0KICAgICJ2YWxpZF90YXJnZXRfbGlua191cmlzIjogWw0KICAgICAgICAiPC0tREVOVElTVC0tPi9haXJjYW5hZGEvbGFuZGluZ19wYWdlIg0KICAgIF0NCiAgfSwNCiAgImRlbnRpc3QiOiB7DQogICAgImNvbXBhbnlfbmFtZSI6ICJIYXBweSBTbWlsZSBGYW1pbHkgRGVudGlzdHMiLA0KICAgICJjb21wYW55X2xvZ28iOiAiL3dlYi9pbWcvbG9nby5wbmciLA0KICAgICJpbnN0cnVjdGlvbnMiOiAiU2NhbiB3aXRoIHlvdXIgT250YXJpbyBDb3ZpZCBDYXJkIHRvIGJvb2sgYW4gYXBwb2ludG1lbnQiLA0KICAgICJpbnB1dF9jcmVkZW50aWFsX3R5cGUiOiAiPC0tU01BUlRfQ1JFREVOVElBTF9IT1NULS0-L3NtYXJ0LWNyZWRlbnRpYWwvT0gtU21hcnRIZWFsdGhDYXJkLVByb29mIiwNCiAgICAiaW5wdXRfY3JlZGVudGlhbF9yZWFzb24iOiAiUmVxdWlyZWQgdG8gYm9vayBhIHNhZmUgYXBwb2ludG1lbnQiLA0KICAgICJhcHBsaWNhdGlvbl91cmwiOiAiPC0tREVOVElTVC0tPi9kZW50aXN0IiwNCiAgICAidmFsaWRfdGFyZ2V0X2xpbmtfdXJpcyI6IFsNCiAgICAgICAgIjwtLURFTlRJU1QtLT4vZGVudGlzdC9sYW5kaW5nX3BhZ2UiDQogICAgXQ0KICB9LA0KICAibGl0dGxlX2xhdW5jaGVyIjogew0KICAgICJjb21wYW55X25hbWUiOiJMaXR0bGUgTGF1bmNoZXIgQ29ycG9yYXRpb24iLA0KICAgICJpbnB1dF9pc3N1ZXIiOiI8LS1JU1NVRVJfSE9TVC0tPi9vaGlwIiwNCiAgICAiaW5wdXRfY3JlZGVudGlhbF90eXBlIjoiPC0tU01BUlRfQ1JFREVOVElBTF9IT1NULS0-L3NtYXJ0LWNyZWRlbnRpYWwvT250YXJpby1IZWFsdGgtSW5zdXJhbmNlLVBsYW4iLA0KICAgICJpbnB1dF9jcmVkZW50aWFsX25hbWUiOiJEaWdpdGFsIE9ISVAgQ2FyZCIsDQogICAgImlucHV0X2NyZWRlbnRpYWxfcmVhc29uIjoiUmVxdWlyZWQgdG8gYWNjZXNzIHRoZSBMaXR0bGUgTGF1bmNoZXIiLA0KICAgICJkZWZhdWx0X3dhbGxldCI6IjwtLVdBTExFVC0tPi93YWxsZXQvd2FsbGV0Lmh0bWwiLA0KICAgICJvdXRwdXRfaXNzdWVyIjoiPC0tSVNTVUVSX0hPU1QtLT4vb2hpcF9jb3ZpZCIsDQogICAgImFwcGxpY2F0aW9uX3VybCI6ICI8LS1BUFBfTEFVTkNIRVItLT4vYXBwX2xhdW5jaGVyL2xpdHRsZV9sYXVuY2hlci5odG1sIiwNCiAgICAidmFsaWRfdGFyZ2V0X2xpbmtfdXJpcyI6IFsNCiAgICAgICAgIjwtLUFQUF9MQVVOQ0hFUi0tPi9hcHBfbGF1bmNoZXIvbGl0dGxlX2xhdW5jaGVyLmh0bWwiLA0KICAgICAgICAiPC0tQVBQX0xBVU5DSEVSLS0-L2FwcF9sYXVuY2hlci9saXR0bGVfbGF1bmNoZXJfcG9zdF9kZWJ1Zy5qcyIsDQogICAgICAgICI8LS1BUFBfTEFVTkNIRVItLT4vYnVpbGQvaW5kZXguaHRtbCINCiAgICBdDQogIH0NCn0","client_api.js":"bW9kdWxlLmV4cG9ydHMgPSB7DQoJcmVnaXN0ZXJFbmRwb2ludHM6IHJlZ2lzdGVyRW5kcG9pbnRzDQp9DQoNCmNvbnN0IGNvbnRlbnRNb2R1bGVOYW1lID0gJ2NsaWVudF9hcGknOw0KdmFyIGNsaWVudF9hcGlfdXJsID0gJy8nICsgY29udGVudE1vZHVsZU5hbWU7DQoNCnZhciBwayA9IG51bGw7DQp2YXIgc2lvcF9jbGllbnRzID0ge307DQoNCmZ1bmN0aW9uIHJlZ2lzdGVyRW5kcG9pbnRzKHBrU291cmNlKSB7DQoJcGsgPSBwa1NvdXJjZTsNCg0KICBpbml0aWFsaXplQXBwQ29uZmlndXJhdGlvbnMoKTsNCg0KICB2YXIgZW5kcG9pbnQgPSBjbGllbnRfYXBpX3VybCArICcvcXJfY29kZS86Y2xpZW50JzsNCiAgcGsuYXBwLm9wdGlvbnMoZW5kcG9pbnQsIHBrLmNvcnMoKSk7DQogIHBrLmFwcC5nZXQoZW5kcG9pbnQsIHBrLnV0aWwuY29yc09wdGlvbnMoKSwgZnVuY3Rpb24ocmVxLCByZXMpew0KICAgIGdldF9jbGllbnRfcXJfY29kZV9hbmRfdXJsKHJlcSwgcmVzKTsNCiAgfSk7DQoNCiAgdmFyIGVuZHBvaW50ID0gY2xpZW50X2FwaV91cmwgKyAnL2lzc3Vlcl9xcl9jb2RlLzpjbGllbnQnOw0KICBway5hcHAub3B0aW9ucyhlbmRwb2ludCwgcGsuY29ycygpKTsNCiAgcGsuYXBwLmdldChlbmRwb2ludCwgcGsudXRpbC5jb3JzT3B0aW9ucygpLCBmdW5jdGlvbihyZXEsIHJlcyl7DQogICAgZ2V0X2lzc3Vlcl9jcmVkZW50aWFsX3JlcXVlc3RfcXJjb2RlKHJlcSwgcmVzKTsNCiAgfSk7DQoNCiAgdmFyIGVuZHBvaW50ID0gY2xpZW50X2FwaV91cmwgKyAnL29pZGNfaW5pdC86Y2xpZW50JzsNCiAgcGsuYXBwLm9wdGlvbnMoZW5kcG9pbnQsIHBrLmNvcnMoKSkgDQogIHBrLmFwcC5nZXQoZW5kcG9pbnQsIHBrLnV0aWwuY29yc09wdGlvbnMoKSwgYXN5bmMgZnVuY3Rpb24ocmVxLHJlcyl7DQogICAgdmFyIHNpb3BfY2xpZW50ID0gZ2V0X3Npb3BfY2xpZW50KHJlcSwgcmVzKTsNCiAgICBhd2FpdCBzaW9wX2NsaWVudC5ycC5sb2dpbl9pbml0aWF0aW9uKHJlcSwgcmVzKTsNCiAgfSk7DQoNCiAgdmFyIGVuZHBvaW50ID0gY2xpZW50X2FwaV91cmwgKyAnL2F1dGhyZXNwLzpjbGllbnQnOw0KICBway5hcHAub3B0aW9ucyhlbmRwb2ludCwgcGsuY29ycygpKSANCiAgcGsuYXBwLmdldChlbmRwb2ludCwgcGsudXRpbC5jb3JzT3B0aW9ucygpLCBmdW5jdGlvbihyZXEscmVzKXsNCiAgICB2YXIgc2lvcF9jbGllbnQgPSBnZXRfc2lvcF9jbGllbnQocmVxLCByZXMpOw0KICAgIHNpb3BfY2xpZW50LnJwLnByb2Nlc3NBdXRoUmVzcG9uc2UocmVxLCByZXMpOw0KICB9KTsNCiAgcGsuYXBwLnBvc3QoZW5kcG9pbnQsIHBrLnV0aWwuY29yc09wdGlvbnMoKSwgZnVuY3Rpb24ocmVxLCByZXMpew0KICAgIHZhciBzaW9wX2NsaWVudCA9IGdldF9zaW9wX2NsaWVudChyZXEsIHJlcyk7DQogICAgc2lvcF9jbGllbnQucnAucHJvY2Vzc0ltcGxpY2l0UG9zdChyZXEsIHJlcywgZmFsc2UpOw0KICB9KTsgDQoNCiAgdmFyIGVuZHBvaW50ID0gY2xpZW50X2FwaV91cmwgKyAnL2ltcGxpY2l0X3Bvc3QvOmNsaWVudCc7DQogIHBrLmFwcC5vcHRpb25zKGVuZHBvaW50LCBway5jb3JzKCkpIA0KICBway5hcHAucG9zdChlbmRwb2ludCwgcGsudXRpbC5jb3JzT3B0aW9ucygpLCBmdW5jdGlvbihyZXEsIHJlcyl7DQogICAgdmFyIHNpb3BfY2xpZW50ID0gZ2V0X3Npb3BfY2xpZW50KHJlcSwgcmVzKTsNCiAgICBzaW9wX2NsaWVudC5ycC5wcm9jZXNzSW1wbGljaXRQb3N0KHJlcSwgcmVzLCB0cnVlKTsNCiAgfSk7IA0KDQogIHBrLmFwcC5nZXQoY2xpZW50X2FwaV91cmwgKyAnL3Rva2VuUmVzdWx0LzpjbGllbnQnLCBway51dGlsLmNvcnNPcHRpb25zKCksIGZ1bmN0aW9uKHJlcSwgcmVzKXsNCiAgICB2YXIgc2lvcF9jbGllbnQgPSBnZXRfc2lvcF9jbGllbnQocmVxLCByZXMpOw0KICAgIHNpb3BfY2xpZW50LnJwLnByb2Nlc3NUb2tlblJlc3VsdChyZXEsIHJlcyk7DQogIH0pOw0KDQogIHBrLmFwcC5nZXQoY2xpZW50X2FwaV91cmwgKyAnL2ludGVncmF0ZUNsYWltcy86Y2xpZW50JywgcGsudXRpbC5jb3JzT3B0aW9ucygpLCBmdW5jdGlvbihyZXEscmVzKXsNCiAgICB2YXIgc2lvcF9jbGllbnQgPSBnZXRfc2lvcF9jbGllbnQocmVxLCByZXMpOw0KICAgIHBrLnV0aWwubG9nX3Byb3RvY29sKCdJTlRFR1JBVEUgQ0xBSU1TIC0gQXBpIFJlcXVlc3QnLCAnY2xpZW50X2FwaScsIHBrLnV0aWwuaW5ib3VuZF93aXJlX2NvbnRlbnQocmVxKSk7DQogICAgLy8gbm90IGNsZWFyIHdoeSB0aGlzIGlzIG5vdCBhIG5vLW9wIC0gVE9ETzogIGludmVzdGlnYXRlDQogICAgc2lvcF9jbGllbnQucnAuZ2V0SW50ZWdyYXRlZENsYWltcyhyZXEsIHJlcyk7DQogIH0pOw0KDQogIHBrLmFwcC5nZXQoY2xpZW50X2FwaV91cmwgKyAnL3JlbW90ZV93YWxsZXRfdG9rZW4vOmNsaWVudCcsIHBrLnV0aWwuY29yc09wdGlvbnMoKSwgYXN5bmMgZnVuY3Rpb24ocmVxLCByZXMpew0KICAgIHZhciBzaW9wX2NsaWVudCA9IGdldF9zaW9wX2NsaWVudChyZXEsIHJlcyk7DQogICAgc2lvcF9jbGllbnQucnAucHJvY2Vzc1JlbW90ZVdhbGxldFRva2VuKHJlcSwgcmVzKTsNCiAgfSk7DQoNCiAgcGsuYXBwLmdldChjbGllbnRfYXBpX3VybCArICcvYXBwX2NvbmZpZy86Y2xpZW50JywgcGsudXRpbC5jb3JzT3B0aW9ucygpLCBhc3luYyBmdW5jdGlvbihyZXEsIHJlcyl7DQogICAgdmFyIHNpb3BfY2xpZW50ID0gZ2V0X3Npb3BfY2xpZW50KHJlcSwgcmVzKTsNCiAgICBzaW9wX2NsaWVudC5ycC5nZXRBcHBDb25maWcocmVxLCByZXMpOw0KICB9KTsNCg0KICBway5hcHAuZ2V0KGNsaWVudF9hcGlfdXJsICsgJy9lcnJvci86Y2xpZW50JywgcGsudXRpbC5jb3JzT3B0aW9ucygpLCBmdW5jdGlvbihyZXEsIHJlcyl7DQogICAgdmFyIHNpb3BfY2xpZW50ID0gZ2V0X3Npb3BfY2xpZW50KHJlcSwgcmVzKTsNCiAgICBzaW9wX2NsaWVudC5ycC5kaXNwbGF5RXJyb3IocmVxLCByZXMpOw0KICB9KTsgIA0KfQ0KDQpmdW5jdGlvbiBnZXRfc2lvcF9jbGllbnQocmVxLCByZXMpew0KICB2YXIgY2xpZW50X25hbWUgPSByZXEucGFyYW1zLmNsaWVudDsNCiAgdmFyIHNpb3BfY2xpZW50ID0gc2lvcF9jbGllbnRzW2NsaWVudF9uYW1lXTsNCiAgaWYgKCFzaW9wX2NsaWVudCl7DQogICAgdGhyb3coJ1JlcXVlc3QgZm9yIHVucmVjb2duaXplZCBjbGllbnQ6ICgnICsgY2xpZW50X25hbWUgKyAnKScpOw0KICB9DQogIHJldHVybiBzaW9wX2NsaWVudDsNCn0NCg0KYXN5bmMgZnVuY3Rpb24gZ2V0X2NsaWVudF9xcl9jb2RlX2FuZF91cmwocmVxLCByZXMpIHsNCiAgcGsudXRpbC5sb2dfcHJvdG9jb2woJ0NMSUVOVCBRUiBDT0RFIEFORCBVUkwgLSBBcGkgUmVxdWVzdCcsIA0KICAgICdjbGllbnRfYXBpJywgDQogICAgeyBuYW1lOiAne1RSWUJFX09JREN9JywgdXJsOiAnI2NsaWVudF9xcl9jb2RlX2FuZF91cmwnIH0sDQogICAgcGsudXRpbC5pbmJvdW5kX3dpcmVfY29udGVudChyZXEpKTsNCg0KICB2YXIgY2xpZW50X25hbWUgPSByZXEucGFyYW1zLmNsaWVudDsNCiAgdmFyIHNpb3BfY2xpZW50ID0gc2lvcF9jbGllbnRzW2NsaWVudF9uYW1lXTsNCiAgaWYgKCFzaW9wX2NsaWVudCl7DQogICAgcGsudXRpbC5sb2dfZGV0YWlsKCJFcnJvcjogbm8gc2lvcF9jbGllbnQgbWF0Y2hlcyAiICsgY2xpZW50X25hbWUpOw0KICAgIHJlcy5zdGF0dXNDb2RlID0gNDAwOw0KICAgIHZhciBjb250ZW50ID0gew0KICAgICAgInN0YXR1c0NvZGUiOiA0MDAsDQogICAgICAiZXJyb3IiOiAicmVnaXN0cmF0aW9uX3JlcXVpcmVkIiwNCiAgICAgICJlcnJvcl9kZXNjcmlwdGlvbiI6ICJubyBzaW9wX2NsaWVudCBtYXRjaGVzIGNsaWVudF9uYW1lIg0KICAgIH07DQogICAgcmVzLmpzb24oY29udGVudCk7DQogICAgcGsudXRpbC5sb2dfcHJvdG9jb2woJ0NMSUVOVCBRUiBDT0RFIEFORCBVUkwgLSBBcGkgUmVzcG9uc2UnLCANCiAgICAgICdjbGllbnRfYXBpJywgDQogICAgICB7IG5hbWU6ICd7VFJZQkVfT0lEQ30nLCB1cmw6ICcjY2xpZW50X3FyX2NvZGVfYW5kX3VybCcgfSwNCiAgICAgIHBrLnV0aWwub3V0Ym91bmRfd2lyZV9jb250ZW50KHJlcywgY29udGVudCkpOw0KICAgIHJldHVybjsNCiAgfQ0KDQogIHZhciBpc3MgPSByZXEucXVlcnkuaXNzOw0KICB2YXIgdGFyZ2V0X2xpbmtfdXJpID0gcGsudXRpbC5mdWxseURlY29kZVVSSUNvbXBvbmVudChyZXEucXVlcnkudGFyZ2V0X2xpbmtfdXJpKTsNCiAgdmFyIHJlc3BvbnNlX21vZGUgPSByZXEucXVlcnkucmVzcG9uc2VfbW9kZTsNCiAgdmFyIGxpX3BhcmFtZXRlcnMgPSByZXEucXVlcnkubGlfcGFyYW1ldGVyczsNCiAgLy8gbGlfcGFyYW1ldGVycyBtdXN0IGJlIHJlaHlkcmF0ZWQgaWYgcHJlc2VudA0KICBpZiAobGlfcGFyYW1ldGVycyl7DQogICAgdmFyIGRlYyA9IHBrLmJhc2U2NHVybC5kZWNvZGUocGsuYmFzZTY0dXJsLmZyb21CYXNlNjQobGlfcGFyYW1ldGVycykpOw0KICAgIGxpX3BhcmFtZXRlcnMgPSBKU09OLnBhcnNlKGRlYyk7DQogIH0NCg0KICB2YXIgYXJ0aWZhY3RzID0gYXdhaXQgc2lvcF9jbGllbnQucnAuZ2V0X2NsaWVudF9xcl9jb2RlX2FuZF91cmwoY2xpZW50X25hbWUsIGlzcywgdGFyZ2V0X2xpbmtfdXJpLCByZXNwb25zZV9tb2RlLCBsaV9wYXJhbWV0ZXJzKTsNCiAgYXJ0aWZhY3RzWydtcXR0c19zZXJ2ZXInXSA9IHJlcS5xdWVyeS5tcXR0c19zZXJ2ZXI7DQogIGFydGlmYWN0c1snY2xpZW50X2FwaV91cmwnXSA9IHJlcS5xdWVyeS5jbGllbnRfYXBpX3VybDsNCiAgYXJ0aWZhY3RzWydyd2wnXSA9IHJlcS5xdWVyeS5yd2w7DQogIHJlcy5qc29uKGFydGlmYWN0cyk7DQogIHBrLnV0aWwubG9nX3Byb3RvY29sKCdDTElFTlQgUVIgQ09ERSBBTkQgVVJMIC0gQXBpIFJlc3BvbnNlJywgDQogICAgJ2NsaWVudF9hcGknLCANCiAgICB7IG5hbWU6ICd7VFJZQkVfT0lEQ30nLCB1cmw6ICcjY2xpZW50X3FyX2NvZGVfYW5kX3VybCcgfSwNCiAgICBway51dGlsLm91dGJvdW5kX3dpcmVfY29udGVudChyZXMsIGFydGlmYWN0cykpOw0KfQ0KDQphc3luYyBmdW5jdGlvbiBnZXRfaXNzdWVyX2NyZWRlbnRpYWxfcmVxdWVzdF9xcmNvZGUocmVxLCByZXMpIHsNCiAgcGsudXRpbC5sb2dfcHJvdG9jb2woJ0lTU1VFUiBDUkVERU5USUFMIFJFUVVFU1QgUVIgQ09ERSAtIEFwaSBSZXF1ZXN0JywgDQogICAgJ2NsaWVudF9hcGknLCANCiAgICB7IG5hbWU6ICd7VFJZQkVfT0lEQ30nLCB1cmw6ICcjZ2V0X2lzc3Vlcl9jcmVkZW50aWFsX3JlcXVlc3RfcXJjb2RlJyB9LA0KICAgIHBrLnV0aWwuaW5ib3VuZF93aXJlX2NvbnRlbnQocmVxKSk7DQoNCiAgdmFyIHNpb3BfY2xpZW50ID0gZ2V0X3Npb3BfY2xpZW50KHJlcSwgcmVzKTsNCg0KICB2YXIgaXNzdWVyID0gcmVxLnF1ZXJ5Lmlzc3VlcjsNCiAgaWYgKCFpc3N1ZXIpew0KICAgIHRocm93KCdObyBpc3N1ZXIgcGFyYW1ldGVyIGluIGdldF9pc3N1ZXJfY3JlZGVudGlhbF9yZXF1ZXN0X3FyY29kZScpOw0KICB9DQoNCiAgdmFyIG5leHRfc3RlcCA9IHJlcS5xdWVyeS5uZXh0X3N0ZXA7DQoNCiAgdmFyIHFyX2NvZGUgPSBhd2FpdCBzaW9wX2NsaWVudC5ycC5nZXRfaXNzdWVyX2NyZWRlbnRpYWxfcmVxdWVzdF9xcmNvZGUoaXNzdWVyLCBuZXh0X3N0ZXApOw0KICByZXMuanNvbihxcl9jb2RlKTsNCg0KICBway51dGlsLmxvZ19wcm90b2NvbCgnSVNTVUVSIENSRURFTlRJQUwgUkVRVUVTVCBRUiBDT0RFIC0gQXBpIFJlc3BvbnNlJywgDQogICAgJ2NsaWVudF9hcGknLCANCiAgICB7IG5hbWU6ICd7VFJZQkVfT0lEQ30nLCB1cmw6ICcjZ2V0X2lzc3Vlcl9jcmVkZW50aWFsX3JlcXVlc3RfcXJjb2RlJyB9LA0KICAgIHBrLnV0aWwub3V0Ym91bmRfd2lyZV9jb250ZW50KHJlcywgcXJfY29kZSkpOw0KfQ0KDQpmdW5jdGlvbiBzaW9wX2NsaWVudF9mYWN0b3J5KGNsaWVudF9uYW1lLCBjbGllbnRfYXV0aGVudGljYXRvciwgY29uZmlnKXsNCiAgaWYgKHNpb3BfY2xpZW50c1tjbGllbnRfbmFtZV0pew0KICAgIHRocm93ICgiQ2xpZW50ICIgKyBjbGllbnRfbmFtZSArICcgaXMgYWxyZWFkeSByZWdpc3RlcmVkLicpOw0KICB9DQoNCiAgdmFyIF9uYW1lID0gY2xpZW50X25hbWU7DQogIHZhciBfcnAgPSBway5jbGllbnQuaW5pdChwaywgY29udGVudE1vZHVsZU5hbWUsIGNsaWVudF9uYW1lLCBjb25maWcpOw0KICB2YXIgX2NvbmZpZyA9IGNvbmZpZzsNCiAgdmFyIF9zZXNzaW9uS2V5ID0gcGsudXRpbC5yYW5kb21Ub1VSTigpOw0KDQogIE9iamVjdC5kZWZpbmVQcm9wZXJ0eSh0aGlzLCAiY29uZmlnIiwgew0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICByZXR1cm4gX2NvbmZpZzsNCiAgICAgIH0sDQogICAgICBzZXQ6IGZ1bmN0aW9uKHZhbHVlKXsNCiAgICAgICAgX2NvbmZpZyA9IHZhbHVlOw0KICAgICAgfSwNCiAgICAgIGVudW1lcmFibGU6IHRydWUNCiAgICB9KTsNCg0KICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgInJwIiwgew0KICAgICAgZ2V0OiBmdW5jdGlvbigpIHsNCiAgICAgICAgICByZXR1cm4gX3JwOw0KICAgICAgfSwNCiAgICAgIGVudW1lcmFibGU6IHRydWUNCiAgICB9KTsNCg0KICBPYmplY3QuZGVmaW5lUHJvcGVydHkodGhpcywgInNlc3Npb25LZXkiLCB7DQogICAgICBnZXQ6IGZ1bmN0aW9uKCkgew0KICAgICAgICAgIHJldHVybiBfc2Vzc2lvbktleTsNCiAgICAgIH0sDQogICAgICBlbnVtZXJhYmxlOiB0cnVlDQogICAgfSk7DQoNCiAgT2JqZWN0LmRlZmluZVByb3BlcnR5KHRoaXMsICJzZXRDbGFpbSIsIHsNCiAgICB2YWx1ZTogZnVuY3Rpb24oY2xhaW1OYW1lLCB2YWx1ZSkgew0KICAgICAgX3NldENsYWltKGNsYWltTmFtZSwgdmFsdWUpOw0KICAgIH0gDQogIH0pOw0KfQ0KDQoNCi8vIFRPRE8gYWRkIHZhbGlkaXR5IGNoZWNrcw0KLy8gZm9yIGV4YW1wbGUsIHZhbGlkX3RhcmdldF9saW5rX3VyaSBtdXN0IGJlIHNldA0KYXN5bmMgZnVuY3Rpb24gaW5pdGlhbGl6ZUFwcENvbmZpZ3VyYXRpb25zKCl7DQogIHZhciBwb3NzaWJsZV9lcnJvciA9ICdGYXRhbCBFcnJvciByZWFkaW5nIGNsaWVudF9hcGkgYXBwbGljYXRpb25zLmpzb24gZmlsZSc7DQogIHRyeXsNCiAgICB2YXIgYXBwbGljYXRpb25zU3RyaW5nID0gcGsuZnMucmVhZEZpbGVTeW5jKCdjbGllbnRfYXBpL2FwcGxpY2F0aW9ucy5qc29uJywgJ3V0Zi04Jyk7DQogICAgdmFyIHBvc3NpYmxlX2Vycm9yID0gIkZhdGFsIEVycm9yIHBhcnNpbmcgY2xpZW50X2FwaSBhcHBsaWNhdGlvbnMuanNvbiBmaWxlIjsNCiAgICB2YXIgYXBwbGljYXRpb25zID0gSlNPTi5wYXJzZShhcHBsaWNhdGlvbnNTdHJpbmcpOw0KICB9DQogIGNhdGNoKGVycil7DQogICAgcGsudXRpbC5sb2dfZXJyb3IocG9zc2libGVfZXJyb3IsIGVycik7DQogICAgcHJvY2Vzcy5leGl0KDEpOw0KICB9DQoNCiAgdmFyIHN5c3RlbV9hcHBfbGF1bmNoZXJfdXJsOw0KICB2YXIgYXBwX2xhdW5jaGVyX2NvbmZpZyA9IGFwcGxpY2F0aW9uc1snYXBwX2xhdW5jaGVyJ107DQogIGlmIChhcHBfbGF1bmNoZXJfY29uZmlnKXsNCiAgICBzeXN0ZW1fYXBwX2xhdW5jaGVyX3VybCA9IGFwcF9sYXVuY2hlcl9jb25maWcuYXBwbGljYXRpb25fdXJsOw0KICB9DQoNCiAgZm9yICh2YXIgY2xpZW50IGluIGFwcGxpY2F0aW9ucyl7DQogICAgdmFyIGFwcF9jb25maWcgPSBhcHBsaWNhdGlvbnNbY2xpZW50XTsNCiAgICBhcHBfY29uZmlnLmNsaWVudCA9IGNsaWVudDsNCiAgICBhcHBfY29uZmlnLmFwcGxpY2F0aW9uUGF0aCA9ICcvJyArIGNsaWVudDsNCiAgICBhcHBfY29uZmlnLmNsaWVudF9hcGlfdXJsID0gcGsudXRpbC5odHRwc1NlcnZlclVybHNbJ0NMSUVOVF9BUEknXS5ocmVmICsgY29udGVudE1vZHVsZU5hbWU7DQogICAgYXBwX2NvbmZpZy5tcXR0c19zZXJ2ZXIgPSBway51dGlsLmNvbmZpZy5jb250ZW50X21vZHVsZXNbY29udGVudE1vZHVsZU5hbWVdLmNvbmZpZy5tcXR0c19zZXJ2ZXI7DQogICAgaWYgKCFhcHBfY29uZmlnLnNjb3BlKXsNCiAgICAgIGFwcF9jb25maWcuc2NvcGUgPSAib3BlbmlkIjsNCiAgICB9DQoNCiAgICAvLyBzZXQgdXAgYW4gYXBwX2xhdW5jaGVyIHVybCBpZiBvbmUgaXMgbm90IHByZXNlbnQNCiAgICBpZiAoY2xpZW50ICE9LSAnYXBwX2xhdW5jaGVyJyl7DQogICAgICBpZiAoIWFwcF9jb25maWcuYXBwX2xhdW5jaGVyX3VybCl7DQogICAgICAgIGFwcF9jb25maWcuYXBwX2xhdW5jaGVyX3VybCA9IHN5c3RlbV9hcHBfbGF1bmNoZXJfdXJsOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHZhciBzaW9wX2NsaWVudCA9IG5ldyBzaW9wX2NsaWVudF9mYWN0b3J5KGNsaWVudCwgIiIsIGFwcF9jb25maWcpOw0KICAgIHNpb3BfY2xpZW50c1tjbGllbnRdID0gc2lvcF9jbGllbnQ7ICAgDQogICAgY29uc29sZS5sb2coY2xpZW50ICsgJyByZWdpc3RlcmVkIHdpdGggY2xpZW50X2FwaTogJyArIHNpb3BfY2xpZW50LnNlc3Npb25LZXkpOyANCiAgfQ0KfQ","oidc_config.json":"ew0KICAiY29uZmlnIjogew0KCQkiY2xpZW50IjogImNsaWVudF9hcGkiLA0KCQkibXF0dHNfc2VydmVyIjogIndzczovL2h1bWFucHJlc2VudC5jb206ODAwMCINCgl9LA0KICAiY29sbGVjdGlvbnMiOiB7DQogICAgInJ3bHF1ZXVlIjogew0KICAgICAgImtleVBhdGgiOiAiaWQiDQogICAgfQ0KICB9LA0KICAiY29uZmlnX2ZpbGVzIjogWyANCiAgCSIvY2xpZW50X2FwaS9vaWRjX2NvbmZpZy5qc29uIiwNCiAgCSIvY2xpZW50X2FwaS9hcHBsaWNhdGlvbnMuanNvbiINCiAgXQ0KfQ","views":{"auth_response.handlebars":"PGRpdj4NCjxoMT4gT0lEQ19SUCBBdXRoUmVzcG9uc2VsIFBhZ2U8L2gxPg0KPC9kaXY-","debug.handlebars":"PGRpdiBjbGFzcz0iY29udGFpbmVyIiBzdHlsZT0ianVzdGlmeS1jb250ZW50OiBjZW50ZXI7Ij4NCgk8aDQ-e3tpc3N1ZXJNZXNzYWdlfX08L2g0Pg0KCTx0YWJsZSBjbGFzcz0idGFibGUgdGFibGUtaG92ZXIiPg0KCQk8dGhlYWQ-DQoJCQk8dHI-DQoJCQkJPHRoPkNsYWltPC90aD4NCgkJCQk8dGg-VmFsdWU8L3RoPg0KCQkJPC90cj4NCgkJPC90aGVhZD4NCgkJPHRib2R5Pg0Ke3sjdG9rZW5Bc0FycmF5fX0gICAgICANCgkJCTx0cj4NCgkJCQk8dGQ-e3tuYW1lfX08L3RkPg0KCQkJCTx0ZD57e3t2YWx1ZX19fTwvdGQ-DQoJCQk8L3RyPg0Ke3svdG9rZW5Bc0FycmF5fX0gICAgICANCgkJPC90Ym9keT4NCgk8L3RhYmxlPg0KCTxicj4NCgl7e3tjb2RlTWVzc2FnZX19fQ0KCXt7e2FjY2Vzc190b2tlbk1lc3NhZ2V9fX0NCgl7e3t0b2tlblR5cGVNZXNzYWdlfX19DQo8L2Rpdj4NCg0KPHNjcmlwdCBzcmM9Ii9wZXJzb25hbC9qcy9qcXVlcnktMy4yLjEuc2xpbS5taW4uanMiPjwvc2NyaXB0Pg0KPHNjcmlwdD4NCmZ1bmN0aW9uIHZmZXRjaChhZGNfcGFyYW1zLCBkaXNwbGF5SWQpew0KCXZhciB1cmwgPSAiL3Rlc3Rlci9wcm9jZXNzX2NsYWltX3NvdXJjZT9hZGNfcGFyYW1zPSIgKyBhZGNfcGFyYW1zOw0KCQ0KCXZhciB4bWxodHRwID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7CQ0KCXhtbGh0dHAub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24oKSB7DQoJICAgIGlmICh0aGlzLnJlYWR5U3RhdGUgPT0gNCAmJiB0aGlzLnN0YXR1cyA9PSAyMDApIHsNCgkgICAgCWlmICh0aGlzLnJlc3BvbnNlVGV4dCl7DQoJCSAgICAgICAgdmFyIHJlc3BvbnNlT2JqID0gSlNPTi5wYXJzZSh0aGlzLnJlc3BvbnNlVGV4dCk7DQoJCSAgICAgICAgaW5zZXJ0RGlzdHJpYnV0ZWRDbGFpbShyZXNwb25zZU9iaiwgZGlzcGxheUlkKTsJICAgIAkJDQoJICAgIAl9DQoJICAgIH0NCgl9Ow0KCXhtbGh0dHAub3BlbigiR0VUIiwgdXJsLCB0cnVlKTsNCgl4bWxodHRwLnNlbmQoKTsNCg0KCWZ1bmN0aW9uIGluc2VydERpc3RyaWJ1dGVkQ2xhaW0ocmVzcG9uc2VPYmosIGRpc3BsYXlJZCl7DQoJCXZhciBkaXNwbGF5SWRFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGRpc3BsYXlJZCk7DQoJCXZhciBpZF90b2tlbiA9IHJlc3BvbnNlT2JqLmlkX3Rva2VuOw0KCQl2YXIgcHJldHR5UmVzcG9uc2UgPSBKU09OLnN0cmluZ2lmeShpZF90b2tlbiwgbnVsbCwgMik7DQoJCXZhciBodG1sID0gJzxkaXYgIHN0eWxlPSJiYWNrZ3JvdW5kLWNvbG9yOiAjRjBGMEYwOyBwYWRkaW5nOiAxNXB4OyI-JzsNCg0KCQl2YXIgaW5mbyA9IHJlc3BvbnNlT2JqLm5hbWVfYW5kX3NvdXJjZS5pbmZvOw0KCQlpZiAoaW5mbyAhPT0gdW5kZWZpbmVkKXsNCgkJCWh0bWwgKz0gJzxwPicgKyBpbmZvICsgJzwvcD4nOw0KCQl9DQoNCgkJaHRtbCArPSAnPHA-PGk-JyArIHJlc3BvbnNlT2JqLnN0YXR1cyArICc8L2k-PC9wPicNCgkJCSsgJzxwcmU-PGNvZGU-JyArIHByZXR0eVJlc3BvbnNlICsgJzwvY29kZT48L3ByZT4nOw0KCQl2YXIgbmV3Um93ID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgndHInKTsNCgkJdmFyIG5ld0NvbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RkJyk7DQoJCW5ld0NvbC5pbm5lckhUTUwgPSBodG1sOw0KCQluZXdSb3cuYXBwZW5kQ2hpbGQobmV3Q29sKTsNCgkJaW5zZXJ0QWZ0ZXIobmV3Um93LCBkaXNwbGF5SWRFbCk7DQoJfQ0KDQoJZnVuY3Rpb24gaW5zZXJ0QWZ0ZXIobmV3Tm9kZSwgcmVmZXJlbmNlTm9kZSkgew0KCSAgICByZWZlcmVuY2VOb2RlLnBhcmVudE5vZGUuaW5zZXJ0QmVmb3JlKG5ld05vZGUsIHJlZmVyZW5jZU5vZGUubmV4dFNpYmxpbmcpOw0KCX0NCn0NCjwvc2NyaXB0Pg0K","error_received.handlebars":"PGgyPnt7aW5mb319PC9oMj4NCjxici8-DQo8YnIvPg0KPGgzPk9JRENfUlA6IEVycm9yIE9jY3VyZWQ8L2gzPg0KPGg0PkVycm9yOiB7e2Vycm9yfX08L2gzPg0KPGg0PkRldGFpbDoge3tlcnJvcl9kZXNjcmlwdGlvbn19PC9oMz4NCg0K","foo":"Q29tcGFyaW5nIGZpbGVzIGltcGxpY2l0LmhhbmRsZWJhcnMgYW5kIElNUExJQ0lULk5FVy5IQU5ETEVCQVJTDQoqKioqKiBpbXBsaWNpdC5oYW5kbGViYXJzDQogIC8vIEZpcnN0LCBwYXJzZSB0aGUgcXVlcnkgc3RyaW5nDQogIHZhciBwYXJhbXMgPSB7fSwgcG9zdEJvZHkgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKSwNCiAgICAgIHJlZ2V4ID0gLyhbXiY9XSspPShbXiZdKikvZywgbTsNCiAgd2hpbGUgKG0gPSByZWdleC5leGVjKHBvc3RCb2R5KSkgew0KICAgIHBhcmFtc1tkZWNvZGVVUklDb21wb25lbnQobVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KG1bMl0pOw0KKioqKiogSU1QTElDSVQuTkVXLkhBTkRMRUJBUlMNCiAgLy8gRmlyc3QsIHBhcnNlIHRoZSBxdWVyeSBzdHJpbmcNCiAgdmFyIHBhcmFtcyA9IHt9Ow0KICB2YXIgaGFzaENvbnRlbnQgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKTsNCiAgVkFSIHJlZ2V4ID0gLyhbXiY9XSspPShbXiZdKikvZywgbTsNCiAgd2hpbGUgKG0gPSByZWdleC5leGVjKGhhc2hDb250ZW50KSkgew0KICAgIHBhcmFtc1tkZWNvZGVVUklDb21wb25lbnQobVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KG1bMl0pOw0KKioqKioNCg0KKioqKiogaW1wbGljaXQuaGFuZGxlYmFycw0KDQogIC8vIGRlYnVnZ2VyOw0KICANCiAgLy8gQW5kIHNlbmQgdGhlIHRva2VuIG92ZXIgdG8gdGhlIHNlcnZlcg0KKioqKiogSU1QTElDSVQuTkVXLkhBTkRMRUJBUlMNCg0KICB2YXIgcG9zdEJvZHkgPSAnJzsNCiAgZm9yICh2YXIga2V5IGluIHBhcmFtcyl7DQogICAgaWYgKHBvc3RCb2R5KXsNCiAgICAgIHBvc3RCb2R5ICs9ICcmJzsNCiAgICB9DQogICAgcG9zdEJvZHkgKz0ga2V5cyArICc9JyArIHBhcmFtc1trZXldOw0KICB9DQoNCiAgZGVidWdnZXI7DQoNCiAgdmFyIG5ld1BhdGggPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSggImF1dGhyZXNwIiwgImltcGxpY2l0X3Bvc3QiKTsNCg0KICAvLyBBbmQgc2VuZCB0aGUgdG9rZW4gb3ZlciB0byB0aGUgc2VydmVyDQoqKioqKg0KDQoqKioqKiBpbXBsaWNpdC5oYW5kbGViYXJzDQogIHZhciByZXEgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCiAgLy8gdXNpbmcgUE9TVCBzbyBxdWVyeSBpc24ndCBsb2dnZWQNCiAgdmFyIG5ld1BhdGggPSB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgiYXV0aHJlc3AiLCANCiAgICAgICAgICAiaW1wbGljaXRfcG9zdCIpOw0KICByZXEub3BlbignUE9TVCcsICdodHRwczovLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIG5ld1BhdGgsIHRydWUpOw0KICByZXEuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpOw0KKioqKiogSU1QTElDSVQuTkVXLkhBTkRMRUJBUlMNCiAgdmFyIHJlcSA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICByZXEub3BlbignUE9TVCcsIG5ld1BhdGgsIHRydWUpOw0KICByZXEuc2V0UmVxdWVzdEhlYWRlcignQ29udGVudC1UeXBlJywgJ2FwcGxpY2F0aW9uL3gtd3d3LWZvcm0tdXJsZW5jb2RlZCcpOw0KKioqKioNCg0K","implicit.handlebars":"PGRpdiBpZD0icG9zdF9kaXYiIHN0eWxlPSJkaXNwbGF5OiBub25lIj4NCjwvZGl2Pg0KDQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI-DQpwcmVwYXJlSW1wbGljaXQoKTsNCg0KZnVuY3Rpb24gcHJlcGFyZUltcGxpY2l0KCl7DQogIC8vIGRlYnVnZ2VyOw0KDQogIHZhciBwb3N0Qm9keSA9IGxvY2F0aW9uLmhhc2guc3Vic3RyKDEpOw0KICANCiAgLy8gQW5kIHNlbmQgdGhlIHRva2VuIG92ZXIgdG8gdGhlIHNlcnZlcg0KICB2YXIgcmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQogIC8vIHVzaW5nIFBPU1Qgc28gcXVlcnkgaXNuJ3QgbG9nZ2VkDQogIHZhciBuZXdQYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoImF1dGhyZXNwIiwgDQogICAgICAgICAgImltcGxpY2l0X3Bvc3QiKTsNCiAgcmVxLm9wZW4oJ1BPU1QnLCAnaHR0cHM6Ly8nICsgd2luZG93LmxvY2F0aW9uLmhvc3QgKyBuZXdQYXRoLCB0cnVlKTsNCiAgcmVxLnNldFJlcXVlc3RIZWFkZXIoJ0NvbnRlbnQtVHlwZScsICdhcHBsaWNhdGlvbi94LXd3dy1mb3JtLXVybGVuY29kZWQnKTsNCiAgDQogIHJlcS5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbiAoZSkgew0KICAgIGlmIChyZXEucmVhZHlTdGF0ZSA9PSA0KSB7DQogICAgICB2YXIgalJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXEucmVzcG9uc2VUZXh0KTsNCiAgICAgIGlmIChyZXEuc3RhdHVzID09IDIwMCkgew0KICAgICAgICB2YXIgbmV3VXJsOw0KICAgICAgICB2YXIgalJlc3BvbnNlID0gSlNPTi5wYXJzZShyZXEucmVzcG9uc2VUZXh0KTsNCiAgICAgICAgc3dpdGNoKGpSZXNwb25zZS5yZXN1bHQpew0KICAgICAgICAgIGNhc2UgInRva2VuUmVzdWx0IjoNCiAgICAgICAgICAgIG5ld1VybCA9ICdodHRwczovLycgKyB3aW5kb3cubG9jYXRpb24uaG9zdCArIA0KICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucGF0aG5hbWUucmVwbGFjZSgiYXV0aHJlc3AiLCBqUmVzcG9uc2UucmVzdWx0KQ0KICAgICAgICAgICAgICArICI_bm9uY2U9IiArIGpSZXNwb25zZS5ub25jZTsNCiAgICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gbmV3VXJsOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAicmVkaXJlY3QiOg0KICAgICAgICAgICAgbmV3VXJsID0galJlc3BvbnNlLm5ld1VybDsNCiAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IG5ld1VybDsNCiAgICAgICAgICAgIGJyZWFrOw0KICAgICAgICAgIGNhc2UgInBvc3QiOg0KICAgICAgICAgICAgdmFyIGZvcm1FbCA9IGNyZWF0ZVBvc3RGb3JtKA0KICAgICAgICAgICAgICBqUmVzcG9uc2UubmV3VXJsLCANCiAgICAgICAgICAgICAgalJlc3BvbnNlLmlkX3Rva2VuLCANCiAgICAgICAgICAgICAgalJlc3BvbnNlLmVycm9yLCANCiAgICAgICAgICAgICAgalJlc3BvbnNlLmVycm9yX2Rlc2NyaXB0aW9uLCANCiAgICAgICAgICAgICAgalJlc3BvbnNlLnN0YXR1c0NvZGUsDQogICAgICAgICAgICAgIEpTT04uc3RyaW5naWZ5KGpSZXNwb25zZS5saV9wYXJhbWV0ZXJzKSk7DQogICAgICAgICAgICBmb3JtRWwuc3VibWl0KCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICAgIC8vIGlmIHRoZSBPQXV0aCByZXNwb25zZSBpcyBpbnZhbGlkLCBnZW5lcmF0ZSBhbiBlcnJvciBtZXNzYWdlDQogICAgICBlbHNlIHsNCiAgICAgICAgdmFyIGVycjsNCiAgICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gNDAwKSB7DQogICAgICAgICAgZXJyID0galJlc3BvbnNlOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGVyciA9IHsgZXJyb3I6ICdUaGVyZSB3YXMgYW4gZXJyb3IgcHJvY2Vzc2luZyB0aGUgdG9rZW4uJyB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICB2YXIgZXJyVXJsID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoImF1dGhyZXNwIiwgImVycm9yIik7DQogICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGVyclVybCArICI_ZXJyb3I9IiArIGVyci5lcnJvciArICImZXJyb3JfZGVzY3JpcHRpb249IiArIGVyci5lcnJvcl9kZXNjcmlwdGlvbjsNCiAgICAgIH0NCiAgICB9DQogIH0NCg0KICByZXEuc2VuZChwb3N0Qm9keSk7DQp9DQoNCmZ1bmN0aW9uIGNyZWF0ZVBvc3RGb3JtKGFjdGlvbiwgaWRfdG9rZW4sIGVycm9yLCBlcnJvcl9kZXNjcmlwdGlvbiwgc3RhdHVzQ29kZSwgbGlfcGFyYW1ldGVycyl7DQogICAgdmFyIGZvcm0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCJmb3JtIik7IA0KICAgIGZvcm0uc2V0QXR0cmlidXRlKCJtZXRob2QiLCAicG9zdCIpOyANCiAgICBmb3JtLnNldEF0dHJpYnV0ZSgiYWN0aW9uIiwgYWN0aW9uKTsgDQoNCiAgICBpZiAoaWRfdG9rZW4peyAgDQogICAgICBhZGRJbnB1dChmb3JtLCAiaWRfdG9rZW4iLCBpZF90b2tlbik7DQogICAgfQ0KDQogICAgaWYgKGVycm9yKXsgIA0KICAgICAgYWRkSW5wdXQoZm9ybSwgImVycm9yIiwgZXJyb3IpOw0KICAgIH0NCg0KICAgIGlmIChlcnJvcl9kZXNjcmlwdGlvbil7ICANCiAgICAgIGFkZElucHV0KGZvcm0sICJlcnJvcl9kZXNjcmlwdGlvbiIsIGVycm9yX2Rlc2NyaXB0aW9uKTsNCiAgICB9DQoNCiAgICBpZiAoc3RhdHVzQ29kZSl7ICANCiAgICAgIGFkZElucHV0KGZvcm0sICJzdGF0dXNDb2RlIiwgc3RhdHVzQ29kZSk7DQogICAgfQ0KDQogICAgaWYgKGxpX3BhcmFtZXRlcnMpeyAgDQogICAgICBhZGRJbnB1dChmb3JtLCAibGlfcGFyYW1ldGVycyIsIGxpX3BhcmFtZXRlcnMpOw0KICAgIH0NCg0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwb3N0X2RpdiIpLmFwcGVuZENoaWxkKGZvcm0pOw0KICAgIHJldHVybiBmb3JtOw0KDQogICAgZnVuY3Rpb24gYWRkSW5wdXQoZm9ybSwgbmFtZSwgdmFsdWUpew0KICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsgDQogICAgICBlbC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dCIpOyANCiAgICAgIGVsLnNldEF0dHJpYnV0ZSgibmFtZSIsIG5hbWUpOyANCiAgICAgIGVsLnNldEF0dHJpYnV0ZSgidmFsdWUiLCB2YWx1ZSk7IA0KICAgICAgZm9ybS5hcHBlbmRDaGlsZChlbCk7ICANCiAgICB9DQp9DQoNCjwvc2NyaXB0Pg0K","implicit.new.handlebars":"PGRpdiBpZD0icG9zdF9kaXYiIHN0eWxlPSJkaXNwbGF5OiBub25lIj4NCjwvZGl2Pg0KDQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI-DQpwcmVwYXJlSW1wbGljaXQoKTsNCg0KZnVuY3Rpb24gcHJlcGFyZUltcGxpY2l0KCl7DQoNCiAgLy8gRmlyc3QsIHBhcnNlIHRoZSBxdWVyeSBzdHJpbmcNCiAgdmFyIHBhcmFtcyA9IHt9Ow0KICB2YXIgaGFzaENvbnRlbnQgPSBsb2NhdGlvbi5oYXNoLnN1YnN0cmluZygxKTsNCiAgVkFSIHJlZ2V4ID0gLyhbXiY9XSspPShbXiZdKikvZywgbTsNCiAgd2hpbGUgKG0gPSByZWdleC5leGVjKGhhc2hDb250ZW50KSkgew0KICAgIHBhcmFtc1tkZWNvZGVVUklDb21wb25lbnQobVsxXSldID0gZGVjb2RlVVJJQ29tcG9uZW50KG1bMl0pOw0KICB9DQoNCiAgdmFyIHBvc3RCb2R5ID0gJyc7DQogIGZvciAodmFyIGtleSBpbiBwYXJhbXMpew0KICAgIGlmIChwb3N0Qm9keSl7DQogICAgICBwb3N0Qm9keSArPSAnJic7DQogICAgfQ0KICAgIHBvc3RCb2R5ICs9IGtleXMgKyAnPScgKyBwYXJhbXNba2V5XTsNCiAgfQ0KDQogIGRlYnVnZ2VyOw0KDQogIHZhciBuZXdQYXRoID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoICJhdXRocmVzcCIsICJpbXBsaWNpdF9wb3N0Iik7DQoNCiAgLy8gQW5kIHNlbmQgdGhlIHRva2VuIG92ZXIgdG8gdGhlIHNlcnZlcg0KICB2YXIgcmVxID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQogIHJlcS5vcGVuKCdQT1NUJywgbmV3UGF0aCwgdHJ1ZSk7DQogIHJlcS5zZXRSZXF1ZXN0SGVhZGVyKCdDb250ZW50LVR5cGUnLCAnYXBwbGljYXRpb24veC13d3ctZm9ybS11cmxlbmNvZGVkJyk7DQogIA0KICByZXEub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKGUpIHsNCiAgICBpZiAocmVxLnJlYWR5U3RhdGUgPT0gNCkgew0KICAgICAgaWYgKHJlcS5zdGF0dXMgPT0gMjAwKSB7DQogICAgICAgIHZhciBuZXdVcmw7DQogICAgICAgIHZhciBqUmVzcG9uc2UgPSBKU09OLnBhcnNlKHJlcS5yZXNwb25zZVRleHQpOw0KICAgICAgICBzd2l0Y2goalJlc3BvbnNlLnJlc3VsdCl7DQogICAgICAgICAgY2FzZSAidG9rZW5SZXN1bHQiOg0KICAgICAgICAgICAgbmV3VXJsID0gJ2h0dHBzOi8vJyArIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgDQogICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5wYXRobmFtZS5yZXBsYWNlKCJhdXRocmVzcCIsIGpSZXNwb25zZS5yZXN1bHQpDQogICAgICAgICAgICAgICsgIj9ub25jZT0iICsgalJlc3BvbnNlLm5vbmNlOw0KICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24gPSBuZXdVcmw7DQogICAgICAgICAgICBicmVhazsNCiAgICAgICAgICBjYXNlICJyZWRpcmVjdCI6DQogICAgICAgICAgICBuZXdVcmwgPSBqUmVzcG9uc2UubmV3VXJsOw0KICAgICAgICAgICAgd2luZG93LmxvY2F0aW9uID0gbmV3VXJsOw0KICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgY2FzZSAicG9zdCI6DQogICAgICAgICAgICB2YXIgZm9ybUVsID0gY3JlYXRlUG9zdEZvcm0oalJlc3BvbnNlLm5ld1VybCwgalJlc3BvbnNlLmlkX3Rva2VuLCBqUmVzcG9uc2UuZXJyb3IsIGpSZXNwb25zZS5lcnJvcl9kZXNjcmlwdGlvbiwgalJlc3BvbnNlLnN0YXR1c0NvZGUpOw0KICAgICAgICAgICAgZm9ybUVsLnN1Ym1pdCgpOw0KICAgICAgICB9DQogICAgICB9DQogICAgICAvLyBpZiB0aGUgT0F1dGggcmVzcG9uc2UgaXMgaW52YWxpZCwgZ2VuZXJhdGUgYW4gZXJyb3IgbWVzc2FnZQ0KICAgICAgZWxzZSB7DQogICAgICAgIHZhciBlcnI7DQogICAgICAgIGlmIChyZXEuc3RhdHVzID09IDQwMCkgew0KICAgICAgICAgIGVyciA9IHsgZXJyb3I6ICdTdGF0dXMgNDAwOiBUaGUgbGlua191cmkgaXMgbm90IHZhbGlkJyB9Ow0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgIGVyciA9IHsgZXJyb3I6ICdUaGVyZSB3YXMgYW4gZXJyb3IgcHJvY2Vzc2luZyB0aGUgdG9rZW4uJyB9Ow0KICAgICAgICB9DQogICAgICAgIA0KICAgICAgICB2YXIgZXJyVXJsID0gd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoImF1dGhyZXNwIiwgImVycm9yIik7DQogICAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGVyclVybCArICI_ZXJyb3I9IiArIEpTT04uc3RyaW5naWZ5KGVycik7DQogICAgICB9DQogICAgfQ0KICB9DQoNCiAgcmVxLnNlbmQocG9zdEJvZHkpOw0KfQ0KDQpmdW5jdGlvbiBjcmVhdGVQb3N0Rm9ybShhY3Rpb24sIGlkX3Rva2VuLCBlcnJvciwgZXJyb3JfZGVzY3JpcHRpb24sIHN0YXR1c0NvZGUpew0KICAgIHZhciBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpOyANCiAgICBmb3JtLnNldEF0dHJpYnV0ZSgibWV0aG9kIiwgInBvc3QiKTsgDQogICAgZm9ybS5zZXRBdHRyaWJ1dGUoImFjdGlvbiIsIGFjdGlvbik7IA0KDQogICAgaWYgKGlkX3Rva2VuKXsgIA0KICAgICAgYWRkSW5wdXQoZm9ybSwgImlkX3Rva2VuIiwgaWRfdG9rZW4pOw0KICAgIH0NCg0KICAgIGlmIChlcnJvcil7ICANCiAgICAgIGFkZElucHV0KGZvcm0sICJlcnJvciIsIGVycm9yKTsNCiAgICB9DQoNCiAgICBpZiAoZXJyb3JfZGVzY3JpcHRpb24peyAgDQogICAgICBhZGRJbnB1dChmb3JtLCAiZXJyb3JfZGVzY3JpcHRpb24iLCBlcnJvcl9kZXNjcmlwdGlvbik7DQogICAgfQ0KDQogICAgaWYgKHN0YXR1c0NvZGUpeyAgDQogICAgICBhZGRJbnB1dChmb3JtLCAic3RhdHVzQ29kZSIsIHN0YXR1c0NvZGUpOw0KICAgIH0NCg0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCJwb3N0X2RpdiIpLmFwcGVuZENoaWxkKGZvcm0pOw0KICAgIHJldHVybiBmb3JtOw0KDQogICAgZnVuY3Rpb24gYWRkSW5wdXQoZm9ybSwgbmFtZSwgdmFsdWUpew0KICAgICAgdmFyIGVsID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiaW5wdXQiKTsgDQogICAgICBlbC5zZXRBdHRyaWJ1dGUoInR5cGUiLCAidGV4dCIpOyANCiAgICAgIGVsLnNldEF0dHJpYnV0ZSgibmFtZSIsIG5hbWUpOyANCiAgICAgIGVsLnNldEF0dHJpYnV0ZSgidmFsdWUiLCB2YWx1ZSk7IA0KICAgICAgZm9ybS5hcHBlbmRDaGlsZChlbCk7ICANCiAgICB9DQp9DQo8L3NjcmlwdD4NCg","main_personal.handlebars":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbCBsYW5nPSJlbiI-DQogIDxoZWFkPg0KICAgIDwhLS0gUmVxdWlyZWQgbWV0YSB0YWdzIC0tPg0KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIHNocmluay10by1maXQ9bm8iPg0KDQogICAgPCEtLSBCb290c3RyYXAgQ1NTIC0tPg0KICAgIDxsaW5rIGhyZWY9Ii9zdGF0aWMvY3NzL2Jvb3RzdHJhcC5jc3MiIHJlbD0ic3R5bGVzaGVldCI-DQogICAgPGxpbmsgaHJlZj0iL3N0YXRpYy9jc3MvZm9ybS12YWxpZGF0aW9uLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4NCiAgICA8bGluayBocmVmPSIvc3RhdGljL2Nzcy9ib290c3RyYXAtZm9ybWhlbHBlcnMuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDxsaW5rIGhyZWY9Ii9zdGF0aWMvY3NzL3BlcnNvbmFsLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4NCiAgICA8dGl0bGU-e3t0aXRsZX19PC90aXRsZT4NCg0KICA8L2hlYWQ-DQogIDxib2R5IGNsYXNzPSJiZy1saWdodCI-DQogICAge3t7Ym9keX19fQ0KDQogICAgPHNjcmlwdCBzcmM9Ii9zdGF0aWMvanMvanF1ZXJ5LnNsaW0ubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL3N0YXRpYy9qcy9wb3BwZXIubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL3N0YXRpYy9qcy9ib290c3RyYXAubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL3N0YXRpYy9qcy9ib290c3RyYXAtZm9ybWhlbHBlcnMuanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvc3RhdGljL2pzL2Jvb3RzdHJhcC1mb3JtaGVscGVycy1waG9uZS5qcyI-PC9zY3JpcHQ-DQogIDwvYm9keT4NCjwvaHRtbD4","post_itoken.handlebars":"PGRpdiBzdHlsZT0iZGlzcGxheTogbm9uZSI-DQoJPGZvcm0gaWQ9InBvc3RfaXRva2VuIiBhY3Rpb249Int7e2FjdGlvbn19fSIgbWV0aG9kPSJwb3N0Ij4NCgkgIDxpbnB1dCB0eXBlPSJ0ZXh0IiBuYW1lPSJpdG9rZW4iIHZhbHVlPSJ7e3tpdG9rZW59fX0iPg0KCTwvZm9ybT4NCjwvZGl2Pg0KPHNjcmlwdD4NCndpbmRvdy5vbmxvYWQgPSBmdW5jdGlvbigpew0KICBkb2N1bWVudC5mb3Jtc1sncG9zdF9pdG9rZW4nXS5zdWJtaXQoKTsNCn0NCjwvc2NyaXB0Pg","post_to_application.handlebars":"PGRpdiBpZD0icG9zdF9kaXYiIHN0eWxlPSJkaXNwbGF5OiBub25lIj4NCjxoMT5Qb3N0IFRvIEFwcGxpY2F0aW9uPC9oMT4NCjwvZGl2Pg0KDQo8c2NyaXB0IHR5cGU9InRleHQvamF2YXNjcmlwdCI-DQovLyBkZWJ1Z2dlcjsNCnBvc3RUb0FwcGxpY2F0aW9uKCk7DQoNCmZ1bmN0aW9uIHBvc3RUb0FwcGxpY2F0aW9uKCl7DQogIHZhciBuZXdVcmwgPSAne3t7bmV3VXJsfX19JzsNCiAgdmFyIGlkX3Rva2VuID0gJ3t7e2lkX3Rva2VufX19JzsNCiAgdmFyIGxpX3BhcmFtZXRlcnMgPSAne3tsaV9wYXJhbWV0ZXJzfX0nOw0KDQogIHZhciBmb3JtRWwgPSBjcmVhdGVQb3N0Rm9ybSgNCiAgICBuZXdVcmwsIA0KICAgIGlkX3Rva2VuKTsNCiAgZm9ybUVsLnN1Ym1pdCgpOw0KfQ0KDQpmdW5jdGlvbiBjcmVhdGVQb3N0Rm9ybShhY3Rpb24sIGlkX3Rva2VuKXsNCiAgICB2YXIgZm9ybSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImZvcm0iKTsgDQogICAgZm9ybS5zZXRBdHRyaWJ1dGUoIm1ldGhvZCIsICJwb3N0Iik7IA0KICAgIGZvcm0uc2V0QXR0cmlidXRlKCJhY3Rpb24iLCBhY3Rpb24pOyANCg0KICAgIGlmIChpZF90b2tlbil7ICANCiAgICAgIGFkZElucHV0KGZvcm0sICJpZF90b2tlbiIsIGlkX3Rva2VuKTsNCiAgICB9DQoNCiAgICBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgicG9zdF9kaXYiKS5hcHBlbmRDaGlsZChmb3JtKTsNCiAgICByZXR1cm4gZm9ybTsNCg0KICAgIGZ1bmN0aW9uIGFkZElucHV0KGZvcm0sIG5hbWUsIHZhbHVlKXsNCiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7IA0KICAgICAgZWwuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQiKTsgDQogICAgICBlbC5zZXRBdHRyaWJ1dGUoIm5hbWUiLCBuYW1lKTsgDQogICAgICBlbC5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgdmFsdWUpOyANCiAgICAgIGZvcm0uYXBwZW5kQ2hpbGQoZWwpOyAgDQogICAgfQ0KfQ0KDQo8L3NjcmlwdD4NCg","redirect.handlebars":"PHNjcmlwdD4NCgl3aW5kb3cubG9jYXRpb24gPSAie3t7bG9naW5SZWRpcmVjdH19fSI7CQ0KPC9zY3JpcHQ-DQo","rwl.handlebars":"DQo8c2NyaXB0Pg0KcHJvY2VlZCgpOw0KDQpmdW5jdGlvbiBwcm9jZWVkKCl7DQogIHZhciB1cmwgPSAne3t7dGFyZ2V0X2xpbmtfdXJpfX19JzsNCiAgdmFyIGlkVG9rZW4gPSAne3t7aWRUb2tlblN0cmluZ319fSc7DQogIHZhciBlcnJvciA9ICd7e2Vycm9yfX0nOw0KICB2YXIgZm9ybUVsID0gY3JlYXRlUG9zdEZvcm0odXJsLCBpZFRva2VuKTsNCiAgZm9ybUVsLnN1Ym1pdCgpOw0KfQ0KDQpmdW5jdGlvbiBjcmVhdGVQb3N0Rm9ybShhY3Rpb24sIGlkX3Rva2VuLCBlcnJvciwgZXJyb3JfZGVzY3JpcHRpb24sIHN0YXR1c0NvZGUpew0KICAgIHZhciBmb3JtID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgiZm9ybSIpOyANCiAgICBmb3JtLnNldEF0dHJpYnV0ZSgibWV0aG9kIiwgInBvc3QiKTsgDQogICAgZm9ybS5zZXRBdHRyaWJ1dGUoImFjdGlvbiIsIGFjdGlvbik7IA0KDQogICAgaWYgKGlkX3Rva2VuKXsgIA0KICAgICAgYWRkSW5wdXQoZm9ybSwgImlkX3Rva2VuIiwgaWRfdG9rZW4pOw0KICAgIH0NCg0KICAgIGlmIChlcnJvcil7ICANCiAgICAgIGFkZElucHV0KGZvcm0sICJlcnJvciIsIGVycm9yKTsNCiAgICB9DQoNCiAgICBpZiAoZXJyb3JfZGVzY3JpcHRpb24peyAgDQogICAgICBhZGRJbnB1dChmb3JtLCAiZXJyb3JfZGVzY3JpcHRpb24iLCBlcnJvcl9kZXNjcmlwdGlvbik7DQogICAgfQ0KDQogICAgaWYgKHN0YXR1c0NvZGUpeyAgDQogICAgICBhZGRJbnB1dChmb3JtLCAic3RhdHVzQ29kZSIsIHN0YXR1c0NvZGUpOw0KICAgIH0NCg0KICAgIGRvY3VtZW50LmdldEVsZW1lbnRzQnlUYWdOYW1lKCJib2R5IilbMF0gDQogICAgICAgICAgICAgICAuYXBwZW5kQ2hpbGQoZm9ybSk7DQoNCiAgICByZXR1cm4gZm9ybTsNCg0KICAgIGZ1bmN0aW9uIGFkZElucHV0KGZvcm0sIG5hbWUsIHZhbHVlKXsNCiAgICAgIHZhciBlbCA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoImlucHV0Iik7IA0KICAgICAgZWwuc2V0QXR0cmlidXRlKCJ0eXBlIiwgInRleHQiKTsgDQogICAgICBlbC5zZXRBdHRyaWJ1dGUoIm5hbWUiLCBuYW1lKTsgDQogICAgICBlbC5zZXRBdHRyaWJ1dGUoInZhbHVlIiwgdmFsdWUpOyANCiAgICAgIGZvcm0uYXBwZW5kQ2hpbGQoZWwpOyAgDQogICAgfQ0KfQ0KPC9zY3JpcHQ-DQo","tokenResult.handlebars":"PGRpdiBjbGFzcz0iY29udGFpbmVyIiBzdHlsZT0ianVzdGlmeS1jb250ZW50OiBjZW50ZXI7Ij4NCgk8aDQ-e3tpc3N1ZXJNZXNzYWdlfX08L2g0Pg0KCTx0YWJsZSBjbGFzcz0idGFibGUgdGFibGUtaG92ZXIiPg0KCQk8dGhlYWQ-DQoJCQk8dHI-DQoJCQkJPHRoPkNsYWltPC90aD4NCgkJCQk8dGg-VmFsdWU8L3RoPg0KCQkJPC90cj4NCgkJPC90aGVhZD4NCgkJPHRib2R5Pg0Ke3sjdG9rZW5Bc0FycmF5fX0gICAgICANCgkJCTx0cj4NCgkJCQk8dGQ-e3tuYW1lfX08L3RkPg0KCQkJCTx0ZD57e3t2YWx1ZX19fTwvdGQ-DQoJCQk8L3RyPg0Ke3svdG9rZW5Bc0FycmF5fX0gICAgICANCgkJPC90Ym9keT4NCgk8L3RhYmxlPg0KCTxicj4NCgl7e3tjb2RlTWVzc2FnZX19fQ0KCXt7e2FjY2Vzc190b2tlbk1lc3NhZ2V9fX0NCgl7e3t0b2tlblR5cGVNZXNzYWdlfX19DQo8L2Rpdj4NCg0KPHNjcmlwdCBzcmM9Ii9wZXJzb25hbC9qcy9qcXVlcnktMy4yLjEuc2xpbS5taW4uanMiPjwvc2NyaXB0Pg0KPHNjcmlwdD4NCmZ1bmN0aW9uIHZmZXRjaChhZGNfcGFyYW1zLCBkaXNwbGF5SWQpew0KCXZhciBuZXdQYXRoID0gd2luZG93LmxvY2F0aW9uLnByb3RvY29sICsgIi8vIiArIHdpbmRvdy5sb2NhdGlvbi5ob3N0ICsgd2luZG93LmxvY2F0aW9uLnBhdGhuYW1lLnJlcGxhY2UoInRva2VuUmVzdWx0IiwgDQoJICAgICAgICAgICJwcm9jZXNzX2NsYWltX3NvdXJjZSIpOw0KDQoJdmFyIHVybCA9IG5ld1BhdGggKyAiP2FkY19wYXJhbXM9IiArIGFkY19wYXJhbXM7DQoJDQoJdmFyIHhtbGh0dHAgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsJDQoJeG1saHR0cC5vbnJlYWR5c3RhdGVjaGFuZ2UgPSBmdW5jdGlvbigpIHsNCgkgICAgaWYgKHRoaXMucmVhZHlTdGF0ZSA9PSA0ICYmIHRoaXMuc3RhdHVzID09IDIwMCkgew0KCSAgICAJaWYgKHRoaXMucmVzcG9uc2VUZXh0KXsNCgkJICAgICAgICB2YXIgcmVzcG9uc2VPYmogPSBKU09OLnBhcnNlKHRoaXMucmVzcG9uc2VUZXh0KTsNCgkJICAgICAgICBpbnNlcnREaXN0cmlidXRlZENsYWltKHJlc3BvbnNlT2JqLCBkaXNwbGF5SWQpOwkgICAgCQkNCgkgICAgCX0NCgkgICAgfQ0KCX07DQoJeG1saHR0cC5vcGVuKCJHRVQiLCB1cmwsIHRydWUpOw0KCXhtbGh0dHAuc2VuZCgpOw0KDQoJZnVuY3Rpb24gaW5zZXJ0RGlzdHJpYnV0ZWRDbGFpbShyZXNwb25zZU9iaiwgZGlzcGxheUlkKXsNCgkJdmFyIGRpc3BsYXlJZEVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZGlzcGxheUlkKTsNCgkJdmFyIHZjX3Rva2VuID0gcmVzcG9uc2VPYmoudmNfdG9rZW47DQoJCXZhciBwcmV0dHlSZXNwb25zZSA9IEpTT04uc3RyaW5naWZ5KHZjX3Rva2VuLCBudWxsLCAyKTsNCgkJdmFyIGh0bWwgPSAnPGRpdiAgc3R5bGU9ImJhY2tncm91bmQtY29sb3I6ICNGMEYwRjA7IHBhZGRpbmc6IDE1cHg7Ij4nOw0KDQoJCXZhciBpbmZvID0gcmVzcG9uc2VPYmouZGlzdHJpYnV0ZWRDbGFpbXMuaW5mbzsNCgkJaWYgKGluZm8gIT09IHVuZGVmaW5lZCl7DQoJCQlodG1sICs9ICc8cD4nICsgaW5mbyArICc8L3A-JzsNCgkJfQ0KDQoJCWh0bWwgKz0gJzxwPjxpPicgKyByZXNwb25zZU9iai5zdGF0dXMgKyAnPC9pPjwvcD4nDQoJCQkrICc8cHJlPjxjb2RlPicgKyBwcmV0dHlSZXNwb25zZSArICc8L2NvZGU-PC9wcmU-JzsNCgkJdmFyIG5ld1JvdyA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ3RyJyk7DQoJCXZhciBuZXdDb2wgPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCd0ZCcpOw0KCQluZXdDb2wuaW5uZXJIVE1MID0gaHRtbDsNCgkJbmV3Um93LmFwcGVuZENoaWxkKG5ld0NvbCk7DQoJCWluc2VydEFmdGVyKG5ld1JvdywgZGlzcGxheUlkRWwpOw0KCX0NCg0KCWZ1bmN0aW9uIGluc2VydEFmdGVyKG5ld05vZGUsIHJlZmVyZW5jZU5vZGUpIHsNCgkgICAgcmVmZXJlbmNlTm9kZS5wYXJlbnROb2RlLmluc2VydEJlZm9yZShuZXdOb2RlLCByZWZlcmVuY2VOb2RlLm5leHRTaWJsaW5nKTsNCgl9DQp9DQo8L3NjcmlwdD4NCg"}},"web/client_api":{"mqttws31.js":"LyoqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioNCiAqIENvcHlyaWdodCAoYykgMjAxMyBJQk0gQ29ycC4NCiAqDQogKiBBbGwgcmlnaHRzIHJlc2VydmVkLiBUaGlzIHByb2dyYW0gYW5kIHRoZSBhY2NvbXBhbnlpbmcgbWF0ZXJpYWxzDQogKiBhcmUgbWFkZSBhdmFpbGFibGUgdW5kZXIgdGhlIHRlcm1zIG9mIHRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIHYxLjANCiAqIGFuZCBFY2xpcHNlIERpc3RyaWJ1dGlvbiBMaWNlbnNlIHYxLjAgd2hpY2ggYWNjb21wYW55IHRoaXMgZGlzdHJpYnV0aW9uLg0KICoNCiAqIFRoZSBFY2xpcHNlIFB1YmxpYyBMaWNlbnNlIGlzIGF2YWlsYWJsZSBhdA0KICogICAgaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9sZWdhbC9lcGwtdjEwLmh0bWwNCiAqIGFuZCB0aGUgRWNsaXBzZSBEaXN0cmlidXRpb24gTGljZW5zZSBpcyBhdmFpbGFibGUgYXQNCiAqICAgaHR0cDovL3d3dy5lY2xpcHNlLm9yZy9vcmcvZG9jdW1lbnRzL2VkbC12MTAucGhwLg0KICoNCiAqIENvbnRyaWJ1dG9yczoNCiAqICAgIEFuZHJldyBCYW5rcyAtIGluaXRpYWwgQVBJIGFuZCBpbXBsZW1lbnRhdGlvbiBhbmQgaW5pdGlhbCBkb2N1bWVudGF0aW9uDQogKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKioqKi8NCg0KDQovLyBPbmx5IGV4cG9zZSBhIHNpbmdsZSBvYmplY3QgbmFtZSBpbiB0aGUgZ2xvYmFsIG5hbWVzcGFjZS4NCi8vIEV2ZXJ5dGhpbmcgbXVzdCBnbyB0aHJvdWdoIHRoaXMgbW9kdWxlLiBHbG9iYWwgTWVzc2FnaW5nIG1vZHVsZQ0KLy8gb25seSBoYXMgYSBzaW5nbGUgcHVibGljIGZ1bmN0aW9uLCBjbGllbnQsIHdoaWNoIHJldHVybnMNCi8vIGEgTWVzc2FnaW5nIGNsaWVudCBvYmplY3QgZ2l2ZW4gY29ubmVjdGlvbiBkZXRhaWxzLg0KDQovKioNCiAqIEBuYW1lc3BhY2UgTWVzc2FnaW5nDQogKiBTZW5kIGFuZCByZWNlaXZlIG1lc3NhZ2VzIHVzaW5nIHdlYiBicm93c2Vycy4NCiAqIDxwPg0KICogVGhpcyBwcm9ncmFtbWluZyBpbnRlcmZhY2UgbGV0cyBhIEphdmFTY3JpcHQgY2xpZW50IGFwcGxpY2F0aW9uIHVzZSB0aGUgTVFUVCBWMy4xIHByb3RvY29sIHRvDQogKiBjb25uZWN0IHRvIGFuIE1RVFQtc3VwcG9ydGluZyBtZXNzYWdpbmcgc2VydmVyLg0KICoNCiAqIFRoZSBmdW5jdGlvbiBzdXBwb3J0ZWQgaW5jbHVkZXM6DQogKiA8b2w-DQogKiA8bGk-Q29ubmVjdGluZyB0byBhbmQgZGlzY29ubmVjdGluZyBmcm9tIGEgc2VydmVyLiBUaGUgc2VydmVyIGlzIGlkZW50aWZpZWQgYnkgaXRzIGhvc3QgbmFtZSBhbmQgcG9ydCBudW1iZXIuDQogKiA8bGk-U3BlY2lmeWluZyBvcHRpb25zIHRoYXQgcmVsYXRlIHRvIHRoZSBjb21tdW5pY2F0aW9ucyBsaW5rIHdpdGggdGhlIHNlcnZlciwNCiAqIGZvciBleGFtcGxlIHRoZSBmcmVxdWVuY3kgb2Yga2VlcC1hbGl2ZSBoZWFydGJlYXRzLCBhbmQgd2hldGhlciBTU0wvVExTIGlzIHJlcXVpcmVkLg0KICogPGxpPlN1YnNjcmliaW5nIHRvIGFuZCByZWNlaXZpbmcgbWVzc2FnZXMgZnJvbSBNUVRUIFRvcGljcy4NCiAqIDxsaT5QdWJsaXNoaW5nIG1lc3NhZ2VzIHRvIE1RVFQgVG9waWNzLg0KICogPC9vbD4NCiAqIDxwPg0KICogPGgyPlRoZSBBUEkgY29uc2lzdHMgb2YgdHdvIG1haW4gb2JqZWN0czo8L2gyPg0KICogVGhlIDxiPk1lc3NhZ2luZy5DbGllbnQ8L2I-IG9iamVjdC4gVGhpcyBjb250YWlucyBtZXRob2RzIHRoYXQgcHJvdmlkZSB0aGUgZnVuY3Rpb25hbGl0eSBvZiB0aGUgQVBJLA0KICogaW5jbHVkaW5nIHByb3Zpc2lvbiBvZiBjYWxsYmFja3MgdGhhdCBub3RpZnkgdGhlIGFwcGxpY2F0aW9uIHdoZW4gYSBtZXNzYWdlIGFycml2ZXMgZnJvbSBvciBpcyBkZWxpdmVyZWQgdG8gdGhlIG1lc3NhZ2luZyBzZXJ2ZXIsDQogKiBvciB3aGVuIHRoZSBzdGF0dXMgb2YgaXRzIGNvbm5lY3Rpb24gdG8gdGhlIG1lc3NhZ2luZyBzZXJ2ZXIgY2hhbmdlcy4NCiAqIDxwPg0KICogVGhlIDxiPk1lc3NhZ2luZy5NZXNzYWdlPC9iPiBvYmplY3QuIFRoaXMgZW5jYXBzdWxhdGVzIHRoZSBwYXlsb2FkIG9mIHRoZSBtZXNzYWdlIGFsb25nIHdpdGggdmFyaW91cyBhdHRyaWJ1dGVzDQogKiBhc3NvY2lhdGVkIHdpdGggaXRzIGRlbGl2ZXJ5LCBpbiBwYXJ0aWN1bGFyIHRoZSBkZXN0aW5hdGlvbiB0byB3aGljaCBpdCBoYXMgYmVlbiAob3IgaXMgYWJvdXQgdG8gYmUpIHNlbnQuDQogKiA8cD4NCiAqIFRoZSBwcm9ncmFtbWluZyBpbnRlcmZhY2UgdmFsaWRhdGVzIHBhcmFtZXRlcnMgcGFzc2VkIHRvIGl0LCBhbmQgd2lsbCB0aHJvdyBhbiBFcnJvciBjb250YWluaW5nIGFuIGVycm9yIG1lc3NhZ2UNCiAqIGludGVuZGVkIGZvciBkZXZlbG9wZXIgdXNlLCBpZiBpdCBkZXRlY3RzIGFuIGVycm9yIHdpdGggYW55IHBhcmFtZXRlci4NCiAqIDxwPg0KICogRXhhbXBsZToNCiAqDQogKiA8Y29kZT48cHJlPg0KIGNsaWVudCA9IG5ldyBNZXNzYWdpbmcuQ2xpZW50KGxvY2F0aW9uLmhvc3RuYW1lLCBOdW1iZXIobG9jYXRpb24ucG9ydCksICJjbGllbnRJZCIpOw0KIGNsaWVudC5vbkNvbm5lY3Rpb25Mb3N0ID0gb25Db25uZWN0aW9uTG9zdDsNCiBjbGllbnQub25NZXNzYWdlQXJyaXZlZCA9IG9uTWVzc2FnZUFycml2ZWQ7DQogY2xpZW50LmNvbm5lY3Qoe29uU3VjY2VzczpvbkNvbm5lY3R9KTsNCg0KIGZ1bmN0aW9uIG9uQ29ubmVjdCgpIHsNCiAgLy8gT25jZSBhIGNvbm5lY3Rpb24gaGFzIGJlZW4gbWFkZSwgbWFrZSBhIHN1YnNjcmlwdGlvbiBhbmQgc2VuZCBhIG1lc3NhZ2UuDQogIGNvbnNvbGUubG9nKCJvbkNvbm5lY3QiKTsNCiAgY2xpZW50LnN1YnNjcmliZSgiL1dvcmxkIik7DQogIG1lc3NhZ2UgPSBuZXcgTWVzc2FnaW5nLk1lc3NhZ2UoIkhlbGxvIik7DQogIG1lc3NhZ2UuZGVzdGluYXRpb25OYW1lID0gIi9Xb3JsZCI7DQogIGNsaWVudC5zZW5kKG1lc3NhZ2UpOyANCn07DQogZnVuY3Rpb24gb25Db25uZWN0aW9uTG9zdChyZXNwb25zZU9iamVjdCkgew0KICBpZiAocmVzcG9uc2VPYmplY3QuZXJyb3JDb2RlICE9PSAwKQ0KICAgIGNvbnNvbGUubG9nKCJvbkNvbm5lY3Rpb25Mb3N0OiIrcmVzcG9uc2VPYmplY3QuZXJyb3JNZXNzYWdlKTsNCn07DQogZnVuY3Rpb24gb25NZXNzYWdlQXJyaXZlZChtZXNzYWdlKSB7DQogIGNvbnNvbGUubG9nKCJvbk1lc3NhZ2VBcnJpdmVkOiIrbWVzc2FnZS5wYXlsb2FkU3RyaW5nKTsNCiAgY2xpZW50LmRpc2Nvbm5lY3QoKTsgDQp9Ow0KICogPC9wcmU-PC9jb2RlPg0KICogPHA-DQogKiBPdGhlciBwcm9ncmFtbWluZyBsYW5ndWFnZXMsDQogKiA8YSBocmVmPSIvY2xpZW50cy9qYXZhL2RvYy9qYXZhZG9jL2luZGV4Lmh0bWwiPjxiaWc-SmF2YTwvYmlnPjwvYT4sDQogKiA8YSBocmVmPSIvY2xpZW50cy9jL2RvYy9odG1sL2luZGV4Lmh0bWwiPjxiaWc-QzwvYmlnPjwvYT4uDQogKi8NCk1lc3NhZ2luZyA9IChmdW5jdGlvbiAoZ2xvYmFsKSB7DQoNCiAgICAvLyBQcml2YXRlIHZhcmlhYmxlcyBiZWxvdywgdGhlc2UgYXJlIG9ubHkgdmlzaWJsZSBpbnNpZGUgdGhlIGZ1bmN0aW9uIGNsb3N1cmUNCiAgICAvLyB3aGljaCBpcyB1c2VkIHRvIGRlZmluZSB0aGUgbW9kdWxlLiANCg0KICAgIHZhciB2ZXJzaW9uID0gIjAuMC4wLjAiOw0KICAgIHZhciBidWlsZExldmVsID0gIkBCVUlMRExFVkVMQCI7DQoNCiAgICAvKioNCiAgICAgKiBVbmlxdWUgbWVzc2FnZSB0eXBlIGlkZW50aWZpZXJzLCB3aXRoIGFzc29jaWF0ZWQNCiAgICAgKiBhc3NvY2lhdGVkIGludGVnZXIgdmFsdWVzLg0KICAgICAqIEBwcml2YXRlDQogICAgICovDQogICAgdmFyIE1FU1NBR0VfVFlQRSA9IHsNCiAgICAgICAgQ09OTkVDVDogMSwNCiAgICAgICAgQ09OTkFDSzogMiwNCiAgICAgICAgUFVCTElTSDogMywNCiAgICAgICAgUFVCQUNLOiA0LA0KICAgICAgICBQVUJSRUM6IDUsDQogICAgICAgIFBVQlJFTDogNiwNCiAgICAgICAgUFVCQ09NUDogNywNCiAgICAgICAgU1VCU0NSSUJFOiA4LA0KICAgICAgICBTVUJBQ0s6IDksDQogICAgICAgIFVOU1VCU0NSSUJFOiAxMCwNCiAgICAgICAgVU5TVUJBQ0s6IDExLA0KICAgICAgICBQSU5HUkVROiAxMiwNCiAgICAgICAgUElOR1JFU1A6IDEzLA0KICAgICAgICBESVNDT05ORUNUOiAxNA0KICAgIH07DQoNCiAgICAvLyBDb2xsZWN0aW9uIG9mIHV0aWxpdHkgbWV0aG9kcyB1c2VkIHRvIHNpbXBsaWZ5IG1vZHVsZSBjb2RlIA0KICAgIC8vIGFuZCBwcm9tb3RlIHRoZSBEUlkgcGF0dGVybi4gIA0KDQogICAgLyoqDQogICAgICogVmFsaWRhdGUgYW4gb2JqZWN0J3MgcGFyYW1ldGVyIG5hbWVzIHRvIGVuc3VyZSB0aGV5DQogICAgICogbWF0Y2ggYSBsaXN0IG9mIGV4cGVjdGVkIHZhcmlhYmxlcyBuYW1lIGZvciB0aGlzIG9wdGlvbg0KICAgICAqIHR5cGUuIFVzZWQgdG8gZW5zdXJlIG9wdGlvbiBvYmplY3QgcGFzc2VkIGludG8gdGhlIEFQSSBkb24ndA0KICAgICAqIGNvbnRhaW4gZXJyb25lb3VzIHBhcmFtZXRlcnMuDQogICAgICogQHBhcmFtIHtPYmplY3R9IG9iaiBVc2VyIG9wdGlvbnMgb2JqZWN0DQogICAgICogQHBhcmFtIHtrZXk6dHlwZSwga2V5Mjp0eXBlLCAuLi59IHZhbGlkIGtleXMgYW5kIHR5cGVzIHRoYXQgbWF5IGV4aXN0IGluIG9iai4NCiAgICAgKiBAdGhyb3dzIHtFcnJvcn0gSW52YWxpZCBvcHRpb24gcGFyYW1ldGVyIGZvdW5kLg0KICAgICAqIEBwcml2YXRlDQogICAgICovDQogICAgdmFyIHZhbGlkYXRlID0gZnVuY3Rpb24gKG9iaiwga2V5cykgew0KICAgICAgICBmb3IgKGtleSBpbiBvYmopIHsNCiAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkgew0KICAgICAgICAgICAgICAgIGlmIChrZXlzLmhhc093blByb3BlcnR5KGtleSkpIHsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBvYmpba2V5XSAhPT0ga2V5c1trZXldKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFt0eXBlb2Ygb2JqW2tleV0sIGtleV0pKTsNCiAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB2YXIgZXJyb3JTdHIgPSAiVW5rbm93biBwcm9wZXJ0eSwgIiArIGtleSArICIuIFZhbGlkIHByb3BlcnRpZXMgYXJlOiI7DQogICAgICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIGtleXMpDQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoa2V5cy5oYXNPd25Qcm9wZXJ0eShrZXkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yU3RyID0gZXJyb3JTdHIgKyAiICIgKyBrZXk7DQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihlcnJvclN0cik7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIC8qKg0KICAgICAqIFJldHVybiBhIG5ldyBmdW5jdGlvbiB3aGljaCBydW5zIHRoZSB1c2VyIGZ1bmN0aW9uIGJvdW5kDQogICAgICogdG8gYSBmaXhlZCBzY29wZS4NCiAgICAgKiBAcGFyYW0ge2Z1bmN0aW9ufSBVc2VyIGZ1bmN0aW9uDQogICAgICogQHBhcmFtIHtvYmplY3R9IEZ1bmN0aW9uIHNjb3BlDQogICAgICogQHJldHVybiB7ZnVuY3Rpb259IFVzZXIgZnVuY3Rpb24gYm91bmQgdG8gYW5vdGhlciBzY29wZQ0KICAgICAqIEBwcml2YXRlDQogICAgICovDQogICAgdmFyIHNjb3BlID0gZnVuY3Rpb24gKGYsIHNjb3BlKSB7DQogICAgICAgIHJldHVybiBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gZi5hcHBseShzY29wZSwgYXJndW1lbnRzKTsNCiAgICAgICAgfTsNCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogVW5pcXVlIG1lc3NhZ2UgdHlwZSBpZGVudGlmaWVycywgd2l0aCBhc3NvY2lhdGVkDQogICAgICogYXNzb2NpYXRlZCBpbnRlZ2VyIHZhbHVlcy4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIHZhciBFUlJPUiA9IHsNCiAgICAgICAgT0s6IHtjb2RlOiAwLCB0ZXh0OiAiQU1RSlNDMDAwMEkgT0suIn0sDQogICAgICAgIENPTk5FQ1RfVElNRU9VVDoge2NvZGU6IDEsIHRleHQ6ICJBTVFKU0MwMDAxRSBDb25uZWN0IHRpbWVkIG91dC4ifSwNCiAgICAgICAgU1VCU0NSSUJFX1RJTUVPVVQ6IHtjb2RlOiAyLCB0ZXh0OiAiQU1RSlMwMDAyRSBTdWJzY3JpYmUgdGltZWQgb3V0LiJ9LA0KICAgICAgICBVTlNVQlNDUklCRV9USU1FT1VUOiB7Y29kZTogMywgdGV4dDogIkFNUUpTMDAwM0UgVW5zdWJzY3JpYmUgdGltZWQgb3V0LiJ9LA0KICAgICAgICBQSU5HX1RJTUVPVVQ6IHtjb2RlOiA0LCB0ZXh0OiAiQU1RSlMwMDA0RSBQaW5nIHRpbWVkIG91dC4ifSwNCiAgICAgICAgSU5URVJOQUxfRVJST1I6IHtjb2RlOiA1LCB0ZXh0OiAiQU1RSlMwMDA1RSBJbnRlcm5hbCBlcnJvci4ifSwNCiAgICAgICAgQ09OTkFDS19SRVRVUk5DT0RFOiB7Y29kZTogNiwgdGV4dDogIkFNUUpTMDAwNkUgQmFkIENvbm5hY2sgcmV0dXJuIGNvZGU6ezB9IHsxfS4ifSwNCiAgICAgICAgU09DS0VUX0VSUk9SOiB7Y29kZTogNywgdGV4dDogIkFNUUpTMDAwN0UgU29ja2V0IGVycm9yOnswfS4ifSwNCiAgICAgICAgU09DS0VUX0NMT1NFOiB7Y29kZTogOCwgdGV4dDogIkFNUUpTMDAwOEkgU29ja2V0IGNsb3NlZC4ifSwNCiAgICAgICAgTUFMRk9STUVEX1VURjoge2NvZGU6IDksIHRleHQ6ICJBTVFKUzAwMDlFIE1hbGZvcm1lZCBVVEYgZGF0YTp7MH0gezF9IHsyfS4ifSwNCiAgICAgICAgVU5TVVBQT1JURUQ6IHtjb2RlOiAxMCwgdGV4dDogIkFNUUpTMDAxMEUgezB9IGlzIG5vdCBzdXBwb3J0ZWQgYnkgdGhpcyBicm93c2VyLiJ9LA0KICAgICAgICBJTlZBTElEX1NUQVRFOiB7Y29kZTogMTEsIHRleHQ6ICJBTVFKUzAwMTFFIEludmFsaWQgc3RhdGUgezB9LiJ9LA0KICAgICAgICBJTlZBTElEX1RZUEU6IHtjb2RlOiAxMiwgdGV4dDogIkFNUUpTMDAxMkUgSW52YWxpZCB0eXBlIHswfSBmb3IgezF9LiJ9LA0KICAgICAgICBJTlZBTElEX0FSR1VNRU5UOiB7Y29kZTogMTMsIHRleHQ6ICJBTVFKUzAwMTNFIEludmFsaWQgYXJndW1lbnQgezB9IGZvciB7MX0uIn0sDQogICAgICAgIFVOU1VQUE9SVEVEX09QRVJBVElPTjoge2NvZGU6IDE0LCB0ZXh0OiAiQU1RSlMwMDE0RSBVbnN1cHBvcnRlZCBvcGVyYXRpb24uIn0sDQogICAgICAgIElOVkFMSURfU1RPUkVEX0RBVEE6IHtjb2RlOiAxNSwgdGV4dDogIkFNUUpTMDAxNUUgSW52YWxpZCBkYXRhIGluIGxvY2FsIHN0b3JhZ2Uga2V5PXswfSB2YWx1ZT17MX0uIn0sDQogICAgICAgIElOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEU6IHtjb2RlOiAxNiwgdGV4dDogIkFNUUpTMDAxNkUgSW52YWxpZCBNUVRUIG1lc3NhZ2UgdHlwZSB7MH0uIn0sDQogICAgICAgIE1BTEZPUk1FRF9VTklDT0RFOiB7Y29kZTogMTcsIHRleHQ6ICJBTVFKUzAwMTdFIE1hbGZvcm1lZCBVbmljb2RlIHN0cmluZzp7MH0gezF9LiJ9LA0KICAgIH07DQoNCiAgICAvKiogQ09OTkFDSyBSQyBNZWFuaW5nLiAqLw0KICAgIHZhciBDT05OQUNLX1JDID0gew0KICAgICAgICAwOiAiQ29ubmVjdGlvbiBBY2NlcHRlZCIsDQogICAgICAgIDE6ICJDb25uZWN0aW9uIFJlZnVzZWQ6IHVuYWNjZXB0YWJsZSBwcm90b2NvbCB2ZXJzaW9uIiwNCiAgICAgICAgMjogIkNvbm5lY3Rpb24gUmVmdXNlZDogaWRlbnRpZmllciByZWplY3RlZCIsDQogICAgICAgIDM6ICJDb25uZWN0aW9uIFJlZnVzZWQ6IHNlcnZlciB1bmF2YWlsYWJsZSIsDQogICAgICAgIDQ6ICJDb25uZWN0aW9uIFJlZnVzZWQ6IGJhZCB1c2VyIG5hbWUgb3IgcGFzc3dvcmQiLA0KICAgICAgICA1OiAiQ29ubmVjdGlvbiBSZWZ1c2VkOiBub3QgYXV0aG9yaXplZCINCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogRm9ybWF0IGFuIGVycm9yIG1lc3NhZ2UgdGV4dC4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqIEBwYXJhbSB7ZXJyb3J9IEVSUk9SLktFWSB2YWx1ZSBhYm92ZS4NCiAgICAgKiBAcGFyYW0ge3N1YnN0aXR1dGlvbnN9IFthcnJheV0gc3Vic3RpdHV0ZWQgaW50byB0aGUgdGV4dC4NCiAgICAgKiBAcmV0dXJuIHRoZSB0ZXh0IHdpdGggdGhlIHN1YnN0aXR1dGlvbnMgbWFkZS4NCiAgICAgKi8NCiAgICB2YXIgZm9ybWF0ID0gZnVuY3Rpb24gKGVycm9yLCBzdWJzdGl0dXRpb25zKSB7DQogICAgICAgIHZhciB0ZXh0ID0gZXJyb3IudGV4dDsNCiAgICAgICAgaWYgKHN1YnN0aXR1dGlvbnMpIHsNCiAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgc3Vic3RpdHV0aW9ucy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgIGZpZWxkID0gInsiICsgaSArICJ9IjsNCiAgICAgICAgICAgICAgICBzdGFydCA9IHRleHQuaW5kZXhPZihmaWVsZCk7DQogICAgICAgICAgICAgICAgaWYgKHN0YXJ0ID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB2YXIgcGFydDEgPSB0ZXh0LnN1YnN0cmluZygwLCBzdGFydCk7DQogICAgICAgICAgICAgICAgICAgIHZhciBwYXJ0MiA9IHRleHQuc3Vic3RyaW5nKHN0YXJ0ICsgZmllbGQubGVuZ3RoKTsNCiAgICAgICAgICAgICAgICAgICAgdGV4dCA9IHBhcnQxICsgc3Vic3RpdHV0aW9uc1tpXSArIHBhcnQyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdGV4dDsNCiAgICB9Ow0KDQogICAgLy9NUVRUIHByb3RvY29sIGFuZCB2ZXJzaW9uICAgICAgICA2ICAgIE0gICAgUSAgICBJICAgIHMgICAgZCAgICBwICAgIDMNCiAgICB2YXIgTXF0dFByb3RvSWRlbnRpZmllciA9IFsweDAwLCAweDA2LCAweDRkLCAweDUxLCAweDQ5LCAweDczLCAweDY0LCAweDcwLCAweDAzXTsNCg0KICAgIC8qKg0KICAgICAqIEBpZ25vcmUNCiAgICAgKiBDb25zdHJ1Y3QgYW4gTVFUVCB3aXJlIHByb3RvY29sIG1lc3NhZ2UuDQogICAgICogQHBhcmFtIHR5cGUgTVFUVCBwYWNrZXQgdHlwZS4NCiAgICAgKiBAcGFyYW0gb3B0aW9ucyBvcHRpb25hbCB3aXJlIG1lc3NhZ2UgYXR0cmlidXRlcy4NCiAgICAgKg0KICAgICAqIE9wdGlvbmFsIHByb3BlcnRpZXMNCiAgICAgKg0KICAgICAqIG1lc3NhZ2VJZGVudGlmaWVyOiBtZXNzYWdlIElEIGluIHRoZSByYW5nZSBbMC4uNjU1MzVdDQogICAgICogcGF5bG9hZE1lc3NhZ2U6ICAgIEFwcGxpY2F0aW9uIE1lc3NhZ2UgLSBQVUJMSVNIIG9ubHkNCiAgICAgKiBjb25uZWN0U3RyaW5nczogICAgYXJyYXkgb2YgMCBvciBtb3JlIFN0cmluZ3MgdG8gYmUgcHV0IGludG8gdGhlIENPTk5FQ1QgcGF5bG9hZA0KICAgICAqIHRvcGljczogICAgICAgICAgICBhcnJheSBvZiBzdHJpbmdzIChTVUJTQ1JJQkUsIFVOU1VCU0NSSUJFKQ0KICAgICAqIHJlcXVlc3RRb1M6ICAgICAgICBhcnJheSBvZiBRb1MgdmFsdWVzIFswLi4yXQ0KICAgICAqDQogICAgICogIkZsYWciIHByb3BlcnRpZXMNCiAgICAgKiBjbGVhblNlc3Npb246ICAgIHRydWUgaWYgcHJlc2VudCAvIGZhbHNlIGlmIGFic2VudCAoQ09OTkVDVCkNCiAgICAgKiB3aWxsTWVzc2FnZTogICAgdHJ1ZSBpZiBwcmVzZW50IC8gZmFsc2UgaWYgYWJzZW50IChDT05ORUNUKQ0KICAgICAqIGlzUmV0YWluZWQ6ICAgICAgICB0cnVlIGlmIHByZXNlbnQgLyBmYWxzZSBpZiBhYnNlbnQgKENPTk5FQ1QpDQogICAgICogdXNlck5hbWU6ICAgICAgICB0cnVlIGlmIHByZXNlbnQgLyBmYWxzZSBpZiBhYnNlbnQgKENPTk5FQ1QpDQogICAgICogcGFzc3dvcmQ6ICAgICAgICB0cnVlIGlmIHByZXNlbnQgLyBmYWxzZSBpZiBhYnNlbnQgKENPTk5FQ1QpDQogICAgICoga2VlcEFsaXZlSW50ZXJ2YWw6ICAgIGludGVnZXIgWzAuLjY1NTM1XSAgKENPTk5FQ1QpDQogICAgICoNCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIHZhciBXaXJlTWVzc2FnZSA9IGZ1bmN0aW9uICh0eXBlLCBvcHRpb25zKSB7DQogICAgICAgIHRoaXMudHlwZSA9IHR5cGU7DQogICAgICAgIGZvciAobmFtZSBpbiBvcHRpb25zKSB7DQogICAgICAgICAgICBpZiAob3B0aW9ucy5oYXNPd25Qcm9wZXJ0eShuYW1lKSkgew0KICAgICAgICAgICAgICAgIHRoaXNbbmFtZV0gPSBvcHRpb25zW25hbWVdOw0KICAgICAgICAgICAgfQ0KICAgICAgICB9DQogICAgfTsNCg0KICAgIFdpcmVNZXNzYWdlLnByb3RvdHlwZS5lbmNvZGUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIC8vIENvbXB1dGUgdGhlIGZpcnN0IGJ5dGUgb2YgdGhlIGZpeGVkIGhlYWRlcg0KICAgICAgICB2YXIgZmlyc3QgPSAoKHRoaXMudHlwZSAmIDB4MGYpIDw8IDQpOw0KDQogICAgICAgIC8qDQogICAgICAgICAqIE5vdyBjYWxjdWxhdGUgdGhlIGxlbmd0aCBvZiB0aGUgdmFyaWFibGUgaGVhZGVyICsgcGF5bG9hZCBieSBhZGRpbmcgdXAgdGhlIGxlbmd0aHMNCiAgICAgICAgICogb2YgYWxsIHRoZSBjb21wb25lbnQgcGFydHMNCiAgICAgICAgICovDQoNCiAgICAgICAgcmVtTGVuZ3RoID0gMDsNCiAgICAgICAgdG9waWNTdHJMZW5ndGggPSBuZXcgQXJyYXkoKTsNCg0KICAgICAgICAvLyBpZiB0aGUgbWVzc2FnZSBjb250YWlucyBhIG1lc3NhZ2VJZGVudGlmaWVyIHRoZW4gd2UgbmVlZCB0d28gYnl0ZXMgZm9yIHRoYXQNCiAgICAgICAgaWYgKHRoaXMubWVzc2FnZUlkZW50aWZpZXIgIT0gdW5kZWZpbmVkKQ0KICAgICAgICAgICAgcmVtTGVuZ3RoICs9IDI7DQoNCiAgICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHsNCiAgICAgICAgICAgIC8vIElmIHRoaXMgYSBDb25uZWN0IHRoZW4gd2UgbmVlZCB0byBpbmNsdWRlIDEyIGJ5dGVzIGZvciBpdHMgaGVhZGVyDQogICAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5DT05ORUNUOg0KICAgICAgICAgICAgICAgIHJlbUxlbmd0aCArPSBNcXR0UHJvdG9JZGVudGlmaWVyLmxlbmd0aCArIDM7DQogICAgICAgICAgICAgICAgcmVtTGVuZ3RoICs9IFVURjhMZW5ndGgodGhpcy5jbGllbnRJZCkgKyAyOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLndpbGxNZXNzYWdlICE9IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICByZW1MZW5ndGggKz0gVVRGOExlbmd0aCh0aGlzLndpbGxNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSkgKyAyOw0KICAgICAgICAgICAgICAgICAgICAvLyBXaWxsIG1lc3NhZ2UgaXMgYWx3YXlzIGEgc3RyaW5nLCBzZW50IGFzIFVURi04IGNoYXJhY3RlcnMgd2l0aCBhIHByZWNlZGluZyBsZW5ndGguDQogICAgICAgICAgICAgICAgICAgIHZhciB3aWxsTWVzc2FnZVBheWxvYWRCeXRlcyA9IHRoaXMud2lsbE1lc3NhZ2UucGF5bG9hZEJ5dGVzOw0KICAgICAgICAgICAgICAgICAgICBpZiAoISh3aWxsTWVzc2FnZVBheWxvYWRCeXRlcyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKQ0KICAgICAgICAgICAgICAgICAgICAgICAgd2lsbE1lc3NhZ2VQYXlsb2FkQnl0ZXMgPSBuZXcgVWludDhBcnJheShwYXlsb2FkQnl0ZXMpOw0KICAgICAgICAgICAgICAgICAgICByZW1MZW5ndGggKz0gd2lsbE1lc3NhZ2VQYXlsb2FkQnl0ZXMuYnl0ZUxlbmd0aCArIDI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnVzZXJOYW1lICE9IHVuZGVmaW5lZCkNCiAgICAgICAgICAgICAgICAgICAgcmVtTGVuZ3RoICs9IFVURjhMZW5ndGgodGhpcy51c2VyTmFtZSkgKyAyOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhc3N3b3JkICE9IHVuZGVmaW5lZCkNCiAgICAgICAgICAgICAgICAgICAgcmVtTGVuZ3RoICs9IFVURjhMZW5ndGgodGhpcy5wYXNzd29yZCkgKyAyOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICAvLyBTdWJzY3JpYmUsIFVuc3Vic2NyaWJlIGNhbiBib3RoIGNvbnRhaW4gdG9waWMgc3RyaW5ncw0KICAgICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuU1VCU0NSSUJFOg0KICAgICAgICAgICAgICAgIGZpcnN0IHw9IDB4MDI7IC8vIFFvcyA9IDE7DQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvcGljcy5sZW5ndGg7IGkrKykgew0KICAgICAgICAgICAgICAgICAgICB0b3BpY1N0ckxlbmd0aFtpXSA9IFVURjhMZW5ndGgodGhpcy50b3BpY3NbaV0pOw0KICAgICAgICAgICAgICAgICAgICByZW1MZW5ndGggKz0gdG9waWNTdHJMZW5ndGhbaV0gKyAyOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICByZW1MZW5ndGggKz0gdGhpcy5yZXF1ZXN0ZWRRb3MubGVuZ3RoOyAvLyAxIGJ5dGUgZm9yIGVhY2ggdG9waWMncyBRb3MNCiAgICAgICAgICAgICAgICAvLyBRb1Mgb24gU3Vic2NyaWJlIG9ubHkNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuVU5TVUJTQ1JJQkU6DQogICAgICAgICAgICAgICAgZmlyc3QgfD0gMHgwMjsgLy8gUW9zID0gMTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IHRoaXMudG9waWNzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIHRvcGljU3RyTGVuZ3RoW2ldID0gVVRGOExlbmd0aCh0aGlzLnRvcGljc1tpXSk7DQogICAgICAgICAgICAgICAgICAgIHJlbUxlbmd0aCArPSB0b3BpY1N0ckxlbmd0aFtpXSArIDI7DQogICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QVUJMSVNIOg0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnBheWxvYWRNZXNzYWdlLmR1cGxpY2F0ZSkgZmlyc3QgfD0gMHgwODsNCiAgICAgICAgICAgICAgICBmaXJzdCA9IGZpcnN0IHw9ICh0aGlzLnBheWxvYWRNZXNzYWdlLnFvcyA8PCAxKTsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy5wYXlsb2FkTWVzc2FnZS5yZXRhaW5lZCkgZmlyc3QgfD0gMHgwMTsNCiAgICAgICAgICAgICAgICBkZXN0aW5hdGlvbk5hbWVMZW5ndGggPSBVVEY4TGVuZ3RoKHRoaXMucGF5bG9hZE1lc3NhZ2UuZGVzdGluYXRpb25OYW1lKTsNCiAgICAgICAgICAgICAgICByZW1MZW5ndGggKz0gZGVzdGluYXRpb25OYW1lTGVuZ3RoICsgMjsNCiAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZEJ5dGVzID0gdGhpcy5wYXlsb2FkTWVzc2FnZS5wYXlsb2FkQnl0ZXM7DQogICAgICAgICAgICAgICAgcmVtTGVuZ3RoICs9IHBheWxvYWRCeXRlcy5ieXRlTGVuZ3RoOw0KICAgICAgICAgICAgICAgIGlmIChwYXlsb2FkQnl0ZXMgaW5zdGFuY2VvZiBBcnJheUJ1ZmZlcikNCiAgICAgICAgICAgICAgICAgICAgcGF5bG9hZEJ5dGVzID0gbmV3IFVpbnQ4QXJyYXkocGF5bG9hZEJ5dGVzKTsNCiAgICAgICAgICAgICAgICBlbHNlIGlmICghKHBheWxvYWRCeXRlcyBpbnN0YW5jZW9mIFVpbnQ4QXJyYXkpKQ0KICAgICAgICAgICAgICAgICAgICBwYXlsb2FkQnl0ZXMgPSBuZXcgVWludDhBcnJheShwYXlsb2FkQnl0ZXMuYnVmZmVyKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuRElTQ09OTkVDVDoNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICA7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBOb3cgd2UgY2FuIGFsbG9jYXRlIGEgYnVmZmVyIGZvciB0aGUgbWVzc2FnZQ0KDQogICAgICAgIHZhciBtYmkgPSBlbmNvZGVNQkkocmVtTGVuZ3RoKTsgIC8vIENvbnZlcnQgdGhlIGxlbmd0aCB0byBNUVRUIE1CSSBmb3JtYXQNCiAgICAgICAgdmFyIHBvcyA9IG1iaS5sZW5ndGggKyAxOyAgICAgICAgLy8gT2Zmc2V0IG9mIHN0YXJ0IG9mIHZhcmlhYmxlIGhlYWRlcg0KICAgICAgICB2YXIgYnVmZmVyID0gbmV3IEFycmF5QnVmZmVyKHJlbUxlbmd0aCArIHBvcyk7DQogICAgICAgIHZhciBieXRlU3RyZWFtID0gbmV3IFVpbnQ4QXJyYXkoYnVmZmVyKTsgICAgLy8gdmlldyBpdCBhcyBhIHNlcXVlbmNlIG9mIGJ5dGVzDQoNCiAgICAgICAgLy9Xcml0ZSB0aGUgZml4ZWQgaGVhZGVyIGludG8gdGhlIGJ1ZmZlcg0KICAgICAgICBieXRlU3RyZWFtWzBdID0gZmlyc3Q7DQogICAgICAgIGJ5dGVTdHJlYW0uc2V0KG1iaSwgMSk7DQoNCiAgICAgICAgLy8gSWYgdGhpcyBpcyBhIFBVQkxJU0ggdGhlbiB0aGUgdmFyaWFibGUgaGVhZGVyIHN0YXJ0cyB3aXRoIGEgdG9waWMNCiAgICAgICAgaWYgKHRoaXMudHlwZSA9PSBNRVNTQUdFX1RZUEUuUFVCTElTSCkNCiAgICAgICAgICAgIHBvcyA9IHdyaXRlU3RyaW5nKHRoaXMucGF5bG9hZE1lc3NhZ2UuZGVzdGluYXRpb25OYW1lLCBkZXN0aW5hdGlvbk5hbWVMZW5ndGgsIGJ5dGVTdHJlYW0sIHBvcyk7DQogICAgICAgIC8vIElmIHRoaXMgaXMgYSBDT05ORUNUIHRoZW4gdGhlIHZhcmlhYmxlIGhlYWRlciBjb250YWlucyB0aGUgcHJvdG9jb2wgbmFtZS92ZXJzaW9uLCBmbGFncyBhbmQga2VlcGFsaXZlIHRpbWUNCg0KICAgICAgICBlbHNlIGlmICh0aGlzLnR5cGUgPT0gTUVTU0FHRV9UWVBFLkNPTk5FQ1QpIHsNCiAgICAgICAgICAgIGJ5dGVTdHJlYW0uc2V0KE1xdHRQcm90b0lkZW50aWZpZXIsIHBvcyk7DQogICAgICAgICAgICBwb3MgKz0gTXF0dFByb3RvSWRlbnRpZmllci5sZW5ndGg7DQogICAgICAgICAgICB2YXIgY29ubmVjdEZsYWdzID0gMDsNCiAgICAgICAgICAgIGlmICh0aGlzLmNsZWFuU2Vzc2lvbikNCiAgICAgICAgICAgICAgICBjb25uZWN0RmxhZ3MgPSAweDAyOw0KICAgICAgICAgICAgaWYgKHRoaXMud2lsbE1lc3NhZ2UgIT0gdW5kZWZpbmVkKSB7DQogICAgICAgICAgICAgICAgY29ubmVjdEZsYWdzIHw9IDB4MDQ7DQogICAgICAgICAgICAgICAgY29ubmVjdEZsYWdzIHw9ICh0aGlzLndpbGxNZXNzYWdlLnFvcyA8PCAzKTsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy53aWxsTWVzc2FnZS5yZXRhaW5lZCkgew0KICAgICAgICAgICAgICAgICAgICBjb25uZWN0RmxhZ3MgfD0gMHgyMDsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodGhpcy51c2VyTmFtZSAhPSB1bmRlZmluZWQpDQogICAgICAgICAgICAgICAgY29ubmVjdEZsYWdzIHw9IDB4ODA7DQogICAgICAgICAgICBpZiAodGhpcy5wYXNzd29yZCAhPSB1bmRlZmluZWQpDQogICAgICAgICAgICAgICAgY29ubmVjdEZsYWdzIHw9IDB4NDA7DQogICAgICAgICAgICBieXRlU3RyZWFtW3BvcysrXSA9IGNvbm5lY3RGbGFnczsNCiAgICAgICAgICAgIHBvcyA9IHdyaXRlVWludDE2KHRoaXMua2VlcEFsaXZlSW50ZXJ2YWwsIGJ5dGVTdHJlYW0sIHBvcyk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBPdXRwdXQgdGhlIG1lc3NhZ2VJZGVudGlmaWVyIC0gaWYgdGhlcmUgaXMgb25lDQogICAgICAgIGlmICh0aGlzLm1lc3NhZ2VJZGVudGlmaWVyICE9IHVuZGVmaW5lZCkNCiAgICAgICAgICAgIHBvcyA9IHdyaXRlVWludDE2KHRoaXMubWVzc2FnZUlkZW50aWZpZXIsIGJ5dGVTdHJlYW0sIHBvcyk7DQoNCiAgICAgICAgc3dpdGNoICh0aGlzLnR5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLkNPTk5FQ1Q6DQogICAgICAgICAgICAgICAgcG9zID0gd3JpdGVTdHJpbmcodGhpcy5jbGllbnRJZCwgVVRGOExlbmd0aCh0aGlzLmNsaWVudElkKSwgYnl0ZVN0cmVhbSwgcG9zKTsNCiAgICAgICAgICAgICAgICBpZiAodGhpcy53aWxsTWVzc2FnZSAhPSB1bmRlZmluZWQpIHsNCiAgICAgICAgICAgICAgICAgICAgcG9zID0gd3JpdGVTdHJpbmcodGhpcy53aWxsTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUsIFVURjhMZW5ndGgodGhpcy53aWxsTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUpLCBieXRlU3RyZWFtLCBwb3MpOw0KICAgICAgICAgICAgICAgICAgICBwb3MgPSB3cml0ZVVpbnQxNih3aWxsTWVzc2FnZVBheWxvYWRCeXRlcy5ieXRlTGVuZ3RoLCBieXRlU3RyZWFtLCBwb3MpOw0KICAgICAgICAgICAgICAgICAgICBieXRlU3RyZWFtLnNldCh3aWxsTWVzc2FnZVBheWxvYWRCeXRlcywgcG9zKTsNCiAgICAgICAgICAgICAgICAgICAgcG9zICs9IHdpbGxNZXNzYWdlUGF5bG9hZEJ5dGVzLmJ5dGVMZW5ndGg7DQoNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKHRoaXMudXNlck5hbWUgIT0gdW5kZWZpbmVkKQ0KICAgICAgICAgICAgICAgICAgICBwb3MgPSB3cml0ZVN0cmluZyh0aGlzLnVzZXJOYW1lLCBVVEY4TGVuZ3RoKHRoaXMudXNlck5hbWUpLCBieXRlU3RyZWFtLCBwb3MpOw0KICAgICAgICAgICAgICAgIGlmICh0aGlzLnBhc3N3b3JkICE9IHVuZGVmaW5lZCkNCiAgICAgICAgICAgICAgICAgICAgcG9zID0gd3JpdGVTdHJpbmcodGhpcy5wYXNzd29yZCwgVVRGOExlbmd0aCh0aGlzLnBhc3N3b3JkKSwgYnl0ZVN0cmVhbSwgcG9zKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCTElTSDoNCiAgICAgICAgICAgICAgICAvLyBQVUJMSVNIIGhhcyBhIHRleHQgb3IgYmluYXJ5IHBheWxvYWQsIGlmIHRleHQgZG8gbm90IGFkZCBhIDIgYnl0ZSBsZW5ndGggZmllbGQsIGp1c3QgdGhlIFVURiBjaGFyYWN0ZXJzLg0KICAgICAgICAgICAgICAgIGJ5dGVTdHJlYW0uc2V0KHBheWxvYWRCeXRlcywgcG9zKTsNCg0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQovLyAgICAJICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQlJFQzoJDQovLyAgICAJICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQlJFTDoJDQovLyAgICAJICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQkNPTVA6CQ0KLy8gICAgCSAgICAJYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlNVQlNDUklCRToNCiAgICAgICAgICAgICAgICAvLyBTVUJTQ1JJQkUgaGFzIGEgbGlzdCBvZiB0b3BpYyBzdHJpbmdzIGFuZCByZXF1ZXN0IFFvUw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgdGhpcy50b3BpY3MubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgcG9zID0gd3JpdGVTdHJpbmcodGhpcy50b3BpY3NbaV0sIHRvcGljU3RyTGVuZ3RoW2ldLCBieXRlU3RyZWFtLCBwb3MpOw0KICAgICAgICAgICAgICAgICAgICBieXRlU3RyZWFtW3BvcysrXSA9IHRoaXMucmVxdWVzdGVkUW9zW2ldOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuVU5TVUJTQ1JJQkU6DQogICAgICAgICAgICAgICAgLy8gVU5TVUJTQ1JJQkUgaGFzIGEgbGlzdCBvZiB0b3BpYyBzdHJpbmdzDQogICAgICAgICAgICAgICAgZm9yICh2YXIgaSA9IDA7IGkgPCB0aGlzLnRvcGljcy5sZW5ndGg7IGkrKykNCiAgICAgICAgICAgICAgICAgICAgcG9zID0gd3JpdGVTdHJpbmcodGhpcy50b3BpY3NbaV0sIHRvcGljU3RyTGVuZ3RoW2ldLCBieXRlU3RyZWFtLCBwb3MpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBkZWZhdWx0Og0KICAgICAgICAgICAgLy8gRG8gbm90aGluZy4NCiAgICAgICAgfQ0KDQogICAgICAgIHJldHVybiBidWZmZXI7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gZGVjb2RlTWVzc2FnZShpbnB1dCkgew0KICAgICAgICAvL3ZhciBtc2cgPSBuZXcgT2JqZWN0KCk7ICAvLyBtZXNzYWdlIHRvIGJlIGNvbnN0cnVjdGVkDQogICAgICAgIHZhciBmaXJzdCA9IGlucHV0WzBdOw0KICAgICAgICB2YXIgdHlwZSA9IGZpcnN0ID4-IDQ7DQogICAgICAgIHZhciBtZXNzYWdlSW5mbyA9IGZpcnN0ICY9IDB4MGY7DQogICAgICAgIHZhciBwb3MgPSAxOw0KDQoNCiAgICAgICAgLy8gRGVjb2RlIHRoZSByZW1haW5pbmcgbGVuZ3RoIChNQkkgZm9ybWF0KQ0KDQogICAgICAgIHZhciBkaWdpdDsNCiAgICAgICAgdmFyIHJlbUxlbmd0aCA9IDA7DQogICAgICAgIHZhciBtdWx0aXBsaWVyID0gMTsNCiAgICAgICAgZG8gew0KICAgICAgICAgICAgZGlnaXQgPSBpbnB1dFtwb3MrK107DQogICAgICAgICAgICByZW1MZW5ndGggKz0gKChkaWdpdCAmIDB4N0YpICogbXVsdGlwbGllcik7DQogICAgICAgICAgICBtdWx0aXBsaWVyICo9IDEyODsNCiAgICAgICAgfSB3aGlsZSAoKGRpZ2l0ICYgMHg4MCkgIT0gMCk7DQoNCiAgICAgICAgdmFyIHdpcmVNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKHR5cGUpOw0KICAgICAgICBzd2l0Y2ggKHR5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLkNPTk5BQ0s6DQogICAgICAgICAgICAgICAgd2lyZU1lc3NhZ2UudG9waWNOYW1lQ29tcHJlc3Npb25SZXNwb25zZSA9IGlucHV0W3BvcysrXTsNCiAgICAgICAgICAgICAgICB3aXJlTWVzc2FnZS5yZXR1cm5Db2RlID0gaW5wdXRbcG9zKytdOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QVUJMSVNIOg0KICAgICAgICAgICAgICAgIHZhciBxb3MgPSAobWVzc2FnZUluZm8gPj4gMSkgJiAweDAzOw0KDQogICAgICAgICAgICAgICAgdmFyIGxlbiA9IHJlYWRVaW50MTYoaW5wdXQsIHBvcyk7DQogICAgICAgICAgICAgICAgcG9zICs9IDI7DQogICAgICAgICAgICAgICAgdmFyIHRvcGljTmFtZSA9IHBhcnNlVVRGOChpbnB1dCwgcG9zLCBsZW4pOw0KICAgICAgICAgICAgICAgIHBvcyArPSBsZW47DQogICAgICAgICAgICAgICAgLy8gSWYgUW9TIDEgb3IgMiB0aGVyZSB3aWxsIGJlIGEgbWVzc2FnZUlkZW50aWZpZXINCiAgICAgICAgICAgICAgICBpZiAocW9zID4gMCkgew0KICAgICAgICAgICAgICAgICAgICB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllciA9IHJlYWRVaW50MTYoaW5wdXQsIHBvcyk7DQogICAgICAgICAgICAgICAgICAgIHBvcyArPSAyOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbmV3IE1lc3NhZ2luZy5NZXNzYWdlKGlucHV0LnN1YmFycmF5KHBvcykpOw0KICAgICAgICAgICAgICAgIGlmICgobWVzc2FnZUluZm8gJiAweDAxKSA9PSAweDAxKQ0KICAgICAgICAgICAgICAgICAgICBtZXNzYWdlLnJldGFpbmVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICBpZiAoKG1lc3NhZ2VJbmZvICYgMHgwOCkgPT0gMHgwOCkNCiAgICAgICAgICAgICAgICAgICAgbWVzc2FnZS5kdXBsaWNhdGUgPSB0cnVlOw0KICAgICAgICAgICAgICAgIG1lc3NhZ2UucW9zID0gcW9zOw0KICAgICAgICAgICAgICAgIG1lc3NhZ2UuZGVzdGluYXRpb25OYW1lID0gdG9waWNOYW1lOw0KICAgICAgICAgICAgICAgIHdpcmVNZXNzYWdlLnBheWxvYWRNZXNzYWdlID0gbWVzc2FnZTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAgTUVTU0FHRV9UWVBFLlBVQkFDSzoNCiAgICAgICAgICAgIGNhc2UgIE1FU1NBR0VfVFlQRS5QVUJSRUM6DQogICAgICAgICAgICBjYXNlICBNRVNTQUdFX1RZUEUuUFVCUkVMOg0KICAgICAgICAgICAgY2FzZSAgTUVTU0FHRV9UWVBFLlBVQkNPTVA6DQogICAgICAgICAgICBjYXNlICBNRVNTQUdFX1RZUEUuVU5TVUJBQ0s6DQogICAgICAgICAgICAgICAgd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIgPSByZWFkVWludDE2KGlucHV0LCBwb3MpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlICBNRVNTQUdFX1RZUEUuU1VCQUNLOg0KICAgICAgICAgICAgICAgIHdpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyID0gcmVhZFVpbnQxNihpbnB1dCwgcG9zKTsNCiAgICAgICAgICAgICAgICBwb3MgKz0gMjsNCiAgICAgICAgICAgICAgICB3aXJlTWVzc2FnZS5ncmFudGVkUW9zID0gaW5wdXQuc3ViYXJyYXkocG9zKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICA7DQogICAgICAgIH0NCg0KICAgICAgICByZXR1cm4gd2lyZU1lc3NhZ2U7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gd3JpdGVVaW50MTYoaW5wdXQsIGJ1ZmZlciwgb2Zmc2V0KSB7DQogICAgICAgIGJ1ZmZlcltvZmZzZXQrK10gPSBpbnB1dCA-PiA4OyAgICAgIC8vTVNCDQogICAgICAgIGJ1ZmZlcltvZmZzZXQrK10gPSBpbnB1dCAlIDI1NjsgICAgIC8vTFNCDQogICAgICAgIHJldHVybiBvZmZzZXQ7DQogICAgfQ0KDQogICAgZnVuY3Rpb24gd3JpdGVTdHJpbmcoaW5wdXQsIHV0ZjhMZW5ndGgsIGJ1ZmZlciwgb2Zmc2V0KSB7DQogICAgICAgIG9mZnNldCA9IHdyaXRlVWludDE2KHV0ZjhMZW5ndGgsIGJ1ZmZlciwgb2Zmc2V0KTsNCiAgICAgICAgc3RyaW5nVG9VVEY4KGlucHV0LCBidWZmZXIsIG9mZnNldCk7DQogICAgICAgIHJldHVybiBvZmZzZXQgKyB1dGY4TGVuZ3RoOw0KICAgIH0NCg0KICAgIGZ1bmN0aW9uIHJlYWRVaW50MTYoYnVmZmVyLCBvZmZzZXQpIHsNCiAgICAgICAgcmV0dXJuIDI1NiAqIGJ1ZmZlcltvZmZzZXRdICsgYnVmZmVyW29mZnNldCArIDFdOw0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIEVuY29kZXMgYW4gTVFUVCBNdWx0aS1CeXRlIEludGVnZXINCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIGVuY29kZU1CSShudW1iZXIpIHsNCiAgICAgICAgdmFyIG91dHB1dCA9IG5ldyBBcnJheSgxKTsNCiAgICAgICAgdmFyIG51bUJ5dGVzID0gMDsNCg0KICAgICAgICBkbyB7DQogICAgICAgICAgICB2YXIgZGlnaXQgPSBudW1iZXIgJSAxMjg7DQogICAgICAgICAgICBudW1iZXIgPSBudW1iZXIgPj4gNzsNCiAgICAgICAgICAgIGlmIChudW1iZXIgPiAwKSB7DQogICAgICAgICAgICAgICAgZGlnaXQgfD0gMHg4MDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIG91dHB1dFtudW1CeXRlcysrXSA9IGRpZ2l0Ow0KICAgICAgICB9IHdoaWxlICgobnVtYmVyID4gMCkgJiYgKG51bUJ5dGVzIDwgNCkpOw0KDQogICAgICAgIHJldHVybiBvdXRwdXQ7DQogICAgfQ0KDQogICAgLyoqDQogICAgICogVGFrZXMgYSBTdHJpbmcgYW5kIGNhbGN1bGF0ZXMgaXRzIGxlbmd0aCBpbiBieXRlcyB3aGVuIGVuY29kZWQgaW4gVVRGOC4NCiAgICAgKiBAcHJpdmF0ZQ0KICAgICAqLw0KICAgIGZ1bmN0aW9uIFVURjhMZW5ndGgoaW5wdXQpIHsNCiAgICAgICAgdmFyIG91dHB1dCA9IDA7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgaW5wdXQubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBjaGFyQ29kZSA9IGlucHV0LmNoYXJDb2RlQXQoaSk7DQogICAgICAgICAgICBpZiAoY2hhckNvZGUgPiAweDdGRikgew0KICAgICAgICAgICAgICAgIC8vIFN1cnJvZ2F0ZSBwYWlyIG1lYW5zIGl0cyBhIDQgYnl0ZSBjaGFyYWN0ZXINCiAgICAgICAgICAgICAgICBpZiAoMHhEODAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4REJGRikgew0KICAgICAgICAgICAgICAgICAgICBpKys7DQogICAgICAgICAgICAgICAgICAgIG91dHB1dCsrOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBvdXRwdXQgKz0gMzsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIGVsc2UgaWYgKGNoYXJDb2RlID4gMHg3RikNCiAgICAgICAgICAgICAgICBvdXRwdXQgKz0gMjsNCiAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICBvdXRwdXQrKzsNCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gb3V0cHV0Ow0KICAgIH0NCg0KICAgIC8qKg0KICAgICAqIFRha2VzIGEgU3RyaW5nIGFuZCB3cml0ZXMgaXQgaW50byBhbiBhcnJheSBhcyBVVEY4IGVuY29kZWQgYnl0ZXMuDQogICAgICogQHByaXZhdGUNCiAgICAgKi8NCiAgICBmdW5jdGlvbiBzdHJpbmdUb1VURjgoaW5wdXQsIG91dHB1dCwgc3RhcnQpIHsNCiAgICAgICAgdmFyIHBvcyA9IHN0YXJ0Ow0KICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGlucHV0Lmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICB2YXIgY2hhckNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KGkpOw0KDQogICAgICAgICAgICAvLyBDaGVjayBmb3IgYSBzdXJyb2dhdGUgcGFpci4NCiAgICAgICAgICAgIGlmICgweEQ4MDAgPD0gY2hhckNvZGUgJiYgY2hhckNvZGUgPD0gMHhEQkZGKSB7DQogICAgICAgICAgICAgICAgbG93Q2hhckNvZGUgPSBpbnB1dC5jaGFyQ29kZUF0KCsraSk7DQogICAgICAgICAgICAgICAgaWYgKGlzTmFOKGxvd0NoYXJDb2RlKSkgew0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLk1BTEZPUk1FRF9VTklDT0RFLCBbY2hhckNvZGUsIGxvd0NoYXJDb2RlXSkpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBjaGFyQ29kZSA9ICgoY2hhckNvZGUgLSAweEQ4MDApIDw8IDEwKSArIChsb3dDaGFyQ29kZSAtIDB4REMwMCkgKyAweDEwMDAwOw0KDQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGlmIChjaGFyQ29kZSA8PSAweDdGKSB7DQogICAgICAgICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlOw0KICAgICAgICAgICAgfSBlbHNlIGlmIChjaGFyQ29kZSA8PSAweDdGRikgew0KICAgICAgICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA-PiA2ICYgMHgxRiB8IDB4QzA7DQogICAgICAgICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlICYgMHgzRiB8IDB4ODA7DQogICAgICAgICAgICB9IGVsc2UgaWYgKGNoYXJDb2RlIDw9IDB4RkZGRikgew0KICAgICAgICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA-PiAxMiAmIDB4MEYgfCAweEUwOw0KICAgICAgICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA-PiA2ICYgMHgzRiB8IDB4ODA7DQogICAgICAgICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlICYgMHgzRiB8IDB4ODA7DQogICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA-PiAxOCAmIDB4MDcgfCAweEYwOw0KICAgICAgICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA-PiAxMiAmIDB4M0YgfCAweDgwOw0KICAgICAgICAgICAgICAgIG91dHB1dFtwb3MrK10gPSBjaGFyQ29kZSA-PiA2ICYgMHgzRiB8IDB4ODA7DQogICAgICAgICAgICAgICAgb3V0cHV0W3BvcysrXSA9IGNoYXJDb2RlICYgMHgzRiB8IDB4ODA7DQogICAgICAgICAgICB9DQogICAgICAgICAgICA7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICB9DQoNCiAgICBmdW5jdGlvbiBwYXJzZVVURjgoaW5wdXQsIG9mZnNldCwgbGVuZ3RoKSB7DQogICAgICAgIHZhciBvdXRwdXQgPSAiIjsNCiAgICAgICAgdmFyIHV0ZjE2Ow0KICAgICAgICB2YXIgcG9zID0gb2Zmc2V0Ow0KDQogICAgICAgIHdoaWxlIChwb3MgPCBvZmZzZXQgKyBsZW5ndGgpIHsNCiAgICAgICAgICAgIHZhciBieXRlMSA9IGlucHV0W3BvcysrXTsNCiAgICAgICAgICAgIGlmIChieXRlMSA8IDEyOCkNCiAgICAgICAgICAgICAgICB1dGYxNiA9IGJ5dGUxOw0KICAgICAgICAgICAgZWxzZSB7DQogICAgICAgICAgICAgICAgdmFyIGJ5dGUyID0gaW5wdXRbcG9zKytdIC0gMTI4Ow0KICAgICAgICAgICAgICAgIGlmIChieXRlMiA8IDApDQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuTUFMRk9STUVEX1VURiwgW2J5dGUxLnRvU3RyaW5nKDE2KSwgYnl0ZTIudG9TdHJpbmcoMTYpLCAiIl0pKTsNCiAgICAgICAgICAgICAgICBpZiAoYnl0ZTEgPCAweEUwKSAgICAgICAgICAgICAvLyAyIGJ5dGUgY2hhcmFjdGVyDQogICAgICAgICAgICAgICAgICAgIHV0ZjE2ID0gNjQgKiAoYnl0ZTEgLSAweEMwKSArIGJ5dGUyOw0KICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICB2YXIgYnl0ZTMgPSBpbnB1dFtwb3MrK10gLSAxMjg7DQogICAgICAgICAgICAgICAgICAgIGlmIChieXRlMyA8IDApDQogICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLk1BTEZPUk1FRF9VVEYsIFtieXRlMS50b1N0cmluZygxNiksIGJ5dGUyLnRvU3RyaW5nKDE2KSwgYnl0ZTMudG9TdHJpbmcoMTYpXSkpOw0KICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZTEgPCAweEYwKSAgICAgICAgLy8gMyBieXRlIGNoYXJhY3Rlcg0KICAgICAgICAgICAgICAgICAgICAgICAgdXRmMTYgPSA0MDk2ICogKGJ5dGUxIC0gMHhFMCkgKyA2NCAqIGJ5dGUyICsgYnl0ZTM7DQogICAgICAgICAgICAgICAgICAgIGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIGJ5dGU0ID0gaW5wdXRbcG9zKytdIC0gMTI4Ow0KICAgICAgICAgICAgICAgICAgICAgICAgaWYgKGJ5dGU0IDwgMCkNCiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLk1BTEZPUk1FRF9VVEYsIFtieXRlMS50b1N0cmluZygxNiksIGJ5dGUyLnRvU3RyaW5nKDE2KSwgYnl0ZTMudG9TdHJpbmcoMTYpLCBieXRlNC50b1N0cmluZygxNildKSk7DQogICAgICAgICAgICAgICAgICAgICAgICBpZiAoYnl0ZTEgPCAweEY4KSAgICAgICAgLy8gNCBieXRlIGNoYXJhY3Rlcg0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHV0ZjE2ID0gMjYyMTQ0ICogKGJ5dGUxIC0gMHhGMCkgKyA0MDk2ICogYnl0ZTIgKyA2NCAqIGJ5dGUzICsgYnl0ZTQ7DQogICAgICAgICAgICAgICAgICAgICAgICBlbHNlICAgICAgICAgICAgICAgICAgICAgLy8gbG9uZ2VyIGVuY29kaW5ncyBhcmUgbm90IHN1cHBvcnRlZA0KICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuTUFMRk9STUVEX1VURiwgW2J5dGUxLnRvU3RyaW5nKDE2KSwgYnl0ZTIudG9TdHJpbmcoMTYpLCBieXRlMy50b1N0cmluZygxNiksIGJ5dGU0LnRvU3RyaW5nKDE2KV0pKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgaWYgKHV0ZjE2ID4gMHhGRkZGKSAgIC8vIDQgYnl0ZSBjaGFyYWN0ZXIgLSBleHByZXNzIGFzIGEgc3Vycm9nYXRlIHBhaXINCiAgICAgICAgICAgIHsNCiAgICAgICAgICAgICAgICB1dGYxNiAtPSAweDEwMDAwOw0KICAgICAgICAgICAgICAgIG91dHB1dCArPSBTdHJpbmcuZnJvbUNoYXJDb2RlKDB4RDgwMCArICh1dGYxNiA-PiAxMCkpOyAvLyBsZWFkIGNoYXJhY3Rlcg0KICAgICAgICAgICAgICAgIHV0ZjE2ID0gMHhEQzAwICsgKHV0ZjE2ICYgMHgzRkYpOyAgLy8gdHJhaWwgY2hhcmFjdGVyDQogICAgICAgICAgICB9DQogICAgICAgICAgICBvdXRwdXQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSh1dGYxNik7DQogICAgICAgIH0NCiAgICAgICAgcmV0dXJuIG91dHB1dDsNCiAgICB9DQoNCiAgICAvKiogQGlnbm9yZSBSZXBlYXQga2VlcGFsaXZlIHJlcXVlc3RzLCBtb25pdG9yIHJlc3BvbnNlcy4qLw0KICAgIHZhciBQaW5nZXIgPSBmdW5jdGlvbiAoY2xpZW50LCB3aW5kb3csIGtlZXBBbGl2ZUludGVydmFsKSB7DQogICAgICAgIHRoaXMuX2NsaWVudCA9IGNsaWVudDsNCiAgICAgICAgdGhpcy5fd2luZG93ID0gd2luZG93Ow0KICAgICAgICB0aGlzLl9rZWVwQWxpdmVJbnRlcnZhbCA9IGtlZXBBbGl2ZUludGVydmFsICogMTAwMDsNCiAgICAgICAgdGhpcy5pc1Jlc2V0ID0gZmFsc2U7DQoNCiAgICAgICAgdmFyIHBpbmdSZXEgPSBuZXcgV2lyZU1lc3NhZ2UoTUVTU0FHRV9UWVBFLlBJTkdSRVEpLmVuY29kZSgpOw0KDQogICAgICAgIHZhciBkb1RpbWVvdXQgPSBmdW5jdGlvbiAocGluZ2VyKSB7DQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBkb1BpbmcuYXBwbHkocGluZ2VyKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqIEBpZ25vcmUgKi8NCiAgICAgICAgdmFyIGRvUGluZyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICghdGhpcy5pc1Jlc2V0KSB7DQogICAgICAgICAgICAgICAgdGhpcy5fY2xpZW50Ll90cmFjZSgiUGluZ2VyLmRvUGluZyIsICJUaW1lZCBvdXQiKTsNCiAgICAgICAgICAgICAgICB0aGlzLl9jbGllbnQuX2Rpc2Nvbm5lY3RlZChFUlJPUi5QSU5HX1RJTUVPVVQuY29kZSwgZm9ybWF0KEVSUk9SLlBJTkdfVElNRU9VVCkpOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICB0aGlzLmlzUmVzZXQgPSBmYWxzZTsNCiAgICAgICAgICAgICAgICB0aGlzLl9jbGllbnQuX3RyYWNlKCJQaW5nZXIuZG9QaW5nIiwgInNlbmQgUElOR1JFUSIpOw0KICAgICAgICAgICAgICAgIHRoaXMuX2NsaWVudC5zb2NrZXQuc2VuZChwaW5nUmVxKTsNCiAgICAgICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSB0aGlzLl93aW5kb3cuc2V0VGltZW91dChkb1RpbWVvdXQodGhpcyksIHRoaXMuX2tlZXBBbGl2ZUludGVydmFsKTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KDQogICAgICAgIHRoaXMucmVzZXQgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLmlzUmVzZXQgPSB0cnVlOw0KICAgICAgICAgICAgdGhpcy5fd2luZG93LmNsZWFyVGltZW91dCh0aGlzLnRpbWVvdXQpOw0KICAgICAgICAgICAgaWYgKHRoaXMuX2tlZXBBbGl2ZUludGVydmFsID4gMCkNCiAgICAgICAgICAgICAgICB0aGlzLnRpbWVvdXQgPSBzZXRUaW1lb3V0KGRvVGltZW91dCh0aGlzKSwgdGhpcy5fa2VlcEFsaXZlSW50ZXJ2YWwpOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5jYW5jZWwgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICB0aGlzLl93aW5kb3cuY2xlYXJUaW1lb3V0KHRoaXMudGltZW91dCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqIEBpZ25vcmUgTW9uaXRvciByZXF1ZXN0IGNvbXBsZXRpb24uICovDQogICAgdmFyIFRpbWVvdXQgPSBmdW5jdGlvbiAoY2xpZW50LCB3aW5kb3csIHRpbWVvdXRTZWNvbmRzLCBhY3Rpb24sIGFyZ3MpIHsNCiAgICAgICAgdGhpcy5fd2luZG93ID0gd2luZG93Ow0KICAgICAgICBpZiAoIXRpbWVvdXRTZWNvbmRzKQ0KICAgICAgICAgICAgdGltZW91dFNlY29uZHMgPSAzMDsNCg0KICAgICAgICB2YXIgZG9UaW1lb3V0ID0gZnVuY3Rpb24gKGFjdGlvbiwgY2xpZW50LCBhcmdzKSB7DQogICAgICAgICAgICByZXR1cm4gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgICAgIHJldHVybiBhY3Rpb24uYXBwbHkoY2xpZW50LCBhcmdzKTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH07DQogICAgICAgIHRoaXMudGltZW91dCA9IHNldFRpbWVvdXQoZG9UaW1lb3V0KGFjdGlvbiwgY2xpZW50LCBhcmdzKSwgdGltZW91dFNlY29uZHMgKiAxMDAwKTsNCg0KICAgICAgICB0aGlzLmNhbmNlbCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHRoaXMuX3dpbmRvdy5jbGVhclRpbWVvdXQodGhpcy50aW1lb3V0KTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvKg0KICAgICAqIEludGVybmFsIGltcGxlbWVudGF0aW9uIG9mIHRoZSBXZWJzb2NrZXRzIE1RVFQgVjMuMSBjbGllbnQuDQogICAgICoNCiAgICAgKiBAbmFtZSBNZXNzYWdpbmcuQ2xpZW50SW1wbCBAY29uc3RydWN0b3INCiAgICAgKiBAcGFyYW0ge1N0cmluZ30gaG9zdCB0aGUgRE5TIG5hbWVvZiB0aGUgd2ViU29ja2V0IGhvc3QuDQogICAgICogQHBhcmFtIHtOdW1iZXJ9IHBvcnQgdGhlIHBvcnQgbnVtYmVyIGZvciB0aGF0IGhvc3QuDQogICAgICogQHBhcmFtIHtTdHJpbmd9IGNsaWVudElkIHRoZSBNUSBjbGllbnQgaWRlbnRpZmllci4NCiAgICAgKi8NCiAgICB2YXIgQ2xpZW50SW1wbCA9IGZ1bmN0aW9uIChob3N0LCBwb3J0LCBjbGllbnRJZCkgew0KICAgICAgICAvLyBDaGVjayBkZXBlbmRlbmNpZXMgYXJlIHNhdGlzZmllZCBpbiB0aGlzIGJyb3dzZXIuDQogICAgICAgIGlmICghKCJXZWJTb2NrZXQiIGluIGdsb2JhbCAmJiBnbG9iYWxbIldlYlNvY2tldCJdICE9PSBudWxsKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRCwgWyJXZWJTb2NrZXQiXSkpOw0KICAgICAgICB9DQogICAgICAgIGlmICghKCJsb2NhbFN0b3JhZ2UiIGluIGdsb2JhbCAmJiBnbG9iYWxbImxvY2FsU3RvcmFnZSJdICE9PSBudWxsKSkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRCwgWyJsb2NhbFN0b3JhZ2UiXSkpOw0KICAgICAgICB9DQogICAgICAgIGlmICghKCJBcnJheUJ1ZmZlciIgaW4gZ2xvYmFsICYmIGdsb2JhbFsiQXJyYXlCdWZmZXIiXSAhPT0gbnVsbCkpIHsNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuVU5TVVBQT1JURUQsIFsiQXJyYXlCdWZmZXIiXSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5fdHJhY2UoIk1lc3NhZ2luZy5DbGllbnQiLCBob3N0LCBwb3J0LCBjbGllbnRJZCk7DQoNCiAgICAgICAgdGhpcy5ob3N0ID0gaG9zdDsNCiAgICAgICAgdGhpcy5wb3J0ID0gcG9ydDsNCiAgICAgICAgdGhpcy5jbGllbnRJZCA9IGNsaWVudElkOw0KDQogICAgICAgIC8vIExvY2FsIHN0b3JhZ2VrZXlzIGFyZSBxdWFsaWZpZWQgd2l0aCB0aGUgZm9sbG93aW5nIHN0cmluZy4NCiAgICAgICAgdGhpcy5fbG9jYWxLZXkgPSBob3N0ICsgIjoiICsgcG9ydCArICI6IiArIGNsaWVudElkICsgIjoiOw0KDQogICAgICAgIC8vIENyZWF0ZSBwcml2YXRlIGluc3RhbmNlLW9ubHkgbWVzc2FnZSBxdWV1ZQ0KICAgICAgICAvLyBJbnRlcm5hbCBxdWV1ZSBvZiBtZXNzYWdlcyB0byBiZSBzZW50LCBpbiBzZW5kaW5nIG9yZGVyLiANCiAgICAgICAgdGhpcy5fbXNnX3F1ZXVlID0gW107DQoNCiAgICAgICAgLy8gTWVzc2FnZXMgd2UgaGF2ZSBzZW50IGFuZCBhcmUgZXhwZWN0aW5nIGEgcmVzcG9uc2UgZm9yLCBpbmRleGVkIGJ5IHRoZWlyIHJlc3BlY3RpdmUgbWVzc2FnZSBpZHMuIA0KICAgICAgICB0aGlzLl9zZW50TWVzc2FnZXMgPSB7fTsNCg0KICAgICAgICAvLyBNZXNzYWdlcyB3ZSBoYXZlIHJlY2VpdmVkIGFuZCBhY2tub3dsZWdlZCBhbmQgYXJlIGV4cGVjdGluZyBhIGNvbmZpcm0gbWVzc2FnZSBmb3INCiAgICAgICAgLy8gaW5kZXhlZCBieSB0aGVpciByZXNwZWN0aXZlIG1lc3NhZ2UgaWRzLiANCiAgICAgICAgdGhpcy5fcmVjZWl2ZWRNZXNzYWdlcyA9IHt9Ow0KDQogICAgICAgIC8vIEludGVybmFsIGxpc3Qgb2YgY2FsbGJhY2tzIHRvIGJlIGV4ZWN1dGVkIHdoZW4gbWVzc2FnZXMNCiAgICAgICAgLy8gaGF2ZSBiZWVuIHN1Y2Nlc3NmdWxseSBzZW50IG92ZXIgd2ViIHNvY2tldCwgZS5nLiBkaXNjb25uZWN0DQogICAgICAgIC8vIHdoZW4gaXQgZG9lc24ndCBoYXZlIHRvIHdhaXQgZm9yIEFDSywganVzdCBtZXNzYWdlIGlzIGRpc3BhdGNoZWQuDQogICAgICAgIHRoaXMuX25vdGlmeV9tc2dfc2VudCA9IHt9Ow0KDQogICAgICAgIC8vIFVuaXF1ZSBpZGVudGlmaWVyIGZvciBTRU5EIG1lc3NhZ2VzLCBpbmNyZW1lbnRpbmcNCiAgICAgICAgLy8gY291bnRlciBhcyBtZXNzYWdlcyBhcmUgc2VudC4NCiAgICAgICAgdGhpcy5fbWVzc2FnZV9pZGVudGlmaWVyID0gMTsNCg0KICAgICAgICAvLyBVc2VkIHRvIGRldGVybWluZSB0aGUgdHJhbnNtaXNzaW9uIHNlcXVlbmNlIG9mIHN0b3JlZCBzZW50IG1lc3NhZ2VzLg0KICAgICAgICB0aGlzLl9zZXF1ZW5jZSA9IDA7DQoNCg0KICAgICAgICAvLyBMb2FkIHRoZSBsb2NhbCBzdGF0ZSwgaWYgYW55LCBmcm9tIHRoZSBzYXZlZCB2ZXJzaW9uLCBvbmx5IHJlc3RvcmUgc3RhdGUgcmVsZXZhbnQgdG8gdGhpcyBjbGllbnQuICAgCQ0KICAgICAgICBmb3IgKGtleSBpbiBsb2NhbFN0b3JhZ2UpDQogICAgICAgICAgICBpZiAoa2V5LmluZGV4T2YoIlNlbnQ6IiArIHRoaXMuX2xvY2FsS2V5KSA9PSAwDQogICAgICAgICAgICAgICAgfHwga2V5LmluZGV4T2YoIlJlY2VpdmVkOiIgKyB0aGlzLl9sb2NhbEtleSkgPT0gMCkNCiAgICAgICAgICAgICAgICB0aGlzLnJlc3RvcmUoa2V5KTsNCiAgICB9Ow0KDQogICAgLy8gTWVzc2FnaW5nIENsaWVudCBwdWJsaWMgaW5zdGFuY2UgbWVtYmVycy4gDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuaG9zdDsNCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5wb3J0Ow0KICAgIENsaWVudEltcGwucHJvdG90eXBlLmNsaWVudElkOw0KDQogICAgLy8gTWVzc2FnaW5nIENsaWVudCBwcml2YXRlIGluc3RhbmNlIG1lbWJlcnMuDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuc29ja2V0Ow0KICAgIC8qIHRydWUgb25jZSB3ZSBoYXZlIHJlY2VpdmVkIGFuIGFja25vd2xlZGdlbWVudCB0byBhIENPTk5FQ1QgcGFja2V0LiAqLw0KICAgIENsaWVudEltcGwucHJvdG90eXBlLmNvbm5lY3RlZCA9IGZhbHNlOw0KICAgIC8qIFRoZSBsYXJnZXN0IG1lc3NhZ2UgaWRlbnRpZmllciBhbGxvd2VkLCBtYXkgbm90IGJlIGxhcmdlciB0aGFuIDIqKjE2IGJ1dCANCiAgICAgKiBpZiBzZXQgc21hbGxlciByZWR1Y2VzIHRoZSBtYXhpbXVtIG51bWJlciBvZiBvdXRib3VuZCBtZXNzYWdlcyBhbGxvd2VkLg0KICAgICAqLw0KICAgIENsaWVudEltcGwucHJvdG90eXBlLm1heE1lc3NhZ2VJZGVudGlmaWVyID0gNjU1MzY7DQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuY29ubmVjdE9wdGlvbnM7DQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuaG9zdEluZGV4Ow0KICAgIENsaWVudEltcGwucHJvdG90eXBlLm9uQ29ubmVjdGlvbkxvc3Q7DQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUub25NZXNzYWdlRGVsaXZlcmVkOw0KICAgIENsaWVudEltcGwucHJvdG90eXBlLm9uTWVzc2FnZUFycml2ZWQ7DQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX21zZ19xdWV1ZSA9IG51bGw7DQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX2Nvbm5lY3RUaW1lb3V0Ow0KICAgIC8qIFRoZSBzZW5kUGluZ2VyIG1vbml0b3JzIGhvdyBsb25nIHdlIGFsbG93IGJlZm9yZSB3ZSBzZW5kIGRhdGEgdG8gcHJvdmUgdG8gdGhlIHNlcnZlciB0aGF0IHdlIGFyZSBhbGl2ZS4gKi8NCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5zZW5kUGluZ2VyID0gbnVsbDsNCiAgICAvKiBUaGUgcmVjZWl2ZVBpbmdlciBtb25pdG9ycyBob3cgbG9uZyB3ZSBhbGxvdyBiZWZvcmUgd2UgcmVxdWlyZSBldmlkZW5jZSB0aGF0IHRoZSBzZXJ2ZXIgaXMgYWxpdmUuICovDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUucmVjZWl2ZVBpbmdlciA9IG51bGw7DQoNCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fdHJhY2VCdWZmZXIgPSBudWxsOw0KICAgIENsaWVudEltcGwucHJvdG90eXBlLl9NQVhfVFJBQ0VfRU5UUklFUyA9IDEwMDsNCg0KICAgIENsaWVudEltcGwucHJvdG90eXBlLmNvbm5lY3QgPSBmdW5jdGlvbiAoY29ubmVjdE9wdGlvbnMpIHsNCiAgICAgICAgdmFyIGNvbm5lY3RPcHRpb25zTWFza2VkID0gdGhpcy5fdHJhY2VNYXNrKGNvbm5lY3RPcHRpb25zLCAicGFzc3dvcmQiKTsNCiAgICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5jb25uZWN0IiwgY29ubmVjdE9wdGlvbnNNYXNrZWQsIHRoaXMuc29ja2V0LCB0aGlzLmNvbm5lY3RlZCk7DQoNCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdGVkKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1NUQVRFLCBbImFscmVhZHkgY29ubmVjdGVkIl0pKTsNCiAgICAgICAgaWYgKHRoaXMuc29ja2V0KQ0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1NUQVRFLCBbImFscmVhZHkgY29ubmVjdGVkIl0pKTsNCg0KICAgICAgICB0aGlzLmNvbm5lY3RPcHRpb25zID0gY29ubmVjdE9wdGlvbnM7DQoNCiAgICAgICAgaWYgKGNvbm5lY3RPcHRpb25zLmhvc3RzKSB7DQogICAgICAgICAgICB0aGlzLmhvc3RJbmRleCA9IDA7DQogICAgICAgICAgICB0aGlzLl9kb0Nvbm5lY3QoY29ubmVjdE9wdGlvbnMuaG9zdHNbMF0sIGNvbm5lY3RPcHRpb25zLnBvcnRzWzBdKTsNCiAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgIHRoaXMuX2RvQ29ubmVjdCh0aGlzLmhvc3QsIHRoaXMucG9ydCk7DQogICAgICAgIH0NCg0KICAgIH07DQoNCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZmlsdGVyLCBzdWJzY3JpYmVPcHRpb25zKSB7DQogICAgICAgIHRoaXMuX3RyYWNlKCJDbGllbnQuc3Vic2NyaWJlIiwgZmlsdGVyLCBzdWJzY3JpYmVPcHRpb25zKTsNCg0KICAgICAgICBpZiAoIXRoaXMuY29ubmVjdGVkKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1NUQVRFLCBbIm5vdCBjb25uZWN0ZWQiXSkpOw0KDQogICAgICAgIHZhciB3aXJlTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuU1VCU0NSSUJFKTsNCiAgICAgICAgd2lyZU1lc3NhZ2UudG9waWNzID0gW2ZpbHRlcl07DQogICAgICAgIGlmIChzdWJzY3JpYmVPcHRpb25zLnFvcyAhPSB1bmRlZmluZWQpDQogICAgICAgICAgICB3aXJlTWVzc2FnZS5yZXF1ZXN0ZWRRb3MgPSBbc3Vic2NyaWJlT3B0aW9ucy5xb3NdOw0KICAgICAgICBlbHNlDQogICAgICAgICAgICB3aXJlTWVzc2FnZS5yZXF1ZXN0ZWRRb3MgPSBbMF07DQoNCiAgICAgICAgaWYgKHN1YnNjcmliZU9wdGlvbnMub25TdWNjZXNzKSB7DQogICAgICAgICAgICB3aXJlTWVzc2FnZS5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICBzdWJzY3JpYmVPcHRpb25zLm9uU3VjY2Vzcyh7aW52b2NhdGlvbkNvbnRleHQ6IHN1YnNjcmliZU9wdGlvbnMuaW52b2NhdGlvbkNvbnRleHR9KTsNCiAgICAgICAgICAgIH07DQogICAgICAgIH0NCiAgICAgICAgaWYgKHN1YnNjcmliZU9wdGlvbnMudGltZW91dCkgew0KICAgICAgICAgICAgd2lyZU1lc3NhZ2UudGltZU91dCA9IG5ldyBUaW1lb3V0KHRoaXMsIHdpbmRvdywgc3Vic2NyaWJlT3B0aW9ucy50aW1lb3V0LCBzdWJzY3JpYmVPcHRpb25zLm9uRmFpbHVyZQ0KICAgICAgICAgICAgICAgICwgWw0KICAgICAgICAgICAgICAgICAgICB7aW52b2NhdGlvbkNvbnRleHQ6IHN1YnNjcmliZU9wdGlvbnMuaW52b2NhdGlvbkNvbnRleHQsDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNvZGU6IEVSUk9SLlNVQlNDUklCRV9USU1FT1VULmNvZGUsDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvck1lc3NhZ2U6IGZvcm1hdChFUlJPUi5TVUJTQ1JJQkVfVElNRU9VVCl9DQogICAgICAgICAgICAgICAgXSk7DQogICAgICAgIH0NCg0KICAgICAgICAvLyBBbGwgc3Vic2NyaXB0aW9ucyByZXR1cm4gYSBTVUJBQ0suIA0KICAgICAgICB0aGlzLl9yZXF1aXJlc19hY2sod2lyZU1lc3NhZ2UpOw0KICAgICAgICB0aGlzLl9zY2hlZHVsZV9tZXNzYWdlKHdpcmVNZXNzYWdlKTsNCiAgICB9Ow0KDQogICAgLyoqIEBpZ25vcmUgKi8NCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS51bnN1YnNjcmliZSA9IGZ1bmN0aW9uIChmaWx0ZXIsIHVuc3Vic2NyaWJlT3B0aW9ucykgew0KICAgICAgICB0aGlzLl90cmFjZSgiQ2xpZW50LnVuc3Vic2NyaWJlIiwgZmlsdGVyLCB1bnN1YnNjcmliZU9wdGlvbnMpOw0KDQogICAgICAgIGlmICghdGhpcy5jb25uZWN0ZWQpDQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfU1RBVEUsIFsibm90IGNvbm5lY3RlZCJdKSk7DQoNCiAgICAgICAgdmFyIHdpcmVNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKE1FU1NBR0VfVFlQRS5VTlNVQlNDUklCRSk7DQogICAgICAgIHdpcmVNZXNzYWdlLnRvcGljcyA9IFtmaWx0ZXJdOw0KDQogICAgICAgIGlmICh1bnN1YnNjcmliZU9wdGlvbnMub25TdWNjZXNzKSB7DQogICAgICAgICAgICB3aXJlTWVzc2FnZS5jYWxsYmFjayA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgICAgICB1bnN1YnNjcmliZU9wdGlvbnMub25TdWNjZXNzKHtpbnZvY2F0aW9uQ29udGV4dDogdW5zdWJzY3JpYmVPcHRpb25zLmludm9jYXRpb25Db250ZXh0fSk7DQogICAgICAgICAgICB9Ow0KICAgICAgICB9DQogICAgICAgIGlmICh1bnN1YnNjcmliZU9wdGlvbnMudGltZW91dCkgew0KICAgICAgICAgICAgd2lyZU1lc3NhZ2UudGltZU91dCA9IG5ldyBUaW1lb3V0KHRoaXMsIHdpbmRvdywgdW5zdWJzY3JpYmVPcHRpb25zLnRpbWVvdXQsIHVuc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUNCiAgICAgICAgICAgICAgICAsIFsNCiAgICAgICAgICAgICAgICAgICAge2ludm9jYXRpb25Db250ZXh0OiB1bnN1YnNjcmliZU9wdGlvbnMuaW52b2NhdGlvbkNvbnRleHQsDQogICAgICAgICAgICAgICAgICAgICAgICBlcnJvckNvZGU6IEVSUk9SLlVOU1VCU0NSSUJFX1RJTUVPVVQuY29kZSwNCiAgICAgICAgICAgICAgICAgICAgICAgIGVycm9yTWVzc2FnZTogZm9ybWF0KEVSUk9SLlVOU1VCU0NSSUJFX1RJTUVPVVQpfQ0KICAgICAgICAgICAgICAgIF0pOw0KICAgICAgICB9DQoNCiAgICAgICAgLy8gQWxsIHVuc3Vic2NyaWJlcyByZXR1cm4gYSBTVUJBQ0suICAgICAgICAgDQogICAgICAgIHRoaXMuX3JlcXVpcmVzX2Fjayh3aXJlTWVzc2FnZSk7DQogICAgICAgIHRoaXMuX3NjaGVkdWxlX21lc3NhZ2Uod2lyZU1lc3NhZ2UpOw0KICAgIH07DQoNCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5zZW5kID0gZnVuY3Rpb24gKG1lc3NhZ2UpIHsNCiAgICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5zZW5kIiwgbWVzc2FnZSk7DQoNCiAgICAgICAgaWYgKCF0aGlzLmNvbm5lY3RlZCkNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9TVEFURSwgWyJub3QgY29ubmVjdGVkIl0pKTsNCg0KICAgICAgICB3aXJlTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuUFVCTElTSCk7DQogICAgICAgIHdpcmVNZXNzYWdlLnBheWxvYWRNZXNzYWdlID0gbWVzc2FnZTsNCg0KICAgICAgICBpZiAobWVzc2FnZS5xb3MgPiAwKQ0KICAgICAgICAgICAgdGhpcy5fcmVxdWlyZXNfYWNrKHdpcmVNZXNzYWdlKTsNCiAgICAgICAgZWxzZSBpZiAodGhpcy5vbk1lc3NhZ2VEZWxpdmVyZWQpDQogICAgICAgICAgICB0aGlzLl9ub3RpZnlfbXNnX3NlbnRbd2lyZU1lc3NhZ2VdID0gdGhpcy5vbk1lc3NhZ2VEZWxpdmVyZWQod2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UpOw0KICAgICAgICB0aGlzLl9zY2hlZHVsZV9tZXNzYWdlKHdpcmVNZXNzYWdlKTsNCiAgICB9Ow0KDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuZGlzY29ubmVjdCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5kaXNjb25uZWN0Iik7DQoNCiAgICAgICAgaWYgKCF0aGlzLnNvY2tldCkNCiAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9TVEFURSwgWyJub3QgY29ubmVjdGluZyBvciBjb25uZWN0ZWQiXSkpOw0KDQogICAgICAgIHdpcmVNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKE1FU1NBR0VfVFlQRS5ESVNDT05ORUNUKTsNCg0KICAgICAgICAvLyBSdW4gdGhlIGRpc2Nvbm5lY3RlZCBjYWxsIGJhY2sgYXMgc29vbiBhcyB0aGUgbWVzc2FnZSBoYXMgYmVlbiBzZW50LA0KICAgICAgICAvLyBpbiBjYXNlIG9mIGEgZmFpbHVyZSBsYXRlciBvbiBpbiB0aGUgZGlzY29ubmVjdCBwcm9jZXNzaW5nLg0KICAgICAgICAvLyBhcyBhIGNvbnNlcXVlbmNlLCB0aGUgX2Rpc2NvbmVjdGVkIGNhbGwgYmFjayBtYXkgYmUgcnVuIHNldmVyYWwgdGltZXMuDQogICAgICAgIHRoaXMuX25vdGlmeV9tc2dfc2VudFt3aXJlTWVzc2FnZV0gPSBzY29wZSh0aGlzLl9kaXNjb25uZWN0ZWQsIHRoaXMpOw0KDQogICAgICAgIHRoaXMuX3NjaGVkdWxlX21lc3NhZ2Uod2lyZU1lc3NhZ2UpOw0KICAgIH07DQoNCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5nZXRUcmFjZUxvZyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgaWYgKHRoaXMuX3RyYWNlQnVmZmVyICE9PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLl90cmFjZSgiQ2xpZW50LmdldFRyYWNlTG9nIiwgbmV3IERhdGUoKSk7DQogICAgICAgICAgICB0aGlzLl90cmFjZSgiQ2xpZW50LmdldFRyYWNlTG9nIGluIGZsaWdodCBtZXNzYWdlcyIsIHRoaXMuX3NlbnRNZXNzYWdlcy5sZW5ndGgpOw0KICAgICAgICAgICAgZm9yIChrZXkgaW4gdGhpcy5fc2VudE1lc3NhZ2VzKQ0KICAgICAgICAgICAgICAgIHRoaXMuX3RyYWNlKCJfc2VudE1lc3NhZ2VzICIsIGtleSwgdGhpcy5fc2VudE1lc3NhZ2VzW2tleV0pOw0KICAgICAgICAgICAgZm9yIChrZXkgaW4gdGhpcy5fcmVjZWl2ZWRNZXNzYWdlcykNCiAgICAgICAgICAgICAgICB0aGlzLl90cmFjZSgiX3JlY2VpdmVkTWVzc2FnZXMgIiwga2V5LCB0aGlzLl9yZWNlaXZlZE1lc3NhZ2VzW2tleV0pOw0KDQogICAgICAgICAgICByZXR1cm4gdGhpcy5fdHJhY2VCdWZmZXI7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuc3RhcnRUcmFjZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgaWYgKHRoaXMuX3RyYWNlQnVmZmVyID09PSBudWxsKSB7DQogICAgICAgICAgICB0aGlzLl90cmFjZUJ1ZmZlciA9IFtdOw0KICAgICAgICB9DQogICAgICAgIHRoaXMuX3RyYWNlKCJDbGllbnQuc3RhcnRUcmFjZSIsIG5ldyBEYXRlKCksIHZlcnNpb24pOw0KICAgIH07DQoNCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5zdG9wVHJhY2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGRlbGV0ZSB0aGlzLl90cmFjZUJ1ZmZlcjsNCiAgICB9Ow0KDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX2RvQ29ubmVjdCA9IGZ1bmN0aW9uIChob3N0LCBwb3J0KSB7DQogICAgICAgIC8vIFdoZW4gdGhlIHNvY2tldCBpcyBvcGVuLCB0aGlzIGNsaWVudCB3aWxsIHNlbmQgdGhlIENPTk5FQ1QgV2lyZU1lc3NhZ2UgdXNpbmcgdGhlIHNhdmVkIHBhcmFtZXRlcnMuIA0KICAgICAgICBpZiAodGhpcy5jb25uZWN0T3B0aW9ucy51c2VTU0wpDQogICAgICAgICAgICB3c3VybCA9IFsid3NzOi8vIiwgaG9zdCwgIjoiLCBwb3J0LCAiL21xdHQiXS5qb2luKCIiKTsNCiAgICAgICAgZWxzZQ0KICAgICAgICAgICAgd3N1cmwgPSBbIndzOi8vIiwgaG9zdCwgIjoiLCBwb3J0LCAiL21xdHQiXS5qb2luKCIiKTsNCiAgICAgICAgdGhpcy5jb25uZWN0ZWQgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5zb2NrZXQgPSBuZXcgV2ViU29ja2V0KHdzdXJsLCAnbXF0dHYzLjEnKTsNCiAgICAgICAgdGhpcy5zb2NrZXQuYmluYXJ5VHlwZSA9ICdhcnJheWJ1ZmZlcic7DQogICAgICAgIHRoaXMuc29ja2V0Lm9ub3BlbiA9IHNjb3BlKHRoaXMuX29uX3NvY2tldF9vcGVuLCB0aGlzKTsNCiAgICAgICAgdGhpcy5zb2NrZXQub25tZXNzYWdlID0gc2NvcGUodGhpcy5fb25fc29ja2V0X21lc3NhZ2UsIHRoaXMpOw0KICAgICAgICB0aGlzLnNvY2tldC5vbmVycm9yID0gc2NvcGUodGhpcy5fb25fc29ja2V0X2Vycm9yLCB0aGlzKTsNCiAgICAgICAgdGhpcy5zb2NrZXQub25jbG9zZSA9IHNjb3BlKHRoaXMuX29uX3NvY2tldF9jbG9zZSwgdGhpcyk7DQoNCiAgICAgICAgdGhpcy5zZW5kUGluZ2VyID0gbmV3IFBpbmdlcih0aGlzLCB3aW5kb3csIHRoaXMuY29ubmVjdE9wdGlvbnMua2VlcEFsaXZlSW50ZXJ2YWwpOw0KICAgICAgICB0aGlzLnJlY2VpdmVQaW5nZXIgPSBuZXcgUGluZ2VyKHRoaXMsIHdpbmRvdywgdGhpcy5jb25uZWN0T3B0aW9ucy5rZWVwQWxpdmVJbnRlcnZhbCk7DQoNCiAgICAgICAgdGhpcy5fY29ubmVjdFRpbWVvdXQgPSBuZXcgVGltZW91dCh0aGlzLCB3aW5kb3csIHRoaXMuY29ubmVjdE9wdGlvbnMudGltZW91dCwgdGhpcy5fZGlzY29ubmVjdGVkLCBbRVJST1IuQ09OTkVDVF9USU1FT1VULmNvZGUsIGZvcm1hdChFUlJPUi5DT05ORUNUX1RJTUVPVVQpXSk7DQogICAgfTsNCg0KDQogICAgLy8gU2NoZWR1bGUgYSBuZXcgbWVzc2FnZSB0byBiZSBzZW50IG92ZXIgdGhlIFdlYlNvY2tldHMNCiAgICAvLyBjb25uZWN0aW9uLiBDT05ORUNUIG1lc3NhZ2VzIGNhdXNlIFdlYlNvY2tldCBjb25uZWN0aW9uDQogICAgLy8gdG8gYmUgc3RhcnRlZC4gQWxsIG90aGVyIG1lc3NhZ2VzIGFyZSBxdWV1ZWQgaW50ZXJuYWxseQ0KICAgIC8vIHVudGlsIHRoaXMgaGFzIGhhcHBlbmVkLiBXaGVuIFdTIGNvbm5lY3Rpb24gc3RhcnRzLCBwcm9jZXNzDQogICAgLy8gYWxsIG91dHN0YW5kaW5nIG1lc3NhZ2VzLiANCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fc2NoZWR1bGVfbWVzc2FnZSA9IGZ1bmN0aW9uIChtZXNzYWdlKSB7DQogICAgICAgIHRoaXMuX21zZ19xdWV1ZS5wdXNoKG1lc3NhZ2UpOw0KICAgICAgICAvLyBQcm9jZXNzIG91dHN0YW5kaW5nIG1lc3NhZ2VzIGluIHRoZSBxdWV1ZSBpZiB3ZSBoYXZlIGFuICBvcGVuIHNvY2tldCwgYW5kIGhhdmUgcmVjZWl2ZWQgQ09OTkFDSy4gDQogICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZCkgew0KICAgICAgICAgICAgdGhpcy5fcHJvY2Vzc19xdWV1ZSgpOw0KICAgICAgICB9DQogICAgfTsNCg0KICAgIENsaWVudEltcGwucHJvdG90eXBlLnN0b3JlID0gZnVuY3Rpb24gKHByZWZpeCwgd2lyZU1lc3NhZ2UpIHsNCiAgICAgICAgc3RvcmVkTWVzc2FnZSA9IHt0eXBlOiB3aXJlTWVzc2FnZS50eXBlLCBtZXNzYWdlSWRlbnRpZmllcjogd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIsIHZlcnNpb246IDF9Ow0KDQogICAgICAgIHN3aXRjaCAod2lyZU1lc3NhZ2UudHlwZSkgew0KICAgICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCTElTSDoNCiAgICAgICAgICAgICAgICBpZiAod2lyZU1lc3NhZ2UucHViUmVjUmVjZWl2ZWQpDQogICAgICAgICAgICAgICAgICAgIHN0b3JlZE1lc3NhZ2UucHViUmVjUmVjZWl2ZWQgPSB0cnVlOw0KDQogICAgICAgICAgICAgICAgLy8gQ29udmVydCB0aGUgcGF5bG9hZCB0byBhIGhleCBzdHJpbmcuDQogICAgICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZSA9IHt9Ow0KICAgICAgICAgICAgICAgIHZhciBoZXggPSAiIjsNCiAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZUJ5dGVzID0gd2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucGF5bG9hZEJ5dGVzOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgbWVzc2FnZUJ5dGVzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChtZXNzYWdlQnl0ZXNbaV0gPD0gMHhGKQ0KICAgICAgICAgICAgICAgICAgICAgICAgaGV4ID0gaGV4ICsgIjAiICsgbWVzc2FnZUJ5dGVzW2ldLnRvU3RyaW5nKDE2KTsNCiAgICAgICAgICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgICAgICAgICAgaGV4ID0gaGV4ICsgbWVzc2FnZUJ5dGVzW2ldLnRvU3RyaW5nKDE2KTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5wYXlsb2FkSGV4ID0gaGV4Ow0KDQogICAgICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5xb3MgPSB3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5xb3M7DQogICAgICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUgPSB3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWU7DQogICAgICAgICAgICAgICAgaWYgKHdpcmVNZXNzYWdlLnBheWxvYWRNZXNzYWdlLmR1cGxpY2F0ZSkNCiAgICAgICAgICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5kdXBsaWNhdGUgPSB0cnVlOw0KICAgICAgICAgICAgICAgIGlmICh3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5yZXRhaW5lZCkNCiAgICAgICAgICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5yZXRhaW5lZCA9IHRydWU7DQoNCiAgICAgICAgICAgICAgICAvLyBBZGQgYSBzZXF1ZW5jZSBudW1iZXIgdG8gc2VudCBtZXNzYWdlcy4NCiAgICAgICAgICAgICAgICBpZiAocHJlZml4LmluZGV4T2YoIlNlbnQ6IikgPT0gMCkgew0KICAgICAgICAgICAgICAgICAgICBpZiAod2lyZU1lc3NhZ2Uuc2VxdWVuY2UgPT09IHVuZGVmaW5lZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHdpcmVNZXNzYWdlLnNlcXVlbmNlID0gKyt0aGlzLl9zZXF1ZW5jZTsNCiAgICAgICAgICAgICAgICAgICAgc3RvcmVkTWVzc2FnZS5zZXF1ZW5jZSA9IHdpcmVNZXNzYWdlLnNlcXVlbmNlOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgZGVmYXVsdDoNCiAgICAgICAgICAgICAgICB0aHJvdyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9TVE9SRURfREFUQSwgW2tleSwgc3RvcmVkTWVzc2FnZV0pKTsNCiAgICAgICAgfQ0KICAgICAgICBsb2NhbFN0b3JhZ2Uuc2V0SXRlbShwcmVmaXggKyB0aGlzLl9sb2NhbEtleSArIHdpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyLCBKU09OLnN0cmluZ2lmeShzdG9yZWRNZXNzYWdlKSk7DQogICAgfTsNCg0KICAgIENsaWVudEltcGwucHJvdG90eXBlLnJlc3RvcmUgPSBmdW5jdGlvbiAoa2V5KSB7DQogICAgICAgIHZhciB2YWx1ZSA9IGxvY2FsU3RvcmFnZS5nZXRJdGVtKGtleSk7DQogICAgICAgIHZhciBzdG9yZWRNZXNzYWdlID0gSlNPTi5wYXJzZSh2YWx1ZSk7DQoNCiAgICAgICAgdmFyIHdpcmVNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKHN0b3JlZE1lc3NhZ2UudHlwZSwgc3RvcmVkTWVzc2FnZSk7DQoNCiAgICAgICAgc3dpdGNoIChzdG9yZWRNZXNzYWdlLnR5cGUpIHsNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQkxJU0g6DQogICAgICAgICAgICAgICAgLy8gUmVwbGFjZSB0aGUgcGF5bG9hZCBtZXNzYWdlIHdpdGggYSBNZXNzYWdlIG9iamVjdC4NCiAgICAgICAgICAgICAgICB2YXIgaGV4ID0gc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5wYXlsb2FkSGV4Ow0KICAgICAgICAgICAgICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoKGhleC5sZW5ndGgpIC8gMik7DQogICAgICAgICAgICAgICAgdmFyIGJ5dGVTdHJlYW0gPSBuZXcgVWludDhBcnJheShidWZmZXIpOw0KICAgICAgICAgICAgICAgIHZhciBpID0gMDsNCiAgICAgICAgICAgICAgICB3aGlsZSAoaGV4Lmxlbmd0aCA-PSAyKSB7DQogICAgICAgICAgICAgICAgICAgIHZhciB4ID0gcGFyc2VJbnQoaGV4LnN1YnN0cmluZygwLCAyKSwgMTYpOw0KICAgICAgICAgICAgICAgICAgICBoZXggPSBoZXguc3Vic3RyaW5nKDIsIGhleC5sZW5ndGgpOw0KICAgICAgICAgICAgICAgICAgICBieXRlU3RyZWFtW2krK10gPSB4Ow0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICB2YXIgcGF5bG9hZE1lc3NhZ2UgPSBuZXcgTWVzc2FnaW5nLk1lc3NhZ2UoYnl0ZVN0cmVhbSk7DQoNCiAgICAgICAgICAgICAgICBwYXlsb2FkTWVzc2FnZS5xb3MgPSBzdG9yZWRNZXNzYWdlLnBheWxvYWRNZXNzYWdlLnFvczsNCiAgICAgICAgICAgICAgICBwYXlsb2FkTWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUgPSBzdG9yZWRNZXNzYWdlLnBheWxvYWRNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZTsNCiAgICAgICAgICAgICAgICBpZiAoc3RvcmVkTWVzc2FnZS5wYXlsb2FkTWVzc2FnZS5kdXBsaWNhdGUpDQogICAgICAgICAgICAgICAgICAgIHBheWxvYWRNZXNzYWdlLmR1cGxpY2F0ZSA9IHRydWU7DQogICAgICAgICAgICAgICAgaWYgKHN0b3JlZE1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucmV0YWluZWQpDQogICAgICAgICAgICAgICAgICAgIHBheWxvYWRNZXNzYWdlLnJldGFpbmVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICB3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZSA9IHBheWxvYWRNZXNzYWdlOw0KDQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfU1RPUkVEX0RBVEEsIFtrZXksIHZhbHVlXSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKGtleS5pbmRleE9mKCJTZW50OiIgKyB0aGlzLl9sb2NhbEtleSkgPT0gMCkgew0KICAgICAgICAgICAgdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXSA9IHdpcmVNZXNzYWdlOw0KICAgICAgICB9IGVsc2UgaWYgKGtleS5pbmRleE9mKCJSZWNlaXZlZDoiICsgdGhpcy5fbG9jYWxLZXkpID09IDApIHsNCiAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVkTWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdID0gd2lyZU1lc3NhZ2U7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3Byb2Nlc3NfcXVldWUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIHZhciBtZXNzYWdlID0gbnVsbDsNCiAgICAgICAgLy8gUHJvY2VzcyBtZXNzYWdlcyBpbiBvcmRlciB0aGV5IHdlcmUgYWRkZWQNCiAgICAgICAgdmFyIGZpZm8gPSB0aGlzLl9tc2dfcXVldWUucmV2ZXJzZSgpOw0KDQogICAgICAgIC8vIFNlbmQgYWxsIHF1ZXVlZCBtZXNzYWdlcyBkb3duIHNvY2tldCBjb25uZWN0aW9uDQogICAgICAgIHdoaWxlICgobWVzc2FnZSA9IGZpZm8ucG9wKCkpKSB7DQogICAgICAgICAgICB0aGlzLl9zb2NrZXRfc2VuZChtZXNzYWdlKTsNCiAgICAgICAgICAgIC8vIE5vdGlmeSBsaXN0ZW5lcnMgdGhhdCBtZXNzYWdlIHdhcyBzdWNjZXNzZnVsbHkgc2VudA0KICAgICAgICAgICAgaWYgKHRoaXMuX25vdGlmeV9tc2dfc2VudFttZXNzYWdlXSkgew0KICAgICAgICAgICAgICAgIHRoaXMuX25vdGlmeV9tc2dfc2VudFttZXNzYWdlXSgpOw0KICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9ub3RpZnlfbXNnX3NlbnRbbWVzc2FnZV07DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQGlnbm9yZQ0KICAgICAqIEV4cGVjdCBhbiBBQ0sgcmVzcG9uc2UgZm9yIHRoaXMgbWVzc2FnZS4gQWRkIG1lc3NhZ2UgdG8gdGhlIHNldCBvZiBpbiBwcm9ncmVzcw0KICAgICAqIG1lc3NhZ2VzIGFuZCBzZXQgYW4gdW51c2VkIGlkZW50aWZpZXIgaW4gdGhpcyBtZXNzYWdlLg0KICAgICAqLw0KICAgIENsaWVudEltcGwucHJvdG90eXBlLl9yZXF1aXJlc19hY2sgPSBmdW5jdGlvbiAod2lyZU1lc3NhZ2UpIHsNCiAgICAgICAgdmFyIG1lc3NhZ2VDb3VudCA9IE9iamVjdC5rZXlzKHRoaXMuX3NlbnRNZXNzYWdlcykubGVuZ3RoOw0KICAgICAgICBpZiAobWVzc2FnZUNvdW50ID4gdGhpcy5tYXhNZXNzYWdlSWRlbnRpZmllcikNCiAgICAgICAgICAgIHRocm93IEVycm9yKCJUb28gbWFueSBtZXNzYWdlczoiICsgbWVzc2FnZUNvdW50KTsNCg0KICAgICAgICB3aGlsZSAodGhpcy5fc2VudE1lc3NhZ2VzW3RoaXMuX21lc3NhZ2VfaWRlbnRpZmllcl0gIT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5fbWVzc2FnZV9pZGVudGlmaWVyKys7DQogICAgICAgIH0NCiAgICAgICAgd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIgPSB0aGlzLl9tZXNzYWdlX2lkZW50aWZpZXI7DQogICAgICAgIHRoaXMuX3NlbnRNZXNzYWdlc1t3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcl0gPSB3aXJlTWVzc2FnZTsNCiAgICAgICAgaWYgKHdpcmVNZXNzYWdlLnR5cGUgPT09IE1FU1NBR0VfVFlQRS5QVUJMSVNIKSB7DQogICAgICAgICAgICB0aGlzLnN0b3JlKCJTZW50OiIsIHdpcmVNZXNzYWdlKTsNCiAgICAgICAgfQ0KICAgICAgICBpZiAodGhpcy5fbWVzc2FnZV9pZGVudGlmaWVyID09PSB0aGlzLm1heE1lc3NhZ0lkZW50aWZpZXIpIHsNCiAgICAgICAgICAgIHRoaXMuX21lc3NhZ2VfaWRlbnRpZmllciA9IDE7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQGlnbm9yZQ0KICAgICAqIENhbGxlZCB3aGVuIHRoZSB1bmRlcmx5aW5nIHdlYnNvY2tldCBoYXMgYmVlbiBvcGVuZWQuDQogICAgICovDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX29uX3NvY2tldF9vcGVuID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAvLyBDcmVhdGUgdGhlIENPTk5FQ1QgbWVzc2FnZSBvYmplY3QuDQogICAgICAgIHZhciB3aXJlTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuQ09OTkVDVCwgdGhpcy5jb25uZWN0T3B0aW9ucyk7DQogICAgICAgIHdpcmVNZXNzYWdlLmNsaWVudElkID0gdGhpcy5jbGllbnRJZDsNCiAgICAgICAgdGhpcy5fc29ja2V0X3NlbmQod2lyZU1lc3NhZ2UpOw0KICAgIH07DQoNCiAgICAvKioNCiAgICAgKiBAaWdub3JlDQogICAgICogQ2FsbGVkIHdoZW4gdGhlIHVuZGVybHlpbmcgd2Vic29ja2V0IGhhcyByZWNlaXZlZCBhIGNvbXBsZXRlIHBhY2tldC4NCiAgICAgKi8NCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fb25fc29ja2V0X21lc3NhZ2UgPSBmdW5jdGlvbiAoZXZlbnQpIHsNCiAgICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5fb25fc29ja2V0X21lc3NhZ2UiLCBldmVudC5kYXRhKTsNCg0KICAgICAgICAvLyBSZXNldCB0aGUgcmVjZWl2ZSBwaW5nIHRpbWVyLCB3ZSBub3cgaGF2ZSBldmlkZW5jZSB0aGUgc2VydmVyIGlzIGFsaXZlLg0KICAgICAgICB0aGlzLnJlY2VpdmVQaW5nZXIucmVzZXQoKTsNCiAgICAgICAgdmFyIGJ5dGVBcnJheSA9IG5ldyBVaW50OEFycmF5KGV2ZW50LmRhdGEpOw0KICAgICAgICB0cnkgew0KICAgICAgICAgICAgdmFyIHdpcmVNZXNzYWdlID0gZGVjb2RlTWVzc2FnZShieXRlQXJyYXkpOw0KICAgICAgICB9IGNhdGNoIChlcnJvcikgew0KICAgICAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkKEVSUk9SLklOVEVSTkFMX0VSUk9SLmNvZGUsIGZvcm1hdChFUlJPUi5JTlRFUk5BTF9FUlJPUiwgW2Vycm9yLm1lc3NhZ2VdKSk7DQogICAgICAgICAgICByZXR1cm47DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5fb25fc29ja2V0X21lc3NhZ2UiLCB3aXJlTWVzc2FnZSk7DQoNCiAgICAgICAgc3dpdGNoICh3aXJlTWVzc2FnZS50eXBlKSB7DQogICAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5DT05OQUNLOg0KICAgICAgICAgICAgICAgIHRoaXMuX2Nvbm5lY3RUaW1lb3V0LmNhbmNlbCgpOw0KDQogICAgICAgICAgICAgICAgLy8gSWYgd2UgaGF2ZSBzdGFydGVkIHVzaW5nIGNsZWFuIHNlc3Npb24gdGhlbiBjbGVhciB1cCB0aGUgbG9jYWwgc3RhdGUuDQogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdE9wdGlvbnMuY2xlYW5TZXNzaW9uKSB7DQogICAgICAgICAgICAgICAgICAgIGZvciAoa2V5IGluIHRoaXMuX3NlbnRNZXNzYWdlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHNlbnRNZXNzYWdlID0gdGhpcy5fc2VudE1lc3NhZ2VzW2tleV07DQogICAgICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiU2VudDoiICsgdGhpcy5fbG9jYWxLZXkgKyBzZW50TWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcik7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2VudE1lc3NhZ2VzID0ge307DQoNCiAgICAgICAgICAgICAgICAgICAgZm9yIChrZXkgaW4gdGhpcy5fcmVjZWl2ZWRNZXNzYWdlcykgew0KICAgICAgICAgICAgICAgICAgICAgICAgdmFyIHJlY2VpdmVkTWVzc2FnZSA9IHRoaXMuX3JlY2VpdmVkTWVzc2FnZXNba2V5XTsNCiAgICAgICAgICAgICAgICAgICAgICAgIGxvY2FsU3RvcmFnZS5yZW1vdmVJdGVtKCJSZWNlaXZlZDoiICsgdGhpcy5fbG9jYWxLZXkgKyByZWNlaXZlZE1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVkTWVzc2FnZXMgPSB7fTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gQ2xpZW50IGNvbm5lY3RlZCBhbmQgcmVhZHkgZm9yIGJ1c2luZXNzLg0KICAgICAgICAgICAgICAgIGlmICh3aXJlTWVzc2FnZS5yZXR1cm5Db2RlID09PSAwKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gdHJ1ZTsNCiAgICAgICAgICAgICAgICAgICAgLy8gSnVtcCB0byB0aGUgZW5kIG9mIHRoZSBsaXN0IG9mIGhvc3RzIGFuZCBzdG9wIGxvb2tpbmcgZm9yIGEgZ29vZCBob3N0Lg0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0T3B0aW9ucy5ob3N0cykNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMuaG9zdEluZGV4ID0gdGhpcy5jb25uZWN0T3B0aW9ucy5ob3N0cy5sZW5ndGg7DQogICAgICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkKEVSUk9SLkNPTk5BQ0tfUkVUVVJOQ09ERS5jb2RlLCBmb3JtYXQoRVJST1IuQ09OTkFDS19SRVRVUk5DT0RFLCBbd2lyZU1lc3NhZ2UucmV0dXJuQ29kZSwgQ09OTkFDS19SQ1t3aXJlTWVzc2FnZS5yZXR1cm5Db2RlXV0pKTsNCiAgICAgICAgICAgICAgICAgICAgYnJlYWs7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gUmVzZW5kIG1lc3NhZ2VzLg0KICAgICAgICAgICAgICAgIHZhciBzZXF1ZW5jZWRNZXNzYWdlcyA9IG5ldyBBcnJheSgpOw0KICAgICAgICAgICAgICAgIGZvciAodmFyIG1zZ0lkIGluIHRoaXMuX3NlbnRNZXNzYWdlcykgew0KICAgICAgICAgICAgICAgICAgICBpZiAodGhpcy5fc2VudE1lc3NhZ2VzLmhhc093blByb3BlcnR5KG1zZ0lkKSkNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlcXVlbmNlZE1lc3NhZ2VzLnB1c2godGhpcy5fc2VudE1lc3NhZ2VzW21zZ0lkXSk7DQogICAgICAgICAgICAgICAgfQ0KDQogICAgICAgICAgICAgICAgLy8gU29ydCBzZW50TWVzc2FnZXMgaW50byB0aGUgb3JpZ2luYWwgc2VudCBvcmRlci4NCiAgICAgICAgICAgICAgICB2YXIgc2VxdWVuY2VkTWVzc2FnZXMgPSBzZXF1ZW5jZWRNZXNzYWdlcy5zb3J0KGZ1bmN0aW9uIChhLCBiKSB7DQogICAgICAgICAgICAgICAgICAgIHJldHVybiBhLnNlcXVlbmNlIC0gYi5zZXF1ZW5jZTsNCiAgICAgICAgICAgICAgICB9KTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMCwgbGVuID0gc2VxdWVuY2VkTWVzc2FnZXMubGVuZ3RoOyBpIDwgbGVuOyBpKyspIHsNCiAgICAgICAgICAgICAgICAgICAgdmFyIHNlbnRNZXNzYWdlID0gc2VxdWVuY2VkTWVzc2FnZXNbaV07DQogICAgICAgICAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZS50eXBlID09IE1FU1NBR0VfVFlQRS5QVUJMSVNIICYmIHNlbnRNZXNzYWdlLnB1YlJlY1JlY2VpdmVkKSB7DQogICAgICAgICAgICAgICAgICAgICAgICB2YXIgcHViUmVsTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuUFVCUkVMLCB7bWVzc2FnZUlkZW50aWZpZXI6IHNlbnRNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyfSk7DQogICAgICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY2hlZHVsZV9tZXNzYWdlKHB1YlJlbE1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2NoZWR1bGVfbWVzc2FnZShzZW50TWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICAgICAgOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIEV4ZWN1dGUgdGhlIGNvbm5lY3RPcHRpb25zLm9uU3VjY2VzcyBjYWxsYmFjayBpZiB0aGVyZSBpcyBvbmUuDQogICAgICAgICAgICAgICAgaWYgKHRoaXMuY29ubmVjdE9wdGlvbnMub25TdWNjZXNzKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdE9wdGlvbnMub25TdWNjZXNzKHtpbnZvY2F0aW9uQ29udGV4dDogdGhpcy5jb25uZWN0T3B0aW9ucy5pbnZvY2F0aW9uQ29udGV4dH0pOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIC8vIFByb2Nlc3MgYWxsIHF1ZXVlZCBtZXNzYWdlcyBub3cgdGhhdCB0aGUgY29ubmVjdGlvbiBpcyBlc3RhYmxpc2hlZC4NCiAgICAgICAgICAgICAgICB0aGlzLl9wcm9jZXNzX3F1ZXVlKCk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQkxJU0g6DQogICAgICAgICAgICAgICAgdGhpcy5fcmVjZWl2ZVB1Ymxpc2god2lyZU1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QVUJBQ0s6DQogICAgICAgICAgICAgICAgdmFyIHNlbnRNZXNzYWdlID0gdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsNCiAgICAgICAgICAgICAgICAvLyBJZiB0aGlzIGlzIGEgcmUgZmxvdyBvZiBhIFBVQkFDSyBhZnRlciB3ZSBoYXZlIHJlc3RhcnRlZCByZWNlaXZlZE1lc3NhZ2Ugd2lsbCBub3QgZXhpc3QuDQogICAgICAgICAgICAgICAgaWYgKHNlbnRNZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOw0KICAgICAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiU2VudDoiICsgdGhpcy5fbG9jYWxLZXkgKyB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcik7DQogICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9uTWVzc2FnZURlbGl2ZXJlZCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHRoaXMub25NZXNzYWdlRGVsaXZlcmVkKHNlbnRNZXNzYWdlLnBheWxvYWRNZXNzYWdlKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQlJFQzoNCiAgICAgICAgICAgICAgICB2YXIgc2VudE1lc3NhZ2UgPSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOw0KICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSByZSBmbG93IG9mIGEgUFVCUkVDIGFmdGVyIHdlIGhhdmUgcmVzdGFydGVkIHJlY2VpdmVkTWVzc2FnZSB3aWxsIG5vdCBleGlzdC4NCiAgICAgICAgICAgICAgICBpZiAoc2VudE1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICAgICAgc2VudE1lc3NhZ2UucHViUmVjUmVjZWl2ZWQgPSB0cnVlOw0KICAgICAgICAgICAgICAgICAgICB2YXIgcHViUmVsTWVzc2FnZSA9IG5ldyBXaXJlTWVzc2FnZShNRVNTQUdFX1RZUEUuUFVCUkVMLCB7bWVzc2FnZUlkZW50aWZpZXI6IHdpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyfSk7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuc3RvcmUoIlNlbnQ6Iiwgc2VudE1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgICAgICB0aGlzLl9zY2hlZHVsZV9tZXNzYWdlKHB1YlJlbE1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIH0NCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSBNRVNTQUdFX1RZUEUuUFVCUkVMOg0KICAgICAgICAgICAgICAgIHZhciByZWNlaXZlZE1lc3NhZ2UgPSB0aGlzLl9yZWNlaXZlZE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsNCiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiUmVjZWl2ZWQ6IiArIHRoaXMuX2xvY2FsS2V5ICsgd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXIpOw0KICAgICAgICAgICAgICAgIC8vIElmIHRoaXMgaXMgYSByZSBmbG93IG9mIGEgUFVCUkVMIGFmdGVyIHdlIGhhdmUgcmVzdGFydGVkIHJlY2VpdmVkTWVzc2FnZSB3aWxsIG5vdCBleGlzdC4NCiAgICAgICAgICAgICAgICBpZiAocmVjZWl2ZWRNZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVNZXNzYWdlKHJlY2VpdmVkTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9yZWNlaXZlZE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgLy8gQWx3YXlzIGZsb3cgUHViQ29tcCwgd2UgbWF5IGhhdmUgcHJldmlvdXNseSBmbG93ZWQgUHViQ29tcCBidXQgdGhlIHNlcnZlciBsb3N0IGl0IGFuZCByZXN0YXJ0ZWQuDQogICAgICAgICAgICAgICAgcHViQ29tcE1lc3NhZ2UgPSBuZXcgV2lyZU1lc3NhZ2UoTUVTU0FHRV9UWVBFLlBVQkNPTVAsIHttZXNzYWdlSWRlbnRpZmllcjogd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJ9KTsNCiAgICAgICAgICAgICAgICB0aGlzLl9zY2hlZHVsZV9tZXNzYWdlKHB1YkNvbXBNZXNzYWdlKTsNCg0KDQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlBVQkNPTVA6DQogICAgICAgICAgICAgICAgdmFyIHNlbnRNZXNzYWdlID0gdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsNCiAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsNCiAgICAgICAgICAgICAgICBsb2NhbFN0b3JhZ2UucmVtb3ZlSXRlbSgiU2VudDoiICsgdGhpcy5fbG9jYWxLZXkgKyB3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcik7DQogICAgICAgICAgICAgICAgaWYgKHRoaXMub25NZXNzYWdlRGVsaXZlcmVkKQ0KICAgICAgICAgICAgICAgICAgICB0aGlzLm9uTWVzc2FnZURlbGl2ZXJlZChzZW50TWVzc2FnZS5wYXlsb2FkTWVzc2FnZSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlNVQkFDSzoNCiAgICAgICAgICAgICAgICB2YXIgc2VudE1lc3NhZ2UgPSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOw0KICAgICAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZSkgew0KICAgICAgICAgICAgICAgICAgICBpZiAoc2VudE1lc3NhZ2UudGltZU91dCkNCiAgICAgICAgICAgICAgICAgICAgICAgIHNlbnRNZXNzYWdlLnRpbWVPdXQuY2FuY2VsKCk7DQogICAgICAgICAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZS5jYWxsYmFjaykgew0KICAgICAgICAgICAgICAgICAgICAgICAgc2VudE1lc3NhZ2UuY2FsbGJhY2soKTsNCiAgICAgICAgICAgICAgICAgICAgfQ0KICAgICAgICAgICAgICAgICAgICBkZWxldGUgdGhpcy5fc2VudE1lc3NhZ2VzW3dpcmVNZXNzYWdlLm1lc3NhZ2VJZGVudGlmaWVyXTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGNhc2UgTUVTU0FHRV9UWVBFLlVOU1VCQUNLOg0KICAgICAgICAgICAgICAgIHZhciBzZW50TWVzc2FnZSA9IHRoaXMuX3NlbnRNZXNzYWdlc1t3aXJlTWVzc2FnZS5tZXNzYWdlSWRlbnRpZmllcl07DQogICAgICAgICAgICAgICAgaWYgKHNlbnRNZXNzYWdlKSB7DQogICAgICAgICAgICAgICAgICAgIGlmIChzZW50TWVzc2FnZS50aW1lT3V0KQ0KICAgICAgICAgICAgICAgICAgICAgICAgc2VudE1lc3NhZ2UudGltZU91dC5jYW5jZWwoKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHNlbnRNZXNzYWdlLmNhbGxiYWNrKSB7DQogICAgICAgICAgICAgICAgICAgICAgICBzZW50TWVzc2FnZS5jYWxsYmFjaygpOw0KICAgICAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgICAgIGRlbGV0ZSB0aGlzLl9zZW50TWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdOw0KICAgICAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5QSU5HUkVTUDoNCiAgICAgICAgICAgICAgICAvKiBUaGUgc2VuZFBpbmdlciBvciByZWNlaXZlUGluZ2VyIG1heSBoYXZlIHNlbnQgYSBwaW5nLCB0aGUgcmVjZWl2ZVBpbmdlciBoYXMgYWxyZWFkeSBiZWVuIHJlc2V0LiAqLw0KICAgICAgICAgICAgICAgIHRoaXMuc2VuZFBpbmdlci5yZXNldCgpOw0KICAgICAgICAgICAgICAgIGJyZWFrOw0KDQogICAgICAgICAgICBjYXNlIE1FU1NBR0VfVFlQRS5ESVNDT05ORUNUOg0KICAgICAgICAgICAgICAgIC8vIENsaWVudHMgZG8gbm90IGV4cGVjdCB0byByZWNlaXZlIGRpc2Nvbm5lY3QgcGFja2V0cy4NCiAgICAgICAgICAgICAgICB0aGlzLl9kaXNjb25uZWN0ZWQoRVJST1IuSU5WQUxJRF9NUVRUX01FU1NBR0VfVFlQRS5jb2RlLCBmb3JtYXQoRVJST1IuSU5WQUxJRF9NUVRUX01FU1NBR0VfVFlQRSwgW3dpcmVNZXNzYWdlLnR5cGVdKSk7DQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkKEVSUk9SLklOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEUuY29kZSwgZm9ybWF0KEVSUk9SLklOVkFMSURfTVFUVF9NRVNTQUdFX1RZUEUsIFt3aXJlTWVzc2FnZS50eXBlXSkpOw0KICAgICAgICB9DQogICAgICAgIDsNCiAgICB9Ow0KDQogICAgLyoqIEBpZ25vcmUgKi8NCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fb25fc29ja2V0X2Vycm9yID0gZnVuY3Rpb24gKGVycm9yKSB7DQogICAgICAgIHRoaXMuX2Rpc2Nvbm5lY3RlZChFUlJPUi5TT0NLRVRfRVJST1IuY29kZSwgZm9ybWF0KEVSUk9SLlNPQ0tFVF9FUlJPUiwgW2Vycm9yLmRhdGFdKSk7DQogICAgfTsNCg0KICAgIC8qKiBAaWdub3JlICovDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX29uX3NvY2tldF9jbG9zZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgdGhpcy5fZGlzY29ubmVjdGVkKEVSUk9SLlNPQ0tFVF9DTE9TRS5jb2RlLCBmb3JtYXQoRVJST1IuU09DS0VUX0NMT1NFKSk7DQogICAgfTsNCg0KICAgIC8qKiBAaWdub3JlICovDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3NvY2tldF9zZW5kID0gZnVuY3Rpb24gKHdpcmVNZXNzYWdlKSB7DQogICAgICAgIGlmICh3aXJlTWVzc2FnZS50eXBlID09IDEpIHsNCiAgICAgICAgICAgIHZhciB3aXJlTWVzc2FnZU1hc2tlZCA9IHRoaXMuX3RyYWNlTWFzayh3aXJlTWVzc2FnZSwgInBhc3N3b3JkIik7DQogICAgICAgICAgICB0aGlzLl90cmFjZSgiQ2xpZW50Ll9zb2NrZXRfc2VuZCIsIHdpcmVNZXNzYWdlTWFza2VkKTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHRoaXMuX3RyYWNlKCJDbGllbnQuX3NvY2tldF9zZW5kIiwgd2lyZU1lc3NhZ2UpOw0KDQogICAgICAgIHRoaXMuc29ja2V0LnNlbmQod2lyZU1lc3NhZ2UuZW5jb2RlKCkpOw0KICAgICAgICAvKiBXZSBoYXZlIHByb3ZlZCB0byB0aGUgc2VydmVyIHdlIGFyZSBhbGl2ZS4gKi8NCiAgICAgICAgdGhpcy5zZW5kUGluZ2VyLnJlc2V0KCk7DQogICAgfTsNCg0KICAgIC8qKiBAaWdub3JlICovDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3JlY2VpdmVQdWJsaXNoID0gZnVuY3Rpb24gKHdpcmVNZXNzYWdlKSB7DQogICAgICAgIHN3aXRjaCAod2lyZU1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucW9zKSB7DQogICAgICAgICAgICBjYXNlICJ1bmRlZmluZWQiOg0KICAgICAgICAgICAgY2FzZSAwOg0KICAgICAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVNZXNzYWdlKHdpcmVNZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAxOg0KICAgICAgICAgICAgICAgIHZhciBwdWJBY2tNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKE1FU1NBR0VfVFlQRS5QVUJBQ0ssIHttZXNzYWdlSWRlbnRpZmllcjogd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJ9KTsNCiAgICAgICAgICAgICAgICB0aGlzLl9zY2hlZHVsZV9tZXNzYWdlKHB1YkFja01lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVNZXNzYWdlKHdpcmVNZXNzYWdlKTsNCiAgICAgICAgICAgICAgICBicmVhazsNCg0KICAgICAgICAgICAgY2FzZSAyOg0KICAgICAgICAgICAgICAgIHRoaXMuX3JlY2VpdmVkTWVzc2FnZXNbd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJdID0gd2lyZU1lc3NhZ2U7DQogICAgICAgICAgICAgICAgdGhpcy5zdG9yZSgiUmVjZWl2ZWQ6Iiwgd2lyZU1lc3NhZ2UpOw0KICAgICAgICAgICAgICAgIHZhciBwdWJSZWNNZXNzYWdlID0gbmV3IFdpcmVNZXNzYWdlKE1FU1NBR0VfVFlQRS5QVUJSRUMsIHttZXNzYWdlSWRlbnRpZmllcjogd2lyZU1lc3NhZ2UubWVzc2FnZUlkZW50aWZpZXJ9KTsNCiAgICAgICAgICAgICAgICB0aGlzLl9zY2hlZHVsZV9tZXNzYWdlKHB1YlJlY01lc3NhZ2UpOw0KDQogICAgICAgICAgICAgICAgYnJlYWs7DQoNCiAgICAgICAgICAgIGRlZmF1bHQ6DQogICAgICAgICAgICAgICAgdGhyb3cgRXJyb3IoIkludmFpbGQgcW9zPSIgKyB3aXJlTW1lc3NhZ2UucGF5bG9hZE1lc3NhZ2UucW9zKTsNCiAgICAgICAgfQ0KICAgICAgICA7DQogICAgfTsNCg0KICAgIC8qKiBAaWdub3JlICovDQogICAgQ2xpZW50SW1wbC5wcm90b3R5cGUuX3JlY2VpdmVNZXNzYWdlID0gZnVuY3Rpb24gKHdpcmVNZXNzYWdlKSB7DQogICAgICAgIGlmICh0aGlzLm9uTWVzc2FnZUFycml2ZWQpIHsNCiAgICAgICAgICAgIHRoaXMub25NZXNzYWdlQXJyaXZlZCh3aXJlTWVzc2FnZS5wYXlsb2FkTWVzc2FnZSk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQGlnbm9yZQ0KICAgICAqIENsaWVudCBoYXMgZGlzY29ubmVjdGVkIGVpdGhlciBhdCBpdHMgb3duIHJlcXVlc3Qgb3IgYmVjYXVzZSB0aGUgc2VydmVyDQogICAgICogb3IgbmV0d29yayBkaXNjb25uZWN0ZWQgaXQuIFJlbW92ZSBhbGwgbm9uLWR1cmFibGUgc3RhdGUuDQogICAgICogQHBhcmFtIHtlcnJvckNvZGV9IFtudW1iZXJdIHRoZSBlcnJvciBudW1iZXIuDQogICAgICogQHBhcmFtIHtlcnJvclRleHR9IFtzdHJpbmddIHRoZSBlcnJvciB0ZXh0Lg0KICAgICAqLw0KICAgIENsaWVudEltcGwucHJvdG90eXBlLl9kaXNjb25uZWN0ZWQgPSBmdW5jdGlvbiAoZXJyb3JDb2RlLCBlcnJvclRleHQpIHsNCiAgICAgICAgdGhpcy5fdHJhY2UoIkNsaWVudC5fZGlzY29ubmVjdGVkIiwgZXJyb3JDb2RlLCBlcnJvclRleHQpOw0KDQogICAgICAgIHRoaXMuc2VuZFBpbmdlci5jYW5jZWwoKTsNCiAgICAgICAgdGhpcy5yZWNlaXZlUGluZ2VyLmNhbmNlbCgpOw0KICAgICAgICBpZiAodGhpcy5fY29ubmVjdFRpbWVvdXQpDQogICAgICAgICAgICB0aGlzLl9jb25uZWN0VGltZW91dC5jYW5jZWwoKTsNCiAgICAgICAgLy8gQ2xlYXIgbWVzc2FnZSBidWZmZXJzLg0KICAgICAgICB0aGlzLl9tc2dfcXVldWUgPSBbXTsNCiAgICAgICAgdGhpcy5fbm90aWZ5X21zZ19zZW50ID0ge307DQoNCiAgICAgICAgaWYgKHRoaXMuc29ja2V0KSB7DQogICAgICAgICAgICAvLyBDYW5jZWwgYWxsIHNvY2tldCBjYWxsYmFja3Mgc28gdGhhdCB0aGV5IGNhbm5vdCBiZSBkcml2ZW4gYWdhaW4gYnkgdGhpcyBzb2NrZXQuDQogICAgICAgICAgICB0aGlzLnNvY2tldC5vbm9wZW4gPSBudWxsOw0KICAgICAgICAgICAgdGhpcy5zb2NrZXQub25tZXNzYWdlID0gbnVsbDsNCiAgICAgICAgICAgIHRoaXMuc29ja2V0Lm9uZXJyb3IgPSBudWxsOw0KICAgICAgICAgICAgdGhpcy5zb2NrZXQub25jbG9zZSA9IG51bGw7DQogICAgICAgICAgICBpZiAodGhpcy5zb2NrZXQucmVhZHlTdGF0ZSA9PT0gMSkNCiAgICAgICAgICAgICAgICB0aGlzLnNvY2tldC5jbG9zZSgpOw0KICAgICAgICAgICAgZGVsZXRlIHRoaXMuc29ja2V0Ow0KICAgICAgICB9DQoNCiAgICAgICAgaWYgKHRoaXMuY29ubmVjdE9wdGlvbnMuaG9zdHMgJiYgdGhpcy5ob3N0SW5kZXggPCB0aGlzLmNvbm5lY3RPcHRpb25zLmhvc3RzLmxlbmd0aCAtIDEpIHsNCiAgICAgICAgICAgIC8vIFRyeSB0aGUgbmV4dCBob3N0Lg0KICAgICAgICAgICAgdGhpcy5ob3N0SW5kZXgrKzsNCiAgICAgICAgICAgIHRoaXMuX2RvQ29ubmVjdCh0aGlzLmNvbm5lY3RPcHRpb25zLmhvc3RzW3RoaXMuaG9zdEluZGV4XSwgdGhpcy5jb25uZWN0T3B0aW9ucy5wb3J0c1t0aGlzLmhvc3RJbmRleF0pOw0KDQogICAgICAgIH0gZWxzZSB7DQoNCiAgICAgICAgICAgIGlmIChlcnJvckNvZGUgPT09IHVuZGVmaW5lZCkgew0KICAgICAgICAgICAgICAgIGVycm9yQ29kZSA9IEVSUk9SLk9LLmNvZGU7DQogICAgICAgICAgICAgICAgZXJyb3JUZXh0ID0gZm9ybWF0KEVSUk9SLk9LKTsNCiAgICAgICAgICAgIH0NCg0KICAgICAgICAgICAgLy8gUnVuIGFueSBhcHBsaWNhdGlvbiBjYWxsYmFja3MgbGFzdCBhcyB0aGV5IG1heSBhdHRlbXB0IHRvIHJlY29ubmVjdCBhbmQgaGVuY2UgY3JlYXRlIGEgbmV3IHNvY2tldC4NCiAgICAgICAgICAgIGlmICh0aGlzLmNvbm5lY3RlZCkgew0KICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdGVkID0gZmFsc2U7DQogICAgICAgICAgICAgICAgLy8gRXhlY3V0ZSB0aGUgY29ubmVjdGlvbkxvc3RDYWxsYmFjayBpZiB0aGVyZSBpcyBvbmUsIGFuZCB3ZSB3ZXJlIGNvbm5lY3RlZC4gICAgICAgDQogICAgICAgICAgICAgICAgaWYgKHRoaXMub25Db25uZWN0aW9uTG9zdCkNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5vbkNvbm5lY3Rpb25Mb3N0KHtlcnJvckNvZGU6IGVycm9yQ29kZSwgZXJyb3JNZXNzYWdlOiBlcnJvclRleHR9KTsNCiAgICAgICAgICAgIH0gZWxzZSB7DQogICAgICAgICAgICAgICAgLy8gT3RoZXJ3aXNlIHdlIG5ldmVyIGhhZCBhIGNvbm5lY3Rpb24sIHNvIGluZGljYXRlIHRoYXQgdGhlIGNvbm5lY3QgaGFzIGZhaWxlZC4NCiAgICAgICAgICAgICAgICBpZiAodGhpcy5jb25uZWN0T3B0aW9ucy5vbkZhaWx1cmUpDQogICAgICAgICAgICAgICAgICAgIHRoaXMuY29ubmVjdE9wdGlvbnMub25GYWlsdXJlKHtpbnZvY2F0aW9uQ29udGV4dDogdGhpcy5jb25uZWN0T3B0aW9ucy5pbnZvY2F0aW9uQ29udGV4dCwgZXJyb3JDb2RlOiBlcnJvckNvZGUsIGVycm9yTWVzc2FnZTogZXJyb3JUZXh0fSk7DQogICAgICAgICAgICB9DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqIEBpZ25vcmUgKi8NCiAgICBDbGllbnRJbXBsLnByb3RvdHlwZS5fdHJhY2UgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgIGlmICh0aGlzLl90cmFjZUJ1ZmZlciAhPT0gbnVsbCkgew0KICAgICAgICAgICAgZm9yICh2YXIgaSA9IDAsIG1heCA9IGFyZ3VtZW50cy5sZW5ndGg7IGkgPCBtYXg7IGkrKykgew0KICAgICAgICAgICAgICAgIGlmICh0aGlzLl90cmFjZUJ1ZmZlci5sZW5ndGggPT0gdGhpcy5fTUFYX1RSQUNFX0VOVFJJRVMpIHsNCiAgICAgICAgICAgICAgICAgICAgdGhpcy5fdHJhY2VCdWZmZXIuc2hpZnQoKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICAgICAgaWYgKGkgPT09IDApIHRoaXMuX3RyYWNlQnVmZmVyLnB1c2goYXJndW1lbnRzW2ldKTsNCiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlb2YgYXJndW1lbnRzW2ldID09PSAidW5kZWZpbmVkIikgdGhpcy5fdHJhY2VCdWZmZXIucHVzaChhcmd1bWVudHNbaV0pOw0KICAgICAgICAgICAgICAgIGVsc2UgdGhpcy5fdHJhY2VCdWZmZXIucHVzaCgiICAiICsgSlNPTi5zdHJpbmdpZnkoYXJndW1lbnRzW2ldKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICA7DQogICAgICAgIH0NCiAgICAgICAgOw0KICAgIH07DQoNCiAgICAvKiogQGlnbm9yZSAqLw0KICAgIENsaWVudEltcGwucHJvdG90eXBlLl90cmFjZU1hc2sgPSBmdW5jdGlvbiAodHJhY2VPYmplY3QsIG1hc2tlZCkgew0KICAgICAgICB2YXIgdHJhY2VPYmplY3RNYXNrZWQgPSB7fTsNCiAgICAgICAgZm9yICh2YXIgYXR0ciBpbiB0cmFjZU9iamVjdCkgew0KICAgICAgICAgICAgaWYgKHRyYWNlT2JqZWN0Lmhhc093blByb3BlcnR5KGF0dHIpKSB7DQogICAgICAgICAgICAgICAgaWYgKGF0dHIgPT0gbWFza2VkKQ0KICAgICAgICAgICAgICAgICAgICB0cmFjZU9iamVjdE1hc2tlZFthdHRyXSA9ICIqKioqKioiOw0KICAgICAgICAgICAgICAgIGVsc2UNCiAgICAgICAgICAgICAgICAgICAgdHJhY2VPYmplY3RNYXNrZWRbYXR0cl0gPSB0cmFjZU9iamVjdFthdHRyXTsNCiAgICAgICAgICAgIH0NCiAgICAgICAgfQ0KICAgICAgICByZXR1cm4gdHJhY2VPYmplY3RNYXNrZWQ7DQogICAgfTsNCg0KICAgIC8vIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLQ0KICAgIC8vIFB1YmxpYyBQcm9ncmFtbWluZyBpbnRlcmZhY2UuDQogICAgLy8gLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tDQoNCiAgICAvKioNCiAgICAgKiBUaGUgSmF2YVNjcmlwdCBhcHBsaWNhdGlvbiBjb21tdW5pY2F0ZXMgdG8gdGhlIHNlcnZlciB1c2luZyBhIE1lc3NhZ2luZy5DbGllbnQgb2JqZWN0Lg0KICAgICAqIDxwPg0KICAgICAqIE90aGVyIHByb2dyYW1taW5nIGxhbmd1YWdlcywNCiAgICAgKiA8YSBocmVmPSIvY2xpZW50cy9qYXZhL2RvYy9qYXZhZG9jL2NvbS9pYm0vbWljcm8vY2xpZW50L21xdHR2My9NcXR0Q2xpZW50Lmh0bWwiPjxiaWc-SmF2YTwvYmlnPjwvYT4sDQogICAgICogPGEgaHJlZj0iL2NsaWVudHMvYy9kb2MvaHRtbC9pbmRleC5odG1sIj48YmlnPkM8L2JpZz48L2E-Lg0KICAgICAqIDxwPg0KICAgICAqIE1vc3QgYXBwbGljYXRpb25zIHdpbGwgY3JlYXRlIGp1c3Qgb25lIENsaWVudCBvYmplY3QgYW5kIHRoZW4gY2FsbCBpdHMgY29ubmVjdCgpIG1ldGhvZCwNCiAgICAgKiBob3dldmVyIGFwcGxpY2F0aW9ucyBjYW4gY3JlYXRlIG1vcmUgdGhhbiBvbmUgQ2xpZW50IG9iamVjdCBpZiB0aGV5IHdpc2guDQogICAgICogSW4gdGhpcyBjYXNlIHRoZSBjb21iaW5hdGlvbiBvZiBob3N0LCBwb3J0IGFuZCBjbGllbnRJZCBhdHRyaWJ1dGVzIG11c3QgYmUgZGlmZmVyZW50IGZvciBlYWNoIENsaWVudCBvYmplY3QuDQogICAgICogPHA-DQogICAgICogVGhlIHNlbmQsIHN1YnNjcmliZSBhbmQgdW5zdWJzY3JpYmUgbWV0aG9kcyBhcmUgaW1wbGVtZW50ZWQgYXMgYXN5bmNocm9ub3VzIEphdmFTY3JpcHQgbWV0aG9kcw0KICAgICAqIChldmVuIHRob3VnaCB0aGUgdW5kZXJseWluZyBwcm90b2NvbCBleGNoYW5nZSBtaWdodCBiZSBzeW5jaHJvbm91cyBpbiBuYXR1cmUpLg0KICAgICAqIFRoaXMgbWVhbnMgdGhleSBzaWduYWwgdGhlaXIgY29tcGxldGlvbiBieSBjYWxsaW5nIGJhY2sgdG8gdGhlIGFwcGxpY2F0aW9uLA0KICAgICAqIHZpYSBTdWNjZXNzIG9yIEZhaWx1cmUgY2FsbGJhY2sgZnVuY3Rpb25zIHByb3ZpZGVkIGJ5IHRoZSBhcHBsaWNhdGlvbiBvbiB0aGUgbWV0aG9kIGluIHF1ZXN0aW9uLg0KICAgICAqIFN1Y2ggY2FsbGJhY2tzIGFyZSBjYWxsZWQgYXQgbW9zdCBvbmNlIHBlciBtZXRob2QgaW52b2NhdGlvbiBhbmQgZG8gbm90IHBlcnNpc3QgYmV5b25kIHRoZSBsaWZldGltZQ0KICAgICAqIG9mIHRoZSBzY3JpcHQgdGhhdCBtYWRlIHRoZSBpbnZvY2F0aW9uLg0KICAgICAqIDxwPg0KICAgICAqIEluIGNvbnRyYXN0IHRoZXJlIGFyZSBzb21lIGNhbGxiYWNrIGZ1bmN0aW9ucyA8aT4gbW9zdCBub3RhYmx5IG9uTWVzc2FnZUFycml2ZWQ8L2k-DQogICAgICogdGhhdCBhcmUgZGVmaW5lZCBvbiB0aGUgTWVzc2FnaW5nLkNsaWVudCBvYmplY3QuDQogICAgICogVGhlc2UgbWF5IGdldCBjYWxsZWQgbXVsdGlwbGUgdGltZXMsIGFuZCBhcmVuJ3QgZGlyZWN0bHkgcmVsYXRlZCB0byBzcGVjaWZpYyBtZXRob2QgaW52b2NhdGlvbnMgbWFkZSBieSB0aGUgY2xpZW50Lg0KICAgICAqDQogICAgICogQG5hbWUgTWVzc2FnaW5nLkNsaWVudA0KICAgICAqDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQ3JlYXRlcyBhIE1lc3NhZ2luZy5DbGllbnQgb2JqZWN0IHRoYXQgY2FuIGJlIHVzZWQgdG8gY29tbXVuaWNhdGUgd2l0aCBhIE1lc3NhZ2luZyBzZXJ2ZXIuDQogICAgICoNCiAgICAgKiBAcGFyYW0ge3N0cmluZ30gaG9zdCB0aGUgYWRkcmVzcyBvZiB0aGUgbWVzc2FnaW5nIHNlcnZlciwgYXMgYSBETlMgbmFtZSBvciBkb3R0ZWQgZGVjaW1hbCBJUCBhZGRyZXNzLg0KICAgICAqIEBwYXJhbSB7bnVtYmVyfSBwb3J0IHRoZSBwb3J0IG51bWJlciBpbiB0aGUgaG9zdCB0byBjb25uZWN0IHRvLg0KICAgICAqIEBwYXJhbSB7c3RyaW5nfSBjbGllbnRJZCB0aGUgTWVzc2FnaW5nIGNsaWVudCBpZGVudGlmaWVyLCBiZXR3ZWVuIDEgYW5kIDIzIGNoYXJhY3RlcnMgaW4gbGVuZ3RoLg0KICAgICAqDQogICAgICogQHByb3BlcnR5IHtzdHJpbmd9IGhvc3QgPGk-cmVhZCBvbmx5PC9pPiB0aGUgc2VydmVyJ3MgRE5TIGhvc3RuYW1lIG9yIGRvdHRlZCBkZWNpbWFsIElQIGFkZHJlc3MuDQogICAgICogQHByb3BlcnR5IHtudW1iZXJ9IHBvcnQgPGk-cmVhZCBvbmx5PC9pPiB0aGUgc2VydmVyJ3MgcG9ydC4NCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gY2xpZW50SWQgPGk-cmVhZCBvbmx5PC9pPiB1c2VkIHdoZW4gY29ubmVjdGluZyB0byB0aGUgc2VydmVyLg0KICAgICAqIEBwcm9wZXJ0eSB7ZnVuY3Rpb259IG9uQ29ubmVjdGlvbkxvc3QgY2FsbGVkIHdoZW4gYSBjb25uZWN0aW9uIGhhcyBiZWVuIGxvc3QsDQogICAgICogYWZ0ZXIgYSBjb25uZWN0KCkgbWV0aG9kIGhhcyBzdWNjZWVkZWQuDQogICAgICogRXN0YWJsaXNoIHRoZSBjYWxsIGJhY2sgdXNlZCB3aGVuIGEgY29ubmVjdGlvbiBoYXMgYmVlbiBsb3N0LiBUaGUgY29ubmVjdGlvbiBtYXkgYmUNCiAgICAgKiBsb3N0IGJlY2F1c2UgdGhlIGNsaWVudCBpbml0aWF0ZXMgYSBkaXNjb25uZWN0IG9yIGJlY2F1c2UgdGhlIHNlcnZlciBvciBuZXR3b3JrDQogICAgICogY2F1c2UgdGhlIGNsaWVudCB0byBiZSBkaXNjb25uZWN0ZWQuIFRoZSBkaXNjb25uZWN0IGNhbGwgYmFjayBtYXkgYmUgY2FsbGVkIHdpdGhvdXQNCiAgICAgKiB0aGUgY29ubmVjdGlvbkNvbXBsZXRlIGNhbGwgYmFjayBiZWluZyBpbnZva2VkIGlmLCBmb3IgZXhhbXBsZSB0aGUgY2xpZW50IGZhaWxzIHRvDQogICAgICogY29ubmVjdC4NCiAgICAgKiBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25Db25uZWN0aW9uTG9zdCBjYWxsYmFjayBjb250YWluaW5nIHRoZSBmb2xsb3dpbmcgZmllbGRzOg0KICAgICAqIDxvbD4NCiAgICAgKiA8bGk-ZXJyb3JDb2RlDQogICAgICogPGxpPmVycm9yTWVzc2FnZQ0KICAgICAqIDwvb2w-DQogICAgICogQHByb3BlcnR5IHtmdW5jdGlvbn0gb25NZXNzYWdlRGVsaXZlcmVkIGNhbGxlZCB3aGVuIGEgbWVzc2FnZSBoYXMgYmVlbiBkZWxpdmVyZWQuDQogICAgICogQWxsIHByb2Nlc3NpbmcgdGhhdCB0aGlzIENsaWVudCB3aWxsIGV2ZXIgZG8gaGFzIGJlZW4gY29tcGxldGVkLiBTbywgZm9yIGV4YW1wbGUsDQogICAgICogaW4gdGhlIGNhc2Ugb2YgYSBRb3M9MiBtZXNzYWdlIHNlbnQgYnkgdGhpcyBjbGllbnQsIHRoZSBQdWJDb21wIGZsb3cgaGFzIGJlZW4gcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyDQogICAgICogYW5kIHRoZSBtZXNzYWdlIGhhcyBiZWVuIHJlbW92ZWQgZnJvbSBwZXJzaXN0ZW50IHN0b3JhZ2UgYmVmb3JlIHRoaXMgY2FsbGJhY2sgaXMgaW52b2tlZC4NCiAgICAgKiBQYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgb25NZXNzYWdlRGVsaXZlcmVkIGNhbGxiYWNrIGFyZToNCiAgICAgKiA8b2w-DQogICAgICogPGxpPk1lc3NhZ2luZy5NZXNzYWdlIHRoYXQgd2FzIGRlbGl2ZXJlZC4NCiAgICAgKiA8L29sPg0KICAgICAqIEBwcm9wZXJ0eSB7ZnVuY3Rpb259IG9uTWVzc2FnZUFycml2ZWQgY2FsbGVkIHdoZW4gYSBtZXNzYWdlIGhhcyBhcnJpdmVkIGluIHRoaXMgTWVzc2FnaW5nLmNsaWVudC4NCiAgICAgKiBQYXJhbWV0ZXJzIHBhc3NlZCB0byB0aGUgb25NZXNzYWdlQXJyaXZlZCBjYWxsYmFjayBhcmU6DQogICAgICogPG9sPg0KICAgICAqIDxsaT5NZXNzYWdpbmcuTWVzc2FnZSB0aGF0IGhhcyBhcnJpdmVkLg0KICAgICAqIDwvb2w-DQogICAgICovDQogICAgdmFyIENsaWVudCA9IGZ1bmN0aW9uIChob3N0LCBwb3J0LCBjbGllbnRJZCkgew0KICAgICAgICBpZiAodHlwZW9mIGhvc3QgIT09ICJzdHJpbmciKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFt0eXBlb2YgaG9zdCwgImhvc3QiXSkpOw0KICAgICAgICBpZiAodHlwZW9mIHBvcnQgIT09ICJudW1iZXIiIHx8IHBvcnQgPCAwKQ0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFt0eXBlb2YgcG9ydCwgInBvcnQiXSkpOw0KDQogICAgICAgIHZhciBjbGllbnRJZExlbmd0aCA9IDA7DQogICAgICAgIGZvciAodmFyIGkgPSAwOyBpIDwgY2xpZW50SWQubGVuZ3RoOyBpKyspIHsNCiAgICAgICAgICAgIHZhciBjaGFyQ29kZSA9IGNsaWVudElkLmNoYXJDb2RlQXQoaSk7DQogICAgICAgICAgICBpZiAoMHhEODAwIDw9IGNoYXJDb2RlICYmIGNoYXJDb2RlIDw9IDB4REJGRikgew0KICAgICAgICAgICAgICAgIGkrKzsgLy8gU3Vycm9nYXRlIHBhaXIuDQogICAgICAgICAgICB9DQogICAgICAgICAgICBjbGllbnRJZExlbmd0aCsrOw0KICAgICAgICB9DQogICAgICAgIGlmICh0eXBlb2YgY2xpZW50SWQgIT09ICJzdHJpbmciIHx8IGNsaWVudElkTGVuZ3RoIDwgMSB8IGNsaWVudElkTGVuZ3RoID4gMjMpDQogICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtjbGllbnRJZCwgImNsaWVudElkIl0pKTsNCg0KICAgICAgICB2YXIgY2xpZW50ID0gbmV3IENsaWVudEltcGwoaG9zdCwgcG9ydCwgY2xpZW50SWQpOw0KICAgICAgICB0aGlzLl9nZXRIb3N0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5ob3N0Ow0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLl9zZXRIb3N0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRF9PUEVSQVRJT04pKTsNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLl9nZXRQb3J0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5wb3J0Ow0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLl9zZXRQb3J0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRF9PUEVSQVRJT04pKTsNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLl9nZXRDbGllbnRJZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiBjbGllbnQuY2xpZW50SWQ7DQogICAgICAgIH07DQogICAgICAgIHRoaXMuX3NldENsaWVudElkID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5VTlNVUFBPUlRFRF9PUEVSQVRJT04pKTsNCiAgICAgICAgfTsNCg0KICAgICAgICB0aGlzLl9nZXRPbkNvbm5lY3Rpb25Mb3N0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5vbkNvbm5lY3Rpb25Mb3N0Ow0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLl9zZXRPbkNvbm5lY3Rpb25Mb3N0ID0gZnVuY3Rpb24gKG5ld09uQ29ubmVjdGlvbkxvc3QpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3T25Db25uZWN0aW9uTG9zdCA9PT0gImZ1bmN0aW9uIikNCiAgICAgICAgICAgICAgICBjbGllbnQub25Db25uZWN0aW9uTG9zdCA9IG5ld09uQ29ubmVjdGlvbkxvc3Q7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFt0eXBlb2YgbmV3T25Db25uZWN0aW9uTG9zdCwgIm9uQ29ubmVjdGlvbkxvc3QiXSkpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHRoaXMuX2dldE9uTWVzc2FnZURlbGl2ZXJlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiBjbGllbnQub25NZXNzYWdlRGVsaXZlcmVkOw0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLl9zZXRPbk1lc3NhZ2VEZWxpdmVyZWQgPSBmdW5jdGlvbiAobmV3T25NZXNzYWdlRGVsaXZlcmVkKSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIG5ld09uTWVzc2FnZURlbGl2ZXJlZCA9PT0gImZ1bmN0aW9uIikNCiAgICAgICAgICAgICAgICBjbGllbnQub25NZXNzYWdlRGVsaXZlcmVkID0gbmV3T25NZXNzYWdlRGVsaXZlcmVkOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9UWVBFLCBbdHlwZW9mIG5ld09uTWVzc2FnZURlbGl2ZXJlZCwgIm9uTWVzc2FnZURlbGl2ZXJlZCJdKSk7DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5fZ2V0T25NZXNzYWdlQXJyaXZlZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiBjbGllbnQub25NZXNzYWdlQXJyaXZlZDsNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5fc2V0T25NZXNzYWdlQXJyaXZlZCA9IGZ1bmN0aW9uIChuZXdPbk1lc3NhZ2VBcnJpdmVkKSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIG5ld09uTWVzc2FnZUFycml2ZWQgPT09ICJmdW5jdGlvbiIpDQogICAgICAgICAgICAgICAgY2xpZW50Lm9uTWVzc2FnZUFycml2ZWQgPSBuZXdPbk1lc3NhZ2VBcnJpdmVkOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9UWVBFLCBbdHlwZW9mIG5ld09uTWVzc2FnZUFycml2ZWQsICJvbk1lc3NhZ2VBcnJpdmVkIl0pKTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogQ29ubmVjdCB0aGlzIE1lc3NhZ2luZyBjbGllbnQgdG8gaXRzIHNlcnZlci4NCiAgICAgICAgICoNCiAgICAgICAgICogQG5hbWUgTWVzc2FnaW5nLkNsaWVudCNjb25uZWN0DQogICAgICAgICAqIEBmdW5jdGlvbg0KICAgICAgICAgKiBAcGFyYW0ge09iamVjdH0gW2Nvbm5lY3RPcHRpb25zXSBhdHRyaWJ1dGVzIHVzZWQgd2l0aCB0aGUgY29ubmVjdGlvbi4NCiAgICAgICAgICogPHA-DQogICAgICAgICAqIFByb3BlcnRpZXMgb2YgdGhlIGNvbm5lY3Qgb3B0aW9ucyBhcmU6DQogICAgICAgICAqIEBjb25maWcge251bWJlcn0gW3RpbWVvdXRdIElmIHRoZSBjb25uZWN0IGhhcyBub3Qgc3VjY2VlZGVkIHdpdGhpbiB0aGlzIG51bWJlciBvZiBzZWNvbmRzLCBpdCBpcyBkZWVtZWQgdG8gaGF2ZSBmYWlsZWQuDQogICAgICAgICAqICAgICAgICAgICAgICAgICAgICAgICAgICAgIFRoZSBkZWZhdWx0IGlzIDMwIHNlY29uZHMuDQogICAgICAgICAqIEBjb25maWcge3N0cmluZ30gW3VzZXJOYW1lXSBBdXRoZW50aWNhdGlvbiB1c2VybmFtZSBmb3IgdGhpcyBjb25uZWN0aW9uLg0KICAgICAgICAgKiBAY29uZmlnIHtzdHJpbmd9IFtwYXNzd29yZF0gQXV0aGVudGljYXRpb24gcGFzc3dvcmQgZm9yIHRoaXMgY29ubmVjdGlvbi4NCiAgICAgICAgICogQGNvbmZpZyB7TWVzc2FnaW5nLk1lc3NhZ2V9IFt3aWxsTWVzc2FnZV0gc2VudCBieSB0aGUgc2VydmVyIHdoZW4gdGhlIGNsaWVudCBkaXNjb25uZWN0cyBhYm5vcm1hbGx5Lg0KICAgICAgICAgKiBAY29uZmlnIHtOdW1iZXJ9IFtrZWVwQWxpdmVJbnRlcnZhbF0gdGhlIHNlcnZlciBkaXNjb25uZWN0cyB0aGlzIGNsaWVudCBpZiB0aGVyZSBpcyBubyBhY3Rpdml0eSBmb3IgdGhpcw0KICAgICAgICAgKiAgICAgICAgICAgICAgICBudW1iZXIgb2Ygc2Vjb25kcy4gVGhlIGRlZmF1bHQgdmFsdWUgb2YgNjAgc2Vjb25kcyBpcyBhc3N1bWVkIGlmIG5vdCBzZXQuDQogICAgICAgICAqIEBjb25maWcge2Jvb2xlYW59IFtjbGVhblNlc3Npb25dIGlmIHRydWUoZGVmYXVsdCkgdGhlIGNsaWVudCBhbmQgc2VydmVyIHBlcnNpc3RlbnQgc3RhdGUgaXMgZGVsZXRlZCBvbiBzdWNjZXNzZnVsIGNvbm5lY3QuDQogICAgICAgICAqIEBjb25maWcge2Jvb2xlYW59IFt1c2VTU0xdIGlmIHByZXNlbnQgYW5kIHRydWUsIHVzZSBhbiBTU0wgV2Vic29ja2V0IGNvbm5lY3Rpb24uDQogICAgICAgICAqIEBjb25maWcge29iamVjdH0gW2ludm9jYXRpb25Db250ZXh0XSBwYXNzZWQgdG8gdGhlIG9uU3VjY2VzcyBjYWxsYmFjayBvciBvbkZhaWx1cmUgY2FsbGJhY2suDQogICAgICAgICAqIEBjb25maWcge2Z1bmN0aW9ufSBbb25TdWNjZXNzXSBjYWxsZWQgd2hlbiB0aGUgY29ubmVjdCBhY2tub3dsZWRnZW1lbnQgaGFzIGJlZW4gcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyLg0KICAgICAgICAgKiBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25TdWNjZXNzIGNhbGxiYWNrIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBmaWVsZHM6DQogICAgICAgICAqIDxvbD4NCiAgICAgICAgICogPGxpPmludm9jYXRpb25Db250ZXh0IGFzIHBhc3NlZCBpbiB0byB0aGUgb25TdWNjZXNzIG1ldGhvZCBpbiB0aGUgY29ubmVjdE9wdGlvbnMuDQogICAgICAgICAqIDwvb2w-DQogICAgICAgICAqIEBjb25maWcge2Z1bmN0aW9ufSBbb25GYWlsdXJlXSBjYWxsZWQgd2hlbiB0aGUgY29ubmVjdCByZXF1ZXN0IGhhcyBmYWlsZWQgb3IgdGltZWQgb3V0Lg0KICAgICAgICAgKiBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25GYWlsdXJlIGNhbGxiYWNrIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBmaWVsZHM6DQogICAgICAgICAqIDxvbD4NCiAgICAgICAgICogPGxpPmludm9jYXRpb25Db250ZXh0IGFzIHBhc3NlZCBpbiB0byB0aGUgb25GYWlsdXJlIG1ldGhvZCBpbiB0aGUgY29ubmVjdE9wdGlvbnMuDQogICAgICAgICAqIDxsaT5lcnJvckNvZGUgYSBudW1iZXIgaW5kaWNhdGluZyB0aGUgbmF0dXJlIG9mIHRoZSBlcnJvci4NCiAgICAgICAgICogPGxpPmVycm9yTWVzc2FnZSB0ZXh0IGRlc2NyaWJpbmcgdGhlIGVycm9yLg0KICAgICAgICAgKiA8L29sPg0KICAgICAgICAgKiBAY29uZmlnIHtBcnJheX0gW2hvc3RzXSBJZiBwcmVzZW50IHRoaXMgc2V0IG9mIGhvc3RuYW1lcyBpcyB0cmllZCBpbiBvcmRlciBpbiBwbGFjZQ0KICAgICAgICAgKiBvZiB0aGUgaG9zdCBhbmQgcG9ydCBwYXJhbWF0ZXIgb24gdGhlIGNvbnN0cnV0b3IuIFRoZSBob3N0cyBhbmQgdGhlIG1hdGNoaW5nIHBvcnRzIGFyZSB0cmllZCBvbmUgYXQgYXQgdGltZSBpbiBvcmRlciB1bnRpbA0KICAgICAgICAgKiBvbmUgb2YgdGhlbiBzdWNjZWVkcy4NCiAgICAgICAgICogQGNvbmZpZyB7QXJyYXl9IFtwb3J0c10gSWYgcHJlc2VudCB0aGlzIHNldCBvZiBwb3J0cyBtYXRjaGluZyB0aGUgaG9zdHMuDQogICAgICAgICAqIEB0aHJvd3Mge0ludmFsaWRTdGF0ZX0gaWYgdGhlIGNsaWVudCBpcyBub3QgaW4gZGlzY29ubmVjdGVkIHN0YXRlLiBUaGUgY2xpZW50IG11c3QgaGF2ZSByZWNlaXZlZCBjb25uZWN0aW9uTG9zdA0KICAgICAgICAgKiBvciBkaXNjb25uZWN0ZWQgYmVmb3JlIGNhbGxpbmcgY29ubmVjdCBmb3IgYSBzZWNvbmQgb3Igc3Vic2VxdWVudCB0aW1lLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5jb25uZWN0ID0gZnVuY3Rpb24gKGNvbm5lY3RPcHRpb25zKSB7DQogICAgICAgICAgICBjb25uZWN0T3B0aW9ucyA9IGNvbm5lY3RPcHRpb25zIHx8IHt9Ow0KICAgICAgICAgICAgdmFsaWRhdGUoY29ubmVjdE9wdGlvbnMsIHt0aW1lb3V0OiAibnVtYmVyIiwNCiAgICAgICAgICAgICAgICB1c2VyTmFtZTogInN0cmluZyIsDQogICAgICAgICAgICAgICAgcGFzc3dvcmQ6ICJzdHJpbmciLA0KICAgICAgICAgICAgICAgIHdpbGxNZXNzYWdlOiAib2JqZWN0IiwNCiAgICAgICAgICAgICAgICBrZWVwQWxpdmVJbnRlcnZhbDogIm51bWJlciIsDQogICAgICAgICAgICAgICAgY2xlYW5TZXNzaW9uOiAiYm9vbGVhbiIsDQogICAgICAgICAgICAgICAgdXNlU1NMOiAiYm9vbGVhbiIsDQogICAgICAgICAgICAgICAgaW52b2NhdGlvbkNvbnRleHQ6ICJvYmplY3QiLA0KICAgICAgICAgICAgICAgIG9uU3VjY2VzczogImZ1bmN0aW9uIiwNCiAgICAgICAgICAgICAgICBvbkZhaWx1cmU6ICJmdW5jdGlvbiIsDQogICAgICAgICAgICAgICAgaG9zdHM6ICJvYmplY3QiLA0KICAgICAgICAgICAgICAgIHBvcnRzOiAib2JqZWN0In0pOw0KDQogICAgICAgICAgICAvLyBJZiBubyBrZWVwIGFsaXZlIGludGVydmFsIGlzIHNldCwgYXNzdW1lIDYwIHNlY29uZHMuDQogICAgICAgICAgICBpZiAoY29ubmVjdE9wdGlvbnMua2VlcEFsaXZlSW50ZXJ2YWwgPT09IHVuZGVmaW5lZCkNCiAgICAgICAgICAgICAgICBjb25uZWN0T3B0aW9ucy5rZWVwQWxpdmVJbnRlcnZhbCA9IDYwOw0KDQogICAgICAgICAgICBpZiAoY29ubmVjdE9wdGlvbnMud2lsbE1lc3NhZ2UpIHsNCiAgICAgICAgICAgICAgICBpZiAoIShjb25uZWN0T3B0aW9ucy53aWxsTWVzc2FnZSBpbnN0YW5jZW9mIE1lc3NhZ2UpKQ0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfVFlQRSwgW2Nvbm5lY3RPcHRpb25zLndpbGxNZXNzYWdlLCAiY29ubmVjdE9wdGlvbnMud2lsbE1lc3NhZ2UiXSkpOw0KICAgICAgICAgICAgICAgIC8vIFRoZSB3aWxsIG1lc3NhZ2UgbXVzdCBoYXZlIGEgcGF5bG9hZCB0aGF0IGNhbiBiZSByZXByZXNlbnRlZCBhcyBhIHN0cmluZy4NCiAgICAgICAgICAgICAgICAvLyBDYXVzZSB0aGUgd2lsbE1lc3NhZ2UgdG8gdGhyb3cgYW4gZXhjZXB0aW9uIGlmIHRoaXMgaXMgbm90IHRoZSBjYXNlLg0KICAgICAgICAgICAgICAgIGNvbm5lY3RPcHRpb25zLndpbGxNZXNzYWdlLnN0cmluZ1BheWxvYWQ7DQoNCiAgICAgICAgICAgICAgICBpZiAodHlwZW9mIGNvbm5lY3RPcHRpb25zLndpbGxNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSA9PT0gInVuZGVmaW5lZCIpDQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9UWVBFLCBbdHlwZW9mIGNvbm5lY3RPcHRpb25zLndpbGxNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSwgImNvbm5lY3RPcHRpb25zLndpbGxNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSJdKSk7DQogICAgICAgICAgICB9DQogICAgICAgICAgICBpZiAodHlwZW9mIGNvbm5lY3RPcHRpb25zLmNsZWFuU2Vzc2lvbiA9PT0gInVuZGVmaW5lZCIpDQogICAgICAgICAgICAgICAgY29ubmVjdE9wdGlvbnMuY2xlYW5TZXNzaW9uID0gdHJ1ZTsNCiAgICAgICAgICAgIGlmIChjb25uZWN0T3B0aW9ucy5ob3N0cykgew0KICAgICAgICAgICAgICAgIGlmICghY29ubmVjdE9wdGlvbnMucG9ydHMpDQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2Nvbm5lY3RPcHRpb25zLnBvcnRzLCAiY29ubmVjdE9wdGlvbnMucG9ydHMiXSkpOw0KICAgICAgICAgICAgICAgIGlmICghKGNvbm5lY3RPcHRpb25zLmhvc3RzIGluc3RhbmNlb2YgQXJyYXkpKQ0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtjb25uZWN0T3B0aW9ucy5ob3N0cywgImNvbm5lY3RPcHRpb25zLmhvc3RzIl0pKTsNCiAgICAgICAgICAgICAgICBpZiAoIShjb25uZWN0T3B0aW9ucy5wb3J0cyBpbnN0YW5jZW9mIEFycmF5KSkNCiAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX0FSR1VNRU5ULCBbY29ubmVjdE9wdGlvbnMucG9ydHMsICJjb25uZWN0T3B0aW9ucy5wb3J0cyJdKSk7DQogICAgICAgICAgICAgICAgaWYgKGNvbm5lY3RPcHRpb25zLmhvc3RzLmxlbmd0aCA8IDEpDQogICAgICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW2Nvbm5lY3RPcHRpb25zLmhvc3RzLCAiY29ubmVjdE9wdGlvbnMuaG9zdHMiXSkpOw0KICAgICAgICAgICAgICAgIGlmIChjb25uZWN0T3B0aW9ucy5ob3N0cy5sZW5ndGggIT0gY29ubmVjdE9wdGlvbnMucG9ydHMubGVuZ3RoKQ0KICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoZm9ybWF0KEVSUk9SLklOVkFMSURfQVJHVU1FTlQsIFtjb25uZWN0T3B0aW9ucy5wb3J0cywgImNvbm5lY3RPcHRpb25zLnBvcnRzIl0pKTsNCiAgICAgICAgICAgICAgICBmb3IgKHZhciBpID0gMDsgaSA8IGNvbm5lY3RPcHRpb25zLmhvc3RzLmxlbmd0aDsgaSsrKSB7DQogICAgICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgY29ubmVjdE9wdGlvbnMuaG9zdHNbaV0gIT09ICJzdHJpbmciKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFt0eXBlb2YgY29ubmVjdE9wdGlvbnMuaG9zdHNbaV0sICJjb25uZWN0T3B0aW9ucy5ob3N0c1siICsgaSArICJdIl0pKTsNCiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVvZiBjb25uZWN0T3B0aW9ucy5wb3J0c1tpXSAhPT0gIm51bWJlciIgfHwgY29ubmVjdE9wdGlvbnMucG9ydHNbaV0gPCAwKQ0KICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKGZvcm1hdChFUlJPUi5JTlZBTElEX1RZUEUsIFt0eXBlb2YgY29ubmVjdE9wdGlvbnMucG9ydHNbaV0sICJjb25uZWN0T3B0aW9ucy5wb3J0c1siICsgaSArICJdIl0pKTsNCiAgICAgICAgICAgICAgICB9DQogICAgICAgICAgICB9DQoNCiAgICAgICAgICAgIGNsaWVudC5jb25uZWN0KGNvbm5lY3RPcHRpb25zKTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogU3Vic2NyaWJlIGZvciBtZXNzYWdlcywgcmVxdWVzdCByZWNlaXB0IG9mIGEgY29weSBvZiBtZXNzYWdlcyBzZW50IHRvIHRoZSBkZXN0aW5hdGlvbnMgZGVzY3JpYmVkIGJ5IHRoZSBmaWx0ZXIuDQogICAgICAgICAqDQogICAgICAgICAqIEBuYW1lIE1lc3NhZ2luZy5DbGllbnQjc3Vic2NyaWJlDQogICAgICAgICAqIEBmdW5jdGlvbg0KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyIGRlc2NyaWJpbmcgdGhlIGRlc3RpbmF0aW9ucyB0byByZWNlaXZlIG1lc3NhZ2VzIGZyb20uDQogICAgICAgICAqIDxicj4NCiAgICAgICAgICogQHBhcmFtIHtvYmplY3R9IFtzdWJzY3JpYmVPcHRpb25zXSB1c2VkIHRvIGNvbnRyb2wgdGhlIHN1YnNjcmlwdGlvbiwgYXMgZm9sbG93czoNCiAgICAgICAgICogPHA-DQogICAgICAgICAqIEBjb25maWcge251bWJlcn0gW3Fvc10gdGhlIG1haXhpbXVtIHFvcyBvZiBhbnkgcHVibGljYXRpb25zIHNlbnQgYXMgYSByZXN1bHQgb2YgbWFraW5nIHRoaXMgc3Vic2NyaXB0aW9uLg0KICAgICAgICAgKiBAY29uZmlnIHtvYmplY3R9IFtpbnZvY2F0aW9uQ29udGV4dF0gcGFzc2VkIHRvIHRoZSBvblN1Y2Nlc3MgY2FsbGJhY2sgb3Igb25GYWlsdXJlIGNhbGxiYWNrLg0KICAgICAgICAgKiBAY29uZmlnIHtmdW5jdGlvbn0gW29uU3VjY2Vzc10gY2FsbGVkIHdoZW4gdGhlIHN1YnNjcmliZSBhY2tub3dsZWRnZW1lbnQgaGFzIGJlZW4gcmVjZWl2ZWQgZnJvbSB0aGUgc2VydmVyLg0KICAgICAgICAgKiBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25TdWNjZXNzIGNhbGxiYWNrIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBmaWVsZHM6DQogICAgICAgICAqIDxvbD4NCiAgICAgICAgICogPGxpPmludm9jYXRpb25Db250ZXh0IGlmIHNldCBpbiB0aGUgc3Vic2NyaWJlT3B0aW9ucy4NCiAgICAgICAgICogPC9vbD4NCiAgICAgICAgICogQGNvbmZpZyB7ZnVuY3Rpb259IFtvbkZhaWx1cmVdIGNhbGxlZCB3aGVuIHRoZSBzdWJzY3JpYmUgcmVxdWVzdCBoYXMgZmFpbGVkIG9yIHRpbWVkIG91dC4NCiAgICAgICAgICogQSBzaW5nbGUgcmVzcG9uc2Ugb2JqZWN0IHBhcmFtZXRlciBpcyBwYXNzZWQgdG8gdGhlIG9uRmFpbHVyZSBjYWxsYmFjayBjb250YWluaW5nIHRoZSBmb2xsb3dpbmcgZmllbGRzOg0KICAgICAgICAgKiA8b2w-DQogICAgICAgICAqIDxsaT5pbnZvY2F0aW9uQ29udGV4dCBpZiBzZXQgaW4gdGhlIHN1YnNjcmliZU9wdGlvbnMuDQogICAgICAgICAqIDxsaT5lcnJvckNvZGUgYSBudW1iZXIgaW5kaWNhdGluZyB0aGUgbmF0dXJlIG9mIHRoZSBlcnJvci4NCiAgICAgICAgICogPGxpPmVycm9yTWVzc2FnZSB0ZXh0IGRlc2NyaWJpbmcgdGhlIGVycm9yLg0KICAgICAgICAgKiA8L29sPg0KICAgICAgICAgKiBAY29uZmlnIHtudW1iZXJ9IFt0aW1lb3V0XSB3aGljaCBpZiBwcmVzZW50IGRldGVybWluZXMgdGhlIG51bWJlciBvZiBzZWNvbmRzIGFmdGVyIHdoaWNoIHRoZSBvbkZhaWx1cmUgY2FsYmFjayBpcyBjYWxsZWQNCiAgICAgICAgICogdGhlIHByZXNlbmNlIG9mIGEgdGltZW91dCBkb2VzIG5vdCBwcmV2ZW50IHRoZSBvblN1Y2Nlc3MgY2FsbGJhY2sgZnJvbSBiZWluZyBjYWxsZWQgd2hlbiB0aGUgTVFUVCBTdWJhY2sgaXMgZXZlbnR1YWxseSByZWNlaXZlZC4NCiAgICAgICAgICogQHRocm93cyB7SW52YWxpZFN0YXRlfSBpZiB0aGUgY2xpZW50IGlzIG5vdCBpbiBjb25uZWN0ZWQgc3RhdGUuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnN1YnNjcmliZSA9IGZ1bmN0aW9uIChmaWx0ZXIsIHN1YnNjcmliZU9wdGlvbnMpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsdGVyICE9PSAic3RyaW5nIikNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYXJndW1lbnQ6IiArIGZpbHRlcik7DQogICAgICAgICAgICBzdWJzY3JpYmVPcHRpb25zID0gc3Vic2NyaWJlT3B0aW9ucyB8fCB7fTsNCiAgICAgICAgICAgIHZhbGlkYXRlKHN1YnNjcmliZU9wdGlvbnMsIHtxb3M6ICJudW1iZXIiLA0KICAgICAgICAgICAgICAgIGludm9jYXRpb25Db250ZXh0OiAib2JqZWN0IiwNCiAgICAgICAgICAgICAgICBvblN1Y2Nlc3M6ICJmdW5jdGlvbiIsDQogICAgICAgICAgICAgICAgb25GYWlsdXJlOiAiZnVuY3Rpb24iLA0KICAgICAgICAgICAgICAgIHRpbWVvdXQ6ICJudW1iZXIiDQogICAgICAgICAgICB9KTsNCiAgICAgICAgICAgIGlmIChzdWJzY3JpYmVPcHRpb25zLnRpbWVvdXQgJiYgIXN1YnNjcmliZU9wdGlvbnMub25GYWlsdXJlKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigic3Vic2NyaWJlT3B0aW9ucy50aW1lb3V0IHNwZWNpZmllZCB3aXRoIG5vIG9uRmFpbHVyZSBjYWxsYmFjay4iKTsNCiAgICAgICAgICAgIGlmICh0eXBlb2Ygc3Vic2NyaWJlT3B0aW9ucy5xb3MgIT09ICJ1bmRlZmluZWQiDQogICAgICAgICAgICAgICAgJiYgIShzdWJzY3JpYmVPcHRpb25zLnFvcyA9PT0gMCB8fCBzdWJzY3JpYmVPcHRpb25zLnFvcyA9PT0gMSB8fCBzdWJzY3JpYmVPcHRpb25zLnFvcyA9PT0gMiApKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW3N1YnNjcmliZU9wdGlvbnMucW9zLCAic3Vic2NyaWJlT3B0aW9ucy5xb3MiXSkpOw0KICAgICAgICAgICAgY2xpZW50LnN1YnNjcmliZShmaWx0ZXIsIHN1YnNjcmliZU9wdGlvbnMpOw0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBVbnN1YnNjcmliZSBmb3IgbWVzc2FnZXMsIHN0b3AgcmVjZWl2aW5nIG1lc3NhZ2VzIHNlbnQgdG8gZGVzdGluYXRpb25zIGRlc2NyaWJlZCBieSB0aGUgZmlsdGVyLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbmFtZSBNZXNzYWdpbmcuQ2xpZW50I3Vuc3Vic2NyaWJlDQogICAgICAgICAqIEBmdW5jdGlvbg0KICAgICAgICAgKiBAcGFyYW0ge3N0cmluZ30gZmlsdGVyIGRlc2NyaWJpbmcgdGhlIGRlc3RpbmF0aW9ucyB0byByZWNlaXZlIG1lc3NhZ2VzIGZyb20uDQogICAgICAgICAqIEBwYXJhbSB7b2JqZWN0fSBbdW5zdWJzY3JpYmVPcHRpb25zXSB1c2VkIHRvIGNvbnRyb2wgdGhlIHN1YnNjcmlwdGlvbiwgYXMgZm9sbG93czoNCiAgICAgICAgICogPHA-DQogICAgICAgICAqIEBjb25maWcge29iamVjdH0gW2ludm9jYXRpb25Db250ZXh0XSBwYXNzZWQgdG8gdGhlIG9uU3VjY2VzcyBjYWxsYmFjayBvciBvbkZhaWx1cmUgY2FsbGJhY2suDQogICAgICAgICAqIEBjb25maWcge2Z1bmN0aW9ufSBbb25TdWNjZXNzXSBjYWxsZWQgd2hlbiB0aGUgdW5zdWJzY3JpYmUgYWNrbm93bGVkZ2VtZW50IGhhcyBiZWVuIHJlY2VpdmUgZGZyb20gdGhlIHNlcnZlci4NCiAgICAgICAgICogQSBzaW5nbGUgcmVzcG9uc2Ugb2JqZWN0IHBhcmFtZXRlciBpcyBwYXNzZWQgdG8gdGhlIG9uU3VjY2VzcyBjYWxsYmFjayBjb250YWluaW5nIHRoZSBmb2xsb3dpbmcgZmllbGRzOg0KICAgICAgICAgKiA8b2w-DQogICAgICAgICAqIDxsaT5pbnZvY2F0aW9uQ29udGV4dCBpZiBzZXQgaW4gdGhlIHVuc3Vic2NyaWJlT3B0aW9ucy4NCiAgICAgICAgICogPC9vbD4NCiAgICAgICAgICogQGNvbmZpZyB7ZnVuY3Rpb259IFtvbkZhaWx1cmVdIGNhbGxlZCB3aGVuIHRoZSB1bnN1YnNjcmliZSByZXF1ZXN0IGhhcyBmYWlsZWQgb3IgdGltZWQgb3V0Lg0KICAgICAgICAgKiBBIHNpbmdsZSByZXNwb25zZSBvYmplY3QgcGFyYW1ldGVyIGlzIHBhc3NlZCB0byB0aGUgb25GYWlsdXJlIGNhbGxiYWNrIGNvbnRhaW5pbmcgdGhlIGZvbGxvd2luZyBmaWVsZHM6DQogICAgICAgICAqIDxvbD4NCiAgICAgICAgICogPGxpPmludm9jYXRpb25Db250ZXh0IGlmIHNldCBpbiB0aGUgdW5zdWJzY3JpYmVPcHRpb25zLg0KICAgICAgICAgKiA8bGk-ZXJyb3JDb2RlIGEgbnVtYmVyIGluZGljYXRpbmcgdGhlIG5hdHVyZSBvZiB0aGUgZXJyb3IuDQogICAgICAgICAqIDxsaT5lcnJvck1lc3NhZ2UgdGV4dCBkZXNjcmliaW5nIHRoZSBlcnJvci4NCiAgICAgICAgICogPC9vbD4NCiAgICAgICAgICogQGNvbmZpZyB7bnVtYmVyfSBbdGltZW91dF0gd2hpY2ggaWYgcHJlc2VudCBkZXRlcm1pbmVzIHRoZSBudW1iZXIgb2Ygc2Vjb25kcyBhZnRlciB3aGljaCB0aGUgb25GYWlsdXJlIGNhbGxiYWNrIGlzIGNhbGxlZCwgdGhlDQogICAgICAgICAqIHByZXNlbmNlIG9mIGEgdGltZW91dCBkb2VzIG5vdCBwcmV2ZW50IHRoZSBvblN1Y2Nlc3MgY2FsbGJhY2sgZnJvbSBiZWluZyBjYWxsZWQgd2hlbiB0aGUgTVFUVCBVblN1YmFjayBpcyBldmVudHVhbGx5IHJlY2VpdmVkLg0KICAgICAgICAgKiBAdGhyb3dzIHtJbnZhbGlkU3RhdGV9IGlmIHRoZSBjbGllbnQgaXMgbm90IGluIGNvbm5lY3RlZCBzdGF0ZS4NCiAgICAgICAgICovDQogICAgICAgIHRoaXMudW5zdWJzY3JpYmUgPSBmdW5jdGlvbiAoZmlsdGVyLCB1bnN1YnNjcmliZU9wdGlvbnMpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgZmlsdGVyICE9PSAic3RyaW5nIikNCiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoIkludmFsaWQgYXJndW1lbnQ6IiArIGZpbHRlcik7DQogICAgICAgICAgICB1bnN1YnNjcmliZU9wdGlvbnMgPSB1bnN1YnNjcmliZU9wdGlvbnMgfHwge307DQogICAgICAgICAgICB2YWxpZGF0ZSh1bnN1YnNjcmliZU9wdGlvbnMsIHtpbnZvY2F0aW9uQ29udGV4dDogIm9iamVjdCIsDQogICAgICAgICAgICAgICAgb25TdWNjZXNzOiAiZnVuY3Rpb24iLA0KICAgICAgICAgICAgICAgIG9uRmFpbHVyZTogImZ1bmN0aW9uIiwNCiAgICAgICAgICAgICAgICB0aW1lb3V0OiAibnVtYmVyIg0KICAgICAgICAgICAgfSk7DQogICAgICAgICAgICBpZiAodW5zdWJzY3JpYmVPcHRpb25zLnRpbWVvdXQgJiYgIXVuc3Vic2NyaWJlT3B0aW9ucy5vbkZhaWx1cmUpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJ1bnN1YnNjcmliZU9wdGlvbnMudGltZW91dCBzcGVjaWZpZWQgd2l0aCBubyBvbkZhaWx1cmUgY2FsbGJhY2suIik7DQogICAgICAgICAgICBjbGllbnQudW5zdWJzY3JpYmUoZmlsdGVyLCB1bnN1YnNjcmliZU9wdGlvbnMpOw0KICAgICAgICB9Ow0KDQogICAgICAgIC8qKg0KICAgICAgICAgKiBTZW5kIGEgbWVzc2FnZSB0byB0aGUgY29uc3VtZXJzIG9mIHRoZSBkZXN0aW5hdGlvbiBpbiB0aGUgTWVzc2FnZS4NCiAgICAgICAgICoNCiAgICAgICAgICogQG5hbWUgTWVzc2FnaW5nLkNsaWVudCNzZW5kDQogICAgICAgICAqIEBmdW5jdGlvbg0KICAgICAgICAgKiBAcGFyYW0ge01lc3NhZ2luZy5NZXNzYWdlfSBtZXNzYWdlIHRvIHNlbmQuDQoNCiAgICAgICAgICogQHRocm93cyB7SW52YWxpZFN0YXRlfSBpZiB0aGUgY2xpZW50IGlzIG5vdCBpbiBjb25uZWN0ZWQgc3RhdGUuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnNlbmQgPSBmdW5jdGlvbiAobWVzc2FnZSkgew0KICAgICAgICAgICAgaWYgKCEobWVzc2FnZSBpbnN0YW5jZW9mIE1lc3NhZ2UpKQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcigiSW52YWxpZCBhcmd1bWVudDoiICsgdHlwZW9mIG1lc3NhZ2UpOw0KICAgICAgICAgICAgaWYgKHR5cGVvZiBtZXNzYWdlLmRlc3RpbmF0aW9uTmFtZSA9PT0gInVuZGVmaW5lZCIpDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIHBhcmFtZXRlciBNZXNzYWdlLmRlc3RpbmF0aW9uTmFtZToiICsgbWVzc2FnZS5kZXN0aW5hdGlvbk5hbWUpOw0KDQogICAgICAgICAgICBjbGllbnQuc2VuZChtZXNzYWdlKTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogTm9ybWFsIGRpc2Nvbm5lY3Qgb2YgdGhpcyBNZXNzYWdpbmcgY2xpZW50IGZyb20gaXRzIHNlcnZlci4NCiAgICAgICAgICoNCiAgICAgICAgICogQG5hbWUgTWVzc2FnaW5nLkNsaWVudCNkaXNjb25uZWN0DQogICAgICAgICAqIEBmdW5jdGlvbg0KICAgICAgICAgKiBAdGhyb3dzIHtJbnZhbGlkU3RhdGV9IGlmIHRoZSBjbGllbnQgaXMgbm90IGluIGNvbm5lY3RlZCBvciBjb25uZWN0aW5nIHN0YXRlLg0KICAgICAgICAgKi8NCiAgICAgICAgdGhpcy5kaXNjb25uZWN0ID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgY2xpZW50LmRpc2Nvbm5lY3QoKTsNCiAgICAgICAgfTsNCg0KICAgICAgICAvKioNCiAgICAgICAgICogR2V0IHRoZSBjb250ZW50cyBvZiB0aGUgdHJhY2UgbG9nLg0KICAgICAgICAgKg0KICAgICAgICAgKiBAbmFtZSBNZXNzYWdpbmcuQ2xpZW50I2dldFRyYWNlTG9nDQogICAgICAgICAqIEBmdW5jdGlvbg0KICAgICAgICAgKiBAcmV0dXJuIHtPYmplY3RbXX0gdHJhY2VidWZmZXIgY29udGFpbmluZyB0aGUgdGltZSBvcmRlcmVkIHRyYWNlIHJlY29yZHMuDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLmdldFRyYWNlTG9nID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIGNsaWVudC5nZXRUcmFjZUxvZygpOw0KICAgICAgICB9DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFN0YXJ0IHRyYWNpbmcuDQogICAgICAgICAqDQogICAgICAgICAqIEBuYW1lIE1lc3NhZ2luZy5DbGllbnQjc3RhcnRUcmFjZQ0KICAgICAgICAgKiBAZnVuY3Rpb24NCiAgICAgICAgICovDQogICAgICAgIHRoaXMuc3RhcnRUcmFjZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGNsaWVudC5zdGFydFRyYWNlKCk7DQogICAgICAgIH07DQoNCiAgICAgICAgLyoqDQogICAgICAgICAqIFN0b3AgdHJhY2luZy4NCiAgICAgICAgICoNCiAgICAgICAgICogQG5hbWUgTWVzc2FnaW5nLkNsaWVudCNzdG9wVHJhY2UNCiAgICAgICAgICogQGZ1bmN0aW9uDQogICAgICAgICAqLw0KICAgICAgICB0aGlzLnN0b3BUcmFjZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGNsaWVudC5zdG9wVHJhY2UoKTsNCiAgICAgICAgfTsNCiAgICB9Ow0KDQogICAgQ2xpZW50LnByb3RvdHlwZSA9IHsNCiAgICAgICAgZ2V0IGhvc3QoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0SG9zdCgpOw0KICAgICAgICB9LA0KICAgICAgICBzZXQgaG9zdChuZXdIb3N0KSB7DQogICAgICAgICAgICB0aGlzLl9zZXRIb3N0KG5ld0hvc3QpOw0KICAgICAgICB9LA0KDQogICAgICAgIGdldCBwb3J0KCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBvcnQoKTsNCiAgICAgICAgfSwNCiAgICAgICAgc2V0IHBvcnQobmV3UG9ydCkgew0KICAgICAgICAgICAgdGhpcy5fc2V0UG9ydChuZXdQb3J0KTsNCiAgICAgICAgfSwNCg0KICAgICAgICBnZXQgY2xpZW50SWQoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0Q2xpZW50SWQoKTsNCiAgICAgICAgfSwNCiAgICAgICAgc2V0IGNsaWVudElkKG5ld0NsaWVudElkKSB7DQogICAgICAgICAgICB0aGlzLl9zZXRDbGllbnRJZChuZXdDbGllbnRJZCk7DQogICAgICAgIH0sDQoNCiAgICAgICAgZ2V0IG9uQ29ubmVjdGlvbkxvc3QoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0T25Db25uZWN0aW9uTG9zdCgpOw0KICAgICAgICB9LA0KICAgICAgICBzZXQgb25Db25uZWN0aW9uTG9zdChuZXdPbkNvbm5lY3Rpb25Mb3N0KSB7DQogICAgICAgICAgICB0aGlzLl9zZXRPbkNvbm5lY3Rpb25Mb3N0KG5ld09uQ29ubmVjdGlvbkxvc3QpOw0KICAgICAgICB9LA0KDQogICAgICAgIGdldCBvbk1lc3NhZ2VEZWxpdmVyZWQoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0T25NZXNzYWdlRGVsaXZlcmVkKCk7DQogICAgICAgIH0sDQogICAgICAgIHNldCBvbk1lc3NhZ2VEZWxpdmVyZWQobmV3T25NZXNzYWdlRGVsaXZlcmVkKSB7DQogICAgICAgICAgICB0aGlzLl9zZXRPbk1lc3NhZ2VEZWxpdmVyZWQobmV3T25NZXNzYWdlRGVsaXZlcmVkKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBnZXQgb25NZXNzYWdlQXJyaXZlZCgpIHsNCiAgICAgICAgICAgIHJldHVybiB0aGlzLl9nZXRPbk1lc3NhZ2VBcnJpdmVkKCk7DQogICAgICAgIH0sDQogICAgICAgIHNldCBvbk1lc3NhZ2VBcnJpdmVkKG5ld09uTWVzc2FnZUFycml2ZWQpIHsNCiAgICAgICAgICAgIHRoaXMuX3NldE9uTWVzc2FnZUFycml2ZWQobmV3T25NZXNzYWdlQXJyaXZlZCk7DQogICAgICAgIH0NCiAgICB9Ow0KDQogICAgLyoqDQogICAgICogQW4gYXBwbGljYXRpb24gbWVzc2FnZSwgc2VudCBvciByZWNlaXZlZC4NCiAgICAgKiA8cD4NCiAgICAgKiBPdGhlciBwcm9ncmFtbWluZyBsYW5ndWFnZXMsDQogICAgICogPGEgaHJlZj0iL2NsaWVudHMvamF2YS9kb2MvamF2YWRvYy9jb20vaWJtL21pY3JvL2NsaWVudC9tcXR0djMvTXF0dE1lc3NhZ2UuaHRtbCI-PGJpZz5KYXZhPC9iaWc-PC9hPiwNCiAgICAgKiA8YSBocmVmPSIvY2xpZW50cy9jL2RvYy9odG1sL3N0cnVjdF9tX3FfdF90X2NsaWVudF9fbWVzc2FnZS5odG1sIj48YmlnPkM8L2JpZz48L2E-Lg0KICAgICAqIDxwPg0KICAgICAqIEFsbCBhdHRyaWJ1dGVzIG1heSBiZSBudWxsLCB3aGljaCBpbXBsaWVzIHRoZSBkZWZhdWx0IHZhbHVlcy4NCiAgICAgKg0KICAgICAqIEBuYW1lIE1lc3NhZ2luZy5NZXNzYWdlDQogICAgICogQGNvbnN0cnVjdG9yDQogICAgICogQHBhcmFtIHtTdHJpbmd8QXJyYXlCdWZmZXJ9IHBheWxvYWQgVGhlIG1lc3NhZ2UgZGF0YSB0byBiZSBzZW50Lg0KICAgICAqIDxwPg0KICAgICAqIEBwcm9wZXJ0eSB7c3RyaW5nfSBwYXlsb2FkU3RyaW5nIDxpPnJlYWQgb25seTwvaT4gVGhlIHBheWxvYWQgYXMgYSBzdHJpbmcgaWYgdGhlIHBheWxvYWQgY29uc2lzdHMgb2YgdmFsaWQgVVRGLTggY2hhcmFjdGVycy4NCiAgICAgKiBAcHJvcGVydHkge0FycmF5QnVmZmVyfSBwYXlsb2FkQnl0ZXMgPGk-cmVhZCBvbmx5PC9pPiBUaGUgcGF5bG9hZCBhcyBhbiBBcnJheUJ1ZmZlci4NCiAgICAgKiA8cD4NCiAgICAgKiBAcHJvcGVydHkge3N0cmluZ30gZGVzdGluYXRpb25OYW1lIDxiPm1hbmRhdG9yeTwvYj4gVGhlIG5hbWUgb2YgdGhlIGRlc3RpbmF0aW9uIHRvIHdoaWNoIHRoZSBtZXNzYWdlIGlzIHRvIGJlIHNlbnQNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgKGZvciBtZXNzYWdlcyBhYm91dCB0byBiZSBzZW50KSBvciB0aGUgbmFtZSBvZiB0aGUgZGVzdGluYXRpb24gZnJvbSB3aGljaCB0aGUgbWVzc2FnZSBoYXMgYmVlbiByZWNlaXZlZC4NCiAgICAgKiAgICAgICAgICAgICAgICAgICAgKGZvciBtZXNzYWdlcyByZWNlaXZlZCBieSB0aGUgb25NZXNzYWdlIGZ1bmN0aW9uKS4NCiAgICAgKiA8cD4NCiAgICAgKiBAcHJvcGVydHkge251bWJlcn0gcW9zIFRoZSBRdWFsaXR5IG9mIFNlcnZpY2UgdXNlZCB0byBkZWxpdmVyIHRoZSBtZXNzYWdlLg0KICAgICAqIDxkbD4NCiAgICAgKiAgICAgPGR0PjAgQmVzdCBlZmZvcnQgKGRlZmF1bHQpLg0KICAgICAqICAgICA8ZHQ-MSBBdCBsZWFzdCBvbmNlLg0KICAgICAqICAgICA8ZHQ-MiBFeGFjdGx5IG9uY2UuDQogICAgICogPC9kbD4NCiAgICAgKiA8cD4NCiAgICAgKiBAcHJvcGVydHkge0Jvb2xlYW59IHJldGFpbmVkIElmIHRydWUsIHRoZSBtZXNzYWdlIGlzIHRvIGJlIHJldGFpbmVkIGJ5IHRoZSBzZXJ2ZXIgYW5kIGRlbGl2ZXJlZA0KICAgICAqICAgICAgICAgICAgICAgICAgICAgdG8gYm90aCBjdXJyZW50IGFuZCBmdXR1cmUgc3Vic2NyaXB0aW9ucy4NCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIElmIGZhbHNlIHRoZSBzZXJ2ZXIgb25seSBkZWxpdmVycyB0aGUgbWVzc2FnZSB0byBjdXJyZW50IHN1YnNjcmliZXJzLCB0aGlzIGlzIHRoZSBkZWZhdWx0IGZvciBuZXcgTWVzc2FnZXMuDQogICAgICogICAgICAgICAgICAgICAgICAgICBBIHJlY2VpdmVkIG1lc3NhZ2UgaGFzIHRoZSByZXRhaW5lZCBib29sZWFuIHNldCB0byB0cnVlIGlmIHRoZSBtZXNzYWdlIHdhcyBwdWJsaXNoZWQNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIHdpdGggdGhlIHJldGFpbmVkIGJvb2xlYW4gc2V0IHRvIHRydWUNCiAgICAgKiAgICAgICAgICAgICAgICAgICAgIGFuZCB0aGUgc3Vic2NycHRpb24gd2FzIG1hZGUgYWZ0ZXIgdGhlIG1lc3NhZ2UgaGFzIGJlZW4gcHVibGlzaGVkLg0KICAgICAqIDxwPg0KICAgICAqIEBwcm9wZXJ0eSB7Qm9vbGVhbn0gZHVwbGljYXRlIDxpPnJlYWQgb25seTwvaT4gSWYgdHJ1ZSwgdGhpcyBtZXNzYWdlIG1pZ2h0IGJlIGEgZHVwbGljYXRlIG9mIG9uZSB3aGljaCBoYXMgYWxyZWFkeSBiZWVuIHJlY2VpdmVkLg0KICAgICAqICAgICAgICAgICAgICAgICAgICAgVGhpcyBpcyBvbmx5IHNldCBvbiBtZXNzYWdlcyByZWNlaXZlZCBmcm9tIHRoZSBzZXJ2ZXIuDQogICAgICoNCiAgICAgKi8NCiAgICB2YXIgTWVzc2FnZSA9IGZ1bmN0aW9uIChuZXdQYXlsb2FkKSB7DQogICAgICAgIHZhciBwYXlsb2FkOw0KICAgICAgICBpZiAodHlwZW9mIG5ld1BheWxvYWQgPT09ICJzdHJpbmciDQogICAgICAgICAgICB8fCBuZXdQYXlsb2FkIGluc3RhbmNlb2YgQXJyYXlCdWZmZXINCiAgICAgICAgICAgIHx8IG5ld1BheWxvYWQgaW5zdGFuY2VvZiBJbnQ4QXJyYXkNCiAgICAgICAgICAgIHx8IG5ld1BheWxvYWQgaW5zdGFuY2VvZiBVaW50OEFycmF5DQogICAgICAgICAgICB8fCBuZXdQYXlsb2FkIGluc3RhbmNlb2YgSW50MTZBcnJheQ0KICAgICAgICAgICAgfHwgbmV3UGF5bG9hZCBpbnN0YW5jZW9mIFVpbnQxNkFycmF5DQogICAgICAgICAgICB8fCBuZXdQYXlsb2FkIGluc3RhbmNlb2YgSW50MzJBcnJheQ0KICAgICAgICAgICAgfHwgbmV3UGF5bG9hZCBpbnN0YW5jZW9mIFVpbnQzMkFycmF5DQogICAgICAgICAgICB8fCBuZXdQYXlsb2FkIGluc3RhbmNlb2YgRmxvYXQzMkFycmF5DQogICAgICAgICAgICB8fCBuZXdQYXlsb2FkIGluc3RhbmNlb2YgRmxvYXQ2NEFycmF5DQogICAgICAgICAgICApIHsNCiAgICAgICAgICAgIHBheWxvYWQgPSBuZXdQYXlsb2FkOw0KICAgICAgICB9IGVsc2Ugew0KICAgICAgICAgICAgdGhyb3cgKGZvcm1hdChFUlJPUi5JTlZBTElEX0FSR1VNRU5ULCBbbmV3UGF5bG9hZCwgIm5ld1BheWxvYWQiXSkpOw0KICAgICAgICB9DQoNCiAgICAgICAgdGhpcy5fZ2V0UGF5bG9hZFN0cmluZyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgcGF5bG9hZCA9PT0gInN0cmluZyIpDQogICAgICAgICAgICAgICAgcmV0dXJuIHBheWxvYWQ7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgcmV0dXJuIHBhcnNlVVRGOChwYXlsb2FkLCAwLCBwYXlsb2FkLmxlbmd0aCk7DQogICAgICAgIH07DQoNCiAgICAgICAgdGhpcy5fZ2V0UGF5bG9hZEJ5dGVzID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgaWYgKHR5cGVvZiBwYXlsb2FkID09PSAic3RyaW5nIikgew0KICAgICAgICAgICAgICAgIHZhciBidWZmZXIgPSBuZXcgQXJyYXlCdWZmZXIoVVRGOExlbmd0aChwYXlsb2FkKSk7DQogICAgICAgICAgICAgICAgdmFyIGJ5dGVTdHJlYW0gPSBuZXcgVWludDhBcnJheShidWZmZXIpOw0KICAgICAgICAgICAgICAgIHN0cmluZ1RvVVRGOChwYXlsb2FkLCBieXRlU3RyZWFtLCAwKTsNCg0KICAgICAgICAgICAgICAgIHJldHVybiBieXRlU3RyZWFtOw0KICAgICAgICAgICAgfSBlbHNlIHsNCiAgICAgICAgICAgICAgICByZXR1cm4gcGF5bG9hZDsNCiAgICAgICAgICAgIH0NCiAgICAgICAgICAgIDsNCiAgICAgICAgfTsNCg0KICAgICAgICB2YXIgZGVzdGluYXRpb25OYW1lID0gdW5kZWZpbmVkOw0KICAgICAgICB0aGlzLl9nZXREZXN0aW5hdGlvbk5hbWUgPSBmdW5jdGlvbiAoKSB7DQogICAgICAgICAgICByZXR1cm4gZGVzdGluYXRpb25OYW1lOw0KICAgICAgICB9Ow0KICAgICAgICB0aGlzLl9zZXREZXN0aW5hdGlvbk5hbWUgPSBmdW5jdGlvbiAobmV3RGVzdGluYXRpb25OYW1lKSB7DQogICAgICAgICAgICBpZiAodHlwZW9mIG5ld0Rlc3RpbmF0aW9uTmFtZSA9PT0gInN0cmluZyIpDQogICAgICAgICAgICAgICAgZGVzdGluYXRpb25OYW1lID0gbmV3RGVzdGluYXRpb25OYW1lOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW25ld0Rlc3RpbmF0aW9uTmFtZSwgIm5ld0Rlc3RpbmF0aW9uTmFtZSJdKSk7DQogICAgICAgIH07DQoNCiAgICAgICAgdmFyIHFvcyA9IDA7DQogICAgICAgIHRoaXMuX2dldFFvcyA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiBxb3M7DQogICAgICAgIH07DQogICAgICAgIHRoaXMuX3NldFFvcyA9IGZ1bmN0aW9uIChuZXdRb3MpIHsNCiAgICAgICAgICAgIGlmIChuZXdRb3MgPT09IDAgfHwgbmV3UW9zID09PSAxIHx8IG5ld1FvcyA9PT0gMikNCiAgICAgICAgICAgICAgICBxb3MgPSBuZXdRb3M7DQogICAgICAgICAgICBlbHNlDQogICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKCJJbnZhbGlkIGFyZ3VtZW50OiIgKyBuZXdRb3MpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciByZXRhaW5lZCA9IGZhbHNlOw0KICAgICAgICB0aGlzLl9nZXRSZXRhaW5lZCA9IGZ1bmN0aW9uICgpIHsNCiAgICAgICAgICAgIHJldHVybiByZXRhaW5lZDsNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5fc2V0UmV0YWluZWQgPSBmdW5jdGlvbiAobmV3UmV0YWluZWQpIHsNCiAgICAgICAgICAgIGlmICh0eXBlb2YgbmV3UmV0YWluZWQgPT09ICJib29sZWFuIikNCiAgICAgICAgICAgICAgICByZXRhaW5lZCA9IG5ld1JldGFpbmVkOw0KICAgICAgICAgICAgZWxzZQ0KICAgICAgICAgICAgICAgIHRocm93IG5ldyBFcnJvcihmb3JtYXQoRVJST1IuSU5WQUxJRF9BUkdVTUVOVCwgW25ld1JldGFpbmVkLCAibmV3UmV0YWluZWQiXSkpOw0KICAgICAgICB9Ow0KDQogICAgICAgIHZhciBkdXBsaWNhdGUgPSBmYWxzZTsNCiAgICAgICAgdGhpcy5fZ2V0RHVwbGljYXRlID0gZnVuY3Rpb24gKCkgew0KICAgICAgICAgICAgcmV0dXJuIGR1cGxpY2F0ZTsNCiAgICAgICAgfTsNCiAgICAgICAgdGhpcy5fc2V0RHVwbGljYXRlID0gZnVuY3Rpb24gKG5ld0R1cGxpY2F0ZSkgew0KICAgICAgICAgICAgZHVwbGljYXRlID0gbmV3RHVwbGljYXRlOw0KICAgICAgICB9Ow0KICAgIH07DQoNCiAgICBNZXNzYWdlLnByb3RvdHlwZSA9IHsNCiAgICAgICAgZ2V0IHBheWxvYWRTdHJpbmcoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0UGF5bG9hZFN0cmluZygpOw0KICAgICAgICB9LA0KICAgICAgICBnZXQgcGF5bG9hZEJ5dGVzKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFBheWxvYWRCeXRlcygpOw0KICAgICAgICB9LA0KDQogICAgICAgIGdldCBkZXN0aW5hdGlvbk5hbWUoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RGVzdGluYXRpb25OYW1lKCk7DQogICAgICAgIH0sDQogICAgICAgIHNldCBkZXN0aW5hdGlvbk5hbWUobmV3RGVzdGluYXRpb25OYW1lKSB7DQogICAgICAgICAgICB0aGlzLl9zZXREZXN0aW5hdGlvbk5hbWUobmV3RGVzdGluYXRpb25OYW1lKTsNCiAgICAgICAgfSwNCg0KICAgICAgICBnZXQgcW9zKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFFvcygpOw0KICAgICAgICB9LA0KICAgICAgICBzZXQgcW9zKG5ld1Fvcykgew0KICAgICAgICAgICAgdGhpcy5fc2V0UW9zKG5ld1Fvcyk7DQogICAgICAgIH0sDQoNCiAgICAgICAgZ2V0IHJldGFpbmVkKCkgew0KICAgICAgICAgICAgcmV0dXJuIHRoaXMuX2dldFJldGFpbmVkKCk7DQogICAgICAgIH0sDQogICAgICAgIHNldCByZXRhaW5lZChuZXdSZXRhaW5lZCkgew0KICAgICAgICAgICAgdGhpcy5fc2V0UmV0YWluZWQobmV3UmV0YWluZWQpOw0KICAgICAgICB9LA0KDQogICAgICAgIGdldCBkdXBsaWNhdGUoKSB7DQogICAgICAgICAgICByZXR1cm4gdGhpcy5fZ2V0RHVwbGljYXRlKCk7DQogICAgICAgIH0sDQogICAgICAgIHNldCBkdXBsaWNhdGUobmV3RHVwbGljYXRlKSB7DQogICAgICAgICAgICB0aGlzLl9zZXREdXBsaWNhdGUobmV3RHVwbGljYXRlKTsNCiAgICAgICAgfQ0KICAgIH07DQoNCiAgICAvLyBNb2R1bGUgY29udGVudHMuDQogICAgcmV0dXJuIHsNCiAgICAgICAgQ2xpZW50OiBDbGllbnQsDQogICAgICAgIE1lc3NhZ2U6IE1lc3NhZ2UNCiAgICB9Ow0KfSkod2luZG93KTsNCg","oidc_app_instance.js":"d2luZG93Lm9pZGNfYXBwX2luc3RhbmNlID0gY2xhc3Mgb2lkY19hcHBfaW5zdGFuY2Ugew0KICBjb25zdHJ1Y3RvcihhcHBfY29uZmlnX3BhcmFtcywgYXBwX2luc3RhbmNlX3BhcmFtcywgb25XYWxsZXRSZXN1bHQsIG9wdGlvbnMpew0KICAgIHRoaXMub25XYWxsZXRSZXN1bHQgPSBvbldhbGxldFJlc3VsdDsNCiAgICB0aGlzLndhbGxldF91cmw7DQoNCiAgICAvLyBnZXQgb3B0aW9ucyBmcm9tIGNvbW1hbmQgbGluZSBvciBvcHRpb25zDQogICAgdmFyIHVybFBhcmFtZXRlcnMgPSBuZXcgVVJMU2VhcmNoUGFyYW1zKHdpbmRvdy5sb2NhdGlvbi5zZWFyY2gpOw0KICAgIHZhciBzdGFydHVwX2Vycm9yID0gdXJsUGFyYW1ldGVycy5nZXQoJ2Vycm9yJyk7DQogICAgdmFyIGNsZWFyX2Nvb2tpZXMgPSB1cmxQYXJhbWV0ZXJzLmdldCgnY2xlYXJfY29va2llcycpOw0KICAgIC8vIHNob3VsZCBubyBsb25nZXIgYmUgbmVlZGVkDQogICAgLy92YXIgcndsID0gdXJsUGFyYW1ldGVycy5nZXQoJ3J3bCcpOw0KICAgIHZhciByd2w7DQoNCiAgICAvLyBmb3IgaW52b2tpbmcgYSB1cmwgd2UganVzdCB1c2UgdGhlICdyd2wnIHBhcmFtZXRlciByYXRoZXIgdGhhbiBlbmNvZGluZyBpdCBpbiBsaV9wYXJhbWV0ZXJzDQogICAgLy8gYW5kIG9uIHN0YXJ0dXAgbm9ybWFsaXplIGl0IGludG8gbGlfcGFyYW1ldGVycw0KICAgIHRoaXMubGlfcGFyYW1ldGVycyA9IHt9Ow0KICAgIGlmIChyd2wgIT09ICJmYWxzZSIgJiYgcndsICE9PSB1bmRlZmluZWQpew0KICAgICAgdGhpcy5saV9wYXJhbWV0ZXJzLnJ3bCA9IHJ3bDsNCiAgICB9DQoNCiAgICBpZiAob3B0aW9ucyl7DQogICAgICBpZihvcHRpb25zWydzdGFydHVwX2Vycm9yJ10pew0KICAgICAgICBzdGFydHVwX2Vycm9yID0gb3B0aW9uc1snc3RhcnR1cF9lcnJvciddOw0KICAgICAgfQ0KICAgICAgaWYgKG9wdGlvbnNbJ2NsZWFyX2Nvb2tpZXMnXSl7DQogICAgICAgIGNsZWFyX2Nvb2tpZXMgPSBvcHRpb25zWydjbGVhcl9jb29raWVzJ107DQogICAgICB9DQogICAgICBpZiAob3B0aW9uc1snbGlfcGFyYW1ldGVycyddKXsNCiAgICAgICAgaWYgKG9wdGlvbnNbJ2xpX3BhcmFtZXRlcnMnXS5yd2wgPT09IHRydWUpew0KICAgICAgICAgIG9wdGlvbnNbJ2xpX3BhcmFtZXRlcnMnXS5yd2wgPSAndHJ1ZSc7DQogICAgICAgIH0NCiAgICAgICAgdGhpcy5saV9wYXJhbWV0ZXJzID0gb3B0aW9uc1snbGlfcGFyYW1ldGVycyddOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChzdGFydHVwX2Vycm9yKXsNCiAgICAgIGFsZXJ0KCdFcnJvciBzdGFydGluZyB1cDogJyArIHN0YXJ0dXBfZXJyb3IpOw0KICAgICAgcmV0dXJuOw0KICAgIH0gDQoNCiAgICBpZiAoY2xlYXJfY29va2llcyl7DQogICAgICBzaW9wX3JlbW92ZUNvb2tpZXMoKTsNCiAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoJ3sgImNvb2tpZXMiOiAiZGVsZXRlZCIgfScsICcqJyk7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKCFhcHBfY29uZmlnX3BhcmFtcyl7DQogICAgICB0aHJvdygnYXBwX2NvbmZpZ19wYXJhbXMgbXVzdCBiZSBzZXQgaW4gb2lkY19hcHBfaW5zdGFuY2UnKTsNCiAgICB9DQogICAgZWxzZSBpZiAodHlwZW9mIGFwcF9jb25maWdfcGFyYW1zID09PSAnc3RyaW5nJyl7DQogICAgICB2YXIgYXBwX2NvbmZpZ19zdHJpbmcgPSBzaW9wX3ZhbHVlRnJvbUVsZW1lbnRJZChhcHBfY29uZmlnX3BhcmFtcyk7DQogICAgICBpZiAoIWFwcF9jb25maWdfc3RyaW5nKXsNCiAgICAgICAgdGhyb3coJ2FwcF9jb25maWdfcGFyYW1zIGlucHV0IGVsZW1lbnQgWycgKyBhcHBfY29uZmlnX3BhcmFtcyArICddIHdhcyBwcmVzZW50IGJ1dCBubyB2YWx1ZSB3YXMgc2V0IGluIHRoZSBkb2N1bWVudCcpOw0KICAgICAgfQ0KICAgICAgdGhpcy5hcHBfY29uZmlnX3BhcmFtcyA9IEpTT04ucGFyc2UoYXBwX2NvbmZpZ19zdHJpbmcpOw0KICAgIH0NCiAgICBlbHNlew0KICAgICAgdGhpcy5hcHBfY29uZmlnX3BhcmFtcyA9IGFwcF9jb25maWdfcGFyYW1zOw0KICAgIH0NCg0KICAgIGlmICghYXBwX2luc3RhbmNlX3BhcmFtcyl7DQogICAgICB0aHJvdygnYXBwX2luc3RhbmNlX3BhcmFtcyBtdXN0IGJlIHNldCBpbiBvaWRjX2FwcF9pbnN0YW5jZScpOw0KICAgIH0NCiAgICBlbHNlIGlmICh0eXBlb2YgYXBwX2luc3RhbmNlX3BhcmFtcyA9PT0gJ3N0cmluZycpew0KICAgICAgdmFyIGFwcF9pbnN0YW5jZV9wYXJhbV9zdHJpbmcgPSBzaW9wX3ZhbHVlRnJvbUVsZW1lbnRJZChhcHBfaW5zdGFuY2VfcGFyYW1zKTsNCiAgICAgIGlmICghYXBwX2luc3RhbmNlX3BhcmFtX3N0cmluZyl7DQogICAgICAgIHRocm93KCdhcHBfaXNudGFuY2VfcGFyYW1zIGlucHV0IGVsZW1lbnQgWycgKyBhcHBfaW5zdGFuY2VfcGFyYW1zICsgJ10gd2FzIHByZXNlbnQgYnV0IG5vIHZhbHVlIHdhcyBzZXQgaW4gdGhlIGRvY3VtZW50Jyk7DQogICAgICB9DQogICAgICB0aGlzLmFwcF9pbnN0YW5jZV9wYXJhbXMgPSBKU09OLnBhcnNlKGFwcF9pbnN0YW5jZV9wYXJhbV9zdHJpbmcpOw0KICAgIH0NCiAgICBlbHNlew0KICAgICAgdGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zID0gYXBwX2luc3RhbmNlX3BhcmFtczsNCiAgICB9DQoNCiAgICBpZiAodGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zLmxpX3BhcmFtZXRlcnMpew0KICAgICAgdGhpcy5saV9wYXJhbWV0ZXJzID0gdGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zLmxpX3BhcmFtZXRlcnM7DQogICAgfQ0KDQogICAgaWYgKHRoaXMuYXBwX2luc3RhbmNlX3BhcmFtcy5yZXNwb25zZV9tb2RlKXsNCiAgICAgIHRoaXMubGlfcGFyYW1ldGVyc1sncmVzcG9uc2VfbW9kZSddID0gdGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zLnJlc3BvbnNlX21vZGU7DQogICAgfQ0KDQogICAgaWYgKCFvbldhbGxldFJlc3VsdCl7DQogICAgICB0aHJvdygnb25XYWxsZXRSZXN1bHQgbXVzdCBiZSBzZXQgaW4gb2lkY19hcHBfaW5zdGFuY2UnKTsNCiAgICB9DQogIH0NCg0KICBhc3luYyBzdGFydHVwKCl7DQogICAgdGhpcy53YWxsZXRfdXJsID0gYXdhaXQgdGhpcy5nZXRfd2FsbGV0X3VybCgpOw0KICAgIGlmICh0aGlzLndhbGxldF91cmwpew0KICAgICAgdGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zLmlzcyA9IHRoaXMud2FsbGV0X3VybDsNCiAgICB9DQoNCiAgICB2YXIgZGlzY292ZXJ5X2luZm8gPSBhd2FpdCB0aGlzLmdldF9kaXNjb3ZlcnlfaW5mbygpOw0KICAgIGlmIChkaXNjb3ZlcnlfaW5mbyAmJiB0aGlzLm9uV2FsbGV0UmVzdWx0KXsNCiAgICAgIHRoaXMub25XYWxsZXRSZXN1bHQoZGlzY292ZXJ5X2luZm8sIHRoaXMud2FsbGV0X3VybCk7DQogICAgfQ0KICB9DQoNCiAgYXN5bmMgZ2V0X3dhbGxldF91cmwoKXsNCiAgICB2YXIgY3JlZGVudGlhbCA9IHRoaXMuYXBwX2NvbmZpZ19wYXJhbXMuY3JlZGVudGlhbF90eXBlOw0KICAgIGlmICghY3JlZGVudGlhbCl7DQogICAgICBjcmVkZW50aWFsID0gdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5pbnB1dF9jcmVkZW50aWFsX3R5cGU7DQogICAgfQ0KICAgIGlmICghY3JlZGVudGlhbCl7DQogICAgICBhbGVydCgnY29uZmlndXJhdGlvbiBlcnJvcjogY29uZmlnIHJlcXVpcmVzIGVpdGhlciBjcmVkZW50aWFsX3R5cGUgb3IgaW5wdXRfY3JlZGVudGlhbF90eXBlJyk7DQogICAgICB2YXIgZm9vID0gYWJvcnQ7DQogICAgfQ0KDQogICAgLy8gaXMgdGhlcmUgYW4gYXBwIGNvb2tpZQ0KICAgIHZhciB3YWxsZXRVcmwgPSBzaW9wX2dldENvb2tpZSgnd2FsbGV0XycgKyBjcmVkZW50aWFsKTsNCiAgICBpZiAod2FsbGV0VXJsKXsNCiAgICAgIGlmICh3YWxsZXRVcmwgPT09ICJjcmVkZW50aWFsX3JlbW92ZWQiKXsNCiAgICAgICAgd2FsbGV0VXJsID0gdW5kZWZpbmVkOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHdhbGxldFVybDsNCiAgICB9DQoNCiAgICAvLyAgV2UgbmVlZCB0byB1c2Ugc21hcnQgY3JlZGVudGlhbA0KICAgIHRyeXsNCiAgICAgIHZhciB3YWxsZXRfdXJsX3Jlc3BvbnNlX3N0cmluZyA9IGF3YWl0IHRoaXMuZ2V0X3dhbGxldF9mcm9tX1NDKGNyZWRlbnRpYWwpOw0KICAgICAgdmFyIHdhbGxldF91cmxfcmVzcG9uc2UgPSBKU09OLnBhcnNlKHdhbGxldF91cmxfcmVzcG9uc2Vfc3RyaW5nKTsNCiAgICAgIHdhbGxldFVybCA9IHdhbGxldF91cmxfcmVzcG9uc2Uud2FsbGV0Ow0KICAgICAgaWYgKHdhbGxldFVybCA9PT0gJ24vYScpew0KICAgICAgICB3YWxsZXRVcmwgPSB1bmRlZmluZWQ7DQogICAgICB9DQogICAgICBlbHNlew0KICAgICAgICBzaW9wX3NldENvb2tpZSgnd2FsbGV0XycgKyBjcmVkZW50aWFsLCB3YWxsZXRVcmwsIDEwLCAnLycpOw0KICAgICAgfQ0KICAgICAgcmV0dXJuIHdhbGxldFVybDsNCiAgICB9DQogICAgY2F0Y2goZXJyKXsNCiAgICAgIHdpbmRvdy5sb2NhdGlvbiA9IGFwcGVuZFVSSUNvbXBvbmVudCh0aGlzLmFwcF9pbnN0YW5jZV9wYXJhbXMud2FsbGV0X2Vycm9yX3VybCwgJ2Vycm9yPScgKyBlcnIpOw0KICAgIH0NCiAgfQ0KDQogIGFzeW5jIGdldF93YWxsZXRfZnJvbV9TQyhjcmVkZW50aWFsKXsNCiAgICByZXR1cm4gYXdhaXQgc2lvcF9yZWFkX3JlbW90ZV9jb29raWUoY3JlZGVudGlhbCArICIvd2FsbGV0Iik7DQogIH0NCg0KICBhc3luYyBnZXRfaXNzdWVyX2NyZWRlbnRpYWxfcmVxdWVzdF9xcmNvZGUoaXNzdWVyKXsNCiAgICB0cnl7DQogICAgICB2YXIgYXBpX2VuZHBvaW50ID0gdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5jbGllbnRfYXBpX3VybCArICcvaXNzdWVyX3FyX2NvZGUvJyANCiAgICAgICAgKyB0aGlzLmFwcF9jb25maWdfcGFyYW1zLmNsaWVudDsNCg0KICAgICAgdmFyIHVybCA9IGFwaV9lbmRwb2ludCArIHNpb3BfY3JlYXRlUGFyYW1ldGVyU3RyaW5nKHsgaXNzdWVyOiBpc3N1ZXIgfSwgZmFsc2UpOw0KDQogICAgICB2YXIgaHR0cE9wdGlvbnMgPSB7DQogICAgICAgIHVybDogdXJsLA0KICAgICAgICBtZXRob2Q6ICdHRVQnLA0KICAgICAgICAgIGhlYWRlcnM6IFsgeyBuYW1lOiAnQWNjZXB0JywgdmFsdWU6ICdhcHBsaWNhdGlvbi9qc29uJyB9IF0NCiAgICAgIH07DQoNCiAgICAgIHZhciBpc3N1ZXJfcXJfY29kZV9zdHJpbmcgPSBhd2FpdCBqc29uSHR0cERhdGEoaHR0cE9wdGlvbnMpOw0KICAgICAgdmFyIHFyX2NvZGUgPSBKU09OLnBhcnNlKGlzc3Vlcl9xcl9jb2RlX3N0cmluZyk7DQogICAgICByZXR1cm4gcXJfY29kZTsNCiAgICB9IA0KICAgIGNhdGNoKGVycil7DQoNCiAgICB9ICAgDQogIH0NCg0KICBhc3luYyBnZXRfZGlzY292ZXJ5X2luZm8oKXsNCiAgICB2YXIgYXBpQ29ubmVjdEVycm9yOw0KICAgIHRyeSB7DQogICAgICAvLyB0aGUgcmVtb3RlV2FsbGV0IHBhcmFtZXRlciBjb25maWd1cmVzIGRpc2NvdmVyeSBpbmZvDQogICAgICAvLyB0byBpbmNsdWRlIGFuIHJ3bCAocmVtb3RlV2FsbGV0TG9jYXRvcikgcGFyYW1ldGVyIHNpZ25hbGxpbmcNCiAgICAgIC8vIHRoYXQgdGhlIHRva2VuIHNob3VsZCBiZSBwbGFjZWQgaW4gYSBxdWV1ZSBhdCB0aGUgYXBwbGljYXRpb24NCiAgICAgIC8vIHRpbGwgdGhlIGRlc2t0b3AgY29udGludWVzIHRoZSB0cmFuc2FjdGlvbg0KICAgICAgLy8gd2hpY2ggTVVTVCBiZSAndHJ1ZScsICdmYWxzZScsIG9yIGFuIHJ3bCBpZA0KICAgICAgaWYgKHRoaXMubGlfcGFyYW1ldGVycyl7DQogICAgICAgIGlmICh0aGlzLmxpX3BhcmFtZXRlcnMucndsID09PSAidHJ1ZSIpew0KICAgICAgICAgIHRoaXMubGlfcGFyYW1ldGVycy5yd2wgPSByYW5kb20oeyJraW5kIjogImNvZGUiLCAibGVuZ3RoIjogMTYgfSk7DQogICAgICAgIH0NCiAgICAgICAgZWxzZSBpZighdGhpcy5saV9wYXJhbWV0ZXJzLnJ3bCl7DQogICAgICAgICAgdGhpcy5saV9wYXJhbWV0ZXJzLnJ3bCA9ICdmYWxzZSc7DQogICAgICAgIH0NCiAgICAgIH0NCg0KICAgICAgLy8gY2FsbCB0aGUgcXJfY29kZSBhcGkgZW5kcG9pbnQgc28gcXJfY29kZSBhbmQgdGFyZ2V0X2xpbmtfdXJpIGNhbg0KICAgICAgLy8gYmUgZGlzcGxheWVkIGluIHRoZSBzdGFydHVwIHNjcmVlbg0KICAgICAgdmFyIGFwaV9lbmRwb2ludCA9IHRoaXMuYXBwX2NvbmZpZ19wYXJhbXMuY2xpZW50X2FwaV91cmwgKyAnL3FyX2NvZGUvJyArIHRoaXMuYXBwX2NvbmZpZ19wYXJhbXMuY2xpZW50Ow0KICAgICAgdmFyIGRpc2NvdmVyeV9wYXJhbXMgPSB7DQogICAgICAgIGlzczogdGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zLmlzcywNCiAgICAgICAgdGFyZ2V0X2xpbmtfdXJpOiB0aGlzLmFwcF9pbnN0YW5jZV9wYXJhbXMudGFyZ2V0X2xpbmtfdXJpICAgIA0KICAgICAgfQ0KDQogICAgICAvKg0KICAgICAgLy8gZG9uJ3QgYnJpbmcgaW4gZW1wdHkgb2JqZWN0DQogICAgICBpZiAodGhpcy5saV9wYXJhbWV0ZXJzKXsNCiAgICAgIAlmb3IgKHZhciBrIGluIHRoaXMubGlfcGFyYW1ldGVycyl7DQoJICAgICAgICBkaXNjb3ZlcnlfcGFyYW1zLmxpX3BhcmFtZXRlcnMgPSB0aGlzLmxpX3BhcmFtZXRlcnM7DQoJICAgICAgICBicmVhazsNCiAgICAgIAl9DQogICAgICB9DQogICAgICAqLw0KCSAgZGlzY292ZXJ5X3BhcmFtcy5saV9wYXJhbWV0ZXJzID0gdGhpcy5saV9wYXJhbWV0ZXJzOw0KICAgIGRpc2NvdmVyeV9wYXJhbXMucndsID0gdGhpcy5saV9wYXJhbWV0ZXJzLnJ3bDsNCgkgIA0KICAgIGlmICh0aGlzLmxpX3BhcmFtZXRlcnMucndsICE9PSAnZmFsc2UnKXsJDQogICAgICAgIGRpc2NvdmVyeV9wYXJhbXMubXF0dHNfc2VydmVyID0gdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5tcXR0c19zZXJ2ZXI7DQogICAgICAgIGRpc2NvdmVyeV9wYXJhbXMuY2xpZW50X2FwaV91cmwgPSB0aGlzLmFwcF9jb25maWdfcGFyYW1zLmNsaWVudF9hcGlfdXJsOw0KCSAgfQ0KDQogICAgICBpZiAodGhpcy5yZXNwb25zZV9tb2RlKXsNCiAgICAgIAlkaXNjb3ZlcnlfcGFyYW1zWydyZXNwb25zZV9tb2RlJ10gPSB0aGlzLnJlc3BvbnNlX21vZGU7DQogICAgICB9DQogICAgICANCiAgICAgIHZhciB1cmwgPSBhcGlfZW5kcG9pbnQgKyBzaW9wX2NyZWF0ZVBhcmFtZXRlclN0cmluZyhkaXNjb3ZlcnlfcGFyYW1zLCBmYWxzZSk7DQogICAgICB2YXIgaHR0cE9wdGlvbnMgPSB7DQogICAgICAgIHVybDogdXJsLA0KICAgICAgICBtZXRob2Q6ICdHRVQnLA0KICAgICAgICAgIGhlYWRlcnM6IFsgeyBuYW1lOiAnQWNjZXB0JywgdmFsdWU6ICdhcHBsaWNhdGlvbi9qc29uJyB9IF0NCiAgICAgIH07DQoNCiAgICAgIHZhciBkaXNjb3ZlcnlfaW5mb19zdHJpbmcgPSBhd2FpdCBqc29uSHR0cERhdGEoaHR0cE9wdGlvbnMpOw0KICAgICAgdmFyIGRpc2NvdmVyeV9pbmZvID0gSlNPTi5wYXJzZShkaXNjb3ZlcnlfaW5mb19zdHJpbmcpOw0KICAgICAgaWYgKGRpc2NvdmVyeV9pbmZvLmVycm9yKXsNCiAgICAgICAgYWxlcnQoJ0Rpc2NvdmVyeSBpbmZvIGVycm9yIC0gc2VlIGNvbnNvbGUgbG9nOiAnICsgZGlzY292ZXJ5X2luZm8uZXJyb3IpOw0KICAgICAgfQ0KICAgIH0NCiAgICBjYXRjaCAoZXJyKXsNCiAgICAgIHZhciBlcnJvciA9IEpTT04ucGFyc2UoZXJyKTsNCiAgICAgIGlmIChlcnJvci5zdGF0dXNDb2RlID09PSA0MDApew0KICAgICAgICB3aW5kb3cubG9jYXRpb24gPSB0aGlzLmFwcF9pbnN0YW5jZV9wYXJhbXMudGFyZ2V0X2xpbmtfdXJpICsgc2lvcF9jcmVhdGVQYXJhbWV0ZXJTdHJpbmcoZXJyb3IpOw0KICAgICAgICByZXR1cm47DQogICAgICB9DQogICAgfQ0KDQogICAgcmV0dXJuIGRpc2NvdmVyeV9pbmZvOw0KICB9DQoNCiAgc2V0X3J3bF9kZXZpY2Uoc3RhdGUpew0KICAgIGlmICh0eXBlb2Ygc3RhdGUgPT09ICJzdHJpbmciKXsNCiAgICAgIGlmIChzdGF0ZS50b0xvd2VyQ2FzZSgpID09PSAidHJ1ZSIpew0KICAgICAgICBzdGF0ZSA9IHRydWU7DQogICAgICB9DQogICAgICBlbHNlew0KICAgICAgICBzdGF0ZSA9IGZhbHNlOw0KICAgICAgfQ0KICAgIH0NCiAgICBpZiAoc3RhdGUpew0KICAgICAgc2lvcF9zZXRDb29raWUoJ3J3bF9kZXZpY2UnLCBzdGF0ZSwgMTAqMzY1LCAnLycpOw0KICAgIH0NCiAgfQ0KDQogIGFzeW5jIGdldF9hcHBfbGF1bmNoZXJfdXJsKCl7DQogICAgLy8gZGVidWdnZXI7DQogICAgdmFyIGFwcF9sYXVuY2hlcl9jb29raWUgPSBzaW9wX2dldENvb2tpZSgnYXBwX2xhdW5jaGVyJyk7DQogICAgaWYgKGFwcF9sYXVuY2hlcl9jb29raWUpew0KICAgICAgcmV0dXJuIGFwcF9sYXVuY2hlcl9jb29raWU7IA0KICAgIH0NCg0KICAgIHZhciBodHRwT3B0aW9ucyA9IHsNCiAgICAgIHVybDogdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5jbGllbnRfYXBpX3VybCArICcvYXBwX2NvbmZpZy8nICsgJ2FwcF9sYXVuY2hlcicsDQogICAgICBtZXRob2Q6ICdHRVQnLA0KICAgICAgICBoZWFkZXJzOiBbIHsgbmFtZTogJ0FjY2VwdCcsIHZhbHVlOiAnYXBwbGljYXRpb24vanNvbicgfSBdLA0KICAgICAgICBwYXJzZUpzb25SZXNwb25zZTogdHJ1ZQ0KICAgIH07DQogICAgdmFyIGFwcF9sYXVuY2hlcl9jb25maWcgPSBhd2FpdCBqc29uSHR0cERhdGEoaHR0cE9wdGlvbnMpOw0KICAgIHNpb3Bfc2V0Q29va2llKCdhcHBfbGF1bmNoZXInLCBhcHBfbGF1bmNoZXJfY29uZmlnLmFwcGxpY2F0aW9uX3VybCwgMzY1LCAnLycpOw0KICAgIHJldHVybiBhcHBfbGF1bmNoZXJfY29uZmlnLmFwcGxpY2F0aW9uX3VybDsNCiAgfQ0KfQ0KDQovLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vLy8vDQogIA0KZnVuY3Rpb24gc2lvcF9yZWFkX3JlbW90ZV9jb29raWUoaWZyYW1lVXJsKXsNCiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0-IHsNCiAgICB2YXIgbGF1bmNoSWZyYW1lU3RyaW5nID0gJ1wNCiAgICAgIDxkaXYgc3R5bGU9ImRpc3BsYXk6IG5vbmU7Ij5cDQogICAgICAgIDxpZnJhbWUgaWQ9IndhbGxldF9pZnJhbWUiXA0KICAgICAgICAgICAgd2lkdGg9IjMwMCJcDQogICAgICAgICAgICBoZWlnaHQ9IjIwMCJcDQogICAgICAgICAgICBzcmM9IicgKyBpZnJhbWVVcmwgKyAnIj5cDQogICAgICAgIDwvaWZyYW1lPlwNCiAgICAgIDwvZGl2Pic7DQogICAgdmFyIHRpbWVyID0gc2V0VGltZW91dChmdW5jdGlvbiAoKSB7DQogICAgICByZWplY3QoJ3NtYXJ0IGNyZWRlbnRpYWwgb2ZmbGluZScpOw0KICAgIH0sIDUwMDApOyAgIA0KICAgIHZhciBsaXN0ZW5lciA9IHdpbmRvdy5hZGRFdmVudExpc3RlbmVyKCJtZXNzYWdlIiwgKGV2ZW50KSA9PiB7DQogICAgICBjbGVhclRpbWVvdXQodGltZXIpOw0KICAgICAgcmVzb2x2ZShldmVudC5kYXRhKTsNCiAgICB9LCBmYWxzZSk7DQogICAgdmFyIHJlbW90ZUNvb2tpZUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoJ3JlbW90ZV9jb29raWVfcmVhZGVyJyk7DQogICAgaWYgKCFyZW1vdGVDb29raWVFbCl7DQogICAgICBhbGVydCgnQ29uZmlndXJhdGlvbiBlcnJvcjogIHJlbW90ZV9jb29raWVfcmVhZGVyIGRpdiBtdXN0IGJlIHByZXNlbnQgaW4gdGhlIGRvY3VtZW50LicpDQogICAgICB2YXIgZm9vID0gYWJvcnQ7ICAgICANCiAgICB9DQogICAgcmVtb3RlQ29va2llRWwuaW5uZXJIVE1MID0gbGF1bmNoSWZyYW1lU3RyaW5nOw0KICB9KTsNCn0NCg0KZnVuY3Rpb24gc2lvcF9zZXRDb29raWUoY25hbWUsIGN2YWx1ZSwgZXhkYXlzLCBwYXRoKSB7DQogIGlmICghcGF0aCl7DQogICAgcGF0aCA9ICcvJzsNCiAgfQ0KICB2YXIgZCA9IG5ldyBEYXRlKCk7DQogIGQuc2V0VGltZShkLmdldFRpbWUoKSArIChleGRheXMqMjQqNjAqNjAqMTAwMCkpOw0KICB2YXIgZXhwaXJlcyA9ICdleHBpcmVzPScrIGQudG9VVENTdHJpbmcoKTsNCiAgZG9jdW1lbnQuY29va2llID0gY25hbWUgKyAnPScgKyBjdmFsdWUgKyAnOycgKyBleHBpcmVzICsgJztwYXRoPScgKyBwYXRoOw0KfQ0KDQpmdW5jdGlvbiBzaW9wX2dldENvb2tpZShjbmFtZSkgew0KICB2YXIgbmFtZSA9IGNuYW1lICsgIj0iOw0KICB2YXIgZGVjb2RlZENvb2tpZSA9IGRlY29kZVVSSUNvbXBvbmVudChkb2N1bWVudC5jb29raWUpOw0KICB2YXIgY2EgPSBkZWNvZGVkQ29va2llLnNwbGl0KCc7Jyk7DQogIGZvcih2YXIgaSA9IDA7IGkgPGNhLmxlbmd0aDsgaSsrKSB7DQogICAgdmFyIGMgPSBjYVtpXTsNCiAgICB3aGlsZSAoYy5jaGFyQXQoMCkgPT0gJyAnKSB7DQogICAgICBjID0gYy5zdWJzdHJpbmcoMSk7DQogICAgfQ0KICAgIGlmIChjLmluZGV4T2YobmFtZSkgPT0gMCkgew0KICAgICAgcmV0dXJuIGMuc3Vic3RyaW5nKG5hbWUubGVuZ3RoLCBjLmxlbmd0aCk7DQogICAgfQ0KICB9DQogIHJldHVybiAiIjsNCn0NCg0KZnVuY3Rpb24gc2lvcF9yZW1vdmVDb29raWVzKCkgew0KICB2YXIgcmVzID0gZG9jdW1lbnQuY29va2llOw0KICB2YXIgbXVsdGlwbGUgPSByZXMuc3BsaXQoIjsiKTsNCiAgZm9yKHZhciBpID0gMDsgaSA8IG11bHRpcGxlLmxlbmd0aDsgaSsrKSB7DQogICAgIHZhciBrZXkgPSBtdWx0aXBsZVtpXS5zcGxpdCgiPSIpOw0KLy8gICAgIGRvY3VtZW50LmNvb2tpZSA9IGtleVswXSsiPTtleHBpcmVzPVRodSwgMDEgSmFuIDE5NzAgMDA6MDA6MDAgVVRDIjsNCiAgICAgZG9jdW1lbnQuY29va2llID0ga2V5WzBdKyc9OyBNYXgtQWdlPS05OTk5OTk5OTtwYXRoPS8nOyAgDQogIH0NCn0NCg0KZnVuY3Rpb24gc2lvcF9lcmFzZUNvb2tpZShjbmFtZSkgeyAgIA0KICAgIGRvY3VtZW50LmNvb2tpZSA9IGNuYW1lKyc9OyBNYXgtQWdlPS05OTk5OTk5OTsnOyAgDQp9DQoNCmZ1bmN0aW9uIGpzb25IdHRwRGF0YShvcHRpb25zKXsNCiAgcmV0dXJuIG5ldyBQcm9taXNlKChyZXNvbHZlLCByZWplY3QpID0-IHsNCiAgICB2YXIgeGhyID0gbmV3IFhNTEh0dHBSZXF1ZXN0KCk7DQogICAgdmFyIG1ldGhvZCA9IG9wdGlvbnMubWV0aG9kOw0KICAgIGlmIChtZXRob2QgPT09IHVuZGVmaW5lZCl7DQogICAgICBtZXRob2QgPSAnR0VUJzsNCiAgICB9DQogICAgeGhyLm9wZW4obWV0aG9kLCBvcHRpb25zLnVybCwgdHJ1ZSk7DQoNCiAgICB2YXIgYXV0aG9yaXphdGlvbkhlYWRlclByZXNlbnQgPSBmYWxzZTsNCiAgICBpZiAob3B0aW9ucy5oZWFkZXJzICE9PSB1bmRlZmluZWQpew0KICAgICAgZm9yICh2YXIgaT0wOyBpIDwgb3B0aW9ucy5oZWFkZXJzLmxlbmd0aDsgaSsrKXsNCiAgICAgICAgdmFyIGhlYWRlciA9IG9wdGlvbnMuaGVhZGVyc1tpXTsNCiAgICAgICAgaWYgKGhlYWRlci5uYW1lID09PSAnQXV0aG9yaXphdGlvbicpew0KICAgICAgICAgIGF1dGhvcml6YXRpb25IZWFkZXJQcmVzZW50ID0gdHJ1ZTsNCiAgICAgICAgfQ0KICAgICAgICB4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXIubmFtZSwgaGVhZGVyLnZhbHVlKTsNCiAgICAgIH0NCiAgICB9DQoNCiAgICB4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgew0KICAgICAgaWYgKHhoci5yZWFkeVN0YXRlID09PSA0KXsNCiAgICAgICAgaWYgKHhoci5zdGF0dXMgPT09IDIwMCkgew0KICAgICAgICAgIHZhciByZXN1bHQgPSB4aHIucmVzcG9uc2VUZXh0Ow0KICAgICAgICAgIGlmIChvcHRpb25zLnBhcnNlSnNvblJlc3BvbnNlKXsNCiAgICAgICAgICAgIHJlc3VsdCA9IEpTT04ucGFyc2UocmVzdWx0KTsNCiAgICAgICAgICB9DQogICAgICAgICAgcmVzb2x2ZShyZXN1bHQpOw0KICAgICAgICB9DQogICAgICAgIGVsc2Ugew0KICAgICAgICAgIHJlamVjdCh4aHIucmVzcG9uc2VUZXh0KTsNCiAgICAgICAgfQ0KICAgICAgfQ0KICAgIH07DQoNCiAgICBpZiAoYXV0aG9yaXphdGlvbkhlYWRlclByZXNlbnQpew0KICAgICAgeGhyLndpdGhDcmVkZW50aWFscyA9IHRydWU7DQogICAgfQ0KDQogICAgaWYgKG1ldGhvZC50b1VwcGVyQ2FzZSgpID09PSAnR0VUJyB8fCBvcHRpb25zLnBvc3REYXRhID09PSB1bmRlZmluZWQpew0KICAgICAgeGhyLnNlbmQoKTsNCiAgICB9DQogICAgZWxzZXsNCiAgICAgIHZhciBwb3N0RGF0YSA9IG9wdGlvbnMucG9zdERhdGE7DQogICAgICBpZiAodHlwZW9mIHBvc3REYXRhICE9PSAnc3RyaW5nJyl7DQogICAgICAgIHBvc3REYXRhID0gSlNPTi5zdHJpbmdpZnkocG9zdERhdGEpOw0KICAgICAgfQ0KICAgICAgeGhyLnNlbmQocG9zdERhdGEpOyAgICAgICAgIA0KICAgIH0NCiAgfSk7DQp9DQoNCmZ1bmN0aW9uIHNpb3BfdmFsdWVGcm9tRWxlbWVudElkKGlkKXsNCiAgdmFyIHBhcmFtRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7DQogIGlmICghcGFyYW1FbCl7DQogICAgYWxlcnQoJ2RvY3VtZW50IG1pc3NpbmcgZWxlbWVudCB3aXRoIGlkIFsnICsgaWQgKyAnXSBpbiBvaWRjX2FwcF9pbnN0YW5jZScpOw0KICAgIHRocm93ICgncGFyYW1ldGVyX2Vycm9yJyk7DQogIH0NCg0KICByZXR1cm4gcGFyYW1FbC52YWx1ZTsNCn0NCg0KZnVuY3Rpb24gc2lvcF9jcmVhdGVQYXJhbWV0ZXJTdHJpbmcob2JqLCBlbmNvZGUpew0KICB2YXIgaGFuZGxlRW5jb2RlOw0KICBpZiAoZW5jb2RlID09PSBmYWxzZSl7DQogICAgaGFuZGxlRW5jb2RlID0gZnVuY3Rpb24oaW5wdXQpew0KICAgICAgcmV0dXJuIGlucHV0Ow0KICAgIH0NCiAgfQ0KICBlbHNlew0KICAgIGhhbmRsZUVuY29kZSA9IGVuY29kZVVSSUNvbXBvbmVudDsgICAgDQogIH0NCg0KICB2YXIgcmVzdWx0ID0gJyc7DQogIHZhciBzZXBhcmF0b3IgPSAnPyc7DQogIGZvciAodmFyIGtleSBpbiBvYmopew0KICAgIHZhciB2YWx1ZSA9IG9ialtrZXldID8gaGFuZGxlRW5jb2RlKG9ialtrZXldKSA6ICcnOw0KICAgIGlmICh0eXBlb2YgdmFsdWUgIT09ICdzdHJpbmcnKXsNCiAgICAgIHZhbHVlID0gdXRvYShKU09OLnN0cmluZ2lmeSh2YWx1ZSkpOw0KICAgIH0NCiAgICByZXN1bHQgKz0gc2VwYXJhdG9yICsgaGFuZGxlRW5jb2RlKGtleSkgKyAnPScgKyB2YWx1ZTsNCiAgICBzZXBhcmF0b3IgPSAnJic7DQogIH0NCg0KICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBzaW9wX3BhcnNlUGFyYW1ldGVyU3RyaW5nKGlucHV0U3RyaW5nKXsNCiAgaWYgKGlucHV0U3RyaW5nLnN0YXJ0c1dpdGgoIj8iKSB8fCBpbnB1dFN0cmluZy5zdGFydHNXaXRoKCIjIikpew0KICAgIGlucHV0U3RyaW5nID0gaW5wdXRTdHJpbmcuc3Vic3RyaW5nKDEpOw0KICB9DQogIHZhciBwYXJhbXMgPSBpbnB1dFN0cmluZy5zcGxpdCgiJiIpOw0KICB2YXIgcVBhcmFtcyA9IHt9Ow0KICBmb3IgKHZhciBpPTA7IGkgPCBwYXJhbXMubGVuZ3RoOyBpKyspew0KICAgIHZhciBxUGFyYW0gPSBwYXJhbXNbaV0uc3BsaXQoIj0iKTsNCiAgICB2YXIga2V5ID0gZGVjb2RlVVJJQ29tcG9uZW50KHFQYXJhbVswXSk7DQogICAgdmFyIHZhbHVlID0gc2lvcF9mdWxseURlY29kZVVSSUNvbXBvbmVudChxUGFyYW1bMV0pOw0KICAgIHFQYXJhbXNba2V5XSA9IHZhbHVlOw0KICB9DQogIHJldHVybiBxUGFyYW1zOw0KfQ0KDQpmdW5jdGlvbiB1dG9hKGRhdGEpIHsNCiAgcmV0dXJuIGJ0b2EodW5lc2NhcGUoZW5jb2RlVVJJQ29tcG9uZW50KGRhdGEpKSk7DQp9ICANCg0KZnVuY3Rpb24gYXRvdShiNjQpIHsNCiAgcmV0dXJuIGRlY29kZVVSSUNvbXBvbmVudChlc2NhcGUoYXRvYihiNjQpKSk7DQp9DQoNCmZ1bmN0aW9uIGZ1bGx5RGVjb2RlVVJJQ29tcG9uZW50KHZhbHVlKXsNCiAgdmFyIGN1dG9mZiA9IDA7DQogIHZhciB2YWx1ZTEgPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOw0KICB3aGlsZSAodmFsdWUxICE9PSB2YWx1ZSAmJiBjdXRvZmYgPCA1KXsNCiAgICBjdXRvZmYrKzsNCiAgICB2YWx1ZSA9IHZhbHVlMTsNCiAgICB2YWx1ZTEgPSBkZWNvZGVVUklDb21wb25lbnQodmFsdWUpOw0KICB9DQogIHJldHVybiB2YWx1ZTsNCn0NCg0KZnVuY3Rpb24gYXBwZW5kVVJJQ29tcG9uZW50KHVybCwgY29tcG9uZW50KXsNCiAgcmV0dXJuIHVybCArICh1cmwuaW5jbHVkZXMoJz8nKSA_ICcmJyA6ICc_JykgKyBjb21wb25lbnQ7DQp9DQoNCmZ1bmN0aW9uIHJhbmRvbShvcHRpb25zKXsNCiAgaWYgKCFvcHRpb25zLmxlbmd0aCl7DQogICAgb3B0aW9ucy5sZW5ndGggPSA0ODsNCiAgfQ0KICAgDQogIHZhciBhciA9IG5ldyBVaW50OEFycmF5KG9wdGlvbnMubGVuZ3RoKTsgDQogIHdpbmRvdy5jcnlwdG8uZ2V0UmFuZG9tVmFsdWVzKGFyKTsNCiAgdmFyIHJlc3VsdCA9ICIiOw0KICBmb3IgKHZhciBpPTA7IGk8b3B0aW9ucy5sZW5ndGg7IGkrKyl7DQogICAgICB2YXIgZGlnaXQgPSBhcltpXSAlIDEwOw0KICAgICAgcmVzdWx0ICs9IFN0cmluZy5mcm9tQ2hhckNvZGUoMHgzMCArIGRpZ2l0KTsNCiAgfQ0KDQogIHJldHVybiByZXN1bHQ7DQp9DQoNCmFzeW5jIGZ1bmN0aW9uIHJlZGlyZWN0X3RvX2FwcF9sYXVuY2hlcihjdXJyZW50X29pZGNfYXBwX2luc3RhbmNlKXsNCiAgICB2YXIgYXBwX2xhdW5jaGVyX3VybCA9IGF3YWl0IGN1cnJlbnRfb2lkY19hcHBfaW5zdGFuY2UuZ2V0X2FwcF9sYXVuY2hlcl91cmwoKTsNCiAgICBsb2NhdGlvbiA9IGFwcF9sYXVuY2hlcl91cmw7DQp9DQoNCmZ1bmN0aW9uIHNpb3Bfc2V0X2ltZyhxcl9jb2RlX2luZm8pew0KICB2YXIgc2lvcF9xcl9jb2RlRWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnc2lvcF9xcl9jb2RlJyk7DQogIGlmICghc2lvcF9xcl9jb2RlRWwpew0KICAgIHJldHVybjsNCiAgfQ0KDQogIHZhciBzdHlsZSA9IHNpb3BfcXJfY29kZUVsLmdldEF0dHJpYnV0ZSgnc3R5bGUnKTsNCiAgc2lvcF9xcl9jb2RlRWwucmVtb3ZlQXR0cmlidXRlKCJzdHlsZSIpOw0KDQogIHZhciBvbkNsaWNrQXJnID0gJyc7DQogIHZhciBvbkNvbnRleHRBcmcgPSAnJzsNCiAgdmFyIGNyVXJsID0gcXJfY29kZV9pbmZvLmNyZWRlbnRpYWxfcmVxdWVzdF91cmw7DQogIGlmIChjclVybCl7DQogICAgb25DbGlja0FyZyA9ICdvbkNsaWNrPSJzaW9wX3NpbXVsYXRlU2NhbihcJycgKyBjclVybCArICdcJyk7IiAnOw0KICAgIHZhciBsb2MgPSBjclVybC5zdWJzdHJpbmcoMCwgY3JVcmwuaW5kZXhPZignJnRhcmdldCcpKSArICcmdGFyZ2V0X2xpbmtfdXJpPS9kZWJ1Zyc7DQogICAgb25Db250ZXh0QXJnID0gJ29uY29udGV4dG1lbnU9InNpb3Bfc2ltdWxhdGVTY2FuKFwnJyArIGNyVXJsICsgJ1wnKTtyZXR1cm4gZmFsc2U7IiAnOw0KICB9DQoNCiAgdmFyIGltYWdlRWxTdHJpbmcgPSAnPGltZyAnICsgb25DbGlja0FyZyArIG9uQ29udGV4dEFyZyArICdfc3R5bGVfIHNyYz0iJyArIHFyX2NvZGVfaW5mby5xcl9jb2RlICsgJyI-JzsNCiAgdmFyIHN1YiA9IHN0eWxlID8gJ3N0eWxlPSInICsgc3R5bGUgKyAnIicgOiAnJzsNCiAgaW1hZ2VFbFN0cmluZyA9IGltYWdlRWxTdHJpbmcucmVwbGFjZSgnX3N0eWxlXycsIHN1Yik7DQogIHNpb3BfcXJfY29kZUVsLmlubmVySFRNTCA9IGltYWdlRWxTdHJpbmc7DQoNCiAgZnVuY3Rpb24gc2lvcF9zaW11bGF0ZVNjYW4oYXJnKXsNCiAgICB3aW5kb3cubG9jYXRpb24gPSBhcmc7DQogIH0NCg0KICBmdW5jdGlvbiBzaW9wX25vTGFuZGluZ1BhZ2UoKXsNCiAgICAgIHZhciBsb2MgPSBxcl9jb2RlX2luZm8uY3JlZGVudGlhbF9yZXF1ZXN0X3VybDsNCiAgICAgIGxvYyA9IGxvYy5zdWJzdHJpbmcoMCwgbG9jLmluZGV4T2YoJyZ0YXJnZXQnKSkgKyAnJnRhcmdldF9saW5rX3VyaT0vZGVidWcnOw0KICAgICAgd2luZG93LmxvY2F0aW9uID0gbG9jOw0KICB9DQp9DQoNCg0K","oidc_app_instance.safe.5-17.js":"Y2xhc3Mgb2lkY19hcHBfaW5zdGFuY2V7DQogIGNvbnN0cnVjdG9yKGFwcF9jb25maWdfcGFyYW1zLCBhcHBfaW5zdGFuY2VfcGFyYW1zLCBvbldhbGxldFJlc3VsdCwgb3B0aW9ucyl7DQogICAgdGhpcy5vbldhbGxldFJlc3VsdCA9IG9uV2FsbGV0UmVzdWx0Ow0KICAgIHRoaXMud2FsbGV0X3VybDsNCg0KICAgIC8vIGdldCBvcHRpb25zIGZyb20gY29tbWFuZCBsaW5lIG9yIG9wdGlvbnMNCiAgICB2YXIgdXJsUGFyYW1ldGVycyA9IG5ldyBVUkxTZWFyY2hQYXJhbXMod2luZG93LmxvY2F0aW9uLnNlYXJjaCk7DQogICAgdmFyIHN0YXJ0dXBfZXJyb3IgPSB1cmxQYXJhbWV0ZXJzLmdldCgnZXJyb3InKTsNCiAgICB2YXIgY2xlYXJfY29va2llcyA9IHVybFBhcmFtZXRlcnMuZ2V0KCdjbGVhcl9jb29raWVzJyk7DQogICAgdGhpcy5yd2wgPSB1cmxQYXJhbWV0ZXJzLmdldCgncndsJyk7DQoNCiAgICBpZiAob3B0aW9ucyl7DQogICAgICBpZihvcHRpb25zWydzdGFydHVwX2Vycm9yJ10pew0KICAgICAgICBzdGFydHVwX2Vycm9yID0gb3B0aW9uc1snc3RhcnR1cF9lcnJvciddOw0KICAgICAgfQ0KICAgICAgaWYgKG9wdGlvbnNbJ2NsZWFyX2Nvb2tpZXMnXSl7DQogICAgICAgIGNsZWFyX2Nvb2tpZXMgPSBvcHRpb25zWydjbGVhcl9jb29raWVzJ107DQogICAgICB9DQogICAgICBpZiAob3B0aW9uc1sncndsJ10pew0KICAgICAgICB0aGlzLnJ3bCA9IG9wdGlvbnNbJ3J3bCddOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIGlmIChzdGFydHVwX2Vycm9yKXsNCiAgICAgIGFsZXJ0KCdFcnJvciBzdGFydGluZyB1cDogJyArIHN0YXJ0dXBfZXJyb3IpOw0KICAgICAgcmV0dXJuOw0KICAgIH0gDQoNCiAgICBpZiAoY2xlYXJfY29va2llcyl7DQogICAgICBzaW9wX3JlbW92ZUNvb2tpZXMoKTsNCiAgICAgIHdpbmRvdy5wYXJlbnQucG9zdE1lc3NhZ2UoJ3sgImNvb2tpZXMiOiAiZGVsZXRlZCIgfScsICcqJyk7DQogICAgICByZXR1cm47DQogICAgfQ0KDQogICAgaWYgKCFhcHBfY29uZmlnX3BhcmFtcyl7DQogICAgICB0aHJvdygnYXBwX2NvbmZpZ19wYXJhbXMgbXVzdCBiZSBzZXQgaW4gb2lkY19hcHBfaW5zdGFuY2UnKTsNCiAgICB9DQogICAgZWxzZSBpZiAodHlwZW9mIGFwcF9jb25maWdfcGFyYW1zID09PSAnc3RyaW5nJyl7DQogICAgICB2YXIgYXBwX2NvbmZpZ19zdHJpbmcgPSBzaW9wX3ZhbHVlRnJvbUVsZW1lbnRJZChhcHBfY29uZmlnX3BhcmFtcyk7DQogICAgICBpZiAoIWFwcF9jb25maWdfc3RyaW5nKXsNCiAgICAgICAgdGhyb3coJ2FwcF9jb25maWdfcGFyYW1zIGlucHV0IGVsZW1lbnQgWycgKyBhcHBfY29uZmlnX3BhcmFtcyArICddIHdhcyBwcmVzZW50IGJ1dCBubyB2YWx1ZSB3YXMgc2V0IGluIHRoZSBkb2N1bWVudCcpOw0KICAgICAgfQ0KICAgICAgdGhpcy5hcHBfY29uZmlnX3BhcmFtcyA9IEpTT04ucGFyc2UoYXBwX2NvbmZpZ19zdHJpbmcpOw0KICAgIH0NCiAgICBlbHNlew0KICAgICAgdGhpcy5hcHBfY29uZmlnX3BhcmFtcyA9IGFwcF9jb25maWdfcGFyYW1zOw0KICAgIH0NCg0KICAgIGlmICghYXBwX2luc3RhbmNlX3BhcmFtcyl7DQogICAgICB0aHJvdygnYXBwX2luc3RhbmNlX3BhcmFtcyBtdXN0IGJlIHNldCBpbiBvaWRjX2FwcF9pbnN0YW5jZScpOw0KICAgIH0NCiAgICBlbHNlIGlmICh0eXBlb2YgYXBwX2luc3RhbmNlX3BhcmFtcyA9PT0gJ3N0cmluZycpew0KICAgICAgdmFyIGFwcF9pbnN0YW5jZV9wYXJhbV9zdHJpbmcgPSBzaW9wX3ZhbHVlRnJvbUVsZW1lbnRJZChhcHBfaW5zdGFuY2VfcGFyYW1zKTsNCiAgICAgIGlmICghYXBwX2luc3RhbmNlX3BhcmFtX3N0cmluZyl7DQogICAgICAgIHRocm93KCdhcHBfaXNudGFuY2VfcGFyYW1zIGlucHV0IGVsZW1lbnQgWycgKyBhcHBfaW5zdGFuY2VfcGFyYW1zICsgJ10gd2FzIHByZXNlbnQgYnV0IG5vIHZhbHVlIHdhcyBzZXQgaW4gdGhlIGRvY3VtZW50Jyk7DQogICAgICB9DQogICAgICB0aGlzLmFwcF9pbnN0YW5jZV9wYXJhbXMgPSBKU09OLnBhcnNlKGFwcF9pbnN0YW5jZV9wYXJhbV9zdHJpbmcpOw0KICAgIH0NCiAgICBlbHNlew0KICAgICAgdGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zID0gYXBwX2luc3RhbmNlX3BhcmFtczsNCiAgICB9DQoNCiAgICBpZiAoIW9uV2FsbGV0UmVzdWx0KXsNCiAgICAgIHRocm93KCdvbldhbGxldFJlc3VsdCBtdXN0IGJlIHNldCBpbiBvaWRjX2FwcF9pbnN0YW5jZScpOw0KICAgIH0NCiAgfQ0KDQogIGFzeW5jIHN0YXJ0dXAoKXsNCiAgICB0aGlzLndhbGxldF91cmwgPSBhd2FpdCB0aGlzLmdldF93YWxsZXRfdXJsKCk7DQogICAgaWYgKHRoaXMud2FsbGV0X3VybCl7DQogICAgICB0aGlzLmFwcF9pbnN0YW5jZV9wYXJhbXMuaXNzID0gdGhpcy53YWxsZXRfdXJsOw0KICAgIH0NCg0KICAgIHZhciBkaXNjb3ZlcnlfaW5mbyA9IGF3YWl0IHRoaXMuZ2V0X2Rpc2NvdmVyeV9pbmZvKCk7DQogICAgaWYgKGRpc2NvdmVyeV9pbmZvICYmIHRoaXMub25XYWxsZXRSZXN1bHQpew0KICAgICAgdGhpcy5vbldhbGxldFJlc3VsdChkaXNjb3ZlcnlfaW5mbywgdGhpcy53YWxsZXRfdXJsKTsNCiAgICB9DQogIH0NCg0KICBhc3luYyBnZXRfd2FsbGV0X3VybCgpew0KICAgIHZhciBjcmVkZW50aWFsID0gdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5jcmVkZW50aWFsX3R5cGU7DQogICAgaWYgKCFjcmVkZW50aWFsKXsNCiAgICAgIGNyZWRlbnRpYWwgPSB0aGlzLmFwcF9jb25maWdfcGFyYW1zLmlucHV0X2NyZWRlbnRpYWxfdHlwZTsNCiAgICB9DQogICAgaWYgKCFjcmVkZW50aWFsKXsNCiAgICAgIGFsZXJ0KCdjb25maWd1cmF0aW9uIGVycm9yOiBjb25maWcgcmVxdWlyZXMgZWl0aGVyIGNyZWRlbnRpYWxfdHlwZSBvciBpbnB1dF9jcmVkZW50aWFsX3R5cGUnKTsNCiAgICAgIHZhciBmb28gPSBhYm9ydDsNCiAgICB9DQoNCiAgICAvLyBpcyB0aGVyZSBhbiBhcHAgY29va2llDQogICAgdmFyIHdhbGxldFVybCA9IHNpb3BfZ2V0Q29va2llKCd3YWxsZXRfJyArIGNyZWRlbnRpYWwpOw0KICAgIGlmICh3YWxsZXRVcmwpew0KICAgICAgaWYgKHdhbGxldFVybCA9PT0gImNyZWRlbnRpYWxfcmVtb3ZlZCIpew0KICAgICAgICB3YWxsZXRVcmwgPSB1bmRlZmluZWQ7DQogICAgICB9DQogICAgICByZXR1cm4gd2FsbGV0VXJsOw0KICAgIH0NCg0KICAgIC8vICBXZSBuZWVkIHRvIHVzZSBzbWFydCBjcmVkZW50aWFsDQogICAgdHJ5ew0KICAgICAgdmFyIHdhbGxldF91cmxfcmVzcG9uc2Vfc3RyaW5nID0gYXdhaXQgdGhpcy5nZXRfd2FsbGV0X2Zyb21fU0MoY3JlZGVudGlhbCk7DQogICAgICB2YXIgd2FsbGV0X3VybF9yZXNwb25zZSA9IEpTT04ucGFyc2Uod2FsbGV0X3VybF9yZXNwb25zZV9zdHJpbmcpOw0KICAgICAgd2FsbGV0VXJsID0gd2FsbGV0X3VybF9yZXNwb25zZS53YWxsZXQ7DQogICAgICBpZiAod2FsbGV0VXJsID09PSAnbi9hJyl7DQogICAgICAgIHdhbGxldFVybCA9IHVuZGVmaW5lZDsNCiAgICAgIH0NCiAgICAgIGVsc2V7DQogICAgICAgIHNpb3Bfc2V0Q29va2llKCd3YWxsZXRfJyArIGNyZWRlbnRpYWwsIHdhbGxldFVybCwgMTAsICcvJyk7DQogICAgICB9DQogICAgICByZXR1cm4gd2FsbGV0VXJsOw0KICAgIH0NCiAgICBjYXRjaChlcnIpew0KICAgICAgd2luZG93LmxvY2F0aW9uID0gYXBwZW5kVVJJQ29tcG9uZW50KHRoaXMuYXBwX2luc3RhbmNlX3BhcmFtcy53YWxsZXRfZXJyb3JfdXJsLCAnZXJyb3I9JyArIGVycik7DQogICAgfQ0KICB9DQoNCiAgYXN5bmMgZ2V0X3dhbGxldF9mcm9tX1NDKGNyZWRlbnRpYWwpew0KICAgIHJldHVybiBhd2FpdCBzaW9wX3JlYWRfcmVtb3RlX2Nvb2tpZShjcmVkZW50aWFsICsgIi93YWxsZXQiKTsNCiAgfQ0KDQogIGFzeW5jIGdldF9kaXNjb3ZlcnlfaW5mbygpew0KICAgIHZhciBhcGlDb25uZWN0RXJyb3I7DQogICAgdHJ5IHsNCiAgICAgIC8vIHRoZSByZW1vdGVXYWxsZXQgcGFyYW1ldGVyIGNvbmZpZ3VyZXMgZGlzY292ZXJ5IGluZm8NCiAgICAgIC8vIHRvIGluY2x1ZGUgYW4gcndsIChyZW1vdGVXYWxsZXRMb2NhdG9yKSBwYXJhbWV0ZXIgc2lnbmFsbGluZw0KICAgICAgLy8gdGhhdCB0aGUgdG9rZW4gc2hvdWxkIGJlIHBsYWNlZCBpbiBhIHF1ZXVlIGF0IHRoZSBhcHBsaWNhdGlvbg0KICAgICAgLy8gdGlsbCB0aGUgZGVza3RvcCBjb250aW51ZXMgdGhlIHRyYW5zYWN0aW9uDQogICAgICBpZiAodGhpcy5yd2wgPT09IHRydWUpew0KICAgICAgICAgIHRoaXMucndsID0gcmFuZG9tKHsia2luZCI6ICJjb2RlIiwgImxlbmd0aCI6IDE2IH0pOw0KICAgICAgfQ0KDQogICAgICAvLyBjYWxsIHRoZSBxcl9jb2RlIGFwaSBlbmRwb2ludCBzbyBxcl9jb2RlIGFuZCB0YXJnZXRfbGlua191cmkgY2FuDQogICAgICAvLyBiZSBkaXNwbGF5ZWQgaW4gdGhlIHN0YXJ0dXAgc2NyZWVuDQogICAgICB2YXIgYXBpX2VuZHBvaW50ID0gdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5jbGllbnRfYXBpX3VybCArICcvcXJfY29kZS8nICsgdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5jbGllbnQ7DQogICAgICB2YXIgZGlzY292ZXJ5X3BhcmFtcyA9IHsNCiAgICAgICAgaXNzOiB0aGlzLmFwcF9pbnN0YW5jZV9wYXJhbXMuaXNzLA0KICAgICAgICB0YXJnZXRfbGlua191cmk6IHRoaXMuYXBwX2luc3RhbmNlX3BhcmFtcy50YXJnZXRfbGlua191cmkgICAgDQogICAgICB9DQoNCiAgICAgIGlmICh0aGlzLnJ3bCl7DQogICAgICAgIGRpc2NvdmVyeV9wYXJhbXNbInJ3bCJdID0gdGhpcy5yd2w7DQogICAgICAgIGRpc2NvdmVyeV9wYXJhbXNbJ21xdHRzX3NlcnZlciddID0gdGhpcy5hcHBfY29uZmlnX3BhcmFtcy5tcXR0c19zZXJ2ZXI7DQogICAgICAgIGRpc2NvdmVyeV9wYXJhbXNbJ2NsaWVudF9hcGlfdXJsJ10gPSB0aGlzLmFwcF9jb25maWdfcGFyYW1zLmNsaWVudF9hcGlfdXJsOw0KICAgICAgfQ0KICAgICAgDQogICAgICB2YXIgdXJsID0gYXBpX2VuZHBvaW50ICsgc2lvcF9jcmVhdGVQYXJhbWV0ZXJTdHJpbmcoZGlzY292ZXJ5X3BhcmFtcywgZmFsc2UpOw0KICAgICAgdmFyIGh0dHBPcHRpb25zID0gew0KICAgICAgICB1cmw6IHVybCwNCiAgICAgICAgbWV0aG9kOiAnR0VUJywNCiAgICAgICAgICBoZWFkZXJzOiBbIHsgbmFtZTogJ0FjY2VwdCcsIHZhbHVlOiAnYXBwbGljYXRpb24vanNvbicgfSBdDQogICAgICB9Ow0KDQogICAgICB2YXIgZGlzY292ZXJ5X2luZm9fc3RyaW5nID0gYXdhaXQganNvbkh0dHBEYXRhKGh0dHBPcHRpb25zKTsNCiAgICAgIHZhciBkaXNjb3ZlcnlfaW5mbyA9IEpTT04ucGFyc2UoZGlzY292ZXJ5X2luZm9fc3RyaW5nKTsNCiAgICAgIGlmIChkaXNjb3ZlcnlfaW5mby5lcnJvcil7DQogICAgICAgIGFsZXJ0KCdEaXNjb3ZlcnkgaW5mbyBlcnJvciAtIHNlZSBjb25zb2xlIGxvZzogJyArIGRpc2NvdmVyeV9pbmZvLmVycm9yKTsNCiAgICAgIH0NCiAgICB9DQogICAgY2F0Y2ggKGVycil7DQogICAgICB2YXIgZXJyb3IgPSBKU09OLnBhcnNlKGVycik7DQogICAgICBpZiAoZXJyb3Iuc3RhdHVzQ29kZSA9PT0gNDAwKXsNCiAgICAgICAgd2luZG93LmxvY2F0aW9uID0gdGhpcy5hcHBfaW5zdGFuY2VfcGFyYW1zLnRhcmdldF9saW5rX3VyaSArIHNpb3BfY3JlYXRlUGFyYW1ldGVyU3RyaW5nKGVycm9yKTsNCiAgICAgICAgcmV0dXJuOw0KICAgICAgfQ0KICAgIH0NCg0KICAgIHJldHVybiBkaXNjb3ZlcnlfaW5mbzsNCiAgfQ0KDQogIHNldF9yd2xfZGV2aWNlKHN0YXRlKXsNCiAgICBpZiAodHlwZW9mIHN0YXRlID09PSAic3RyaW5nIil7DQogICAgICBpZiAoc3RhdGUudG9Mb3dlckNhc2UoKSA9PT0gInRydWUiKXsNCiAgICAgICAgc3RhdGUgPSB0cnVlOw0KICAgICAgfQ0KICAgICAgZWxzZXsNCiAgICAgICAgc3RhdGUgPSBmYWxzZTsNCiAgICAgIH0NCiAgICB9DQogICAgaWYgKHN0YXRlKXsNCiAgICAgIHNpb3Bfc2V0Q29va2llKCdyd2xfZGV2aWNlJywgc3RhdGUsIDEwKjM2NSwgJy8nKTsNCiAgICB9DQogIH0NCg0KICBhc3luYyBnZXRfYXBwX2xhdW5jaGVyX3VybCgpew0KICAgIGRlYnVnZ2VyOw0KICAgIHZhciBhcHBfbGF1bmNoZXJfY29va2llID0gc2lvcF9nZXRDb29raWUoJ2FwcF9sYXVuY2hlcicpOw0KICAgIGlmIChhcHBfbGF1bmNoZXJfY29va2llKXsNCiAgICAgIHJldHVybiBhcHBfbGF1bmNoZXJfY29va2llOyANCiAgICB9DQoNCiAgICB2YXIgaHR0cE9wdGlvbnMgPSB7DQogICAgICB1cmw6IHRoaXMuYXBwX2NvbmZpZ19wYXJhbXMuY2xpZW50X2FwaV91cmwgKyAnL2FwcF9jb25maWcvJyArICdhcHBfbGF1bmNoZXInLA0KICAgICAgbWV0aG9kOiAnR0VUJywNCiAgICAgICAgaGVhZGVyczogWyB7IG5hbWU6ICdBY2NlcHQnLCB2YWx1ZTogJ2FwcGxpY2F0aW9uL2pzb24nIH0gXSwNCiAgICAgICAgcGFyc2VKc29uUmVzcG9uc2U6IHRydWUNCiAgICB9Ow0KICAgIHZhciBhcHBfbGF1bmNoZXJfY29uZmlnID0gYXdhaXQganNvbkh0dHBEYXRhKGh0dHBPcHRpb25zKTsNCiAgICBzaW9wX3NldENvb2tpZSgnYXBwX2xhdW5jaGVyJywgYXBwX2xhdW5jaGVyX2NvbmZpZy5hcHBsaWNhdGlvbl91cmwsIDM2NSwgJy8nKTsNCiAgICByZXR1cm4gYXBwX2xhdW5jaGVyX2NvbmZpZy5hcHBsaWNhdGlvbl91cmw7DQogIH0NCn0NCg0KZnVuY3Rpb24gc2lvcF9zZXRfaW1nKHFyX2NvZGVfaW5mbyl7DQogIHZhciBzaW9wX3FyX2NvZGVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdzaW9wX3FyX2NvZGUnKTsNCiAgaWYgKCFzaW9wX3FyX2NvZGVFbCl7DQogICAgcmV0dXJuOw0KICB9DQoNCiAgdmFyIHN0eWxlID0gc2lvcF9xcl9jb2RlRWwuZ2V0QXR0cmlidXRlKCdzdHlsZScpOw0KICBzaW9wX3FyX2NvZGVFbC5yZW1vdmVBdHRyaWJ1dGUoInN0eWxlIik7DQoNCiAgdmFyIG9uQ2xpY2tBcmcgPSAnJzsNCiAgdmFyIG9uQ29udGV4dEFyZyA9ICcnOw0KICB2YXIgY3JVcmwgPSBxcl9jb2RlX2luZm8uY3JlZGVudGlhbF9yZXF1ZXN0X3VybDsNCiAgaWYgKGNyVXJsKXsNCiAgICBvbkNsaWNrQXJnID0gJ29uQ2xpY2s9InNpb3Bfc2ltdWxhdGVTY2FuKFwnJyArIGNyVXJsICsgJ1wnKTsiICc7DQogICAgdmFyIGxvYyA9IGNyVXJsLnN1YnN0cmluZygwLCBjclVybC5pbmRleE9mKCcmdGFyZ2V0JykpICsgJyZ0YXJnZXRfbGlua191cmk9L2RlYnVnJzsNCiAgICBvbkNvbnRleHRBcmcgPSAnb25jb250ZXh0bWVudT0ic2lvcF9zaW11bGF0ZVNjYW4oXCcnICsgY3JVcmwgKyAnXCcpO3JldHVybiBmYWxzZTsiICc7DQogIH0NCg0KICB2YXIgaW1hZ2VFbFN0cmluZyA9ICc8aW1nICcgKyBvbkNsaWNrQXJnICsgb25Db250ZXh0QXJnICsgJ19zdHlsZV8gc3JjPSInICsgcXJfY29kZV9pbmZvLnFyX2NvZGUgKyAnIj4nOw0KICB2YXIgc3ViID0gc3R5bGUgPyAnc3R5bGU9IicgKyBzdHlsZSArICciJyA6ICcnOw0KICBpbWFnZUVsU3RyaW5nID0gaW1hZ2VFbFN0cmluZy5yZXBsYWNlKCdfc3R5bGVfJywgc3ViKTsNCiAgc2lvcF9xcl9jb2RlRWwuaW5uZXJIVE1MID0gaW1hZ2VFbFN0cmluZzsNCg0KICBmdW5jdGlvbiBzaW9wX3NpbXVsYXRlU2Nhbihhcmcpew0KICAgIHdpbmRvdy5sb2NhdGlvbiA9IGFyZzsNCiAgfQ0KDQogIGZ1bmN0aW9uIHNpb3Bfbm9MYW5kaW5nUGFnZSgpew0KICAgICAgdmFyIGxvYyA9IHFyX2NvZGVfaW5mby5jcmVkZW50aWFsX3JlcXVlc3RfdXJsOw0KICAgICAgbG9jID0gbG9jLnN1YnN0cmluZygwLCBsb2MuaW5kZXhPZignJnRhcmdldCcpKSArICcmdGFyZ2V0X2xpbmtfdXJpPS9kZWJ1Zyc7DQogICAgICB3aW5kb3cubG9jYXRpb24gPSBsb2M7DQogIH0NCn0NCg0KICANCmZ1bmN0aW9uIHNpb3BfcmVhZF9yZW1vdGVfY29va2llKGlmcmFtZVVybCl7DQogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgdmFyIGxhdW5jaElmcmFtZVN0cmluZyA9ICdcDQogICAgICA8ZGl2IHN0eWxlPSJkaXNwbGF5OiBub25lOyI-XA0KICAgICAgICA8aWZyYW1lIGlkPSJ3YWxsZXRfaWZyYW1lIlwNCiAgICAgICAgICAgIHdpZHRoPSIzMDAiXA0KICAgICAgICAgICAgaGVpZ2h0PSIyMDAiXA0KICAgICAgICAgICAgc3JjPSInICsgaWZyYW1lVXJsICsgJyI-XA0KICAgICAgICA8L2lmcmFtZT5cDQogICAgICA8L2Rpdj4nOw0KICAgIHZhciB0aW1lciA9IHNldFRpbWVvdXQoZnVuY3Rpb24gKCkgew0KICAgICAgcmVqZWN0KCdzbWFydCBjcmVkZW50aWFsIG9mZmxpbmUnKTsNCiAgICB9LCA1MDAwKTsgICANCiAgICB2YXIgbGlzdGVuZXIgPSB3aW5kb3cuYWRkRXZlbnRMaXN0ZW5lcigibWVzc2FnZSIsIChldmVudCkgPT4gew0KICAgICAgY2xlYXJUaW1lb3V0KHRpbWVyKTsNCiAgICAgIHJlc29sdmUoZXZlbnQuZGF0YSk7DQogICAgfSwgZmFsc2UpOw0KICAgIHZhciByZW1vdGVDb29raWVFbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKCdyZW1vdGVfY29va2llX3JlYWRlcicpOw0KICAgIGlmICghcmVtb3RlQ29va2llRWwpew0KICAgICAgYWxlcnQoJ0NvbmZpZ3VyYXRpb24gZXJyb3I6ICByZW1vdGVfY29va2llX3JlYWRlciBkaXYgbXVzdCBiZSBwcmVzZW50IGluIHRoZSBkb2N1bWVudC4nKQ0KICAgICAgdmFyIGZvbyA9IGFib3J0OyAgICAgDQogICAgfQ0KICAgIHJlbW90ZUNvb2tpZUVsLmlubmVySFRNTCA9IGxhdW5jaElmcmFtZVN0cmluZzsNCiAgfSk7DQp9DQoNCmZ1bmN0aW9uIHNpb3Bfc2V0Q29va2llKGNuYW1lLCBjdmFsdWUsIGV4ZGF5cywgcGF0aCkgew0KICBpZiAoIXBhdGgpew0KICAgIHBhdGggPSAnLyc7DQogIH0NCiAgdmFyIGQgPSBuZXcgRGF0ZSgpOw0KICBkLnNldFRpbWUoZC5nZXRUaW1lKCkgKyAoZXhkYXlzKjI0KjYwKjYwKjEwMDApKTsNCiAgdmFyIGV4cGlyZXMgPSAnZXhwaXJlcz0nKyBkLnRvVVRDU3RyaW5nKCk7DQogIGRvY3VtZW50LmNvb2tpZSA9IGNuYW1lICsgJz0nICsgY3ZhbHVlICsgJzsnICsgZXhwaXJlcyArICc7cGF0aD0nICsgcGF0aDsNCn0NCg0KZnVuY3Rpb24gc2lvcF9nZXRDb29raWUoY25hbWUpIHsNCiAgdmFyIG5hbWUgPSBjbmFtZSArICI9IjsNCiAgdmFyIGRlY29kZWRDb29raWUgPSBkZWNvZGVVUklDb21wb25lbnQoZG9jdW1lbnQuY29va2llKTsNCiAgdmFyIGNhID0gZGVjb2RlZENvb2tpZS5zcGxpdCgnOycpOw0KICBmb3IodmFyIGkgPSAwOyBpIDxjYS5sZW5ndGg7IGkrKykgew0KICAgIHZhciBjID0gY2FbaV07DQogICAgd2hpbGUgKGMuY2hhckF0KDApID09ICcgJykgew0KICAgICAgYyA9IGMuc3Vic3RyaW5nKDEpOw0KICAgIH0NCiAgICBpZiAoYy5pbmRleE9mKG5hbWUpID09IDApIHsNCiAgICAgIHJldHVybiBjLnN1YnN0cmluZyhuYW1lLmxlbmd0aCwgYy5sZW5ndGgpOw0KICAgIH0NCiAgfQ0KICByZXR1cm4gIiI7DQp9DQoNCmZ1bmN0aW9uIHNpb3BfcmVtb3ZlQ29va2llcygpIHsNCiAgdmFyIHJlcyA9IGRvY3VtZW50LmNvb2tpZTsNCiAgdmFyIG11bHRpcGxlID0gcmVzLnNwbGl0KCI7Iik7DQogIGZvcih2YXIgaSA9IDA7IGkgPCBtdWx0aXBsZS5sZW5ndGg7IGkrKykgew0KICAgICB2YXIga2V5ID0gbXVsdGlwbGVbaV0uc3BsaXQoIj0iKTsNCi8vICAgICBkb2N1bWVudC5jb29raWUgPSBrZXlbMF0rIj07ZXhwaXJlcz1UaHUsIDAxIEphbiAxOTcwIDAwOjAwOjAwIFVUQyI7DQogICAgIGRvY3VtZW50LmNvb2tpZSA9IGtleVswXSsnPTsgTWF4LUFnZT0tOTk5OTk5OTk7cGF0aD0vJzsgIA0KICB9DQp9DQoNCmZ1bmN0aW9uIHNpb3BfZXJhc2VDb29raWUoY25hbWUpIHsgICANCiAgICBkb2N1bWVudC5jb29raWUgPSBjbmFtZSsnPTsgTWF4LUFnZT0tOTk5OTk5OTk7JzsgIA0KfQ0KDQpmdW5jdGlvbiBqc29uSHR0cERhdGEob3B0aW9ucyl7DQogIHJldHVybiBuZXcgUHJvbWlzZSgocmVzb2x2ZSwgcmVqZWN0KSA9PiB7DQogICAgdmFyIHhociA9IG5ldyBYTUxIdHRwUmVxdWVzdCgpOw0KICAgIHZhciBtZXRob2QgPSBvcHRpb25zLm1ldGhvZDsNCiAgICBpZiAobWV0aG9kID09PSB1bmRlZmluZWQpew0KICAgICAgbWV0aG9kID0gJ0dFVCc7DQogICAgfQ0KICAgIHhoci5vcGVuKG1ldGhvZCwgb3B0aW9ucy51cmwsIHRydWUpOw0KDQogICAgdmFyIGF1dGhvcml6YXRpb25IZWFkZXJQcmVzZW50ID0gZmFsc2U7DQogICAgaWYgKG9wdGlvbnMuaGVhZGVycyAhPT0gdW5kZWZpbmVkKXsNCiAgICAgIGZvciAodmFyIGk9MDsgaSA8IG9wdGlvbnMuaGVhZGVycy5sZW5ndGg7IGkrKyl7DQogICAgICAgIHZhciBoZWFkZXIgPSBvcHRpb25zLmhlYWRlcnNbaV07DQogICAgICAgIGlmIChoZWFkZXIubmFtZSA9PT0gJ0F1dGhvcml6YXRpb24nKXsNCiAgICAgICAgICBhdXRob3JpemF0aW9uSGVhZGVyUHJlc2VudCA9IHRydWU7DQogICAgICAgIH0NCiAgICAgICAgeGhyLnNldFJlcXVlc3RIZWFkZXIoaGVhZGVyLm5hbWUsIGhlYWRlci52YWx1ZSk7DQogICAgICB9DQogICAgfQ0KDQogICAgeGhyLm9ucmVhZHlzdGF0ZWNoYW5nZSA9IGZ1bmN0aW9uICgpIHsNCiAgICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCl7DQogICAgICAgIGlmICh4aHIuc3RhdHVzID09PSAyMDApIHsNCiAgICAgICAgICB2YXIgcmVzdWx0ID0geGhyLnJlc3BvbnNlVGV4dDsNCiAgICAgICAgICBpZiAob3B0aW9ucy5wYXJzZUpzb25SZXNwb25zZSl7DQogICAgICAgICAgICByZXN1bHQgPSBKU09OLnBhcnNlKHJlc3VsdCk7DQogICAgICAgICAgfQ0KICAgICAgICAgIHJlc29sdmUocmVzdWx0KTsNCiAgICAgICAgfQ0KICAgICAgICBlbHNlIHsNCiAgICAgICAgICByZWplY3QoeGhyLnJlc3BvbnNlVGV4dCk7DQogICAgICAgIH0NCiAgICAgIH0NCiAgICB9Ow0KDQogICAgaWYgKGF1dGhvcml6YXRpb25IZWFkZXJQcmVzZW50KXsNCiAgICAgIHhoci53aXRoQ3JlZGVudGlhbHMgPSB0cnVlOw0KICAgIH0NCg0KICAgIGlmIChtZXRob2QudG9VcHBlckNhc2UoKSA9PT0gJ0dFVCcgfHwgb3B0aW9ucy5wb3N0RGF0YSA9PT0gdW5kZWZpbmVkKXsNCiAgICAgIHhoci5zZW5kKCk7DQogICAgfQ0KICAgIGVsc2V7DQogICAgICB2YXIgcG9zdERhdGEgPSBvcHRpb25zLnBvc3REYXRhOw0KICAgICAgaWYgKHR5cGVvZiBwb3N0RGF0YSAhPT0gJ3N0cmluZycpew0KICAgICAgICBwb3N0RGF0YSA9IEpTT04uc3RyaW5naWZ5KHBvc3REYXRhKTsNCiAgICAgIH0NCiAgICAgIHhoci5zZW5kKHBvc3REYXRhKTsgICAgICAgICANCiAgICB9DQogIH0pOw0KfQ0KDQpmdW5jdGlvbiBzaW9wX3ZhbHVlRnJvbUVsZW1lbnRJZChpZCl7DQogIHZhciBwYXJhbUVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOw0KICBpZiAoIXBhcmFtRWwpew0KICAgIGFsZXJ0KCdkb2N1bWVudCBtaXNzaW5nIGVsZW1lbnQgd2l0aCBpZCBbJyArIGlkICsgJ10gaW4gb2lkY19hcHBfaW5zdGFuY2UnKTsNCiAgICB0aHJvdyAoJ3BhcmFtZXRlcl9lcnJvcicpOw0KICB9DQoNCiAgcmV0dXJuIHBhcmFtRWwudmFsdWU7DQp9DQoNCmZ1bmN0aW9uIHNpb3BfY3JlYXRlUGFyYW1ldGVyU3RyaW5nKG9iaiwgZW5jb2RlKXsNCiAgdmFyIGhhbmRsZUVuY29kZTsNCiAgaWYgKGVuY29kZSA9PT0gZmFsc2Upew0KICAgIGhhbmRsZUVuY29kZSA9IGZ1bmN0aW9uKGlucHV0KXsNCiAgICAgIHJldHVybiBpbnB1dDsNCiAgICB9DQogIH0NCiAgZWxzZXsNCiAgICBoYW5kbGVFbmNvZGUgPSBlbmNvZGVVUklDb21wb25lbnQ7ICAgIA0KICB9DQoNCiAgdmFyIHJlc3VsdCA9ICcnOw0KICB2YXIgc2VwYXJhdG9yID0gJz8nOw0KICBmb3IgKHZhciBrZXkgaW4gb2JqKXsNCiAgICB2YXIgdmFsdWUgPSBvYmpba2V5XSA_IGhhbmRsZUVuY29kZShvYmpba2V5XSkgOiAnJzsNCiAgICByZXN1bHQgKz0gc2VwYXJhdG9yICsgaGFuZGxlRW5jb2RlKGtleSkgKyAnPScgKyB2YWx1ZTsNCiAgICBzZXBhcmF0b3IgPSAnJic7DQogIH0NCg0KICByZXR1cm4gcmVzdWx0Ow0KfQ0KDQpmdW5jdGlvbiBhcHBlbmRVUklDb21wb25lbnQodXJsLCBjb21wb25lbnQpew0KICByZXR1cm4gdXJsICsgKHVybC5pbmNsdWRlcygnPycpID8gJyYnIDogJz8nKSArIGNvbXBvbmVudDsNCn0NCg0KZnVuY3Rpb24gcmFuZG9tKG9wdGlvbnMpew0KICBpZiAoIW9wdGlvbnMubGVuZ3RoKXsNCiAgICBvcHRpb25zLmxlbmd0aCA9IDQ4Ow0KICB9DQogICANCiAgdmFyIGFyID0gbmV3IFVpbnQ4QXJyYXkob3B0aW9ucy5sZW5ndGgpOyANCiAgd2luZG93LmNyeXB0by5nZXRSYW5kb21WYWx1ZXMoYXIpOw0KICB2YXIgcmVzdWx0ID0gIiI7DQogIGZvciAodmFyIGk9MDsgaTxvcHRpb25zLmxlbmd0aDsgaSsrKXsNCiAgICAgIHZhciBkaWdpdCA9IGFyW2ldICUgMTA7DQogICAgICByZXN1bHQgKz0gU3RyaW5nLmZyb21DaGFyQ29kZSgweDMwICsgZGlnaXQpOw0KICB9DQoNCiAgcmV0dXJuIHJlc3VsdDsNCn0NCg0KYXN5bmMgZnVuY3Rpb24gcmVkaXJlY3RfdG9fYXBwX2xhdW5jaGVyKGN1cnJlbnRfb2lkY19hcHBfaW5zdGFuY2Upew0KICAgIHZhciBhcHBfbGF1bmNoZXJfdXJsID0gYXdhaXQgY3VycmVudF9vaWRjX2FwcF9pbnN0YW5jZS5nZXRfYXBwX2xhdW5jaGVyX3VybCgpOw0KICAgIGxvY2F0aW9uID0gYXBwX2xhdW5jaGVyX3VybDsNCiAgfQ0K","oidc_protocols.html":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbD4NCjxoZWFkPg0KCTx0aXRsZT5PaWRjIFByb3RvY29sczwvdGl0bGU-DQo8L2hlYWQ-DQo8Ym9keT4NCjxoMj5PSURDIFYyIFByb3RvY29scyBVbmRlciBEZXZlbG9wbWVudDwvaDI-DQo8L2JvZHk-DQo8L2h0bWw-","siop_mqtt_client.js":"dmFyIGNsaWVudF9hcGlfdXJsOw0KdmFyIGNsaWVudF9uYW1lOw0KDQpmdW5jdGlvbiBzaW9wX21xdHRfY2xpZW50KGRpc2NvdmVyeV9pbmZvKXsNCgl2YXIgcndsID0gZGlzY292ZXJ5X2luZm8ucndsOw0KCWlmICghcndsIHx8IHJ3bCA9PT0gJ2ZhbHNlJyl7DQoJCXJldHVybjsNCgl9DQoJY2xpZW50X2FwaV91cmwgPSBkaXNjb3ZlcnlfaW5mby5jbGllbnRfYXBpX3VybDsNCgljbGllbnRfbmFtZSA9IGRpc2NvdmVyeV9pbmZvLmNsaWVudDsNCg0KCXZhciBtcXR0c19zZXJ2ZXJfdXJsID0gbmV3IFVSTChkaXNjb3ZlcnlfaW5mby5tcXR0c19zZXJ2ZXIpOw0KDQoJLy8gYmVmb3JldW5sb2FkIGV2ZW50IGxpc3RlbmVyIG5vdCBvZXJhYmxlIG9uIGNocm9tZQ0KCS8vZGlzY29ubmVjdCB3aWxsIGJlIHVuZ3JhY2VmdWwgaW4gY2FzZSBvZiBwYWdlbG9hZCwgZXRjDQoJY2xpZW50ID0gbmV3IE1lc3NhZ2luZy5DbGllbnQobXF0dHNfc2VydmVyX3VybC5ob3N0bmFtZSwgTnVtYmVyKG1xdHRzX3NlcnZlcl91cmwucG9ydCksIHJ3bCk7DQoJY2xpZW50Lm9uQ29ubmVjdGlvbkxvc3QgPSBvbkNvbm5lY3Rpb25Mb3N0Ow0KCWNsaWVudC5vbk1lc3NhZ2VBcnJpdmVkID0gb25NZXNzYWdlQXJyaXZlZDsNCgljbGllbnQuY29ubmVjdCgNCgkJew0KCQkJdXNlU1NMOiB0cnVlLCANCgkJCW9uU3VjY2Vzczogb25Db25uZWN0LA0KCQkJaW52b2NhdGlvbkNvbnRleHQ6IHsgc3Vic2NyaXB0aW9uOiByd2wgfQ0KCQl9KTsNCn0NCg0KLy8gY2FsbGVkIHdoZW4gdGhlIGNsaWVudCBjb25uZWN0cw0KZnVuY3Rpb24gb25Db25uZWN0KHJlc3BvbnNlKSB7DQogIC8vIE9uY2UgYSBjb25uZWN0aW9uIGhhcyBiZWVuIG1hZGUsIG1ha2UgYSBzdWJzY3JpcHRpb24gYW5kIHNlbmQgYSBtZXNzYWdlLg0KICB2YXIgbXF0dF9jb25uZWN0RWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZCgnbXF0dF9jb25uZWN0Jyk7DQogIGlmIChtcXR0X2Nvbm5lY3RFbCl7DQogIAltcXR0X2Nvbm5lY3RFbC5zZXRBdHRyaWJ1dGUoInN0eWxlIiwgImRpc3BsYXk6YmxvY2siKTsNCiAgfQ0KDQogIHZhciBzdWJzY3JpcHRpb24gPSByZXNwb25zZS5pbnZvY2F0aW9uQ29udGV4dC5zdWJzY3JpcHRpb247DQogIGNsaWVudC5zdWJzY3JpYmUoc3Vic2NyaXB0aW9uKTsNCn0NCg0KLy8gY2FsbGVkIHdoZW4gdGhlIGNsaWVudCBsb3NlcyBpdHMgY29ubmVjdGlvbg0KZnVuY3Rpb24gb25Db25uZWN0aW9uTG9zdChyZXNwb25zZU9iamVjdCkgew0KICBpZiAocmVzcG9uc2VPYmplY3QuZXJyb3JDb2RlICE9PSAwKSB7DQoJY29uc29sZS5sb2coIm9uQ29ubmVjdGlvbkxvc3Q6IityZXNwb25zZU9iamVjdC5lcnJvck1lc3NhZ2UpOw0KICB9DQp9DQoNCi8vIGNhbGxlZCB3aGVuIGEgbWVzc2FnZSBhcnJpdmVzDQpmdW5jdGlvbiBvbk1lc3NhZ2VBcnJpdmVkKG1lc3NhZ2UpIHsNCiAgY29uc29sZS5sb2coIm9uTWVzc2FnZUFycml2ZWQ6IittZXNzYWdlLnBheWxvYWRTdHJpbmcpOw0KICAJdmFyIHJlZGlyZWN0ID0gY2xpZW50X2FwaV91cmwgKyAnL3JlbW90ZV93YWxsZXRfdG9rZW4vJyArIGNsaWVudF9uYW1lDQogIAkJKyAnP3J3bD0nICsgbWVzc2FnZS5wYXlsb2FkU3RyaW5nOw0KICAJd2luZG93LmxvY2F0aW9uID0gcmVkaXJlY3Q7DQp9DQo","trybe_1.0.html":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbD4NCjxoZWFkPg0KCTx0aXRsZT5UcnliZSBPSURDIENsaWVudCBBcGkgMS4wPC90aXRsZT4NCjwvaGVhZD4NCjxib2R5Pg0KPGgyPlRyeWJlIE9JREMgQ2xpZW50IEFwaSAxLjA8L2gyPg0KPC9ib2R5Pg0KPC9odG1sPg"},"views":{"layouts":{"doc.handlebars":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbCBsYW5nPSJlbiI-DQogIDxoZWFkPg0KICAgIDwhLS0gUmVxdWlyZWQgbWV0YSB0YWdzIC0tPg0KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIHNocmluay10by1maXQ9bm8iPg0KDQogICAgPCEtLSBCb290c3RyYXAgQ1NTIC0tPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvYm9vdHN0cmFwLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4NCiAgICA8bGluayBocmVmPSIvY3NzL2Zvcm0tdmFsaWRhdGlvbi5jc3MiIHJlbD0ic3R5bGVzaGVldCI-DQogICAgPGxpbmsgaHJlZj0iL2Nzcy9ib290c3RyYXAtZm9ybWhlbHBlcnMuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvcGVyc29uYWwuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDx0aXRsZT57e3RpdGxlfX08L3RpdGxlPg0KDQogIDwvaGVhZD4NCiAgPGJvZHkgY2xhc3M9ImJnLWxpZ2h0Ij4NCiAgICA8ZGl2IGNsYXNzPSJmbGV4LWNvbnRhaW5lciI-DQogICAgICAgIDxkaXYgY2xhc3M9ImNvbC1zbS04IG10LTMiPg0KICAgICAgICAgIHt7e2JvZHl9fX0NCiAgICAgICAgPC9kaXY-DQogICAgPC9kaXY-DQoNCiAgICA8c2NyaXB0IHNyYz0iL2pzL2NsYWltZXJkb2MuanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvanMvanF1ZXJ5LTMuMi4xLnNsaW0ubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL2pzL3BvcHBlci5taW4uanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvanMvYm9vdHN0cmFwLm1pbi5qcyI-PC9zY3JpcHQ-DQogICAgPHNjcmlwdCBzcmM9Ii9qcy9ib290c3RyYXAtZm9ybWhlbHBlcnMuanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvanMvYm9vdHN0cmFwLWZvcm1oZWxwZXJzLXBob25lLmpzIj48L3NjcmlwdD4NCiAgPC9ib2R5Pg0KPC9odG1sPg","main.handlebars":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbD4NCjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCiAgICA8dGl0bGU-e3t0aXRsZX19PC90aXRsZT4NCg0KICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgPg0KDQoNCjwvaGVhZD4NCjxib2R5Pg0KDQogICAge3t7Ym9keX19fQ0KDQo8L2JvZHk-DQo8L2h0bWw-","main_bootstrap.handlebars":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbCBsYW5nPSJlbiI-DQogIDxoZWFkPg0KICAgIDwhLS0gUmVxdWlyZWQgbWV0YSB0YWdzIC0tPg0KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIHNocmluay10by1maXQ9bm8iPg0KDQogICAgPCEtLSBCb290c3RyYXAgQ1NTIC0tPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvYm9vdHN0cmFwLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4NCiAgICA8bGluayBocmVmPSIvY3NzL2Zvcm0tdmFsaWRhdGlvbi5jc3MiIHJlbD0ic3R5bGVzaGVldCI-DQogICAgPGxpbmsgaHJlZj0iL2Nzcy9ib290c3RyYXAtZm9ybWhlbHBlcnMuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvcGVyc29uYWwuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KDQogICAgPGxpbmsgaHJlZj0iL2Nzcy9mb250YXdlc29tZS9jc3MvZm9udGF3ZXNvbWUuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvZm9udGF3ZXNvbWUvY3NzL3JlZ3VsYXIuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvZm9udGF3ZXNvbWUvY3NzL3NvbGlkLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4NCiAgICA8IS0tbGluayBocmVmPSIvL21heGNkbi5ib290c3RyYXBjZG4uY29tL2ZvbnQtYXdlc29tZS80LjcuMC9jc3MvZm9udC1hd2Vzb21lLm1pbi5jc3MiIHJlbD0ic3R5bGVzaGVldCItLT4NCg0KICAgICA8dGl0bGU-e3t0aXRsZX19PC90aXRsZT4NCiAgPC9oZWFkPg0KICA8Ym9keSBjbGFzcz0iYmctbGlnaHQiPg0KICAgIDxzY3JpcHQgc3JjPSIvanMvanNvbnBhdGguanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvanMvcGFrby5qcyI-PC9zY3JpcHQ-DQogICAgPHNjcmlwdCBzcmM9Ii9qcy9xcmNvZGUuanMiPjwvc2NyaXB0Pg0KDQogICAge3t7Ym9keX19fQ0KDQogICAgPHNjcmlwdCBzcmM9Ii9qcy9qcXVlcnktMy4yLjEuc2xpbS5taW4uanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvanMvcG9wcGVyLm1pbi5qcyI-PC9zY3JpcHQ-DQogICAgPHNjcmlwdCBzcmM9Ii9qcy9ib290c3RyYXAubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL2pzL2Jvb3RzdHJhcC1mb3JtaGVscGVycy5qcyI-PC9zY3JpcHQ-DQogIDwvYm9keT4NCjwvaHRtbD4","main_june.handlebars":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbD4NCjxoZWFkPg0KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCiAgICA8dGl0bGU-e3t0aXRsZX19PC90aXRsZT4NCg0KICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgPg0KDQoNCjwvaGVhZD4NCjxib2R5Pg0KDQogICAge3t7Ym9keX19fQ0KDQo8L2JvZHk-DQo8L2h0bWw-","main_personal.handlebars":"PCFET0NUWVBFIGh0bWw-DQo8aHRtbCBsYW5nPSJlbiI-DQogIDxoZWFkPg0KICAgIDwhLS0gUmVxdWlyZWQgbWV0YSB0YWdzIC0tPg0KICAgIDxtZXRhIGNoYXJzZXQ9InV0Zi04Ij4NCiAgICA8bWV0YSBuYW1lPSJ2aWV3cG9ydCIgY29udGVudD0id2lkdGg9ZGV2aWNlLXdpZHRoLCBpbml0aWFsLXNjYWxlPTEsIHNocmluay10by1maXQ9bm8iPg0KDQogICAgPCEtLSBCb290c3RyYXAgQ1NTIC0tPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvYm9vdHN0cmFwLmNzcyIgcmVsPSJzdHlsZXNoZWV0Ij4NCiAgICA8bGluayBocmVmPSIvY3NzL2Zvcm0tdmFsaWRhdGlvbi5jc3MiIHJlbD0ic3R5bGVzaGVldCI-DQogICAgPGxpbmsgaHJlZj0iL2Nzcy9ib290c3RyYXAtZm9ybWhlbHBlcnMuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDxsaW5rIGhyZWY9Ii9jc3MvcGVyc29uYWwuY3NzIiByZWw9InN0eWxlc2hlZXQiPg0KICAgIDx0aXRsZT57e3RpdGxlfX08L3RpdGxlPg0KDQogIDwvaGVhZD4NCiAgPGJvZHkgY2xhc3M9ImJnLWxpZ2h0Ij4NCiAgICB7e3tib2R5fX19DQoNCiAgICA8c2NyaXB0IHNyYz0iL2pzL2pxdWVyeS0zLjIuMS5zbGltLm1pbi5qcyI-PC9zY3JpcHQ-DQogICAgPHNjcmlwdCBzcmM9Ii9qcy9wb3BwZXIubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL2pzL2Jvb3RzdHJhcC5taW4uanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvanMvYm9vdHN0cmFwLWZvcm1oZWxwZXJzLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL2pzL2Jvb3RzdHJhcC1mb3JtaGVscGVycy1waG9uZS5qcyI-PC9zY3JpcHQ-DQogIDwvYm9keT4NCjwvaHRtbD4","testlab.handlebars":"DQo8IURPQ1RZUEUgaHRtbD4NCjxodG1sIGxhbmc9ImVuIj4NCiAgPGhlYWQ-DQogICAgPG1ldGEgY2hhcnNldD0idXRmLTgiPg0KICAgIDxtZXRhIG5hbWU9InZpZXdwb3J0IiBjb250ZW50PSJ3aWR0aD1kZXZpY2Utd2lkdGgsIGluaXRpYWwtc2NhbGU9MSwgc2hyaW5rLXRvLWZpdD1ubyI-DQoJPGxpbmsgcmVsPSJzdHlsZXNoZWV0IiBocmVmPSIvY3NzL2tpY2tzdGFydC5jc3MiIG1lZGlhPSJhbGwiIC8-DQoNCiAgICA8dGl0bGU-e3t0aXRsZX19PC90aXRsZT4NCg0KCTxzdHlsZSB0eXBlPSJ0ZXh0L2NzcyI-DQoJCS50ZXN0ZXJfb3Agew0KCQkJZmxvYXQ6IGxlZnQ7DQoJCX0NCgkJLnRlc3Rlcl9uYW1lIHsNCgkJCWZsb2F0OiByaWdodDsNCgkJCWNvbG9yOiBncmF5Ow0KCQl9DQoJCS50ZXN0ZXJfY29udGFpbmVyIHsNCgkJICBkaXNwbGF5OiBmbGV4Ow0KCQkgIGp1c3RpZnktY29udGVudDogY2VudGVyOw0KCQl9DQoJCS50ZXN0ZXJfY2VudGVyIHsNCgkJICB3aWR0aDogMTAwJTsNCgkJfQ0KCTwvc3R5bGU-DQoNCg0KCTxzY3JpcHQ-DQoJCWZ1bmN0aW9uIGxvYWRGb3JtVmFsdWVzKGZvcm1UZW1wbGF0ZSwgZm9ybVZhbHVlcyl7DQoJCQljbGVhcl9lcnJvcigpOw0KDQoJCQlmb3IgKHZhciBwYXJhbWV0ZXIgaW4gZm9ybVRlbXBsYXRlKXsNCgkJCQl2YXIgZGVmaW5pdGlvbiA9IGZvcm1UZW1wbGF0ZVtwYXJhbWV0ZXJdOw0KCQkJCXZhciB2YWx1ZSA9ICcnOw0KCQkJCXZhciBpZCA9ICcnOw0KCQkJCXZhciBlbDsNCg0KCQkJCWlmIChmb3JtVmFsdWVzW3BhcmFtZXRlcl0gPT09IHVuZGVmaW5lZCl7DQoJCQkJCWlmIChkZWZpbml0aW9uLmRlZmF1bHQgPT09ICdzdXBwcmVzcyEnKXsNCgkJCQkJCWNvbnRpbnVlOw0KCQkJCQl9DQoJCQkJCWlmIChkZWZpbml0aW9uLmRlZmF1bHQgIT09IHVuZGVmaW5lZCl7DQoJCQkJCQl2YWx1ZSA9IGRlZmluaXRpb24uZGVmYXVsdDsNCgkJCQkJfQ0KCQkJCX0NCgkJCQllbHNlew0KCQkJCQl2YWx1ZSA9IGZvcm1WYWx1ZXNbcGFyYW1ldGVyXTsNCgkJCQl9DQoNCgkJCQlpZiAodmFsdWUgPT09IHVuZGVmaW5lZCl7DQoJCQkJCWNvbnRpbnVlOw0KCQkJCX0NCg0KCQkJCXN3aXRjaCAoZGVmaW5pdGlvbi5pbnB1dCl7DQoJCQkJCWNhc2UgJ3RleHQnOg0KCQkJCQkJLy8gdGV4dCBtYXkgYmUgYSBzaW1wbGUgdGV4dCBwbGFjZWQgaW50byBhIHRleHQgYm94DQoJCQkJCQkvLyBvciBhbiBhcnJheSBvZiB0ZXh0IHBsYWNlZCBpbnRvIGEgdGV4dGFyZWENCgkJCQkJCS8vIG9yIGFuIGFycmF5IG9mIHRleHQgcGxhY2VkIGludG8gYSB0ZXh0IGJveC4uLiAoZS5nLiBzY29wZSkNCgkJCQkJCWVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocGFyYW1ldGVyKTsNCg0KCQkJCQkJaWYgKHR5cGVvZiB2YWx1ZSA9PT0gJ3N0cmluZycpew0KCQkJCQkJCWVsLnZhbHVlID0gdmFsdWU7DQoJCQkJCQl9DQoJCQkJCQllbHNlIGlmIChBcnJheS5pc0FycmF5KHZhbHVlKSl7DQoJCQkJCQkJaWYgKHZhbHVlLmxlbmd0aCA9PT0gdW5kZWZpbmVkKXsNCgkJCQkJCQkJY29udGludWU7DQoJCQkJCQkJfQ0KDQoJCQkJCQkJdmFyIHZhbHVlU2VwYXJhdG9yID0gJyAnOw0KCQkJCQkJCWlmIChkZWZpbml0aW9uLnR5cGUgID09PSAnYXJyYXknKQ0KCQkJCQkJCQl2YWx1ZVNlcGFyYXRvciA9ICdcbic7DQoNCgkJCQkJCQl2YXIgY29udGVudCA9ICcnOw0KCQkJCQkJCXZhciBzZXBhcmF0b3IgPSAnJzsNCgkJCQkJCQlmb3IgKHZhciBpPTA7IGk8dmFsdWUubGVuZ3RoOyBpKyspew0KCQkJCQkJCQl2YXIgbGluZSA9IHZhbHVlW2ldLnRyaW0oKTsNCgkJCQkJCQkJaWYgKGxpbmUubGVuZ3RoID4gMCl7DQoJCQkJCQkJCQljb250ZW50ICs9IHNlcGFyYXRvciArIGxpbmU7DQoJCQkJCQkJCQlzZXBhcmF0b3IgPSB2YWx1ZVNlcGFyYXRvcjsNCgkJCQkJCQkJfQ0KCQkJCQkJCX0JCQkJCQkJCQ0KCQkJCQkJCWVsLnZhbHVlID0gY29udGVudDsNCgkJCQkJCX0NCgkJCQkJCWVsc2Ugew0KCQkJCQkJCWVsLnZhbHVlID0gSlNPTi5zdHJpbmdpZnkodmFsdWUpOw0KCQkJCQkJfQ0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJY2FzZSAnc2VsZWN0JzoNCgkJCQkJCWVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQocGFyYW1ldGVyKTsNCgkJCQkJCWVsLnZhbHVlID0gdmFsdWU7DQoJCQkJCQlicmVhazsNCg0KCQkJCQljYXNlICdib29sZWFuJzoNCgkJCQkJY2FzZSAncmFkaW8nOg0KCQkJCQkJaWYgKHZhbHVlKXsNCgkJCQkJCQlpZCA9IHBhcmFtZXRlciArICdfJyArIHZhbHVlOw0KCQkJCQkJCWVsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoaWQpOw0KCQkJCQkJCWVsLmNoZWNrZWQgPSB0cnVlOwkJCQkJCQkNCgkJCQkJCX0NCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWNhc2UgJ2NoZWNrYm94ZXMnOg0KCQkJCQkJaWYgKHZhbHVlICYmIHZhbHVlLmxlbmd0aCA-IDApew0KCQkJCQkJCWZvciAodmFyIGk9MDsgaSA8IHZhbHVlLmxlbmd0aDsgaSsrKXsNCgkJCQkJCQkJaWQgPSBwYXJhbWV0ZXIgKyAnXycgKyB2YWx1ZVtpXTsNCgkJCQkJCQkJZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChpZCk7DQoJCQkJCQkJCWVsLmNoZWNrZWQgPSB0cnVlOw0KCQkJCQkJCX0NCgkJCQkJCX0NCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWNhc2UgJ2NoZWNrYm94JzoNCgkJCQkJCWlmICh2YWx1ZSl7DQoJCQkJCQkJZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwYXJhbWV0ZXIpOw0KCQkJCQkJCWVsLmNoZWNrZWQgPSB0cnVlOw0KCQkJCQkJfQ0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJY2FzZSAnZmllbGRzZXQnOg0KCQkJCQkJbG9hZEZvcm1WYWx1ZXMoZGVmaW5pdGlvbi5jb250ZW50LCBmb3JtVmFsdWVzKTsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWNhc2UgJ2hpZGRlbic6DQoJCQkJCQkJZWwgPSBkb2N1bWVudC5nZXRFbGVtZW50QnlJZChwYXJhbWV0ZXIpOw0KCQkJCQkJCWVsLnZhbHVlID0gdmFsdWU7DQoNCgkJCQkJZGVmYXVsdDoNCgkJCQkJCWJyZWFrOw0KCQkJCX0NCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIGZsYXR0ZW5UZW1wbGF0ZXMocmVzdWx0LCB0ZW1wbGF0ZSkNCgkJew0KCQkJdmFyIGRlZmluaXRpb247DQoJCQlmb3IgKHZhciBwYXJhbWV0ZXIgaW4gdGVtcGxhdGUpew0KCQkJCWRlZmluaXRpb24gPSB0ZW1wbGF0ZVtwYXJhbWV0ZXJdOw0KCQkJCWlmIChkZWZpbml0aW9uLmlucHV0ID09PSAnZmllbGRzZXQnKXsNCgkJCQkJZmxhdHRlblRlbXBsYXRlcyhyZXN1bHQsIGRlZmluaXRpb24uY29udGVudCk7DQoJCQkJfQ0KCQkJCWVsc2V7DQoJCQkJCXJlc3VsdFtwYXJhbWV0ZXJdID0gZGVmaW5pdGlvbjsNCgkJCQl9DQoJCQl9DQoJCX0NCg0KCQlmdW5jdGlvbiBmb3JtVG9Kc29uKGZvcm1JZCwgZm9ybVRlbXBsYXRlKXsNCgkJCXZhciBmbGF0VGVtcGxhdGUgPSB7fTsNCgkJCWZsYXR0ZW5UZW1wbGF0ZXMoZmxhdFRlbXBsYXRlLCBmb3JtVGVtcGxhdGUpOw0KCQkJdmFyIGZvcm1FbCA9IGRvY3VtZW50LmdldEVsZW1lbnRCeUlkKGZvcm1JZCk7DQoJCQl2YXIgZm9ybUlucHV0cyA9IGZvcm1FbC5nZXRFbGVtZW50c0J5VGFnTmFtZSgnaW5wdXQnKTsNCgkJCXZhciBmb3JtVGV4dEFyZWFzID0gZm9ybUVsLmdldEVsZW1lbnRzQnlUYWdOYW1lKCd0ZXh0YXJlYScpOw0KCQkJdmFyIGZvcm1TZWxlY3RzID0gZm9ybUVsLmdldEVsZW1lbnRzQnlUYWdOYW1lKCdzZWxlY3QnKTsNCgkJCXZhciByZXN1bHQgPSB7fTsNCg0KCQkJZm9yICh2YXIgaT0wOyBpIDwgZm9ybUlucHV0cy5sZW5ndGg7IGkrKyl7DQoJCQkJdmFyIGlucHV0X2VsID0gZm9ybUlucHV0c1tpXTsNCgkJCQl2YXIgbmFtZSA9IGlucHV0X2VsLm5hbWU7DQoJCQkJdmFyIGRlZmluaXRpb24gPSBmbGF0VGVtcGxhdGVbbmFtZV07DQoJCQkJaWYgKGRlZmluaXRpb24gPT09IHVuZGVmaW5lZCkNCgkJCQkJY29udGludWU7DQoNCgkJCQlzd2l0Y2ggKGlucHV0X2VsLnR5cGUpew0KCQkJCQljYXNlICdoaWRkZW4nOg0KCQkJCQljYXNlICd0ZXh0JzoNCgkJCQkJY2FzZSAnc2VsZWN0JzoNCgkJCQkJCWlmIChpbnB1dF9lbC52YWx1ZS5sZW5ndGggIT09IDApDQoJCQkJCQkJcmVzdWx0W25hbWVdID0gaW5wdXRfZWwudmFsdWU7DQoJCQkJCQlicmVhazsNCg0KCQkJCQljYXNlICdib29sZWFuJzoNCgkJCQkJY2FzZSAncmFkaW8nOg0KCQkJCQkJaWYgKGlucHV0X2VsLmNoZWNrZWQpew0KCQkJCQkJCXZhciBwcmVmaXggPSBuYW1lICsgJ18nOw0KCQkJCQkJCXZhbHVlID0gaW5wdXRfZWwuaWQuc3Vic3RyaW5nKHByZWZpeC5sZW5ndGgpOw0KCQkJCQkJCXJlc3VsdFtuYW1lXSA9IHZhbHVlOw0KCQkJCQkJfQkJCQkJCQkNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWNhc2UgJ2NoZWNrYm94JzoNCgkJCQkJCWlmIChpbnB1dF9lbC5jaGVja2VkKXsNCgkJCQkJCQl2YXIgcHJlZml4ID0gbmFtZSArICdfJzsNCgkJCQkJCQlpZiAoaW5wdXRfZWwuaWQuc3RhcnRzV2l0aChwcmVmaXgpKXsNCgkJCQkJCQkJaWYgKHJlc3VsdFtuYW1lXSA9PT0gdW5kZWZpbmVkKXsNCgkJCQkJCQkJCXJlc3VsdFtuYW1lXSA9IFtdOw0KCQkJCQkJCQl9DQoJCQkJCQkJCXZhbHVlID0gaW5wdXRfZWwuaWQuc3Vic3RyaW5nKHByZWZpeC5sZW5ndGgpOw0KCQkJCQkJCQlyZXN1bHRbbmFtZV0ucHVzaCh2YWx1ZSk7DQoJCQkJCQkJfQ0KCQkJCQkJCWVsc2V7DQoJCQkJCQkJCXJlc3VsdFtuYW1lXSA9IHRydWU7DQoJCQkJCQkJfQkJCQkJCQkJDQoJCQkJCQl9DQoJCQkJCQlicmVhazsNCg0KCQkJCQlkZWZhdWx0Og0KCQkJCQkJYnJlYWs7DQoJCQkJfQ0KCQkJfQ0KDQoJCQlmb3IgKHZhciBpPTA7IGkgPCBmb3JtU2VsZWN0cy5sZW5ndGg7IGkrKyl7DQoJCQkJdmFyIHNlbGVjdF9lbCA9IGZvcm1TZWxlY3RzW2ldOw0KCQkJCXZhciBuYW1lID0gc2VsZWN0X2VsLm5hbWU7DQoJCQkJdmFyIGRlZmluaXRpb24gPSBmbGF0VGVtcGxhdGVbbmFtZV07DQoJCQkJaWYgKGRlZmluaXRpb24gPT09IHVuZGVmaW5lZCkNCgkJCQkJY29udGludWU7DQoNCgkJCQlpZiAoc2VsZWN0X2VsLnZhbHVlLmxlbmd0aCAhPT0gMCkNCgkJCQkJcmVzdWx0W25hbWVdID0gc2VsZWN0X2VsLnZhbHVlOw0KCQkJfQ0KDQoJCQlmb3IgKHZhciBpPTA7IGkgPCBmb3JtVGV4dEFyZWFzLmxlbmd0aDsgaSsrKXsNCgkJCQl2YXIgdGV4dEFyZWFfZWwgPSBmb3JtVGV4dEFyZWFzW2ldOw0KCQkJCXZhciBuYW1lID0gdGV4dEFyZWFfZWwubmFtZTsNCgkJCQl2YXIgZGVmaW5pdGlvbiA9IGZsYXRUZW1wbGF0ZVtuYW1lXTsNCgkJCQlpZiAoZGVmaW5pdGlvbiA9PT0gdW5kZWZpbmVkKQ0KCQkJCQljb250aW51ZTsNCg0KCQkJCWlmICh0ZXh0QXJlYV9lbC52YWx1ZS5sZW5ndGggIT09IDApew0KCQkJCQlpZiAoZGVmaW5pdGlvbi50eXBlID09PSAnYXJyYXknKXsNCgkJCQkJCXZhciB2YWx1ZUFycmF5ID0gW107DQoJCQkJCQl2YXIgdGV4dCA9IHRleHRBcmVhX2VsLnZhbHVlOw0KCQkJCQkJdmFyIHRleHRBcnJheSA9IHRleHQuc3BsaXQoJ1xuJyk7DQoJCQkJCQlmb3IgKHZhciBqPTA7IGo8dGV4dEFycmF5Lmxlbmd0aDsgaisrKXsNCgkJCQkJCQlpZiAodGV4dEFycmF5W2pdLmxlbmd0aCA9PT0gMCkNCgkJCQkJCQkJY29udGludWU7DQoJCQkJCQkJdmFsdWVBcnJheS5wdXNoKHRleHRBcnJheVtqXSk7DQoJCQkJCQl9DQoJCQkJCQlyZXN1bHRbbmFtZV0gPSB2YWx1ZUFycmF5Ow0KCQkJCQl9DQoJCQkJCWVsc2V7DQoJCQkJCQlyZXN1bHRbbmFtZV0gPSB0ZXh0QXJlYV9lbC52YWx1ZTsJCQkJCQkNCgkJCQkJfQ0KCQkJCX0NCgkJCX0NCg0KDQoJCQlyZXR1cm4gcmVzdWx0Ow0KCQl9DQoNCgkJZnVuY3Rpb24gY3JlYXRlSW5wdXREaXYoZm9ybUlkLCBmb3JtVGVtcGxhdGUsIGZvcm1WYWx1ZXMpew0KCQkJdmFyIGZvcm1faHRtbCA9ICc8ZGl2PlxyXG4nOw0KCQkJZm9ybV9odG1sICs9IGdlbmVyYXRlSW5wdXRHcm91cGluZ0h0bWwoZm9ybVRlbXBsYXRlLCBmb3JtVmFsdWVzKTsNCgkJCWZvcm1faHRtbCArPSAnPC9kaXY-XHJcbic7DQoNCgkJCXZhciBmb3JtX2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoZm9ybUlkKTsNCgkJCWZvcm1fZWwuaW5uZXJIVE1MID0gZm9ybV9odG1sOw0KCQl9DQoNCgkJZnVuY3Rpb24gZ2VuZXJhdGVJbnB1dEdyb3VwaW5nSHRtbChmb3JtVGVtcGxhdGUsIGZvcm1WYWx1ZXMpew0KCQkJdmFyIGxhYmVsLCBsZWdlbmQsIHZhbHVlLCBpZDsNCgkJCXZhciBncm91cGluZ19odG1sID0gJyc7DQoNCgkJCWZvciAodmFyIHBhcmFtZXRlciBpbiBmb3JtVGVtcGxhdGUpew0KCQkJCXZhciBwYXJhbV9odG1sID0gJyc7DQoJCQkJdmFyIGRlZmluaXRpb24gPSBmb3JtVGVtcGxhdGVbcGFyYW1ldGVyXTsNCgkJCQlpZiAoZm9ybVZhbHVlc1twYXJhbWV0ZXJdID09PSB1bmRlZmluZWQpew0KCQkJCQlpZiAoZGVmaW5pdGlvbi5kZWZhdWx0ID09PSAnc3VwcHJlc3MhJyl7DQoJCQkJCQljb250aW51ZTsNCgkJCQkJfQ0KCQkJCX0NCg0KCQkJCXN3aXRjaCAoZGVmaW5pdGlvbi5pbnB1dCl7DQoJCQkJCWNhc2UgJ3RleHQnOg0KCQkJCQkJbGFiZWwgPSBjcmVhdGVMYWJlbChkZWZpbml0aW9uLCBwYXJhbWV0ZXIpOw0KCQkJCQkJaWYgKGRlZmluaXRpb24udHlwZSA9PT0gdW5kZWZpbmVkIHx8IGRlZmluaXRpb24udHlwZSA9PT0gJ3N0cmluZycpew0KCQkJCQkJCXBhcmFtX2h0bWwgPSBsYWJlbCArICc8aW5wdXQgdHlwZT0idGV4dCIgaWQ9IicgKyBwYXJhbWV0ZXIgKw0KCQkJCQkJCQknIiBuYW1lPSInICsgcGFyYW1ldGVyICsgJyIgLz5cclxuJzsJCQkJCQ0KCQkJCQkJfQ0KCQkJCQkJZWxzZXsNCgkJCQkJCQlwYXJhbV9odG1sID0gbGFiZWwgKyAnPHRleHRhcmVhIHJvd3M9IjIiIGNvbHM9IjYwIiB3cmFwPSJoYXJkIiBpZD0iJyArIHBhcmFtZXRlciArDQoJCQkJCQkJCSciIG5hbWU9IicgKyBwYXJhbWV0ZXIgKyAnIiBzdHlsZT0iaGVpZ2h0OiBhdXRvOyI-PC90ZXh0YXJlYT5cclxuJzsJCQkJCQkJDQoJCQkJCQl9DQoJCQkJCQlicmVhazsNCg0KCQkJCQljYXNlICdyYWRpbyc6DQoJCQkJCQljaGVja1ZhbHVlc0V4aXN0KHBhcmFtZXRlciwgZGVmaW5pdGlvbik7DQoJCQkJCQlsZWdlbmQgPSBjcmVhdGVMZWdlbmQoZGVmaW5pdGlvbiwgcGFyYW1ldGVyKTsNCgkJCQkJCXBhcmFtX2h0bWwgPSAnPGZpZWxkc2V0PlxyXG4nICsgbGVnZW5kOw0KCQkJCQkJZm9yICh2YXIgaT0wOyBpIDwgZGVmaW5pdGlvbi52YWx1ZXMubGVuZ3RoOyBpKyspew0KCQkJCQkJCXZhbHVlID0gZGVmaW5pdGlvbi52YWx1ZXNbaV07DQoJCQkJCQkJaWQgPSBwYXJhbWV0ZXIgKyAnXycgKyB2YWx1ZTsNCgkJCQkJCQlwYXJhbV9odG1sICs9ICc8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9IicgKyBwYXJhbWV0ZXIgKw0KCQkJCQkJCQknIiBpZD0iJyArIGlkICsgJyIgLz5cclxuJyArDQoJCQkJCQkJCSc8bGFiZWwgZm9yPSInICsgaWQgKyAnIiBjbGFzcz0iaW5saW5lIj4nICsgdmFsdWUgKyAnPC9sYWJlbD48YnIvPlxyXG4nOw0KCQkJCQkJfQ0KCQkJCQkJcGFyYW1faHRtbCArPSAnPC9maWVsZHNldD4nDQoJCQkJCQlicmVhazsNCg0KCQkJCQljYXNlICdzZWxlY3QnOg0KCQkJCQkJY2hlY2tWYWx1ZXNFeGlzdChwYXJhbWV0ZXIsIGRlZmluaXRpb24pOw0KCQkJCQkJbGFiZWwgPSBjcmVhdGVMYWJlbChkZWZpbml0aW9uLCBwYXJhbWV0ZXIpOw0KCQkJCQkJcGFyYW1faHRtbCA9IGxhYmVsICsgJzxzZWxlY3QgaWQ9IicgKyBwYXJhbWV0ZXIgKyAnIiBuYW1lPSInICsgcGFyYW1ldGVyICsgJyIgPlxyXG4nOw0KCQkJCQkJZm9yICh2YXIgaT0wOyBpIDwgZGVmaW5pdGlvbi52YWx1ZXMubGVuZ3RoOyBpKyspew0KCQkJCQkJCXZhbHVlID0gZGVmaW5pdGlvbi52YWx1ZXNbaV07DQoJCQkJCQkJcGFyYW1faHRtbCArPSAnPG9wdGlvbiB2YWx1ZT0iJyArIHZhbHVlICsgJyI-JyArIHZhbHVlICsgJzwvb3B0aW9uPlxyXG4nOw0KCQkJCQkJfQ0KCQkJCQkJcGFyYW1faHRtbCArPSAiPC9zZWxlY3Q-XHJcbiI7DQoJCQkJCQlicmVhazsNCg0KCQkJCQljYXNlICdjaGVja2JveGVzJzoNCgkJCQkJCWNoZWNrVmFsdWVzRXhpc3QocGFyYW1ldGVyLCBkZWZpbml0aW9uKTsNCgkJCQkJCWxlZ2VuZCA9IGNyZWF0ZUxlZ2VuZChkZWZpbml0aW9uLCBwYXJhbWV0ZXIpOw0KCQkJCQkJcGFyYW1faHRtbCA9ICc8ZmllbGRzZXQ-XHJcbicgKyBsZWdlbmQ7DQoJCQkJCQlmb3IgKHZhciBpPTA7IGkgPCBkZWZpbml0aW9uLnZhbHVlcy5sZW5ndGg7IGkrKyl7DQoJCQkJCQkJdmFsdWUgPSBkZWZpbml0aW9uLnZhbHVlc1tpXTsNCgkJCQkJCQlpZCA9IHBhcmFtZXRlciArICdfJyArIHZhbHVlOw0KCQkJCQkJCXBhcmFtX2h0bWwgKz0gJzxpbnB1dCB0eXBlPSJjaGVja2JveCIgaWQ9IicgKyBpZCArICciIG5hbWU9IicgKyBwYXJhbWV0ZXIgKyAnIiAvPlxyXG4nICsNCgkJCQkJCQkJJzxsYWJlbCBmb3I9IicgKyBpZCArICciIGNsYXNzPSJpbmxpbmUiPicgKyB2YWx1ZSArICc8L2xhYmVsPjxici8-XHJcbic7DQoJCQkJCQl9DQoJCQkJCQlwYXJhbV9odG1sICs9ICc8L2ZpZWxkc2V0PicNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWNhc2UgJ2NoZWNrYm94JzoNCgkJCQkJCWxhYmVsID0gY3JlYXRlTGFiZWwoZGVmaW5pdGlvbiwgcGFyYW1ldGVyKTsNCgkJCQkJCXBhcmFtX2h0bWwgPSAnPGlucHV0IHR5cGU9ImNoZWNrYm94IiBpZD0iJyArIHBhcmFtZXRlciArIA0KCQkJCQkJCQknIiBuYW1lPSInICsgcGFyYW1ldGVyICsgJyIgLz4gJm5ic3A7Jm5ic3A7JyArIGxhYmVsICsgJzxici8-JzsNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWNhc2UgJ2Jvb2xlYW4nOg0KCQkJCQkJbGVnZW5kID0gY3JlYXRlTGVnZW5kKGRlZmluaXRpb24sIHBhcmFtZXRlcik7DQoJCQkJCQlwYXJhbV9odG1sID0gJzxmaWVsZHNldD5cclxuJyArIGxlZ2VuZDsNCgkJCQkJCXZhciBib29sX3ZhbHVlcyA9IFsndHJ1ZScsICdmYWxzZSddOw0KCQkJCQkJZm9yICh2YXIgaT0wOyBpIDwgYm9vbF92YWx1ZXMubGVuZ3RoOyBpKyspew0KCQkJCQkJCXZhbHVlID0gYm9vbF92YWx1ZXNbaV07DQoJCQkJCQkJaWQgPSBwYXJhbWV0ZXIgKyAnXycgKyB2YWx1ZTsNCgkJCQkJCQlwYXJhbV9odG1sICs9ICc8aW5wdXQgdHlwZT0icmFkaW8iIG5hbWU9IicgKyBwYXJhbWV0ZXIgKw0KCQkJCQkJCQknIiBpZD0iJyArIGlkICsgJyIgLz5cclxuJyArDQoJCQkJCQkJCSc8bGFiZWwgZm9yPSInICsgaWQgKyAnIiBjbGFzcz0iaW5saW5lIj4nICsgdmFsdWUgKyAnJm5ic3A7Jm5ic3A7PC9sYWJlbD5cclxuJzsNCgkJCQkJCX0NCgkJCQkJCXBhcmFtX2h0bWwgKz0gJzwvZmllbGRzZXQ-Jw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJY2FzZSAnZmllbGRzZXQnOg0KCQkJCQkJcGFyYW1faHRtbCA9IGdlbmVyYXRlSW5wdXRHcm91cGluZ0h0bWwoZGVmaW5pdGlvbi5jb250ZW50LCBmb3JtVmFsdWVzKTsNCgkJCQkJCWlmIChwYXJhbV9odG1sLmxlbmd0aCA-IDApew0KCQkJCQkJCWxlZ2VuZCA9IGNyZWF0ZUxlZ2VuZChkZWZpbml0aW9uLCBwYXJhbWV0ZXIpOw0KCQkJCQkJCXBhcmFtX2h0bWwgPSAnPGZpZWxkc2V0PlxyXG4nICsgbGVnZW5kICsgcGFyYW1faHRtbCArDQoJCQkJCQkJCSc8L2ZpZWxkc2V0PlxyXG4nOw0KCQkJCQkJfQ0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJY2FzZSAnYnV0dG9uJzoNCgkJCQkJCWxhYmVsID0gJ1N1Ym1pdCc7DQoJCQkJCQlpZiAoZGVmaW5pdGlvbi5sYWJlbCAhPT0gdW5kZWZpbmVkKXsNCgkJCQkJCQlsYWJlbCA9IGRlZmluaXRpb24ubGFiZWw7DQoJCQkJCQl9DQoJCQkJCQlwYXJhbV9odG1sID0gJzxkaXYgY2xhc3M9ImNvbF8zIj48aW5wdXQgdHlwZT0iYnV0dG9uIiBpZD0ic3VibWl0X2J1dHRvbiIgdmFsdWU9IicgKyBsYWJlbCArIA0KCQkJCQkJCSciIG9uY2xpY2s9IicgKyBkZWZpbml0aW9uLm1ldGhvZCArICciIC8-PC9kaXY-XHJcbic7DQoNCgkJCQkJCWJyZWFrOw0KDQoJCQkJCWNhc2UgJ2hpZGRlbic6DQoJCQkJCQlwYXJhbV9odG1sID0gJzxpbnB1dCB0eXBlPSJoaWRkZW4iIGlkPSInICsgcGFyYW1ldGVyICsgJyIgbmFtZT0iJyArIHBhcmFtZXRlciArICciLz4nOw0KCQkJCQkJYnJlYWs7DQoNCgkJCQkJZGVmYXVsdDoNCgkJCQkJCS8vIHRocm93ICd1bmRlZmluZWQgaW5wdXQgdHlwZSBpbiByZWdfcGFyYW1ldGVyczogJyArIGRlZmluaXRpb24uaW5wdXQNCgkJCQkJCWJyZWFrOw0KCQkJCX0NCg0KCQkJCWdyb3VwaW5nX2h0bWwgKz0gcGFyYW1faHRtbDsNCgkJCX0NCg0KCQkJcmV0dXJuIGdyb3VwaW5nX2h0bWw7DQoJCX0NCg0KCQlmdW5jdGlvbiBjaGVja1ZhbHVlc0V4aXN0KHBhcmFtZXRlciwgZGVmaW5pdGlvbil7DQoJCQlpZiAoZGVmaW5pdGlvbi52YWx1ZXMgPT09IHVuZGVmaW5lZCl7DQoJCQkJYWxlcnQoJ2Zvcm1UZW1wbGF0ZSAnICsgZGVmaW5pdGlvbi5pbnB1dCArICcgInZhbHVlcyIgZm9yICInICsgcGFyYW1ldGVyICsgJyIgaXMgbm90IGRlZmluZWQnKTsNCgkJCQl0aHJvdyAnZXJyb3I6IHZhbHVlcyBtaXNzaW5nJzsNCgkJCX0NCgkJfQ0KDQoJCWZ1bmN0aW9uIGNyZWF0ZUxhYmVsKGRlZmluaXRpb24sIHBhcmFtZXRlcil7DQoJCQl2YXIgdGV4dCA9IHBhcmFtZXRlcjsNCgkJCWlmIChkZWZpbml0aW9uLmxhYmVsICE9PSB1bmRlZmluZWQpDQoJCQkJdGV4dCA9IGRlZmluaXRpb24ubGFiZWw7DQoJCQl2YXIgbGFiZWxfY2xhc3MgPSAnJzsNCgkJCWlmIChkZWZpbml0aW9uLmxhYmVsX2NsYXNzICE9PSB1bmRlZmluZWQpDQoJCQkJbGFiZWxfY2xhc3MgPSAnIGNsYXNzPSInICsgZGVmaW5pdGlvbi5sYWJlbF9jbGFzcyArICciJzsNCgkJCXJldHVybiAnPGxhYmVsIGZvcj0iJyArIHBhcmFtZXRlciArICciJyArIGxhYmVsX2NsYXNzICsgJz4nICsgdGV4dCArICc8L2xhYmVsPlxyXG4nOw0KCQl9DQoNCgkJZnVuY3Rpb24gY3JlYXRlTGVnZW5kKGRlZmluaXRpb24sIHBhcmFtZXRlcil7DQoJCQl2YXIgdGV4dCA9IHBhcmFtZXRlcjsNCgkJCWlmIChkZWZpbml0aW9uLmxlZ2VuZCAhPT0gdW5kZWZpbmVkKQ0KCQkJCXRleHQgPSBkZWZpbml0aW9uLmxlZ2VuZDsNCgkJCXJldHVybiAnPGxlZ2VuZD4nICsgIHRleHQgKyAnPC9sZWdlbmQ-XHJcbic7DQoJCX0NCg0KCQlmdW5jdGlvbiBwb3N0SnNvbkRhdGEob3B0aW9ucywganNvbkRhdGEsIGNhbGxiYWNrKXsNCgkJCXZhciB4aHIgPSBuZXcgWE1MSHR0cFJlcXVlc3QoKTsNCgkJCXZhciB1cmwgPSBvcHRpb25zLnVybDsNCgkJCXhoci5vcGVuKG9wdGlvbnMubWV0aG9kLCBvcHRpb25zLnVybCwgdHJ1ZSk7DQoJCQlpZiAob3B0aW9ucy5oZWFkZXJzICE9PSB1bmRlZmluZWQpew0KCQkJCWZvciAodmFyIGk9MDsgaTxvcHRpb25zLmhlYWRlcnMubGVuZ3RoOyBpKyspew0KCQkJCQl2YXIgaGVhZGVyID0gb3B0aW9ucy5oZWFkZXJzW2ldOw0KCQkJCQl4aHIuc2V0UmVxdWVzdEhlYWRlcihoZWFkZXIubmFtZSwgaGVhZGVyLnZhbHVlKTsNCgkJCQl9DQoJCQl9DQoJCQl4aHIub25yZWFkeXN0YXRlY2hhbmdlID0gZnVuY3Rpb24gKCkgew0KCQkJICAgIGlmICh4aHIucmVhZHlTdGF0ZSA9PT0gNCAmJiB4aHIuc3RhdHVzID09PSAyMDApIHsNCgkJCSAgICAgICAgdmFyIGpzb24gPSBKU09OLnBhcnNlKHhoci5yZXNwb25zZVRleHQpOw0KCQkJICAgICAgICBjYWxsYmFjayhqc29uKTsNCgkJCSAgICB9DQoJCQl9Ow0KDQoJCQl2YXIgZGF0YSA9IEpTT04uc3RyaW5naWZ5KGpzb25EYXRhKTsNCgkJCXhoci5zZW5kKGRhdGEpOwkJIAkNCgkJfQ0KDQoJCWZ1bmN0aW9uIGRpc3BsYXlfZXJyb3IoY29udGVudCl7DQoJCQl2YXIgd2FybmluZ190ZXh0X2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhcm5pbmdfdGV4dCIpOw0KCQkJdmFyIHdhcm5pbmdfZGl2X2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhcm5pbmdfZGl2Iik7DQoJCQlpZiAod2FybmluZ190ZXh0X2VsICE9PSB1bmRlZmluZWQpDQoJCQkJd2FybmluZ190ZXh0X2VsLmlubmVySFRNTCA9IGNvbnRlbnQ7DQoJCQlpZiAod2FybmluZ19kaXZfZWwgIT09IHVuZGVmaW5lZCl7DQoJCQkJd2FybmluZ19kaXZfZWwuc3R5bGUudmlzaWJpbGl0eSA9ICJ2aXNpYmxlIjsJDQoJCQkJd2luZG93LnNjcm9sbFRvKDAsIDApOw0KCQkJfQ0KCQl9DQoNCgkJZnVuY3Rpb24gY2xlYXJfZXJyb3IoY29udGVudCl7DQoJCQl2YXIgd2FybmluZ190ZXh0X2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhcm5pbmdfdGV4dCIpOw0KCQkJdmFyIHdhcm5pbmdfZGl2X2VsID0gZG9jdW1lbnQuZ2V0RWxlbWVudEJ5SWQoIndhcm5pbmdfZGl2Iik7DQoJCQlpZiAod2FybmluZ190ZXh0X2VsICE9PSB1bmRlZmluZWQpDQoJCQkJd2FybmluZ190ZXh0X2VsLmlubmVySFRNTCA9ICcnOw0KCQkJaWYgKHdhcm5pbmdfZGl2X2VsICE9PSB1bmRlZmluZWQpDQoJCQkJd2FybmluZ19kaXZfZWwuc3R5bGUudmlzaWJpbGl0eSA9ICJoaWRkZW4iOwkNCgkJfQ0KCQ0KCQlmdW5jdGlvbiBpc3NldChwYXJhbSl7DQoJCQlpZiAodHlwZW9mIHBhcmFtICE9PSAnb2JqZWN0Jyl7DQoJCQkJaWYgKHBhcmFtID09PSB1bmRlZmluZWQgfHwgcGFyYW0gPT09IG51bGwgfHwgcGFyYW0ubGVuZ3RoID09PSAwKQ0KCQkJCQlyZXR1cm4gZmFsc2U7DQoJCQl9DQoJCQlyZXR1cm4gdHJ1ZTsNCgkJfQ0KCTwvc2NyaXB0Pg0KICA8L2hlYWQ-DQogIDxib2R5Pg0Ke3t7Ym9keX19fQ0KDQogICAgPHNjcmlwdCBzcmM9Ii9qcy9qcXVlcnktMy4yLjEuc2xpbS5taW4uanMiPjwvc2NyaXB0Pg0KICAgIDxzY3JpcHQgc3JjPSIvanMvcG9wcGVyLm1pbi5qcyI-PC9zY3JpcHQ-DQogICAgPHNjcmlwdCBzcmM9Ii9qcy9ib290c3RyYXAubWluLmpzIj48L3NjcmlwdD4NCiAgICA8c2NyaXB0IHNyYz0iL2pzL2Jvb3RzdHJhcC1mb3JtaGVscGVycy5qcyI-PC9zY3JpcHQ-DQogICAgPHNjcmlwdCBzcmM9Ii9qcy9ib290c3RyYXAtZm9ybWhlbHBlcnMtcGhvbmUuanMiPjwvc2NyaXB0Pg0KDQogIDwvYm9keT4NCjwvaHRtbD4"}}}